{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///plugins/src/TrendsBeaconWidget/TrendsBeaconWidget.js","webpack:///webpack/bootstrap a70c41c015926c30d900","webpack:///./plugins/src/TrendsBeaconWidget/index.ts","webpack:///./plugins/src/TrendsBeaconWidget/TrendsBeaconWidget.ts","webpack:///external \"three-charts\""],"names":["webpackUniversalModuleDefinition","root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_2__","modules","installedModules","__webpack_require__","moduleId","id","loaded","call","m","c","p","__export","hasOwnProperty","__extends","d","b","__","constructor","prototype","Object","create","Mesh","THREE","PlaneBufferGeometry","MeshBasicMaterial","three_charts_1","TrendsBeaconWidget","_super","apply","arguments","getTrendWidgetClass","TrendBeacon","widgetName","TrendsWidget","chart","trendName","initObject","data","animations","enabled","animate","updatePosition","widgetIsEnabled","trendOptions","hasBeacon","type","TREND_TYPE","LINE","getObject3D","mesh","onTrendChange","bindEvents","_this","bindEvent","chartState","onScroll","onChange","changedProps","onStateChange","onDestroy","stopAnimation","light","map","createTexture","transparent","scale","set","add","segment","trend","segmentsManager","getEndSegment","animated","object","animationObject","x","opacity","material","setTimeout","animation","TweenLite","to","eventCallback","restart","kill","h","w","Utils","ctx","beginPath","arc","Math","PI","fillStyle","fill","onTransformationFrame","onSegmentsAnimate","trendsSegments","state","xVal","yVal","currentAnimationState","getOptions","endXVal","endYVal","endPointVector","screen","getPointOnChart","screenWidth","width","screenX","getScreenXByPoint","getPointByScreenX","position","y","TrendWidget"],"mappings":"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","file":"plugins/src/TrendsBeaconWidget/TrendsBeaconWidget.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"three-charts\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"three-charts\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TrendsBeaconWidget\"] = factory(require(\"three-charts\"));\n\telse\n\t\troot[\"THREE_CHARTS\"] = root[\"THREE_CHARTS\"] || {}, root[\"THREE_CHARTS\"][\"TrendsBeaconWidget\"] = factory(root[\"three-charts\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"three-charts\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"three-charts\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TrendsBeaconWidget\"] = factory(require(\"three-charts\"));\n\telse\n\t\troot[\"THREE_CHARTS\"] = root[\"THREE_CHARTS\"] || {}, root[\"THREE_CHARTS\"][\"TrendsBeaconWidget\"] = factory(root[\"three-charts\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tfunction __export(m) {\r\n\t    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n\t}\r\n\t__export(__webpack_require__(1));\r\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar PlaneBufferGeometry = THREE.PlaneBufferGeometry;\r\n\tvar MeshBasicMaterial = THREE.MeshBasicMaterial;\r\n\tvar three_charts_1 = __webpack_require__(2);\r\n\t/**\r\n\t * widget adds blinking beacon on trends end\r\n\t * activated when trend.hasBeacon = true\r\n\t */\r\n\tvar TrendsBeaconWidget = (function (_super) {\r\n\t    __extends(TrendsBeaconWidget, _super);\r\n\t    function TrendsBeaconWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsBeaconWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendBeacon;\r\n\t    };\r\n\t    TrendsBeaconWidget.widgetName = 'TrendsBeacon';\r\n\t    return TrendsBeaconWidget;\r\n\t}(three_charts_1.TrendsWidget));\r\n\texports.TrendsBeaconWidget = TrendsBeaconWidget;\r\n\tvar TrendBeacon = (function (_super) {\r\n\t    __extends(TrendBeacon, _super);\r\n\t    function TrendBeacon(chart, trendName) {\r\n\t        _super.call(this, chart, trendName);\r\n\t        this.initObject();\r\n\t        if (chart.data.animations.enabled) {\r\n\t            this.animate();\r\n\t        }\r\n\t        this.updatePosition();\r\n\t    }\r\n\t    TrendBeacon.widgetIsEnabled = function (trendOptions) {\r\n\t        return trendOptions.enabled && trendOptions.hasBeacon && trendOptions.type == three_charts_1.TREND_TYPE.LINE;\r\n\t    };\r\n\t    TrendBeacon.prototype.getObject3D = function () {\r\n\t        return this.mesh;\r\n\t    };\r\n\t    TrendBeacon.prototype.onTrendChange = function () {\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendBeacon.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        _super.prototype.bindEvents.call(this);\r\n\t        this.bindEvent(this.chartState.onScroll(function () { return _this.updatePosition(); }));\r\n\t        this.bindEvent(this.chartState.onChange(function (changedProps) { return _this.onStateChange(changedProps); }));\r\n\t        this.bindEvent(this.chartState.onDestroy(function () { return _this.stopAnimation(); }));\r\n\t    };\r\n\t    TrendBeacon.prototype.initObject = function () {\r\n\t        // add beacon\r\n\t        var light = this.mesh = new Mesh(new PlaneBufferGeometry(32, 32), new MeshBasicMaterial({ map: TrendBeacon.createTexture(), transparent: true }));\r\n\t        light.scale.set(0.2, 0.2, 1);\r\n\t        // add dot\r\n\t        light.add(new Mesh(new PlaneBufferGeometry(5, 5), new MeshBasicMaterial({ map: TrendBeacon.createTexture() })));\r\n\t        this.segment = this.trend.segmentsManager.getEndSegment();\r\n\t    };\r\n\t    TrendBeacon.prototype.animate = function () {\r\n\t        var _this = this;\r\n\t        this.animated = true;\r\n\t        var object = this.mesh;\r\n\t        var animationObject = {\r\n\t            scale: object.scale.x,\r\n\t            opacity: object.material.opacity\r\n\t        };\r\n\t        this.mesh.scale.set(0.1, 0.1, 1);\r\n\t        setTimeout(function () {\r\n\t            var animation = _this.animation = TweenLite.to(animationObject, 1, { scale: 1, opacity: 0 });\r\n\t            animation.eventCallback('onUpdate', function () {\r\n\t                object.scale.set(animationObject.scale, animationObject.scale, 1);\r\n\t                object.material.opacity = animationObject.opacity;\r\n\t            }).eventCallback('onComplete', function () {\r\n\t                _this.animation && animation.restart();\r\n\t            });\r\n\t        }, 500);\r\n\t    };\r\n\t    TrendBeacon.prototype.stopAnimation = function () {\r\n\t        this.animated = false;\r\n\t        this.animation && this.animation.kill();\r\n\t        this.animation = null;\r\n\t    };\r\n\t    TrendBeacon.createTexture = function () {\r\n\t        var h = 32, w = 32;\r\n\t        return three_charts_1.Utils.createTexture(h, w, function (ctx) {\r\n\t            ctx.beginPath();\r\n\t            ctx.arc(w / 2, h / 2, w / 2, 0, 2 * Math.PI, false);\r\n\t            ctx.fillStyle = 'white';\r\n\t            ctx.fill();\r\n\t        });\r\n\t    };\r\n\t    TrendBeacon.prototype.onTransformationFrame = function () {\r\n\t        this.segment = this.trend.segmentsManager.getEndSegment();\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendBeacon.prototype.onSegmentsAnimate = function (trendsSegments) {\r\n\t        this.segment = trendsSegments.getEndSegment();\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendBeacon.prototype.onStateChange = function (changedProps) {\r\n\t        if (!changedProps.animations)\r\n\t            return;\r\n\t        if (changedProps.animations.enabled == void 0 || changedProps.animations.enabled == this.animated)\r\n\t            return;\r\n\t        if (changedProps.animations.enabled) {\r\n\t            this.animate();\r\n\t        }\r\n\t        else {\r\n\t            this.stopAnimation();\r\n\t        }\r\n\t    };\r\n\t    TrendBeacon.prototype.updatePosition = function () {\r\n\t        var state = this.chartState;\r\n\t        var xVal, yVal;\r\n\t        var currentAnimationState = this.segment.currentAnimationState;\r\n\t        if (this.trend.getOptions().type == three_charts_1.TREND_TYPE.LINE) {\r\n\t            xVal = currentAnimationState.endXVal;\r\n\t            yVal = currentAnimationState.endYVal;\r\n\t        }\r\n\t        else {\r\n\t            xVal = currentAnimationState.xVal;\r\n\t            yVal = currentAnimationState.endYVal;\r\n\t        }\r\n\t        var endPointVector = state.screen.getPointOnChart(xVal, yVal);\r\n\t        var screenWidth = state.data.width;\r\n\t        var x = endPointVector.x;\r\n\t        var screenX = state.screen.getScreenXByPoint(endPointVector.x);\r\n\t        if (screenX < 0)\r\n\t            x = state.screen.getPointByScreenX(0);\r\n\t        if (screenX > screenWidth)\r\n\t            x = state.screen.getPointByScreenX(screenWidth);\r\n\t        this.mesh.position.set(x, endPointVector.y, 0.1);\r\n\t    };\r\n\t    return TrendBeacon;\r\n\t}(three_charts_1.TrendWidget));\r\n\texports.TrendBeacon = TrendBeacon;\r\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** plugins/src/TrendsBeaconWidget/TrendsBeaconWidget.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap a70c41c015926c30d900\n **/","export * from './TrendsBeaconWidget';\n\n\n/** WEBPACK FOOTER **\n ** ./plugins/src/TrendsBeaconWidget/index.ts\n **/","import Object3D = THREE.Object3D;\nimport Mesh = THREE.Mesh;\nimport PlaneBufferGeometry = THREE.PlaneBufferGeometry;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport Vector3 = THREE.Vector3;\n\nimport {\n\tUtils,\n\tChart,\n\tIChartState,\n\tTrendsWidget,\n\tTrendWidget,\n\tTrendSegment,\n\tTrendSegmentsManager,\n\tITrendOptions,\n\tTREND_TYPE\n} from 'three-charts';\n\n/**\n * widget adds blinking beacon on trends end\n * activated when trend.hasBeacon = true\n */\nexport class TrendsBeaconWidget extends TrendsWidget<TrendBeacon> {\n\tstatic widgetName = 'TrendsBeacon';\n\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendBeacon;\n\t}\n}\n\nexport class TrendBeacon extends TrendWidget {\n\tprivate mesh: Mesh;\n\tprivate animated: boolean;\n\tprivate segment: TrendSegment;\n\tprivate animation: TweenLite;\n\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions) {\n\t\treturn trendOptions.enabled && trendOptions.hasBeacon && trendOptions.type == TREND_TYPE.LINE;\n\t}\n\n\tconstructor(chart: Chart, trendName: string) {\n\t\tsuper(chart, trendName);\n\n\t\tthis.initObject();\n\t\tif (chart.data.animations.enabled) {\n\t\t\tthis.animate();\n\t\t}\n\t\tthis.updatePosition();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.mesh;\n\t}\n\n\tonTrendChange() {\n\t\tthis.updatePosition();\n\t}\n\n\tprotected bindEvents() {\n\t\tsuper.bindEvents();\n\t\tthis.bindEvent(this.chartState.onScroll(() => this.updatePosition()));\n\t\tthis.bindEvent(this.chartState.onChange(changedProps => this.onStateChange(changedProps)));\n\t\tthis.bindEvent(this.chartState.onDestroy(() => this.stopAnimation()));\n\t}\n\n\tprivate initObject() {\n\n\t\t// add beacon\n\t\tlet light = this.mesh = new Mesh(\n\t\t\tnew PlaneBufferGeometry(32, 32),\n\t\t\tnew MeshBasicMaterial({map: TrendBeacon.createTexture(), transparent: true})\n\t\t);\n\n\n\t\tlight.scale.set(0.2, 0.2, 1);\n\n\t\t// add dot\n\t\tlight.add(new Mesh(\n\t\t\tnew PlaneBufferGeometry(5, 5),\n\t\t\tnew MeshBasicMaterial({map: TrendBeacon.createTexture()})\n\t\t));\n\n\t\tthis.segment = this.trend.segmentsManager.getEndSegment();\n\t}\n\n\tprivate animate() {\n\t\tthis.animated = true;\n\t\tvar object = this.mesh;\n\t\tvar animationObject = {\n\t\t\tscale: object.scale.x,\n\t\t\topacity: object.material.opacity\n\t\t};\n\n\n\t\tthis.mesh.scale.set(0.1, 0.1, 1);\n\n\t\tsetTimeout(() => {\n\t\t\tvar animation = this.animation = TweenLite.to(\n\t\t\t\tanimationObject,\n\t\t\t\t1,\n\t\t\t\t{scale: 1, opacity: 0}\n\t\t\t);\n\t\t\tanimation.eventCallback('onUpdate', () => {\n\t\t\t\tobject.scale.set(animationObject.scale, animationObject.scale, 1);\n\t\t\t\tobject.material.opacity = animationObject.opacity\n\t\t\t}).eventCallback('onComplete', () => {\n\t\t\t\tthis.animation && animation.restart();\n\t\t\t});\n\t\t}, 500);\n\n\t}\n\n\tprivate stopAnimation() {\n\t\tthis.animated = false;\n\t\tthis.animation && this.animation.kill();\n\t\tthis.animation = null;\n\t}\n\n\tprivate static createTexture() {\n\t\tvar h = 32, w = 32;\n\t\treturn Utils.createTexture(h, w, (ctx: CanvasRenderingContext2D) => {\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(w / 2, h / 2, w / 2, 0, 2 * Math.PI, false);\n\t\t\tctx.fillStyle = 'white';\n\t\t\tctx.fill();\n\t\t});\n\t}\n\n\tprotected onTransformationFrame() {\n\t\tthis.segment = this.trend.segmentsManager.getEndSegment();\n\t\tthis.updatePosition();\n\t}\n\n\tprotected onSegmentsAnimate(trendsSegments: TrendSegmentsManager) {\n\t\tthis.segment = trendsSegments.getEndSegment();\n\t\tthis.updatePosition();\n\t}\n\n\tprivate onStateChange(changedProps: IChartState) {\n\t\tif (!changedProps.animations) return;\n\t\tif (changedProps.animations.enabled == void 0 || changedProps.animations.enabled == this.animated) return;\n\t\tif (changedProps.animations.enabled) {\n\t\t\tthis.animate();\n\t\t} else {\n\t\t\tthis.stopAnimation();\n\t\t}\n\t}\n\n\tprivate updatePosition() {\n\t\tvar state = this.chartState;\n\t\tvar xVal: number, yVal: number;\n\t\tvar currentAnimationState = this.segment.currentAnimationState;\n\t\tif (this.trend.getOptions().type == TREND_TYPE.LINE) {\n\t\t\txVal = currentAnimationState.endXVal;\n\t\t\tyVal = currentAnimationState.endYVal;\n\t\t} else {\n\t\t\txVal = currentAnimationState.xVal;\n\t\t\tyVal = currentAnimationState.endYVal;\n\t\t}\n\t\tvar endPointVector = state.screen.getPointOnChart(xVal, yVal);\n\t\tvar screenWidth = state.data.width;\n\t\tvar x = endPointVector.x;\n\t\tvar screenX = state.screen.getScreenXByPoint(endPointVector.x);\n\t\tif (screenX < 0) x = state.screen.getPointByScreenX(0);\n\t\tif (screenX > screenWidth) x = state.screen.getPointByScreenX(screenWidth);\n\t\tthis.mesh.position.set(x, endPointVector.y, 0.1);\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./plugins/src/TrendsBeaconWidget/TrendsBeaconWidget.ts\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"three-charts\"\n ** module id = 2\n ** module chunks = 0 1 2 3\n **/"],"sourceRoot":""}