{"version":3,"sources":["webpack:///webpack/universalModuleDefinition?5ca6***","webpack:///plugins/src/TrendsMarksPlugin/TrendsMarksPlugin.js","webpack:///webpack/bootstrap 42c99628a5403c1c5127?7d64***","webpack:///./plugins/src/TrendsMarksPlugin/index.ts","webpack:///external \"three-charts\"?bed9**","webpack:///./plugins/src/TrendsMarksPlugin/TrendsMarksPlugin.ts","webpack:///./plugins/src/TrendsMarksPlugin/TrendsMarksWidget.ts","webpack:///./src/Easing.ts"],"names":["webpackUniversalModuleDefinition","root","factory","exports","module","require","define","amd","this","__WEBPACK_EXTERNAL_MODULE_2__","modules","installedModules","__webpack_require__","moduleId","id","loaded","call","m","c","p","__export","hasOwnProperty","__extends","d","b","__","constructor","prototype","Object","create","three_charts_1","TrendsMarksWidget_1","Easing_1","TREND_MARK_SIDE","EVENTS","AXIS_MARK_DEFAULT_OPTIONS","trendName","title","color","xVal","orientation","TOP","width","height","margin","ease","EASING","Elastic","Out","easeSpeed","onRender","DEFAULT_RENDERER","TrendsMarksPlugin","_super","trendsMarksPluginOptions","items","rects","onInitialStateAppliedHandler","onMarksChangeHandler","bindEvents","onStateChanged","getOptions","getItems","getItem","markName","createMark","options","marksOptions","newMarkOptions","concat","chart","setState","pluginsState","_a","name","onChange","cb","ee","subscribe","CHANGE","_this","trendsManager","onSegmentsRebuilded","updateMarksSegments","screen","onZoomFrame","calclulateMarksPositions","trendsMarksOptions","actualMarksNames","_i","trendsMarksOptions_1","length","marks","Utils","getUid","toString","push","error","deepMerge","mark","TrendMark","indexOf","createMarkRect","segment","left","getPointOnXAxis","top","getPointOnYAxis","yVal","isTopSideMark","newOffset","row","markRect","hasIntersection","rect","rectsIntersect","_setOffset","_setRow","trends","getTrendMarks","marksArr","xVals","_setSegment","sort","a","trend","getTrend","points","segmentsManager","getSegmentsForXValues","markInd","emit","trendMarks","NAME","providedWidgets","TrendsMarksWidget","ChartPlugin","type","TREND_TYPE","LINE","endXVal","endYVal","maxYVal","minYVal","offset","TrendsMarksPlugin_1","Mesh","THREE","Object3D","LinearFilter","NearestFilter","apply","arguments","getTrendWidgetClass","TrendMarksWidget","widgetName","TrendsWidget","marksWidgets","object3D","onMarksChange","getObject3D","bindEvent","getTrendsMarksPlugin","onTransformationEvent","event","onScreenTransformationEvent","getPlugin","marksItems","widgets","createMarkWidget","destroyMarkWidget","markWidget","TrendMarkWidget","add","remove","onScreenTransformationEventHandler","onZoomFrameHandler","onSegmentsAnimate","TrendWidget","trendMark","initObject","show","texture","createNearestTexture","ctx","magFilter","transformationInProgress","material","MeshBasicMaterial","map","side","FrontSide","transparent","markMesh","PlaneGeometry","updatePosition","TRANSFORMATION_EVENT","STARTED","needsUpdate","posX","posY","position","set","scale","animationManager","animate","from","to","x","y","trendMarkWidget","isTopSide","Color","lineColor","rgbaColor","getTransparent","rgbaStr","centerX","Math","round","centerY","font","state","textOffset","parseInt","textPosX","textPosY","fillStyle","strokeStyle","fillRect","beginPath","arc","PI","fill","lineEndY","moveTo","lineTo","stroke","textAlign","fillText","Linear","None","k","Quadratic","In","InOut","Cubic","Quartic","Quintic","Sinusoidal","cos","sin","Exponential","pow","Circular","sqrt","Back","s","Bounce"],"mappings":"CAAA,SAAAA,iCAAAC,MAAAC;IACA,WAAAC,YAAA,mBAAAC,WAAA,UACAA,OAAAD,UAAAD,QAAAG,QAAA,uBACA,WAAAC,WAAA,cAAAA,OAAAC,KACAD,SAAA,kBAAAJ,eACA,WAAAC,YAAA,UACAA,QAAA,uBAAAD,QAAAG,QAAA,uBAEAJ,KAAA,kBAAAA,KAAA;IAAmDA,KAAA,uCAAAC,QAAAD,KAAA;GAClDO,MAAA,SAAAC;IACD,OCAgB,SAAUC;QCT1B,IAAAC;QAGA,SAAAC,oBAAAC;YAGA,IAAAF,iBAAAE,WACA,OAAAF,iBAAAE,UAAAV;YAGA,IAAAC,SAAAO,iBAAAE;gBACAV;gBACAW,IAAAD;gBACAE,QAAA;;YAIAL,QAAAG,UAAAG,KAAAZ,OAAAD,SAAAC,eAAAD,SAAAS;YAGAR,OAAAW,SAAA;YAGA,OAAAX,OAAAD;;QAKAS,oBAAAK,IAAAP;QAGAE,oBAAAM,IAAAP;QAGAC,oBAAAO,IAAA;QAGA,OAAAP,oBAAA;QDgBM,SAASR,QAAQD,SAASS;QAE/B;QACA,SAASQ,SAASH;YACd,KAAK,IAAIE,KAAKF,GAAG,KAAKd,QAAQkB,eAAeF,IAAIhB,QAAQgB,KAAKF,EAAEE;;QE1DrEC,SAAAR,oBAAc;QACdQ,SAAAR,oBAAc;OFgEP,EAED,SAASR,QAAQD;QGnEvBC,OAAAD,UAAAM;OHwEO,EACA,EAED,SAASL,QAAQD,SAASS;QAE/B;QACA,IAAIU,YAAad,QAAQA,KAAKc,aAAc,SAAUC,GAAGC;YACrD,KAAK,IAAIL,KAAKK,GAAG,IAAIA,EAAEH,eAAeF,IAAII,EAAEJ,KAAKK,EAAEL;YACnD,SAASM;gBAAOjB,KAAKkB,cAAcH;;YACnCA,EAAEI,YAAYH,MAAM,OAAOI,OAAOC,OAAOL,MAAMC,GAAGE,YAAYH,EAAEG,WAAW,IAAIF;;QI/EpF,IAAAK,iBAAAlB,oBAAgG;QAChG,IAAAmB,sBAAAnB,oBAAqE;QACrE,IAAAoB,WAAApB,oBAAuB;SAEvB,SAAYqB;YAAiBA,gCAAA;YAAKA,gCAAA;WAAtB9B,QAAA8B,oBAAA9B,QAAA8B;QAAZ,IAAYA,kBAAA9B,QAAA8B;SACZ,SAAYC;YAAQA,cAAA;WAAR/B,QAAA+B,WAAA/B,QAAA+B;QAAZ,IAAYA,SAAA/B,QAAA+B;QA6BZ,IAAMC;YACLC,WAAW;YACXC,OAAO;YACPC,OAAO;YACPC,MAAM;YACNC,aAAaP,gBAAgBQ;YAC7BC,OAAO;YACPC,QAAQ;YACRC,QAAQ;YACRC,MAAMb,SAAAc,OAAOC,QAAQC;YACrBC,WAAW;YACXC,UAAUnB,oBAAAoB;;QAIX,IAAAC,oBAAA,SAAAC;YAAuC/B,UAAA8B,mBAAAC;YAOtC,SAAAD,kBAAYE;gBACXD,OAAArC,KAAAR,MAAM8C;gBAJC9C,KAAA+C;gBACA/C,KAAAgD;;YAMEJ,kBAAAzB,UAAA8B,+BAAV;gBACCjD,KAAKkD;gBACLlD,KAAKmD;;YAIIP,kBAAAzB,UAAAiC,iBAAV;gBACCpD,KAAKkD;;YAINN,kBAAAzB,UAAAkC,aAAA;gBACC,OAAOR,OAAA1B,UAAMkC,WAAU7C,KAAAR;;YAGxB4C,kBAAAzB,UAAAmC,WAAA;gBACC,OAAOtD,KAAK+C;;YAGbH,kBAAAzB,UAAAoC,UAAA,SAAQC;gBACP,OAAOxD,KAAK+C,MAAMS;;YAGnBZ,kBAAAzB,UAAAsC,aAAA,SAAWC;gBACV,IAAIC,eAAe3D,KAAKqD,aAAaN;gBACrC,IAAIa,iBAAiBD,aAAaE,SAAQH;gBAC1C1D,KAAK8D,MAAMC;oBAAUC,eAAcC,SAACA,GAACjE,KAAKkE;wBAAQnB,OAAOa;uBAAeK;;gBJ+CjE,IAAIA;;YI5CZrB,kBAAAzB,UAAAgD,WAAA,SAASC;gBACR,OAAOpE,KAAKqE,GAAGC,UAAU5C,OAAOA,OAAO6C,SAASH;;YAGvCxB,kBAAAzB,UAAAgC,aAAV;gBAAA,IAAAqB,QAAAxE;gBACCA,KAAK8D,MAAMW,cAAcC,oBAAoB;oBAC5CF,MAAKG;;gBAEN3E,KAAK8D,MAAMc,OAAOC,YAAY;oBAAM,OAAAL,MAAKM;;;YAGlClC,kBAAAzB,UAAA+B,uBAAR;gBACC,IAAI6B,qBAAqB/E,KAAKqD,aAAaN;gBAC3C,IAAIiC;gBACJ,KAAoB,IAAAC,KAAA,GAAAC,uBAAAH,oBAAAE,KAAAC,qBAAAC,QAAAF,MAAmB;oBAAlC,IAAIvB,UAAOwB,qBAAAD;oBACf,IAAIG,QAAQpF,KAAK+C;oBAGjB,KAAKW,QAAQQ,MAAM;wBAClBR,QAAQQ,OAAO5C,eAAA+D,MAAMC,SAASC;wBAC9BP,iBAAiBQ,KAAK9B,QAAQQ;wBAC9B,IAAIkB,MAAM1B,QAAQQ,OAAO5C,eAAA+D,MAAMI,MAAM,0BAA0B/B,QAAQQ;2BACjE,IAAIkB,MAAM1B,QAAQQ,OAAO;wBAC/Bc,iBAAiBQ,KAAK9B,QAAQQ;wBAC9B;;oBAGDR,UAAUpC,eAAA+D,MAAMK,UAAU/D,2BAA2B+B;oBAErD,IAAIiC,OAAO,IAAIC,UAAU5F,KAAK8D,OAAOJ;oBACrC0B,MAAM1B,QAAQQ,QAAQyB;;gBAIvB,KAAK,IAAInC,YAAYxD,KAAK+C,OAAO;oBAChC,IAAIiC,iBAAiBa,QAAQrC,cAAc,GAAG;2BACvCxD,KAAK+C,MAAMS;;gBAEnBxD,KAAK2E;;YAIE/B,kBAAAzB,UAAA2D,2BAAR;gBACC9E,KAAKgD;gBACL,KAAK,IAAIQ,YAAYxD,KAAK+C,OAAO;oBAChC/C,KAAK8F,eAAe9F,KAAK+C,MAAMS;;;YAIzBZ,kBAAAzB,UAAA2E,iBAAR,SAAuBH;gBACtB,KAAKA,KAAKI,SAAS;gBAEnB,IAAIjC,QAAQ9D,KAAK8D;gBACjB,IAAIJ,UAAUiC,KAAKjC;gBACd,IAAAxB,QAAAwB,QAAAxB,OAAOC,SAAAuB,QAAAvB,QAAQ+B,OAAAR,QAAAQ;gBACpB,IAAI8B,OAAOlC,MAAMmC,gBAAgBN,KAAK5D,QAAQG,QAAQ;gBACtD,IAAIgE,MAAMpC,MAAMqC,gBAAgBR,KAAKS;gBACrC,IAAIC,gBAAgB3C,QAAQ1B,eAAeP,gBAAgBQ;gBAC3D,IAAIqE;gBACJ,IAAIC,MAAM;gBAEV,IAAIF,eAAe;oBAClBH,OAAO/D;;gBAGR,IAAIqE,aAAYR,MAAME,KAAKhE,OAAOC;gBAClC,IAAIsE,kBAAkB;gBACtB,GAAG;oBACF,KAAK,IAAIjD,YAAYxD,KAAKgD,OAAO;wBAChC,IAAI0D,OAAO1G,KAAKgD,MAAMQ;wBACtBiD,kBAAkBnF,eAAA+D,MAAMsB,eAAeD,MAAMF;wBAC7C,KAAKC,iBAAiB;wBACtB,IAAIJ,eAAe;4BAClBG,SAAS,KAAKE,KAAK,KAAKF,SAAS,KAAK9C,QAAQtB;+BACxC;4BACNoE,SAAS,KAAKE,KAAK,KAAKA,KAAK,KAAKhD,QAAQtB;;wBAE3CmE;wBACA;;yBAEOE;gBAET,IAAIJ,eAAe;oBAClBC,YAAYE,SAAS,KAAKA,SAAS,KAAK1C,MAAMqC,gBAAgBR,KAAKS;uBAC7D;oBACNE,YAAYxC,MAAMqC,gBAAgBR,KAAKS,QAAQI,SAAS;;gBAGzDb,KAAKiB,WAAWN;gBAChBX,KAAKkB,QAAQN;gBACbvG,KAAKgD,MAAMkB,QAAQsC;;YAGZ5D,kBAAAzB,UAAAwD,sBAAR;gBACC,IAAIb,QAAQ9D,KAAK8D;gBACjB,IAAIgD,SAAShD,MAAMW,cAAcqC;gBACjC,KAAK,IAAIlF,aAAakF,QAAQ;oBAC7B,IAAI1B,QAAQpF,KAAK+G,cAAcnF;oBAC/B,IAAIoF;oBACJ,IAAIC;oBACJ,KAAK,IAAIzD,YAAY4B,OAAO;wBAC3B,IAAIO,OAAOP,MAAM5B;wBACjByD,MAAMzB,KAAKG,KAAKjC,QAAQ3B;wBACxBiF,SAASxB,KAAKG;wBACdA,KAAKuB,YAAY;;oBAElBF,SAASG,KAAK,SAACC,GAAGpG;wBAAM,OAAAoG,EAAE1D,QAAQ3B,OAAOf,EAAE0C,QAAQ3B;;oBACnD,IAAIsF,QAAQvD,MAAMwD,SAAS1F;oBAC3B,IAAI2F,SAASF,MAAMG,gBAAgBC,sBAAsBR,MAAME,KAAK,SAACC,GAAGpG;wBAAM,OAAAoG,IAAIpG;;oBAClF,KAAK,IAAI0G,UAAU,GAAGA,UAAUV,SAAS7B,QAAQuC,WAAW;wBAC3DV,SAASU,SAASR,YAAYK,OAAOG;;;gBAGvC1H,KAAK8E;gBACL9E,KAAKqE,GAAGsD,KAAKjG,OAAOA,OAAO6C;;YAGpB3B,kBAAAzB,UAAA4F,gBAAR,SAAsBnF;gBACrB,IAAIgG;gBACJ,KAAK,IAAIpE,YAAYxD,KAAK+C,OAAO;oBAChC,IAAI/C,KAAK+C,MAAMS,UAAUE,QAAQ9B,aAAaA,WAAW;oBACzDgG,WAAWpC,KAAKxF,KAAK+C,MAAMS;;gBAE5B,OAAOoE;;YAlKDhF,kBAAAiF,OAAO;YACPjF,kBAAAkF,oBAAyCvG,oBAAAwG;YAoKjD,OAAAnF;UAtKuCtB,eAAA0G;QAA1BrI,QAAAiD,oBAAiBA;QAwK9B,IAAAgD,YAAA;YASC,SAAAA,UAAY9B,OAAcJ;gBAH1B1D,KAAAuG,MAAM;gBAILvG,KAAK0D,UAAUA;gBACf1D,KAAK8D,QAAQA;;YAOd8B,UAAAzE,UAAA+F,cAAA,SAAYnB;gBACX/F,KAAK+F,UAAUA;gBACf,KAAKA,SAAS;gBAEd,IAAIsB,QAAQrH,KAAK8D,MAAMwD,SAAStH,KAAK0D,QAAQ9B;gBAE7C,IAAIyF,MAAMhE,aAAa4E,QAAQ3G,eAAA4G,WAAWC,MAAM;oBAC/CnI,KAAK+B,OAAOgE,QAAQqC;oBACpBpI,KAAKoG,OAAOL,QAAQsC;uBACd,IAAIrI,KAAK0D,QAAQ1B,eAAeP,gBAAgBQ,KAAK;oBAC3DjC,KAAK+B,OAAOgE,QAAQhE;oBACpB/B,KAAKoG,OAAOL,QAAQuC;uBACd;oBACNtI,KAAK+B,OAAOgE,QAAQhE;oBACpB/B,KAAKoG,OAAOL,QAAQwC;;;YAItB3C,UAAAzE,UAAAyF,aAAA,SAAW4B;gBACVxI,KAAKwI,SAASA;;YAGf5C,UAAAzE,UAAA0F,UAAA,SAAQN;gBACPvG,KAAKuG,MAAMA;;YAGb,OAAAX;;QA5CajG,QAAAiG,YAASA;OJkFhB,SAAShG,QAAQD,SAASS;QAE/B;QACA,IAAIU,YAAad,QAAQA,KAAKc,aAAc,SAAUC,GAAGC;YACrD,KAAK,IAAIL,KAAKK,GAAG,IAAIA,EAAEH,eAAeF,IAAII,EAAEJ,KAAKK,EAAEL;YACnD,SAASM;gBAAOjB,KAAKkB,cAAcH;;YACnCA,EAAEI,YAAYH,MAAM,OAAOI,OAAOC,OAAOL,MAAMC,GAAGE,YAAYH,EAAEG,WAAW,IAAIF;;QKnTpF,IAAAK,iBAAAlB,oBAAoF;QACpF,IAAAqI,sBAAArI,oBAA8D;QAE9D,IAAOsI,OAAOC,MAAMD;QAKpB,IAAOE,WAAWD,MAAMC;QAOxB,IAAOC,eAAeF,MAAME;QAC5B,IAAOC,gBAAgBH,MAAMG;QAM7B,IAAAf,oBAAA,SAAAlF;YAAuC/B,UAAAiH,mBAAAlF;YAAvC,SAAAkF;gBAAuClF,OAAAkG,MAAA/I,MAAAgJ;;YAE5BjB,kBAAA5G,UAAA8H,sBAAV;gBACC,OAAOC;;YAFDnB,kBAAAoB,aAAa;YAIrB,OAAApB;UALuCzG,eAAA8H;QAA1BzJ,QAAAoI,oBAAiBA;QAU9B,IAAAmB,mBAAA,SAAArG;YAAsC/B,UAAAoI,kBAAArG;YAKrC,SAAAqG,iBAAapF,OAAclC;gBAC1BiB,OAAArC,KAAAR,MAAM8D,OAAOlC;gBAHN5B,KAAAqJ;gBAIPrJ,KAAKsJ,WAAW,IAAIV;gBACpB5I,KAAKuJ;;YAGNL,iBAAA/H,UAAAqI,cAAA;gBACC,OAAOxJ,KAAKsJ;;YAGHJ,iBAAA/H,UAAAgC,aAAV;gBAAA,IAAAqB,QAAAxE;gBACC6C,OAAA1B,UAAMgC,WAAU3C,KAAAR;gBAChBA,KAAKyJ,UAAUzJ,KAAK0J,uBAAuBvF,SAAS;oBAAM,OAAAK,MAAK+E;;gBAC/DvJ,KAAKyJ,UAAUzJ,KAAK8D,MAAMc,OAAO+E,sBAAsB,SAACC;oBAAU,OAAApF,MAAKqF,4BAA4BD;;;YAG5FV,iBAAA/H,UAAAuI,uBAAR;gBACC,OAAO1J,KAAK8D,MAAMgG,UAAUrB,oBAAA7F,kBAAkBiF;;YAGvCqB,iBAAA/H,UAAAoI,gBAAR;gBACC,IAAIQ,aAAa/J,KAAK0J,uBAAuBpG;gBAC7C,IAAI0G,UAAUhK,KAAKqJ;gBACnB,IAAIrE;gBACJ,KAAK,IAAIxB,YAAYuG,YAAY;oBAChC/E,iBAAiBQ,KAAKhC;oBACtB,KAAKwG,QAAQxG,WAAWxD,KAAKiK,iBAAiBF,WAAWvG;;gBAE1D,KAAK,IAAIA,YAAYxD,KAAKqJ,cAAc;oBACvC,IAAIrE,iBAAiBa,QAAQrC,eAAe,GAAG;oBAC/CxD,KAAKkK,kBAAkB1G;;;YAKjB0F,iBAAA/H,UAAA8I,mBAAR,SAAyBtE;gBACxB,KAAKA,KAAKI,SAAS;gBACnB,IAAIoE,aAAa,IAAIC,gBAAgBpK,KAAK8D,OAAO6B;gBACjD3F,KAAKqJ,aAAa1D,KAAKjC,QAAQQ,QAAQiG;gBACvCnK,KAAKsJ,SAASe,IAAIF,WAAWX;;YAGtBN,iBAAA/H,UAAA+I,oBAAR,SAA0B1G;gBACzBxD,KAAKsJ,SAASgB,OAAOtK,KAAKqJ,aAAa7F,UAAUgG;uBAC1CxJ,KAAKqJ,aAAa7F;;YAGlB0F,iBAAA/H,UAAA0I,8BAAR,SAAoCD;gBACnC,IAAII,UAAUhK,KAAKqJ;gBACnB,KAAK,IAAI7F,YAAYwG,SAAS;oBAC7BA,QAAQxG,UAAU+G,mCAAmCX;;;YAI7CV,iBAAA/H,UAAA0D,cAAV;gBACC,IAAImF,UAAUhK,KAAKqJ;gBACnB,KAAK,IAAI7F,YAAYwG,SAAS;oBAC7BA,QAAQxG,UAAUgH;;;YAIVtB,iBAAA/H,UAAAsJ,oBAAV;gBACC,IAAIT,UAAUhK,KAAKqJ;gBACnB,KAAK,IAAI7F,YAAYwG,SAAS;oBAC7BA,QAAQxG,UAAUiH;;;YAIrB,OAAAvB;UAzEsC5H,eAAAoJ;QAAzB/K,QAAAuJ,mBAAgBA;QA8E7B,IAAAkB,kBAAA;YAKC,SAAAA,gBAAYtG,OAAc6G;gBACzB3K,KAAK8D,QAAQA;gBACb9D,KAAK2F,OAAOgF;gBACZ3K,KAAK4K;gBACL5K,KAAK6K;;YAGIT,gBAAAjJ,UAAAyJ,aAAV;gBAAA,IAAApG,QAAAxE;gBACC,IAAI0D,UAAU1D,KAAK2F,KAAKjC;gBACnB,IAAAxB,QAAAwB,QAAAxB,OAAOC,SAAAuB,QAAAvB;gBAEZ,IAAI2I,UAAUxJ,eAAA+D,MAAM0F,qBAAqB7I,OAAOC,QAAQ,SAAC6I;oBACxDtH,QAAQhB,SAAS8B,OAAMwG,KAAKxG,MAAKV;;gBAKlCgH,QAAQG,YAAYjL,KAAK8D,MAAMc,OAAOsG,2BAA2BrC,eAAeC;gBAEhF,IAAIqC,WAAW,IAAIxC,MAAMyC;oBAAoBC,KAAKP;oBAASQ,MAAM3C,MAAM4C;;gBACvEJ,SAASK,cAAc;gBAEvBxL,KAAKyL,WAAW,IAAI/C,KACnB,IAAIC,MAAM+C,cAAcxJ,OAAOC,SAC/BgJ;;YAIFf,gBAAAjJ,UAAAqI,cAAA;gBACC,OAAOxJ,KAAKyL;;YAGbrB,gBAAAjJ,UAAAsJ,oBAAA;gBACCzK,KAAK2L;;YAGNvB,gBAAAjJ,UAAAqJ,qBAAA;gBACCxK,KAAK2L;;YAGNvB,gBAAAjJ,UAAAoJ,qCAAA,SAAmCX;gBAClC,IAAIkB,UAAW9K,KAAKyL,SAASN,SAA+BE;gBAG5DP,QAAQG,YAAarB,SAAStI,eAAAsK,qBAAqBC,UAAWhD,eAAeC;gBAC7EgC,QAAQgB,cAAc;;YAGf1B,gBAAAjJ,UAAAwK,iBAAR;gBACC,KAAK3L,KAAK2F,KAAKI,SAAS;gBACxB,IAAIJ,OAAO3F,KAAK2F;gBAChB,IAAIf,SAAS5E,KAAK8D,MAAMc;gBAExB,IAAImH,OAAOnH,OAAOqB,gBAAgBN,KAAK5D;gBACvC,IAAIiK,OAAOpH,OAAOuB,gBAAgBR,KAAKS;gBAEvCpG,KAAKyL,SAASQ,SAASC,IAAIH,MAAMC,MAAM;;YAGhC5B,gBAAAjJ,UAAA0J,OAAR;gBACC,KAAK7K,KAAK2F,KAAKI,SAAS;gBACxB/F,KAAK2L;gBACL3L,KAAKyL,SAASU,MAAMD,IAAI,KAAM,KAAM;gBAEpClM,KAAK8D,MAAMsI,iBACTC,QAAQ,KAAMrM,KAAK2F,KAAKjC,QAAQrB,MAChCiK,KAAKtM,KAAKyL,SAASU,OACnBI;oBAAIC,GAAG;oBAAGC,GAAG;;;YAEjB,OAAArC;;QA1EazK,QAAAyK,kBAAeA;QA4EfzK,QAAAgD,mBAAmB,SAC/B+J,iBACA1B,KACAlH;YAGA,IAAI6B,OAAO+G,gBAAgB/G;YAC3B,IAAIjC,UAAUiC,KAAKjC;YACnB,IAAIiJ,YAAYjJ,QAAQ1B,eAAeyG,oBAAAhH,gBAAgBQ;YACvD,IAAIH,QAAQ4B,QAAQ5B,eAAe,IAClC,IAAIR,eAAAsL,MAAMlJ,QAAQ5B,SAClB,IAAIR,eAAAsL,MAAM9I,MAAMwD,SAAS5D,QAAQ9B,WAAWyB,aAAawJ;YAC1D,IAAIC,YAAYhL,MAAMiL,eAAe,IAAKC;YACrC,IAAA9K,QAAAwB,QAAAxB,OAAOC,SAAAuB,QAAAvB;YACZ,IAAI8K,UAAUC,KAAKC,MAAMjL,QAAQ;YACjC,IAAIkL,UAAWF,KAAKC,MAAMhL,SAAS;YACnC,IAAIkL,OAAOvJ,MAAMwJ,MAAMD,KAAK5M;YAC5B,IAAI8M,aAAaC,SAASH;YAC1B,IAAII,WAAWR;YACf,IAAIS,WAAWf,YAAYY,aAAa,MAAMpL,SAASoL,aAAa;YAGpEvC,IAAI2C,YAAYb;YAChB9B,IAAI4C,cAAcd;YAClB9B,IAAI6C,SACH,GACAlB,YAAY,IAAIxK,QAChBD,OACAyK,YAAYY,aAAa,KAAKA,aAAa;YAI5CvC,IAAI8C;YACJ9C,IAAI+C,IAAId,SAASG,SAAS,GAAG,GAAG,IAAIF,KAAKc,IAAI;YAC7ChD,IAAIiD;YAGJ,IAAIC,WAAWR;YACf1C,IAAI8C;YACJ9C,IAAImD,OAAOlB,SAASG;YACpBpC,IAAIoD,OAAOnB,SAASiB;YACpBlD,IAAIqD;YAGJrD,IAAI8C;YACJ9C,IAAIsD,YAAY;YAChBtD,IAAIqC,OAAOA;YACXrC,IAAI2C,YAAY;YAChB3C,IAAIuD,SACH7K,QAAQ7B,OACRqL,KAAKC,MAAMM,WACXP,KAAKC,MAAMO;;OL0QP,SAAS9N,QAAQD;QAEtB;QMpfYA,QAAA2C;YAEZkM;gBAECC,MAAM,SAAUC;oBAEf,OAAOA;;;YAMTC;gBAECC,IAAI,SAAUF;oBAEb,OAAOA,IAAIA;;gBAIZlM,KAAK,SAAUkM;oBAEd,OAAOA,KAAK,IAAIA;;gBAIjBG,OAAO,SAAUH;oBAEhB,KAAKA,KAAK,KAAK,GAAG;wBACjB,OAAO,KAAMA,IAAIA;;oBAGlB,QAAS,QAASA,KAAKA,IAAI,KAAK;;;YAMlCI;gBAECF,IAAI,SAAUF;oBAEb,OAAOA,IAAIA,IAAIA;;gBAIhBlM,KAAK,SAAUkM;oBAEd,SAASA,IAAIA,IAAIA,IAAI;;gBAItBG,OAAO,SAAUH;oBAEhB,KAAKA,KAAK,KAAK,GAAG;wBACjB,OAAO,KAAMA,IAAIA,IAAIA;;oBAGtB,OAAO,OAAQA,KAAK,KAAKA,IAAIA,IAAI;;;YAMnCK;gBAECH,IAAI,SAAUF;oBAEb,OAAOA,IAAIA,IAAIA,IAAIA;;gBAIpBlM,KAAK,SAAUkM;oBAEd,OAAO,MAAOA,IAAIA,IAAIA,IAAIA;;gBAI3BG,OAAO,SAAUH;oBAEhB,KAAKA,KAAK,KAAK,GAAG;wBACjB,OAAO,KAAMA,IAAIA,IAAIA,IAAIA;;oBAG1B,QAAS,OAAQA,KAAK,KAAKA,IAAIA,IAAIA,IAAI;;;YAMzCM;gBAECJ,IAAI,SAAUF;oBAEb,OAAOA,IAAIA,IAAIA,IAAIA,IAAIA;;gBAIxBlM,KAAK,SAAUkM;oBAEd,SAASA,IAAIA,IAAIA,IAAIA,IAAIA,IAAI;;gBAI9BG,OAAO,SAAUH;oBAEhB,KAAKA,KAAK,KAAK,GAAG;wBACjB,OAAO,KAAMA,IAAIA,IAAIA,IAAIA,IAAIA;;oBAG9B,OAAO,OAAQA,KAAK,KAAKA,IAAIA,IAAIA,IAAIA,IAAI;;;YAM3CO;gBAECL,IAAI,SAAUF;oBAEb,OAAO,IAAIxB,KAAKgC,IAAIR,IAAIxB,KAAKc,KAAK;;gBAInCxL,KAAK,SAAUkM;oBAEd,OAAOxB,KAAKiC,IAAIT,IAAIxB,KAAKc,KAAK;;gBAI/Ba,OAAO,SAAUH;oBAEhB,OAAO,MAAO,IAAIxB,KAAKgC,IAAIhC,KAAKc,KAAKU;;;YAMvCU;gBAECR,IAAI,SAAUF;oBAEb,OAAOA,MAAM,IAAI,IAAIxB,KAAKmC,IAAI,MAAMX,IAAI;;gBAIzClM,KAAK,SAAUkM;oBAEd,OAAOA,MAAM,IAAI,IAAI,IAAIxB,KAAKmC,IAAI,IAAK,KAAKX;;gBAI7CG,OAAO,SAAUH;oBAEhB,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,KAAKA,KAAK,KAAK,GAAG;wBACjB,OAAO,KAAMxB,KAAKmC,IAAI,MAAMX,IAAI;;oBAGjC,OAAO,OAASxB,KAAKmC,IAAI,IAAK,MAAMX,IAAI,MAAM;;;YAMhDY;gBAECV,IAAI,SAAUF;oBAEb,OAAO,IAAIxB,KAAKqC,KAAK,IAAIb,IAAIA;;gBAI9BlM,KAAK,SAAUkM;oBAEd,OAAOxB,KAAKqC,KAAK,MAAOb,IAAIA;;gBAI7BG,OAAO,SAAUH;oBAEhB,KAAKA,KAAK,KAAK,GAAG;wBACjB,QAAS,MAAOxB,KAAKqC,KAAK,IAAIb,IAAIA,KAAK;;oBAGxC,OAAO,MAAOxB,KAAKqC,KAAK,KAAKb,KAAK,KAAKA,KAAK;;;YAM9CnM;gBAECqM,IAAI,SAAUF;oBAEb,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,QAAQxB,KAAKmC,IAAI,GAAG,MAAMX,IAAI,MAAMxB,KAAKiC,KAAKT,IAAI,OAAO,IAAIxB,KAAKc;;gBAInExL,KAAK,SAAUkM;oBAEd,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,OAAOxB,KAAKmC,IAAI,IAAI,KAAKX,KAAKxB,KAAKiC,KAAKT,IAAI,MAAO,IAAIxB,KAAKc,MAAM;;gBAInEa,OAAO,SAAUH;oBAEhB,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGR,IAAIA,MAAM,GAAG;wBACZ,OAAO;;oBAGRA,KAAK;oBAEL,IAAIA,IAAI,GAAG;wBACV,QAAQ,KAAMxB,KAAKmC,IAAI,GAAG,MAAMX,IAAI,MAAMxB,KAAKiC,KAAKT,IAAI,OAAO,IAAIxB,KAAKc;;oBAGzE,OAAO,KAAMd,KAAKmC,IAAI,IAAI,MAAMX,IAAI,MAAMxB,KAAKiC,KAAKT,IAAI,OAAO,IAAIxB,KAAKc,MAAM;;;YAMhFwB;gBAECZ,IAAI,SAAUF;oBAEb,IAAIe,IAAI;oBAER,OAAOf,IAAIA,MAAMe,IAAI,KAAKf,IAAIe;;gBAI/BjN,KAAK,SAAUkM;oBAEd,IAAIe,IAAI;oBAER,SAASf,IAAIA,MAAMe,IAAI,KAAKf,IAAIe,KAAK;;gBAItCZ,OAAO,SAAUH;oBAEhB,IAAIe,IAAI,UAAU;oBAElB,KAAKf,KAAK,KAAK,GAAG;wBACjB,OAAO,MAAOA,IAAIA,MAAMe,IAAI,KAAKf,IAAIe;;oBAGtC,OAAO,OAAQf,KAAK,KAAKA,MAAMe,IAAI,KAAKf,IAAIe,KAAK;;;YAMnDC;gBAECd,IAAI,SAAUF;oBAEb,OAAO,IAAI/O,QAAA2C,OAAOoN,OAAOlN,IAAI,IAAIkM;;gBAIlClM,KAAK,SAAUkM;oBAEd,IAAIA,IAAK,IAAI,MAAO;wBACnB,OAAO,SAASA,IAAIA;2BACd,IAAIA,IAAK,IAAI,MAAO;wBAC1B,OAAO,UAAUA,KAAM,MAAM,QAASA,IAAI;2BACpC,IAAIA,IAAK,MAAM,MAAO;wBAC5B,OAAO,UAAUA,KAAM,OAAO,QAASA,IAAI;2BACrC;wBACN,OAAO,UAAUA,KAAM,QAAQ,QAASA,IAAI;;;gBAK9CG,OAAO,SAAUH;oBAEhB,IAAIA,IAAI,IAAK;wBACZ,OAAO/O,QAAA2C,OAAOoN,OAAOd,GAAGF,IAAI,KAAK;;oBAGlC,OAAO/O,QAAA2C,OAAOoN,OAAOlN,IAAIkM,IAAI,IAAI,KAAK,KAAM","file":"plugins/src/TrendsMarksPlugin/TrendsMarksPlugin.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"three-charts\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"three-charts\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TrendsMarksPlugin\"] = factory(require(\"three-charts\"));\n\telse\n\t\troot[\"THREE_CHARTS\"] = root[\"THREE_CHARTS\"] || {}, root[\"THREE_CHARTS\"][\"TrendsMarksPlugin\"] = factory(root[\"three-charts\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"three-charts\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"three-charts\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"TrendsMarksPlugin\"] = factory(require(\"three-charts\"));\n\telse\n\t\troot[\"THREE_CHARTS\"] = root[\"THREE_CHARTS\"] || {}, root[\"THREE_CHARTS\"][\"TrendsMarksPlugin\"] = factory(root[\"three-charts\"]);\n})(this, function(__WEBPACK_EXTERNAL_MODULE_2__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tfunction __export(m) {\r\n\t    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n\t}\r\n\t__export(__webpack_require__(5));\r\n\t__export(__webpack_require__(6));\r\n\n\n/***/ },\n/* 1 */,\n/* 2 */\n/***/ function(module, exports) {\n\n\tmodule.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n/***/ },\n/* 3 */,\n/* 4 */,\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar three_charts_1 = __webpack_require__(2);\r\n\tvar TrendsMarksWidget_1 = __webpack_require__(6);\r\n\tvar Easing_1 = __webpack_require__(7);\r\n\t(function (TREND_MARK_SIDE) {\r\n\t    TREND_MARK_SIDE[TREND_MARK_SIDE[\"TOP\"] = 0] = \"TOP\";\r\n\t    TREND_MARK_SIDE[TREND_MARK_SIDE[\"BOTTOM\"] = 1] = \"BOTTOM\";\r\n\t})(exports.TREND_MARK_SIDE || (exports.TREND_MARK_SIDE = {}));\r\n\tvar TREND_MARK_SIDE = exports.TREND_MARK_SIDE;\r\n\t(function (EVENTS) {\r\n\t    EVENTS[EVENTS[\"CHANGE\"] = 0] = \"CHANGE\";\r\n\t})(exports.EVENTS || (exports.EVENTS = {}));\r\n\tvar EVENTS = exports.EVENTS;\r\n\tvar AXIS_MARK_DEFAULT_OPTIONS = {\r\n\t    trendName: '',\r\n\t    title: '',\r\n\t    color: 'rgba(#0099d9, 0.5)',\r\n\t    xVal: 0,\r\n\t    orientation: TREND_MARK_SIDE.TOP,\r\n\t    width: 105,\r\n\t    height: 100,\r\n\t    margin: 10,\r\n\t    ease: Easing_1.EASING.Elastic.Out,\r\n\t    easeSpeed: 1000,\r\n\t    onRender: TrendsMarksWidget_1.DEFAULT_RENDERER\r\n\t};\r\n\tvar TrendsMarksPlugin = (function (_super) {\r\n\t    __extends(TrendsMarksPlugin, _super);\r\n\t    function TrendsMarksPlugin(trendsMarksPluginOptions) {\r\n\t        _super.call(this, trendsMarksPluginOptions);\r\n\t        this.items = {};\r\n\t        this.rects = {};\r\n\t    }\r\n\t    TrendsMarksPlugin.prototype.onInitialStateAppliedHandler = function () {\r\n\t        this.onMarksChangeHandler();\r\n\t        this.bindEvents();\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.onStateChanged = function () {\r\n\t        this.onMarksChangeHandler();\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.getOptions = function () {\r\n\t        return _super.prototype.getOptions.call(this);\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.getItems = function () {\r\n\t        return this.items;\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.getItem = function (markName) {\r\n\t        return this.items[markName];\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.createMark = function (options) {\r\n\t        var marksOptions = this.getOptions().items;\r\n\t        var newMarkOptions = marksOptions.concat([options]);\r\n\t        this.chart.setState({ pluginsState: (_a = {}, _a[this.name] = { items: newMarkOptions }, _a) });\r\n\t        var _a;\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.onChange = function (cb) {\r\n\t        return this.ee.subscribe(EVENTS[EVENTS.CHANGE], cb);\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.chart.trendsManager.onSegmentsRebuilded(function () {\r\n\t            _this.updateMarksSegments();\r\n\t        });\r\n\t        this.chart.screen.onZoomFrame(function () { return _this.calclulateMarksPositions(); });\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.onMarksChangeHandler = function () {\r\n\t        var trendsMarksOptions = this.getOptions().items;\r\n\t        var actualMarksNames = [];\r\n\t        for (var _i = 0, trendsMarksOptions_1 = trendsMarksOptions; _i < trendsMarksOptions_1.length; _i++) {\r\n\t            var options = trendsMarksOptions_1[_i];\r\n\t            var marks = this.items;\r\n\t            // set mark name\r\n\t            if (!options.name) {\r\n\t                options.name = three_charts_1.Utils.getUid().toString();\r\n\t                actualMarksNames.push(options.name);\r\n\t                if (marks[options.name])\r\n\t                    three_charts_1.Utils.error('duplicated mark name ' + options.name);\r\n\t            }\r\n\t            else if (marks[options.name]) {\r\n\t                actualMarksNames.push(options.name);\r\n\t                continue;\r\n\t            }\r\n\t            options = three_charts_1.Utils.deepMerge(AXIS_MARK_DEFAULT_OPTIONS, options);\r\n\t            var mark = new TrendMark(this.chart, options);\r\n\t            marks[options.name] = mark;\r\n\t        }\r\n\t        // delete not relevant marks\r\n\t        for (var markName in this.items) {\r\n\t            if (actualMarksNames.indexOf(markName) != -1)\r\n\t                continue;\r\n\t            delete this.items[markName];\r\n\t        }\r\n\t        this.updateMarksSegments();\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.calclulateMarksPositions = function () {\r\n\t        this.rects = {};\r\n\t        for (var markName in this.items) {\r\n\t            this.createMarkRect(this.items[markName]);\r\n\t        }\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.createMarkRect = function (mark) {\r\n\t        if (!mark.segment)\r\n\t            return;\r\n\t        var chart = this.chart;\r\n\t        var options = mark.options;\r\n\t        var width = options.width, height = options.height, name = options.name;\r\n\t        var left = chart.getPointOnXAxis(mark.xVal) - width / 2;\r\n\t        var top = chart.getPointOnYAxis(mark.yVal);\r\n\t        var isTopSideMark = options.orientation == TREND_MARK_SIDE.TOP;\r\n\t        var newOffset;\r\n\t        var row = 0;\r\n\t        if (isTopSideMark) {\r\n\t            top += height;\r\n\t        }\r\n\t        var markRect = [left, top, width, height];\r\n\t        var hasIntersection = false;\r\n\t        do {\r\n\t            for (var markName in this.rects) {\r\n\t                var rect = this.rects[markName];\r\n\t                hasIntersection = three_charts_1.Utils.rectsIntersect(rect, markRect);\r\n\t                if (!hasIntersection)\r\n\t                    continue;\r\n\t                if (isTopSideMark) {\r\n\t                    markRect[1] = rect[1] + markRect[3] + options.margin;\r\n\t                }\r\n\t                else {\r\n\t                    markRect[1] = rect[1] - rect[3] - options.margin;\r\n\t                }\r\n\t                row++;\r\n\t                break;\r\n\t            }\r\n\t        } while (hasIntersection);\r\n\t        if (isTopSideMark) {\r\n\t            newOffset = markRect[1] - markRect[3] - chart.getPointOnYAxis(mark.yVal);\r\n\t        }\r\n\t        else {\r\n\t            newOffset = chart.getPointOnYAxis(mark.yVal) - markRect[1];\r\n\t        }\r\n\t        mark._setOffset(newOffset);\r\n\t        mark._setRow(row);\r\n\t        this.rects[name] = markRect;\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.updateMarksSegments = function () {\r\n\t        var chart = this.chart;\r\n\t        var trends = chart.trendsManager.trends;\r\n\t        for (var trendName in trends) {\r\n\t            var marks = this.getTrendMarks(trendName);\r\n\t            var marksArr = [];\r\n\t            var xVals = [];\r\n\t            for (var markName in marks) {\r\n\t                var mark = marks[markName];\r\n\t                xVals.push(mark.options.xVal);\r\n\t                marksArr.push(mark);\r\n\t                mark._setSegment(null);\r\n\t            }\r\n\t            marksArr.sort(function (a, b) { return a.options.xVal - b.options.xVal; });\r\n\t            var trend = chart.getTrend(trendName);\r\n\t            var points = trend.segmentsManager.getSegmentsForXValues(xVals.sort(function (a, b) { return a - b; }));\r\n\t            for (var markInd = 0; markInd < marksArr.length; markInd++) {\r\n\t                marksArr[markInd]._setSegment(points[markInd]);\r\n\t            }\r\n\t        }\r\n\t        this.calclulateMarksPositions();\r\n\t        this.ee.emit(EVENTS[EVENTS.CHANGE]);\r\n\t    };\r\n\t    TrendsMarksPlugin.prototype.getTrendMarks = function (trendName) {\r\n\t        var trendMarks = [];\r\n\t        for (var markName in this.items) {\r\n\t            if (this.items[markName].options.trendName != trendName)\r\n\t                continue;\r\n\t            trendMarks.push(this.items[markName]);\r\n\t        }\r\n\t        return trendMarks;\r\n\t    };\r\n\t    TrendsMarksPlugin.NAME = 'TrendsMarks';\r\n\t    TrendsMarksPlugin.providedWidgets = [TrendsMarksWidget_1.TrendsMarksWidget];\r\n\t    return TrendsMarksPlugin;\r\n\t}(three_charts_1.ChartPlugin));\r\n\texports.TrendsMarksPlugin = TrendsMarksPlugin;\r\n\tvar TrendMark = (function () {\r\n\t    function TrendMark(chart, options) {\r\n\t        this.row = 0;\r\n\t        this.options = options;\r\n\t        this.chart = chart;\r\n\t    }\r\n\t    /**\r\n\t     * only for internal usage\r\n\t     */\r\n\t    TrendMark.prototype._setSegment = function (segment) {\r\n\t        this.segment = segment;\r\n\t        if (!segment)\r\n\t            return;\r\n\t        var trend = this.chart.getTrend(this.options.trendName);\r\n\t        if (trend.getOptions().type == three_charts_1.TREND_TYPE.LINE) {\r\n\t            this.xVal = segment.endXVal;\r\n\t            this.yVal = segment.endYVal;\r\n\t        }\r\n\t        else if (this.options.orientation == TREND_MARK_SIDE.TOP) {\r\n\t            this.xVal = segment.xVal;\r\n\t            this.yVal = segment.maxYVal;\r\n\t        }\r\n\t        else {\r\n\t            this.xVal = segment.xVal;\r\n\t            this.yVal = segment.minYVal;\r\n\t        }\r\n\t    };\r\n\t    TrendMark.prototype._setOffset = function (offset) {\r\n\t        this.offset = offset;\r\n\t    };\r\n\t    TrendMark.prototype._setRow = function (row) {\r\n\t        this.row = row;\r\n\t    };\r\n\t    return TrendMark;\r\n\t}());\r\n\texports.TrendMark = TrendMark;\r\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar three_charts_1 = __webpack_require__(2);\r\n\tvar TrendsMarksPlugin_1 = __webpack_require__(5);\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar Object3D = THREE.Object3D;\r\n\tvar LinearFilter = THREE.LinearFilter;\r\n\tvar NearestFilter = THREE.NearestFilter;\r\n\t/**\r\n\t * widget for drawing trends marks for all trends\r\n\t */\r\n\tvar TrendsMarksWidget = (function (_super) {\r\n\t    __extends(TrendsMarksWidget, _super);\r\n\t    function TrendsMarksWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsMarksWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendMarksWidget;\r\n\t    };\r\n\t    TrendsMarksWidget.widgetName = \"TrendsMarks\";\r\n\t    return TrendsMarksWidget;\r\n\t}(three_charts_1.TrendsWidget));\r\n\texports.TrendsMarksWidget = TrendsMarksWidget;\r\n\t/**\r\n\t * widget for drawing trend marks for one trend\r\n\t */\r\n\tvar TrendMarksWidget = (function (_super) {\r\n\t    __extends(TrendMarksWidget, _super);\r\n\t    function TrendMarksWidget(chart, trendName) {\r\n\t        _super.call(this, chart, trendName);\r\n\t        this.marksWidgets = {};\r\n\t        this.object3D = new Object3D();\r\n\t        this.onMarksChange();\r\n\t    }\r\n\t    TrendMarksWidget.prototype.getObject3D = function () {\r\n\t        return this.object3D;\r\n\t    };\r\n\t    TrendMarksWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        _super.prototype.bindEvents.call(this);\r\n\t        this.bindEvent(this.getTrendsMarksPlugin().onChange(function () { return _this.onMarksChange(); }));\r\n\t        this.bindEvent(this.chart.screen.onTransformationEvent(function (event) { return _this.onScreenTransformationEvent(event); }));\r\n\t    };\r\n\t    TrendMarksWidget.prototype.getTrendsMarksPlugin = function () {\r\n\t        return this.chart.getPlugin(TrendsMarksPlugin_1.TrendsMarksPlugin.NAME);\r\n\t    };\r\n\t    TrendMarksWidget.prototype.onMarksChange = function () {\r\n\t        var marksItems = this.getTrendsMarksPlugin().getItems();\r\n\t        var widgets = this.marksWidgets;\r\n\t        var actualMarksNames = [];\r\n\t        for (var markName in marksItems) {\r\n\t            actualMarksNames.push(markName);\r\n\t            if (!widgets[markName])\r\n\t                this.createMarkWidget(marksItems[markName]);\r\n\t        }\r\n\t        for (var markName in this.marksWidgets) {\r\n\t            if (actualMarksNames.indexOf(markName) !== -1)\r\n\t                continue;\r\n\t            this.destroyMarkWidget(markName);\r\n\t        }\r\n\t    };\r\n\t    TrendMarksWidget.prototype.createMarkWidget = function (mark) {\r\n\t        if (!mark.segment)\r\n\t            return;\r\n\t        var markWidget = new TrendMarkWidget(this.chart, mark);\r\n\t        this.marksWidgets[mark.options.name] = markWidget;\r\n\t        this.object3D.add(markWidget.getObject3D());\r\n\t    };\r\n\t    TrendMarksWidget.prototype.destroyMarkWidget = function (markName) {\r\n\t        this.object3D.remove(this.marksWidgets[markName].getObject3D());\r\n\t        delete this.marksWidgets[markName];\r\n\t    };\r\n\t    TrendMarksWidget.prototype.onScreenTransformationEvent = function (event) {\r\n\t        var widgets = this.marksWidgets;\r\n\t        for (var markName in widgets) {\r\n\t            widgets[markName].onScreenTransformationEventHandler(event);\r\n\t        }\r\n\t    };\r\n\t    TrendMarksWidget.prototype.onZoomFrame = function () {\r\n\t        var widgets = this.marksWidgets;\r\n\t        for (var markName in widgets) {\r\n\t            widgets[markName].onZoomFrameHandler();\r\n\t        }\r\n\t    };\r\n\t    TrendMarksWidget.prototype.onSegmentsAnimate = function () {\r\n\t        var widgets = this.marksWidgets;\r\n\t        for (var markName in widgets) {\r\n\t            widgets[markName].onSegmentsAnimate();\r\n\t        }\r\n\t    };\r\n\t    return TrendMarksWidget;\r\n\t}(three_charts_1.TrendWidget));\r\n\texports.TrendMarksWidget = TrendMarksWidget;\r\n\t/**\r\n\t * widget for drawing one trend mark\r\n\t */\r\n\tvar TrendMarkWidget = (function () {\r\n\t    function TrendMarkWidget(chart, trendMark) {\r\n\t        this.chart = chart;\r\n\t        this.mark = trendMark;\r\n\t        this.initObject();\r\n\t        this.show();\r\n\t    }\r\n\t    TrendMarkWidget.prototype.initObject = function () {\r\n\t        var _this = this;\r\n\t        var options = this.mark.options;\r\n\t        var width = options.width, height = options.height;\r\n\t        var texture = three_charts_1.Utils.createNearestTexture(width, height, function (ctx) {\r\n\t            options.onRender(_this, ctx, _this.chart);\r\n\t        });\r\n\t        // make text sharp when screen is not transforming\r\n\t        texture.magFilter = this.chart.screen.transformationInProgress ? LinearFilter : NearestFilter;\r\n\t        var material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.FrontSide });\r\n\t        material.transparent = true;\r\n\t        this.markMesh = new Mesh(new THREE.PlaneGeometry(width, height), material);\r\n\t    };\r\n\t    TrendMarkWidget.prototype.getObject3D = function () {\r\n\t        return this.markMesh;\r\n\t    };\r\n\t    TrendMarkWidget.prototype.onSegmentsAnimate = function () {\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendMarkWidget.prototype.onZoomFrameHandler = function () {\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendMarkWidget.prototype.onScreenTransformationEventHandler = function (event) {\r\n\t        var texture = this.markMesh.material.map;\r\n\t        // make text sharp when screen is not transforming\r\n\t        texture.magFilter = (event == three_charts_1.TRANSFORMATION_EVENT.STARTED) ? LinearFilter : NearestFilter;\r\n\t        texture.needsUpdate = true;\r\n\t    };\r\n\t    TrendMarkWidget.prototype.updatePosition = function () {\r\n\t        if (!this.mark.segment)\r\n\t            return;\r\n\t        var mark = this.mark;\r\n\t        var screen = this.chart.screen;\r\n\t        var posX = screen.getPointOnXAxis(mark.xVal);\r\n\t        var posY = screen.getPointOnYAxis(mark.yVal);\r\n\t        this.markMesh.position.set(posX, posY, 0);\r\n\t    };\r\n\t    TrendMarkWidget.prototype.show = function () {\r\n\t        if (!this.mark.segment)\r\n\t            return;\r\n\t        this.updatePosition();\r\n\t        this.markMesh.scale.set(0.01, 0.01, 1);\r\n\t        this.chart.animationManager\r\n\t            .animate(1000, this.mark.options.ease)\r\n\t            .from(this.markMesh.scale)\r\n\t            .to({ x: 1, y: 1 });\r\n\t    };\r\n\t    return TrendMarkWidget;\r\n\t}());\r\n\texports.TrendMarkWidget = TrendMarkWidget;\r\n\texports.DEFAULT_RENDERER = function (trendMarkWidget, ctx, chart) {\r\n\t    var mark = trendMarkWidget.mark;\r\n\t    var options = mark.options;\r\n\t    var isTopSide = options.orientation == TrendsMarksPlugin_1.TREND_MARK_SIDE.TOP;\r\n\t    var color = options.color !== void 0 ?\r\n\t        new three_charts_1.Color(options.color) :\r\n\t        new three_charts_1.Color(chart.getTrend(options.trendName).getOptions().lineColor);\r\n\t    var rgbaColor = color.getTransparent(0.5).rgbaStr;\r\n\t    var width = options.width, height = options.height;\r\n\t    var centerX = Math.round(width / 2);\r\n\t    var centerY = Math.round(height / 2);\r\n\t    var font = chart.state.font.m;\r\n\t    var textOffset = parseInt(font);\r\n\t    var textPosX = centerX;\r\n\t    var textPosY = isTopSide ? textOffset * 1.3 : height - textOffset * 0.7;\r\n\t    // draw rect\r\n\t    ctx.fillStyle = rgbaColor;\r\n\t    ctx.strokeStyle = rgbaColor;\r\n\t    ctx.fillRect(0, isTopSide ? 0 : height, width, isTopSide ? textOffset * 2 : -textOffset * 2);\r\n\t    // draw dot\r\n\t    ctx.beginPath();\r\n\t    ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI, false);\r\n\t    ctx.fill();\r\n\t    // draw line\r\n\t    var lineEndY = textPosY;\r\n\t    ctx.beginPath();\r\n\t    ctx.moveTo(centerX, centerY);\r\n\t    ctx.lineTo(centerX, lineEndY);\r\n\t    ctx.stroke();\r\n\t    // draw text\r\n\t    ctx.beginPath();\r\n\t    ctx.textAlign = 'center';\r\n\t    ctx.font = font;\r\n\t    ctx.fillStyle = 'rgba(250, 250, 250, 0.8)';\r\n\t    ctx.fillText(options.title, Math.round(textPosX), Math.round(textPosY));\r\n\t    // uncomment to preview mark rect\r\n\t    // ctx.rect(0, 0, width, height);\r\n\t    // ctx.stroke();\r\n\t};\r\n\n\n/***/ },\n/* 7 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\t/**\r\n\t * Easing from tween.js lib https://github.com/tweenjs/tween.js\r\n\t **/\r\n\texports.EASING = {\r\n\t    Linear: {\r\n\t        None: function (k) {\r\n\t            return k;\r\n\t        }\r\n\t    },\r\n\t    Quadratic: {\r\n\t        In: function (k) {\r\n\t            return k * k;\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return k * (2 - k);\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if ((k *= 2) < 1) {\r\n\t                return 0.5 * k * k;\r\n\t            }\r\n\t            return -0.5 * (--k * (k - 2) - 1);\r\n\t        }\r\n\t    },\r\n\t    Cubic: {\r\n\t        In: function (k) {\r\n\t            return k * k * k;\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return --k * k * k + 1;\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if ((k *= 2) < 1) {\r\n\t                return 0.5 * k * k * k;\r\n\t            }\r\n\t            return 0.5 * ((k -= 2) * k * k + 2);\r\n\t        }\r\n\t    },\r\n\t    Quartic: {\r\n\t        In: function (k) {\r\n\t            return k * k * k * k;\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return 1 - (--k * k * k * k);\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if ((k *= 2) < 1) {\r\n\t                return 0.5 * k * k * k * k;\r\n\t            }\r\n\t            return -0.5 * ((k -= 2) * k * k * k - 2);\r\n\t        }\r\n\t    },\r\n\t    Quintic: {\r\n\t        In: function (k) {\r\n\t            return k * k * k * k * k;\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return --k * k * k * k * k + 1;\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if ((k *= 2) < 1) {\r\n\t                return 0.5 * k * k * k * k * k;\r\n\t            }\r\n\t            return 0.5 * ((k -= 2) * k * k * k * k + 2);\r\n\t        }\r\n\t    },\r\n\t    Sinusoidal: {\r\n\t        In: function (k) {\r\n\t            return 1 - Math.cos(k * Math.PI / 2);\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return Math.sin(k * Math.PI / 2);\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            return 0.5 * (1 - Math.cos(Math.PI * k));\r\n\t        }\r\n\t    },\r\n\t    Exponential: {\r\n\t        In: function (k) {\r\n\t            return k === 0 ? 0 : Math.pow(1024, k - 1);\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if (k === 0) {\r\n\t                return 0;\r\n\t            }\r\n\t            if (k === 1) {\r\n\t                return 1;\r\n\t            }\r\n\t            if ((k *= 2) < 1) {\r\n\t                return 0.5 * Math.pow(1024, k - 1);\r\n\t            }\r\n\t            return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);\r\n\t        }\r\n\t    },\r\n\t    Circular: {\r\n\t        In: function (k) {\r\n\t            return 1 - Math.sqrt(1 - k * k);\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            return Math.sqrt(1 - (--k * k));\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if ((k *= 2) < 1) {\r\n\t                return -0.5 * (Math.sqrt(1 - k * k) - 1);\r\n\t            }\r\n\t            return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\r\n\t        }\r\n\t    },\r\n\t    Elastic: {\r\n\t        In: function (k) {\r\n\t            if (k === 0) {\r\n\t                return 0;\r\n\t            }\r\n\t            if (k === 1) {\r\n\t                return 1;\r\n\t            }\r\n\t            return -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            if (k === 0) {\r\n\t                return 0;\r\n\t            }\r\n\t            if (k === 1) {\r\n\t                return 1;\r\n\t            }\r\n\t            return Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if (k === 0) {\r\n\t                return 0;\r\n\t            }\r\n\t            if (k === 1) {\r\n\t                return 1;\r\n\t            }\r\n\t            k *= 2;\r\n\t            if (k < 1) {\r\n\t                return -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\r\n\t            }\r\n\t            return 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\r\n\t        }\r\n\t    },\r\n\t    Back: {\r\n\t        In: function (k) {\r\n\t            var s = 1.70158;\r\n\t            return k * k * ((s + 1) * k - s);\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            var s = 1.70158;\r\n\t            return --k * k * ((s + 1) * k + s) + 1;\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            var s = 1.70158 * 1.525;\r\n\t            if ((k *= 2) < 1) {\r\n\t                return 0.5 * (k * k * ((s + 1) * k - s));\r\n\t            }\r\n\t            return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\r\n\t        }\r\n\t    },\r\n\t    Bounce: {\r\n\t        In: function (k) {\r\n\t            return 1 - exports.EASING.Bounce.Out(1 - k);\r\n\t        },\r\n\t        Out: function (k) {\r\n\t            if (k < (1 / 2.75)) {\r\n\t                return 7.5625 * k * k;\r\n\t            }\r\n\t            else if (k < (2 / 2.75)) {\r\n\t                return 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\r\n\t            }\r\n\t            else if (k < (2.5 / 2.75)) {\r\n\t                return 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\r\n\t            }\r\n\t            else {\r\n\t                return 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\r\n\t            }\r\n\t        },\r\n\t        InOut: function (k) {\r\n\t            if (k < 0.5) {\r\n\t                return exports.EASING.Bounce.In(k * 2) * 0.5;\r\n\t            }\r\n\t            return exports.EASING.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\r\n\t        }\r\n\t    }\r\n\t};\r\n\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** plugins/src/TrendsMarksPlugin/TrendsMarksPlugin.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 42c99628a5403c1c5127\n **/","export * from './TrendsMarksPlugin';\nexport * from './TrendsMarksWidget';\n\n\n\n/** WEBPACK FOOTER **\n ** ./plugins/src/TrendsMarksPlugin/index.ts\n **/","module.exports = __WEBPACK_EXTERNAL_MODULE_2__;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"three-charts\"\n ** module id = 2\n ** module chunks = 1 2 3 4\n **/","\nimport Vector3 = THREE.Vector3;\nimport { ChartPlugin, ChartWidget, TrendSegment, TREND_TYPE, Utils, Chart, TColor, TEase } from 'three-charts';\nimport { TrendsMarksWidget, DEFAULT_RENDERER, TrendMarkWidget } from './TrendsMarksWidget';\nimport { EASING } from \"../../../src/Easing\";\n\nexport enum TREND_MARK_SIDE {TOP, BOTTOM}\nexport enum EVENTS {CHANGE}\nexport type TTrendsMarksPluginOptions = {items: ITrendMarkOptions[]};\n\nexport interface ITrendMarkOptions {\n\ttrendName: string,\n\txVal: number,\n\ttitle?: string,\n\tname?: string,\n\tcolor?: TColor,\n\torientation?: TREND_MARK_SIDE,\n\twidth?: number,\n\theight?: number,\n\t/**\n\t * space between marks\n\t */\n\tmargin?: number,\n\t/**\n\t * custom render function\n\t */\n\tonRender?: (\n\t\ttrendMarkWidget: TrendMarkWidget,\n\t\tctx: CanvasRenderingContext2D,\n\t\tchart: Chart\n\t) => any,\n\tease?: TEase,\n\teaseSpeed?: number,\n\tuserData?: any\n}\n\nconst AXIS_MARK_DEFAULT_OPTIONS: ITrendMarkOptions = {\n\ttrendName: '',\n\ttitle: '',\n\tcolor: 'rgba(#0099d9, 0.5)',\n\txVal: 0,\n\torientation: TREND_MARK_SIDE.TOP,\n\twidth: 105,\n\theight: 100,\n\tmargin: 10,\n\tease: EASING.Elastic.Out,\n\teaseSpeed: 1000,\n\tonRender: DEFAULT_RENDERER\n};\n\n\nexport class TrendsMarksPlugin extends ChartPlugin {\n\tstatic NAME = 'TrendsMarks';\n\tstatic providedWidgets: typeof ChartWidget[] = [TrendsMarksWidget];\n\n\tprivate items: {[name: string]: TrendMark} = {};\n\tprivate rects: {[name: string]: number[]} = {};\n\n\tconstructor(trendsMarksPluginOptions: TTrendsMarksPluginOptions) {\n\t\tsuper(trendsMarksPluginOptions);\n\t}\n\n\tprotected onInitialStateAppliedHandler() {\n\t\tthis.onMarksChangeHandler();\n\t\tthis.bindEvents();\n\t}\n\n\n\tprotected onStateChanged() {\n\t\tthis.onMarksChangeHandler();\n\t}\n\n\n\tgetOptions(): TTrendsMarksPluginOptions {\n\t\treturn super.getOptions() as TTrendsMarksPluginOptions;\n\t}\n\n\tgetItems() {\n\t\treturn this.items;\n\t}\n\n\tgetItem(markName: string) {\n\t\treturn this.items[markName];\n\t}\n\n\tcreateMark(options: ITrendMarkOptions) {\n\t\tvar marksOptions = this.getOptions().items;\n\t\tvar newMarkOptions = marksOptions.concat([options]);\n\t\tthis.chart.setState({pluginsState: {[this.name]: {items: newMarkOptions}}});\n\t}\n\n\tonChange(cb: () => any) {\n\t\treturn this.ee.subscribe(EVENTS[EVENTS.CHANGE], cb);\n\t}\n\n\tprotected bindEvents() {\n\t\tthis.chart.trendsManager.onSegmentsRebuilded(() => {\n\t\t\tthis.updateMarksSegments()\n\t\t});\n\t\tthis.chart.screen.onZoomFrame(() => this.calclulateMarksPositions());\n\t}\n\n\tprivate onMarksChangeHandler() {\n\t\tvar trendsMarksOptions = this.getOptions().items;\n\t\tlet actualMarksNames: string[] = [];\n\t\tfor (let options of trendsMarksOptions) {\n\t\t\tvar marks = this.items;\n\n\t\t\t// set mark name\n\t\t\tif (!options.name) {\n\t\t\t\toptions.name = Utils.getUid().toString();\n\t\t\t\tactualMarksNames.push(options.name);\n\t\t\t\tif (marks[options.name]) Utils.error('duplicated mark name ' + options.name);\n\t\t\t} else if (marks[options.name]) {\n\t\t\t\tactualMarksNames.push(options.name);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\toptions = Utils.deepMerge(AXIS_MARK_DEFAULT_OPTIONS, options);\n\n\t\t\tlet mark = new TrendMark(this.chart, options);\n\t\t\tmarks[options.name] = mark;\n\t\t}\n\n\t\t// delete not relevant marks\n\t\tfor (let markName in this.items) {\n\t\t\tif (actualMarksNames.indexOf(markName) != -1) continue;\n\t\t\tdelete this.items[markName];\n\t\t}\n\t\tthis.updateMarksSegments();\n\t}\n\n\n\tprivate calclulateMarksPositions() {\n\t\tthis.rects = {};\n\t\tfor (let markName in this.items) {\n\t\t\tthis.createMarkRect(this.items[markName]);\n\t\t}\n\t}\n\n\tprivate createMarkRect(mark: TrendMark) {\n\t\tif (!mark.segment) return;\n\n\t\tlet chart = this.chart;\n\t\tlet options = mark.options;\n\t\tlet {width, height, name} = options;\n\t\tlet left = chart.getPointOnXAxis(mark.xVal) - width / 2;\n\t\tlet top = chart.getPointOnYAxis(mark.yVal);\n\t\tlet isTopSideMark = options.orientation == TREND_MARK_SIDE.TOP;\n\t\tlet newOffset: number;\n\t\tlet row = 0;\n\n\t\tif (isTopSideMark) {\n\t\t\ttop += height;\n\t\t}\n\n\t\tlet markRect = [left, top, width, height];\n\t\tlet hasIntersection = false;\n\t\tdo {\n\t\t\tfor (let markName in this.rects) {\n\t\t\t\tlet rect = this.rects[markName];\n\t\t\t\thasIntersection = Utils.rectsIntersect(rect, markRect);\n\t\t\t\tif (!hasIntersection) continue;\n\t\t\t\tif (isTopSideMark) {\n\t\t\t\t\tmarkRect[1] = rect[1] + markRect[3] + options.margin;\n\t\t\t\t} else {\n\t\t\t\t\tmarkRect[1] = rect[1] - rect[3] - options.margin;\n\t\t\t\t}\n\t\t\t\trow++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} while (hasIntersection);\n\n\t\tif (isTopSideMark) {\n\t\t\tnewOffset = markRect[1] - markRect[3] - chart.getPointOnYAxis(mark.yVal);\n\t\t} else {\n\t\t\tnewOffset = chart.getPointOnYAxis(mark.yVal) - markRect[1];\n\t\t}\n\n\t\tmark._setOffset(newOffset);\n\t\tmark._setRow(row);\n\t\tthis.rects[name] = markRect;\n\t}\n\n\tprivate updateMarksSegments() {\n\t\tlet chart = this.chart;\n\t\tlet trends = chart.trendsManager.trends;\n\t\tfor (let trendName in trends) {\n\t\t\tvar marks = this.getTrendMarks(trendName);\n\t\t\tvar marksArr: TrendMark[] = [];\n\t\t\tvar xVals: number[] = [];\n\t\t\tfor (let markName in marks) {\n\t\t\t\tlet mark = marks[markName];\n\t\t\t\txVals.push(mark.options.xVal);\n\t\t\t\tmarksArr.push(mark);\n\t\t\t\tmark._setSegment(null);\n\t\t\t}\n\t\t\tmarksArr.sort((a, b) => a.options.xVal - b.options.xVal);\n\t\t\tlet trend = chart.getTrend(trendName);\n\t\t\tlet points = trend.segmentsManager.getSegmentsForXValues(xVals.sort((a, b) => a - b));\n\t\t\tfor (let markInd = 0; markInd < marksArr.length; markInd++) {\n\t\t\t\tmarksArr[markInd]._setSegment(points[markInd]);\n\t\t\t}\n\t\t}\n\t\tthis.calclulateMarksPositions();\n\t\tthis.ee.emit(EVENTS[EVENTS.CHANGE]);\n\t}\n\n\tprivate getTrendMarks(trendName: string): TrendMark[] {\n\t\tlet trendMarks: TrendMark[] = [];\n\t\tfor (let markName in this.items) {\n\t\t\tif (this.items[markName].options.trendName != trendName) continue;\n\t\t\ttrendMarks.push(this.items[markName]);\n\t\t}\n\t\treturn trendMarks;\n\t}\n\n}\n\nexport class TrendMark {\n\toptions: ITrendMarkOptions;\n\tsegment: TrendSegment;\n\txVal: number;\n\tyVal: number;\n\toffset: number;\n\trow = 0;\n\tprotected chart: Chart;\n\n\tconstructor(chart: Chart, options: ITrendMarkOptions) {\n\t\tthis.options = options;\n\t\tthis.chart = chart;\n\t}\n\n\n\t/**\n\t * only for internal usage\n\t */\n\t_setSegment(segment: TrendSegment) {\n\t\tthis.segment = segment;\n\t\tif (!segment) return;\n\n\t\tlet trend = this.chart.getTrend(this.options.trendName);\n\n\t\tif (trend.getOptions().type == TREND_TYPE.LINE) {\n\t\t\tthis.xVal = segment.endXVal;\n\t\t\tthis.yVal = segment.endYVal;\n\t\t} else if (this.options.orientation == TREND_MARK_SIDE.TOP) {\n\t\t\tthis.xVal = segment.xVal;\n\t\t\tthis.yVal = segment.maxYVal;\n\t\t} else {\n\t\t\tthis.xVal = segment.xVal;\n\t\t\tthis.yVal = segment.minYVal;\n\t\t}\n\t}\n\n\t_setOffset(offset: number) {\n\t\tthis.offset = offset;\n\t}\n\n\t_setRow(row: number) {\n\t\tthis.row = row;\n\t}\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./plugins/src/TrendsMarksPlugin/TrendsMarksPlugin.ts\n **/","import {Chart, Utils, TrendsWidget, TrendWidget, TRANSFORMATION_EVENT, Color } from 'three-charts';\nimport { TrendMark, TREND_MARK_SIDE, TrendsMarksPlugin } from \"./TrendsMarksPlugin\";\nimport Geometry = THREE.Geometry;\nimport Mesh = THREE.Mesh;\nimport LineBasicMaterial = THREE.LineBasicMaterial;\nimport Material = THREE.Material;\nimport Vector3 = THREE.Vector3;\nimport Line = THREE.Line;\nimport Object3D = THREE.Object3D;\nimport Face3 = THREE.Face3;\nimport Texture = THREE.Texture;\nimport Vector2 = THREE.Vector2;\nimport LineSegments = THREE.LineSegments;\nimport LineDashedMaterial = THREE.LineDashedMaterial;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport LinearFilter = THREE.LinearFilter;\nimport NearestFilter = THREE.NearestFilter;\n\n\n/**\n * widget for drawing trends marks for all trends\n */\nexport class TrendsMarksWidget extends TrendsWidget<TrendMarksWidget> {\n\tstatic widgetName = \"TrendsMarks\";\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendMarksWidget;\n\t}\n}\n\n/**\n * widget for drawing trend marks for one trend\n */\nexport class TrendMarksWidget extends TrendWidget {\n\n\tprivate object3D: Object3D;\n\tprivate marksWidgets: {[name: string]: TrendMarkWidget} = {};\n\n\tconstructor (chart: Chart, trendName: string) {\n\t\tsuper(chart, trendName);\n\t\tthis.object3D = new Object3D();\n\t\tthis.onMarksChange();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.object3D;\n\t}\n\t\n\tprotected bindEvents() {\n\t\tsuper.bindEvents();\n\t\tthis.bindEvent(this.getTrendsMarksPlugin().onChange(() => this.onMarksChange()));\n\t\tthis.bindEvent(this.chart.screen.onTransformationEvent((event) => this.onScreenTransformationEvent(event)));\n\t}\n\n\tprivate getTrendsMarksPlugin(): TrendsMarksPlugin {\n\t\treturn this.chart.getPlugin(TrendsMarksPlugin.NAME) as TrendsMarksPlugin;\n\t}\n\n\tprivate onMarksChange() {\n\t\tlet marksItems = this.getTrendsMarksPlugin().getItems();\n\t\tlet widgets = this.marksWidgets;\n\t\tlet actualMarksNames: string[] = [];\n\t\tfor (let markName in marksItems) {\n\t\t\tactualMarksNames.push(markName);\n\t\t\tif (!widgets[markName]) this.createMarkWidget(marksItems[markName]);\n\t\t}\n\t\tfor (let markName in this.marksWidgets) {\n\t\t\tif (actualMarksNames.indexOf(markName) !== -1) continue;\n\t\t\tthis.destroyMarkWidget(markName);\n\t\t}\n\n\t}\n\t\n\tprivate createMarkWidget(mark: TrendMark) {\n\t\tif (!mark.segment) return;\n\t\tlet markWidget = new TrendMarkWidget(this.chart, mark);\n\t\tthis.marksWidgets[mark.options.name] = markWidget;\n\t\tthis.object3D.add(markWidget.getObject3D());\n\t}\n\n\tprivate destroyMarkWidget(markName: string) {\n\t\tthis.object3D.remove(this.marksWidgets[markName].getObject3D());\n\t\tdelete this.marksWidgets[markName];\n\t}\n\n\tprivate onScreenTransformationEvent(event: TRANSFORMATION_EVENT) {\n\t\tvar widgets = this.marksWidgets;\n\t\tfor (let markName in widgets) {\n\t\t\twidgets[markName].onScreenTransformationEventHandler(event);\n\t\t}\n\t}\n\n\tprotected onZoomFrame() {\n\t\tvar widgets = this.marksWidgets;\n\t\tfor (let markName in widgets) {\n\t\t\twidgets[markName].onZoomFrameHandler();\n\t\t}\n\t}\n\n\tprotected onSegmentsAnimate() {\n\t\tvar widgets = this.marksWidgets;\n\t\tfor (let markName in widgets) {\n\t\t\twidgets[markName].onSegmentsAnimate();\n\t\t}\n\t}\n\n}\n\n/**\n * widget for drawing one trend mark\n */\nexport class TrendMarkWidget {\n\tmark: TrendMark;\n\tprivate chart: Chart;\n\tprivate markMesh: Mesh;\n\n\tconstructor(chart: Chart, trendMark: TrendMark) {\n\t\tthis.chart = chart;\n\t\tthis.mark = trendMark;\n\t\tthis.initObject();\n\t\tthis.show();\n\t}\n\t\n\tprotected initObject() {\n\t\tlet options = this.mark.options;\n\t\tlet {width, height} = options;\n\n\t\tlet texture = Utils.createNearestTexture(width, height, (ctx) => {\n\t\t\toptions.onRender(this, ctx, this.chart);\n\t\t});\n\n\n\t\t// make text sharp when screen is not transforming\n\t\ttexture.magFilter = this.chart.screen.transformationInProgress ? LinearFilter : NearestFilter;\n\n\t\tvar material = new THREE.MeshBasicMaterial( {map: texture, side: THREE.FrontSide} );\n\t\tmaterial.transparent = true;\n\n\t\tthis.markMesh = new Mesh(\n\t\t\tnew THREE.PlaneGeometry(width, height),\n\t\t\tmaterial\n\t\t);\n\t}\n\n\tgetObject3D() {\n\t\treturn this.markMesh;\n\t}\n\n\tonSegmentsAnimate() {\n\t\tthis.updatePosition();\n\t}\n\n\tonZoomFrameHandler() {\n\t\tthis.updatePosition();\n\t}\n\n\tonScreenTransformationEventHandler(event: TRANSFORMATION_EVENT) {\n\t\tlet texture = (this.markMesh.material as MeshBasicMaterial).map;\n\n\t\t// make text sharp when screen is not transforming\n\t\ttexture.magFilter = (event == TRANSFORMATION_EVENT.STARTED) ? LinearFilter : NearestFilter;\n\t\ttexture.needsUpdate = true;\n\t}\n\n\tprivate updatePosition() {\n\t\tif (!this.mark.segment) return;\n\t\tlet mark = this.mark;\n\t\tlet screen = this.chart.screen;\n\n\t\tlet posX = screen.getPointOnXAxis(mark.xVal);\n\t\tlet posY = screen.getPointOnYAxis(mark.yVal);\n\n\t\tthis.markMesh.position.set(posX, posY, 0);\n\t}\n\n\tprivate show() {\n\t\tif (!this.mark.segment) return;\n\t\tthis.updatePosition();\n\t\tthis.markMesh.scale.set(0.01, 0.01, 1);\n\n\t\tthis.chart.animationManager\n\t\t\t.animate(1000, this.mark.options.ease)\n\t\t\t.from(this.markMesh.scale as Object)\n\t\t\t.to({x: 1, y: 1});\n\t}\n}\n\nexport const DEFAULT_RENDERER = (\n\ttrendMarkWidget: TrendMarkWidget,\n\tctx: CanvasRenderingContext2D,\n\tchart: Chart\n) =>  {\n\n\tlet mark = trendMarkWidget.mark;\n\tlet options = mark.options;\n\tlet isTopSide = options.orientation == TREND_MARK_SIDE.TOP;\n\tlet color = options.color !== void 0 ?\n\t\tnew Color(options.color) :\n\t\tnew Color(chart.getTrend(options.trendName).getOptions().lineColor);\n\tlet rgbaColor = color.getTransparent(0.5).rgbaStr;\n\tlet {width, height} = options;\n\tlet centerX = Math.round(width / 2);\n\tlet centerY =  Math.round(height / 2);\n\tlet font = chart.state.font.m;\n\tlet textOffset = parseInt(font);\n\tlet textPosX = centerX;\n\tlet textPosY = isTopSide ? textOffset * 1.3 : height - textOffset * 0.7;\n\n\t// draw rect\n\tctx.fillStyle = rgbaColor;\n\tctx.strokeStyle = rgbaColor;\n\tctx.fillRect(\n\t\t0,\n\t\tisTopSide ? 0 : height,\n\t\twidth,\n\t\tisTopSide ? textOffset * 2 : -textOffset * 2\n\t);\n\n\t// draw dot\n\tctx.beginPath();\n\tctx.arc(centerX, centerY, 4, 0, 2 * Math.PI, false);\n\tctx.fill();\n\n\t// draw line\n\tlet lineEndY = textPosY ;\n\tctx.beginPath();\n\tctx.moveTo(centerX, centerY);\n\tctx.lineTo(centerX, lineEndY);\n\tctx.stroke();\n\n\t// draw text\n\tctx.beginPath();\n\tctx.textAlign = 'center';\n\tctx.font = font;\n\tctx.fillStyle = 'rgba(250, 250, 250, 0.8)';\n\tctx.fillText(\n\t\toptions.title,\n\t\tMath.round(textPosX),\n\t\tMath.round(textPosY)\n\t);\n\n\n\n\t// uncomment to preview mark rect\n\t// ctx.rect(0, 0, width, height);\n\t// ctx.stroke();\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./plugins/src/TrendsMarksPlugin/TrendsMarksWidget.ts\n **/","export declare type TEase = (k: number) => number;\n\n/**\n * Easing from tween.js lib https://github.com/tweenjs/tween.js\n **/\nexport const EASING = {\n\n\tLinear: {\n\n\t\tNone: function (k: number) {\n\n\t\t\treturn k;\n\n\t\t}\n\n\t},\n\n\tQuadratic: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn k * k;\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn k * (2 - k);\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k;\n\t\t\t}\n\n\t\t\treturn - 0.5 * (--k * (k - 2) - 1);\n\n\t\t}\n\n\t},\n\n\tCubic: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn k * k * k;\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn --k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k + 2);\n\n\t\t}\n\n\t},\n\n\tQuartic: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn k * k * k * k;\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn 1 - (--k * k * k * k);\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn - 0.5 * ((k -= 2) * k * k * k - 2);\n\n\t\t}\n\n\t},\n\n\tQuintic: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn k * k * k * k * k;\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn --k * k * k * k * k + 1;\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * k * k * k * k * k;\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * k * k * k + 2);\n\n\t\t}\n\n\t},\n\n\tSinusoidal: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn 1 - Math.cos(k * Math.PI / 2);\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn Math.sin(k * Math.PI / 2);\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\treturn 0.5 * (1 - Math.cos(Math.PI * k));\n\n\t\t}\n\n\t},\n\n\tExponential: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn k === 0 ? 0 : Math.pow(1024, k - 1);\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn k === 1 ? 1 : 1 - Math.pow(2, - 10 * k);\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * Math.pow(1024, k - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (- Math.pow(2, - 10 * (k - 1)) + 2);\n\n\t\t}\n\n\t},\n\n\tCircular: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn 1 - Math.sqrt(1 - k * k);\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\treturn Math.sqrt(1 - (--k * k));\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn - 0.5 * (Math.sqrt(1 - k * k) - 1);\n\t\t\t}\n\n\t\t\treturn 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);\n\n\t\t}\n\n\t},\n\n\tElastic: {\n\n\t\tIn: function (k: number) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn -Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\treturn Math.pow(2, -10 * k) * Math.sin((k - 0.1) * 5 * Math.PI) + 1;\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif (k === 0) {\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tif (k === 1) {\n\t\t\t\treturn 1;\n\t\t\t}\n\n\t\t\tk *= 2;\n\n\t\t\tif (k < 1) {\n\t\t\t\treturn -0.5 * Math.pow(2, 10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI);\n\t\t\t}\n\n\t\t\treturn 0.5 * Math.pow(2, -10 * (k - 1)) * Math.sin((k - 1.1) * 5 * Math.PI) + 1;\n\n\t\t}\n\n\t},\n\n\tBack: {\n\n\t\tIn: function (k: number) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn k * k * ((s + 1) * k - s);\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\tvar s = 1.70158;\n\n\t\t\treturn --k * k * ((s + 1) * k + s) + 1;\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tvar s = 1.70158 * 1.525;\n\n\t\t\tif ((k *= 2) < 1) {\n\t\t\t\treturn 0.5 * (k * k * ((s + 1) * k - s));\n\t\t\t}\n\n\t\t\treturn 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);\n\n\t\t}\n\n\t},\n\n\tBounce: {\n\n\t\tIn: function (k: number) {\n\n\t\t\treturn 1 - EASING.Bounce.Out(1 - k);\n\n\t\t},\n\n\t\tOut: function (k: number) {\n\n\t\t\tif (k < (1 / 2.75)) {\n\t\t\t\treturn 7.5625 * k * k;\n\t\t\t} else if (k < (2 / 2.75)) {\n\t\t\t\treturn 7.5625 * (k -= (1.5 / 2.75)) * k + 0.75;\n\t\t\t} else if (k < (2.5 / 2.75)) {\n\t\t\t\treturn 7.5625 * (k -= (2.25 / 2.75)) * k + 0.9375;\n\t\t\t} else {\n\t\t\t\treturn 7.5625 * (k -= (2.625 / 2.75)) * k + 0.984375;\n\t\t\t}\n\n\t\t},\n\n\t\tInOut: function (k: number) {\n\n\t\t\tif (k < 0.5) {\n\t\t\t\treturn EASING.Bounce.In(k * 2) * 0.5;\n\t\t\t}\n\n\t\t\treturn EASING.Bounce.Out(k * 2 - 1) * 0.5 + 0.5;\n\n\t\t}\n\n\t}\n\n};\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Easing.ts\n **/"],"sourceRoot":""}