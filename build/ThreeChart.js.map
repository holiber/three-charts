{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///ThreeChart.js","webpack:///webpack/bootstrap 1b961503305d2600f90b","webpack:///./index.ts","webpack:///./src/index.ts","webpack:///./src/Chart.ts","webpack:///./src/deps/deps.ts","webpack:///./~/three/examples/js/libs/stats.min.js","webpack:///./~/three/examples/js/renderers/CanvasRenderer.js","webpack:///./~/three/examples/js/renderers/Projector.js","webpack:///./~/is-plain-object/index.js","webpack:///./~/isobject/index.js","webpack:///./~/EventEmitter2/lib/eventemitter2.js","webpack:///./src/polyfills/es6-promise.js","webpack:///./~/css-element-queries/src/ResizeSensor.js","webpack:///./src/State.ts","webpack:///./src/EventEmmiter.ts","webpack:///./src/Utils.ts","webpack:///./src/Widget.ts","webpack:///./src/TrendsManager.ts","webpack:///./src/Trend.ts","webpack:///./src/TrendSegments.ts","webpack:///./src/Screen.ts","webpack:///./src/AxisMarks.ts","webpack:///./src/interfaces.ts","webpack:///./src/widgets/AxisWidget.ts","webpack:///./src/widgets/GridWidget.ts","webpack:///./src/widgets/TrendsLoadingWidget.ts","webpack:///./src/widgets/TrendsWidget.ts","webpack:///./src/widgets/AxisMarksWidget.ts","webpack:///./src/widgets/BorderWidget.ts","webpack:///./src/widgets/TrendsIndicatorWidget.ts","webpack:///./src/widgets/TrendsLineWidget.ts","webpack:///./src/widgets/TrendsCandleWidget.ts","webpack:///./src/widgets/TrendsBeaconWidget.ts","webpack:///./src/deps/index.ts","webpack:///./src/Plugin.ts"],"names":["webpackUniversalModuleDefinition","root","factory","exports","module","define","amd","this","modules","installedModules","__webpack_require__","moduleId","id","loaded","call","m","c","p","__export","hasOwnProperty","PerspectiveCamera","THREE","State_1","Utils_1","AxisWidget_1","GridWidget_1","TrendsLoadingWidget_1","AxisMarksWidget_1","BorderWidget_1","TrendsIndicatorWidget_1","TrendsLineWidget_1","TrendsCandleWidget_1","TrendsBeaconWidget_1","deps_1","MAX_DATA_LENGTH","Chart","state","$container","plugins","_this","widgets","REVISION","Utils","error","style","getComputedStyle","width","parseInt","height","ChartState","installedWidgets","zoomThrottled","throttle","zoomValue","origin","zoom","init","installWidget","Widget","widgetName","prototype","_a","data","w","h","showStats","autoRender","scene","Scene","isStopped","enabled","renderer","renderers","antialias","alpha","setPixelRatio","devicePixelRatio","setClearColor","backgroundColor","backgroundOpacity","setSize","appendChild","domElement","$el","display","stats","Stats","setupCamera","widgetsClasses","widgetOptions","WidgetConstructor","widget","add","getObject3D","push","bindEvents","renderLoop","isDestroyed","begin","render","fpsLimit","fps","delay","setTimeout","requestAnimationFrame","end","camera","stop","run","destroy","unbindEvents","forceContextLoss","wtf","context","getState","getTrend","trendName","setState","controls","addEventListener","ev","onMouseWheel","onMouseMove","onMouseDown","onMouseUp","onTouchMove","onTouchEnd","autoResize","resizeSensor","ResizeSensor","onChartContainerResizeHandler","clientWidth","clientHeight","unsubscribers","onTrendsChange","autoscroll","screen","onTransformationFrame","options","onScreenTransformHandler","onResize","onChartResize","detach","e","remove","forEach","unsubscribe","camSettings","getCameraSettings","FOV","aspect","near","far","fov","updateProjectionMatrix","position","set","x","y","z","cameraInitialPosition","clone","scrollX","scrollX_1","setX","scrollY","scrollY_1","setY","autoScroll","oldTrendsMaxX","prevState","computedData","trends","maxXVal","trendsMaxXDelta","maxVisibleX","getScreenRightVal","paddingRightX","getPaddingRight","currentScroll","xAxis","range","scroll","scrollDelta","onScrollStop","cursor","dragMode","clientX","clientY","stopPropagation","preventDefault","zoomOrigin","layerX","wheelDeltaY","touches","MAX_ZOOM_VALUE","MIN_ZOOM_VALUE","Math","min","max","autoScrollIsEnabled","then","createPreviewChart","userOptions","previewChartOptions","animations","Grid","Axis","TrendsGradient","deepMerge","window","CanvasRenderer","WebGLRenderer","TrendsLineWidget","TrendsCandlesWidget","AxisWidget","GridWidget","TrendsBeaconWidget","TrendsIndicatorWidget","TrendsLoadingWidget","AxisMarksWidget","BorderWidget","isPlainObject","EE2","es6_promise_1","Promise","a","dom","k","d","children","length","l","document","createElement","cssText","g","performance","Date","now","r","Panel","f","self","memory","t","addPanel","showPanel","update","usedJSHeapSize","jsHeapSizeLimit","setMode","Infinity","round","u","n","q","b","getContext","font","textBaseline","fillStyle","fillRect","fillText","globalAlpha","v","drawImage","SpriteCanvasMaterial","parameters","Material","type","color","Color","program","setValues","Object","create","constructor","material","copy","console","log","_renderData","_elements","_lights","_projector","Projector","_canvas","canvas","undefined","_canvasWidth","_canvasHeight","_canvasWidthHalf","floor","_canvasHeightHalf","_viewportX","_viewportY","_viewportWidth","_viewportHeight","_pixelRatio","_context","_clearColor","_clearAlpha","_contextGlobalAlpha","_contextGlobalCompositeOperation","_contextStrokeStyle","_contextFillStyle","_contextLineWidth","_contextLineCap","_contextLineJoin","_contextLineDash","_camera","_v1","_v2","_v3","_v4","_v5","RenderableVertex","_v6","_v1x","_v1y","_v2x","_v2y","_v3x","_v3y","_v4x","_v4y","_v5x","_v5y","_v6x","_v6y","_color","_color1","_color2","_color3","_color4","_diffuseColor","_emissiveColor","_lightColor","_patterns","_image","_uvs","_uv1x","_uv1y","_uv2x","_uv2y","_uv3x","_uv3y","_clipBox","Box2","_clearBox","_elemBox","_ambientLight","_directionalLights","_pointLights","_vector3","Vector3","_centroid","_normal","_normalViewMatrix","Matrix3","setLineDash","autoClear","sortObjects","sortElements","info","vertices","faces","supportsVertexTextures","setFaceCulling","getContextAttributes","getPixelRatio","value","updateStyle","setViewport","setScissor","setScissorTest","setClearColorHex","hex","warn","getClearColor","getClearAlpha","getMaxAnisotropy","clear","isEmpty","intersect","expandByScalar","clearRect","setBlending","NormalBlending","setOpacity","setFillStyle","makeEmpty","clearColor","clearDepth","clearStencil","Camera","setTransform","translate","projectScene","elements","lights","getNormalMatrix","matrixWorldInverse","calculateLights","el","element","opacity","RenderableSprite","renderSprite","RenderableLine","v1","v2","positionScreen","setFromPoints","intersectsBox","renderLine","RenderableFace","v3","overdraw","expand","renderFace3","union","setRGB","ll","light","lightColor","AmbientLight","DirectionalLight","PointLight","calculateLight","normal","lightPosition","setFromMatrixPosition","matrixWorld","normalize","amount","dot","intensity","multiplyScalar","subVectors","distance","distanceTo","blending","scaleX","scale","scaleY","dist","sqrt","SpriteMaterial","texture","map","pattern","version","textureToPattern","bitmap","image","ox","offset","oy","sx","repeat","sy","cx","cy","save","rotation","rotate","restore","getStyle","setStrokeStyle","beginPath","moveTo","lineTo","LineBasicMaterial","setLineWidth","linewidth","setLineCap","linecap","setLineJoin","linejoin","vertexColors","VertexColors","colorStyle1","colorStyle2","grad","createLinearGradient","addColorStop","exception","stroke","LineDashedMaterial","dashSize","gapSize","uv1","uv2","uv3","drawTriangle","MeshLambertMaterial","MeshPhongMaterial","emissive","FaceColors","multiply","positionWorld","divideScalar","normalModel","wireframe","strokePath","wireframeLinewidth","wireframeLinecap","wireframeLinejoin","fillPath","MeshBasicMaterial","mapping","UVMapping","uvs","patternPath","envMap","SphericalReflectionMapping","vertexNormalsModel","applyMatrix3","MeshNormalMaterial","addScalar","x0","y0","x1","y1","x2","y2","closePath","fill","CompressedTexture","DataTexture","complete","repeatX","wrapS","RepeatWrapping","repeatY","wrapT","createPattern","onUpdate","u0","v0","u1","u2","det","idet","offsetX","offsetY","transform","clipImage","clip","pixels","globalCompositeOperation","AdditiveBlending","SubtractiveBlending","lineWidth","lineCap","lineJoin","strokeStyle","RenderableObject","object","renderOrder","vertexNormalsLength","Vector2","Vector4","visible","vertex","_object","_objectCount","_objectPool","_objectPoolLength","_vertex","_vertexCount","_vertexPool","_vertexPoolLength","_face","_faceCount","_facePool","_facePoolLength","_line","_lineCount","_linePool","_linePoolLength","_sprite","_spriteCount","_spritePool","_spritePoolLength","objects","_vector4","Box3","_boundingBox","_points3","Array","_points4","_viewMatrix","Matrix4","_viewProjectionMatrix","_modelMatrix","_modelViewProjectionMatrix","_normalMatrix","_frustum","Frustum","_clippedVertex1PositionScreen","_clippedVertex2PositionScreen","projectVector","vector","project","unprojectVector","unproject","pickingRay","RenderList","normals","normalMatrix","setObject","projectVertex","applyMatrix4","invW","pushVertex","getNextVertexInPool","pushNormal","pushUv","checkTriangleVisibility","checkBackfaceCulling","pushLine","getNextLineInPool","pushTriangle","side","DoubleSide","getNextFaceInPool","fromArray","i","arguments","uv","renderList","autoUpdate","updateMatrixWorld","parent","getInverse","multiplyMatrices","projectionMatrix","setFromMatrix","traverseVisible","Light","Mesh","Line","Sprite","frustumCulled","intersectsObject","getNextObjectInPool","applyProjection","sort","painterSort","o","ol","geometry","BufferGeometry","attributes","groups","positions","array","index","indices","group","start","count","Geometry","faceVertexUvs","isFaceMaterial","MultiMaterial","objectMaterials","vl","morphTargets","morphInfluences","morphTargetInfluences","tl","influence","target","targetVertex","fl","face","materials","materialIndex","FrontSide","BackSide","negate","faceVertexNormals","vertexNormals","nl","vertexUvs","step","LineSegments","clipLine","colors","getNextSpriteInPool","abs","line","sprite","s1","s2","alpha1","alpha2","bc1near","bc2near","bc1far","bc2far","lerp","isObject","isObjectObject","toString","ctor","prot","val","isArray","__WEBPACK_AMD_DEFINE_RESULT__","_isArray","obj","defaultMaxListeners","_events","_conf","configure","conf","delimiter","maxListeners","wildcard","newListener","listenerTree","EventEmitter","searchListenerTree","handlers","tree","listeners","leaf","len","branch","xTree","xxTree","isolatedBranch","endReached","typeLength","currentType","nextType","_listeners","concat","**","growListenerTree","listener","split","slice","name","shift","warned","trace","setMaxListeners","event","once","fn","many","ttl","Error","off","apply","_origin","on","emit","_all","args","handler","ns","onAny","addListener","leafs","iLeaf","splice","offAny","fns","removeListener","removeAllListeners","listenersAny","EventEmitter2","callback","EventQueue","j","prop","currentStyle","getPropertyValue","attachResizeEvent","resized","resizedAttached","className","styleChild","innerHTML","fixed","absolute","childNodes","expandChild","shrink","shrinkChild","lastWidth","lastHeight","reset","offsetWidth","offsetHeight","scrollLeft","scrollWidth","scrollTop","scrollHeight","changed","addEvent","cb","attachEvent","onScroll","elementType","isCollectionTyped","jQuery","Elements","removeChild","EventEmmiter_1","Widget_1","TrendsManager_1","Screen_1","AxisMarks_1","interfaces_1","CHART_STATE_EVENTS","INITIAL_STATE_APPLIED","READY","DESTROY","CHANGE","TREND_CHANGE","TRENDS_CHANGE","ZOOM","RESIZE","SCROLL","SCROLL_STOP","PLUGINS_STATE_CHANGED","initialState","AXIS_RANGE_TYPE","ALL","from","to","padding","margin","dataType","AXIS_DATA_TYPE","NUMBER","gridMinSize","marks","yAxis","RELATIVE_END","trendChangeSpeed","trendChangeEase","zoomSpeed","zoomEase","Linear","easeNone","scrollSpeed","scrollEase","autoScrollSpeed","autoScrollEase","pluginsState","eventEmitterMaxListeners","isReady","ee","trendsManager","TrendsManager","calculatedOptions","installPlugins","getComputedData","savePrevState","Screen","xAxisMarks","AxisMarks","AXIS_TYPE","X","yAxisMarks","Y","initListeners","onDestroy","subscribe","onInitialStateApplied","onReady","onChange","onTrendChange","onZoom","onPluginsStateChange","newState","eventData","silent","stateData","changedProps","key","trendsData","trendOptions","newStateContainsData","keys","recalculateResult","recalculateState","emitChangedStateEvents","patch","actualData","widgetsOptions","WidgetClass","defaultOptions","getDefaultOptions","ChartWidget","cursorOptions","isMouseDrag","oldX","currentX","deltaXVal","pxToValueByXAxis","chartWasResized","scrollXChanged","needToRecalculateXAxis","zeroVal","xAxisPatch","recalculateXAxis","needToRecalculateYAxis","AUTO","isMirrorMode","yAxisPatch","recalculateYAxis","allChangedProps","computeAll","getEndXVal","minXVal","getStartXVal","copyProps","scrollStopEventNeeded","scrollChangeEventsNeeded","zoomEventsNeeded","resizeEventNeeded","pluginStateChangedEventNeeded","plugin","PluginClass","pluginName","NAME","pluginWidgets","PluginWidget","setupChartState","getPlugin","changedTrends","newData","handleTrendsChange","axisRange","isInitialize","scaleFactor","currentScaleFactor","rangeLength","needToRecalculateZoom","rangeMoreThenMaxValue","maxLength","rangeLessThenMinValue","minLength","fixScale","yAxisRange","trendsEndXVal","trendsStartXVal","xRange","xFrom","xTo","xRangeLength","needToZoom","maxY","getMaxYVal","minY","getMinYVal","trendLastY","distanceFromZeroValForMaxY","distanceFromZeroValForMinY","maxDistanceFromZeroVal","paddingTopInPercents","paddingBottomInPercents","rangeLengthInPercents","visibleRangeLength","fromVal","toVal","maxScreenY","getScreenYByValue","minScreenY","currentAxisRange","newZoom","currentRange","nextRange","newScroll","resolve","animationTime","zoomToRange","scrollToEnd","endXVal","getPointOnXAxis","xVal","getPointOnYAxis","yVal","getValueOnXAxis","valueToPxByXAxis","valueToPxByYAxis","pxToValueByYAxis","getValueByScreenX","getValueByScreenY","getScreenXByValue","getScreenXByPoint","getPointByScreenX","screenX","getPointOnChart","getScreenLeftVal","eventName","_i","listenersCount","deepmerge","src","mergeArrays","dst","indexOf","obj1","obj2","deepCopy","JSON","parse","stringify","toFixed","num","digitsCount","maxDigits","result","intVal","intStr","lengthDiff","afterPointDigitsCount","afterPointStr","substr","bindEvent","createTexture","ctx","Texture","needsUpdate","createPixelPerfectTexture","minFilter","NearestFilter","msg","getUid","currentId","getDistance","num1","num2","binarySearchClosestInd","arr","mid","lo","hi","binarySearchClosest","ind","rectsIntersect","r1","r2","left1","top1","width1","height1","left2","top2","width2","height2","right1","right2","bottom1","bottom2","parseColor","cache","replace","exec","isNaN","getHexColor","str","rgb","func","ms","isThrottled","savedArgs","savedThis","wrapper","msToTimeString","timestamp","s","getRandomItem","random","srcObject","dstObject","props","excludeProps","chartState","unsubscriber","Trend_1","EVENTS","SEGMENTS_REBUILDED","trendsCalculatedOptions","trend","createTrend","getCalculatedOptions","getEnabledTrends","enabledTrends","allTrends","getOptions","getData","firstTrendData","getExtremumYVal","extremumIsMax","fromX","toX","compareFn","trends_1","trendData","trendYValues","dataItem","NaN","onSegmentsRebuilded","onInitialStateAppliedHandler","_loop_1","this_1","segments","onRebuild","Trend","TrendSegments_1","PREPEND_REQUEST","TREND_TYPE","DEFAULT_OPTIONS","LINE","maxSegmentLength","lineColor","hasGradient","hasBeacon","settingsForTypes","CANDLE","minSegmentLengthInPx","maxSegmentLengthInPx","minYVal","maxYVal","dataset","prepareData","TrendSegments","checkForPrependRequest","changedOptions","appendData","rawData","updatedTrendData","changeData","prependData","allData","newData_1","item","statePatch","filteredData","data_1","getFirstItem","getLastItem","setOptions","onPrependRequest","onDataChange","onChangeCb","prependRequest","minScreenX","needToRequest","requestedDataLength","reject","currentData","isPrepend","initialItem","MAX_ANIMATED_SEGMENTS","REBUILD","DISLPAYED_RANGE_CHANGED","ANIMATION_FRAME","segmentsById","animatedSegmentsIds","segmentsLength","animatedSegmentsForAppend","animatedSegmentsForPrepend","nextEmptyId","startSegmentId","endSegmentId","tryToRebuildSegments","onTrendChangeHandler","onZoomHandler","recalculateDisplayedRange","onDestroyHandler","appendAnimation","kill","prependAnimation","segmentsRebuilded","needToRebuildSegments","isAppend","getEndSegment","getStartSegment","force","trendTypeName","trendTypesSettings","trendTypeSettings","needToRebuild","segmentLength","currentSegmentLengthInPx","Number","currentMaxSegmentLengthInPx","ceil","stopAllAnimations","segmentsAreRebuilded","_b","firstDisplayedSegment","lastDisplayedSegment","displayedRange","displayedRangeChanged","getSegmentsForXValues","values","valueInd","lastValueInd","results","segment","hasValue","startXVal","getNext","valueInPoint","onAnimationFrame","onDisplayedRangeChanged","allocateNextSegment","TrendSegment","prevSegment","nextId","prevId","allocatePrevSegment","nextSegment","unshift","needRebuildSegments","startItemInd","initialSegment","initialAnimationState","createAnimationState","itemInd","itemIsInserted","appendItem","isLastItem","isCompleted","recalculateItems","segmentIsReadyForAnimate","startYVal","endYVal","targetAnimationState","prevItem","animationsOptions","time","segmentId","segment_1","currentAnimationState","animate","prependItem","nextItem","animation","isActive","onAnimationFrameHandler","ease","objectToAnimate","animationValue","TweenLite","eventCallback","coefficient","animatedSegmentsIds_1","targetValue","initialValue","currentValue","trendPoints","items","trendSegments","itemsLength","endItem","startItem","minX","maxX","middleXVal","middleYVal","yVals","nextPoint","getPrev","prevPoint","getFrameVal","getFramePoint","frameVal","scrollXVal","scrollYVal","zoomX","zoomY","currentScrollX","currentScrollY","currentZoomX","currentZoomY","vFOV","PI","tan","onZoomFrame","onScrollFrame","cameraIsMoving","scrollXAnimation","zoomXAnimation","onScrollXHandler","onZoomXHandler","onScrollYHandler","onZoomYHandler","scrollYAnimation","zoomYAnimation","isDragMode","canAnimate","zoomXChanged","isAutoscroll","pause","targetX","targetY","targetZoom","getPointByScreenY","screenY","getTop","getBottom","getLeft","getTopVal","getBottomVal","getCenterYVal","__extends","__","AXIS_MARK_DEFAULT_OPTIONS","showValue","stickToEdges","title","axisType","axisMarksOptions","axisMarksOptions_1","axisMark","AxisTimeleftMark","AxisMark","startVal","endVal","markName","mark","markVal","markWasCrossed","getItems","getItem","renderOnTrendsChange","newOptions","getDisplayedVal","displayedValue","String","onMarkCrossed","onValueChange","onDisplayedValueChange","typeName","_super","Object3D","object3D","axisXObject","axisYObject","setupAxis","updateAxisXRequest","updateAxis","onScrollChange","orientation","isXAxis","visibleWidth","visibleHeight","canvasWidth","canvasHeight","traverse","transparent","axisMesh","PlaneGeometry","axisOptions","axisGridParams","getGridParamsForAxis","edgeOffset","segmentsCount","pxVal","textAlign","DATE","getDateStr","gridParams","sec","hour","day","tf","getHours","getMinutes","getSeconds","gridSizeH","gridSizeV","initGrid","updateGrid","updateGridThrottled","xLinesCount","yLinesCount","lineSegments","setZ","axisXGrid","axisYGrid","scrollXInSegments","scrollYInSegments","gridScrollXVal","gridScrollYVal","lineInd","lineSegment","getVerticalLineSegment","getHorizontalLineSegment","verticesNeedUpdate","localYVal","widthVal","localXVal","heightVal","axisWidth","axisLength","gridStep","gridStepInPixels","minGridStepInPixels","axisLengthStr","axisLengthPointPosition","intPartLength","gridStepFound","digitPos","power","multiplier","pow","dividers","dividerInd","nextGridStep","nextGridStepInPixels","gridStart","gridEnd","stepInPx","PlaneBufferGeometry","TrendsWidget_1","getTrendWidgetClass","TrendLoading","TrendsWidget","mesh","deactivate","widgetIsEnabled","activate","restart","updatePosition","center","arc","pointVector","TrendWidget","trendsOptions","TrendWidgetClass","widgetCanBeEnabled","createTrendWidget","destroyTrendWidget","widgetObject","getObjectByName","onSegmentsAnimate","axisMarksWidgets","createAxisMark","axisMarkWidget","AxisMarkWidget","updateMarksPositions","DEFAULT_INDICATOR_RENDER_FUNCTION","indicatorWidth","indicatorHeight","xCoord","INDICATOR_POS_Z","indicatorRenderFunction","frameValue","createLine","indicator","createIndicator","renderIndicator","lineGeometry","onValueChangeHandler","moveAnimation","hasStickMode","bottomVal","topVal","needToStickOnTop","needToStickOnBottom","centerYVal","indicatorPosY","CANVAS_WIDTH","CANVAS_HEIGHT","OFFSET_X","TrendIndicator","initObject","hasIndicator","lastItem","segmentEndXVal","segmentEndYVal","endPointVector","screenWidth","indicatorIsOutOfScreen","MAX_DISPLAYED_SEGMENTS","TrendLine","freeSegmentsInds","displayedSegments","initLine","destroySegments","setupSegments","scaleXFactor","scaleYFactor","segmentIsNotDisplayed","destroySegment","setupSegment","segmentState","pop","segmentInd","lineStartVertex","lineEndVertex","toLocalX","toLocalY","currentScale","toLocalVec","vec","RISE_COLOR","FALL_COLOR","MARGIN_PERCENT","MAX_CANDLES","TrendCandlesWidget","freeCandlesInds","candlesPool","candles","destroyCandles","setupCandles","destroyCandle","setupCandle","candle","candleId","candleInd","CandleWidget","setSegment","rect","leftTop","rightTop","leftBottom","rightBottom","vLineGeometry","vLine","vLineMaterial","lineTop","lineBottom","hLineGeometry","hLine","hLineMaterial","lineLeft","lineRight","TrendBeacon","onStateChange","stopAnimation","animated","animationObject","trendsSegments","DEFAULT_CONFIG","installPluginWidgets","ChartPlugin","config","onChartReadyHandler","changedPluginsStates","onStateChanged","changedState"],"mappings":"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","file":"ThreeChart.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ThreeChart\"] = factory();\n\telse\n\t\troot[\"ThreeChart\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ThreeChart\"] = factory();\n\telse\n\t\troot[\"ThreeChart\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tfunction __export(m) {\r\n\t    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n\t}\r\n\t__export(__webpack_require__(1));\r\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tfunction __export(m) {\r\n\t    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n\t}\r\n\t__export(__webpack_require__(2));\r\n\t__export(__webpack_require__(21));\r\n\t__export(__webpack_require__(20));\r\n\t__export(__webpack_require__(19));\r\n\t__export(__webpack_require__(12));\r\n\t__export(__webpack_require__(17));\r\n\t__export(__webpack_require__(18));\r\n\t__export(__webpack_require__(16));\r\n\t__export(__webpack_require__(14));\r\n\t__export(__webpack_require__(15));\r\n\t__export(__webpack_require__(33));\r\n\t__export(__webpack_require__(25));\r\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\t__webpack_require__(3);\r\n\tvar PerspectiveCamera = THREE.PerspectiveCamera;\r\n\tvar State_1 = __webpack_require__(12);\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar AxisWidget_1 = __webpack_require__(22);\r\n\tvar GridWidget_1 = __webpack_require__(23);\r\n\tvar TrendsLoadingWidget_1 = __webpack_require__(24);\r\n\tvar AxisMarksWidget_1 = __webpack_require__(26);\r\n\tvar BorderWidget_1 = __webpack_require__(27);\r\n\tvar TrendsIndicatorWidget_1 = __webpack_require__(28);\r\n\tvar TrendsLineWidget_1 = __webpack_require__(29);\r\n\tvar TrendsCandleWidget_1 = __webpack_require__(30);\r\n\tvar TrendsBeaconWidget_1 = __webpack_require__(31);\r\n\tvar deps_1 = __webpack_require__(32);\r\n\texports.MAX_DATA_LENGTH = 2692000;\r\n\tvar Chart = (function () {\r\n\t    function Chart(state, $container, plugins) {\r\n\t        var _this = this;\r\n\t        if (plugins === void 0) { plugins = []; }\r\n\t        this.widgets = [];\r\n\t        if (!THREE || !THREE.REVISION)\r\n\t            Utils_1.Utils.error('three.js not found');\r\n\t        if (!$container) {\r\n\t            Utils_1.Utils.error('$el must be set');\r\n\t        }\r\n\t        // calculate chart size\r\n\t        var style = getComputedStyle($container);\r\n\t        state.width = parseInt(style.width);\r\n\t        state.height = parseInt(style.height);\r\n\t        this.state = new State_1.ChartState(state, Chart.installedWidgets, plugins);\r\n\t        this.zoomThrottled = Utils_1.Utils.throttle(function (zoomValue, origin) { return _this.zoom(zoomValue, origin); }, 200);\r\n\t        this.$container = $container;\r\n\t        this.init($container);\r\n\t    }\r\n\t    ;\r\n\t    Chart.installWidget = function (Widget) {\r\n\t        if (!Widget.widgetName) {\r\n\t            Utils_1.Utils.error('unnamed widget');\r\n\t        }\r\n\t        this.installedWidgets[Widget.widgetName] = Widget;\r\n\t    };\r\n\t    Chart.prototype.init = function ($container) {\r\n\t        var state = this.state;\r\n\t        var _a = state.data, w = _a.width, h = _a.height, showStats = _a.showStats, autoRender = _a.autoRender;\r\n\t        this.scene = new THREE.Scene();\r\n\t        this.isStopped = !autoRender.enabled;\r\n\t        var renderer = this.renderer = new Chart.renderers[this.state.data.renderer]({\r\n\t            antialias: true,\r\n\t            alpha: true\r\n\t        });\r\n\t        renderer.setPixelRatio(Chart.devicePixelRatio);\r\n\t        renderer.setClearColor(state.data.backgroundColor, state.data.backgroundOpacity);\r\n\t        renderer.setSize(w, h);\r\n\t        $container.appendChild(renderer.domElement);\r\n\t        this.$el = renderer.domElement;\r\n\t        this.$el.style.display = 'block';\r\n\t        if (showStats) {\r\n\t            this.stats = new Stats();\r\n\t            $container.appendChild(this.stats.domElement);\r\n\t        }\r\n\t        this.setupCamera();\r\n\t        // init widgets\r\n\t        var widgetsClasses = this.state.widgetsClasses;\r\n\t        for (var widgetName in widgetsClasses) {\r\n\t            var widgetOptions = this.state.data.widgets[widgetName];\r\n\t            if (!widgetOptions.enabled)\r\n\t                continue;\r\n\t            var WidgetConstructor = widgetsClasses[widgetName];\r\n\t            var widget = new WidgetConstructor(this.state);\r\n\t            this.scene.add(widget.getObject3D());\r\n\t            this.widgets.push(widget);\r\n\t        }\r\n\t        this.bindEvents();\r\n\t        this.renderLoop();\r\n\t    };\r\n\t    Chart.prototype.renderLoop = function () {\r\n\t        var _this = this;\r\n\t        if (this.isDestroyed)\r\n\t            return;\r\n\t        this.stats && this.stats.begin();\r\n\t        this.render();\r\n\t        if (this.isStopped)\r\n\t            return;\r\n\t        var fpsLimit = this.state.data.autoRender.fps;\r\n\t        if (fpsLimit) {\r\n\t            var delay = 1000 / fpsLimit;\r\n\t            setTimeout(function () { return requestAnimationFrame(function () { return _this.renderLoop(); }); }, delay);\r\n\t        }\r\n\t        else {\r\n\t            requestAnimationFrame(function () { return _this.renderLoop(); });\r\n\t        }\r\n\t        this.stats && this.stats.end();\r\n\t    };\r\n\t    Chart.prototype.render = function () {\r\n\t        this.renderer.render(this.scene, this.camera);\r\n\t    };\r\n\t    Chart.prototype.stop = function () {\r\n\t        this.isStopped = true;\r\n\t    };\r\n\t    Chart.prototype.run = function () {\r\n\t        this.isStopped = false;\r\n\t        this.renderLoop();\r\n\t    };\r\n\t    /**\r\n\t     * call to destroy chart an init garbage collection\r\n\t     */\r\n\t    Chart.prototype.destroy = function () {\r\n\t        this.isDestroyed = true;\r\n\t        this.stop();\r\n\t        this.state.destroy();\r\n\t        this.unbindEvents();\r\n\t        // WARNING! undocumented method for free webgl context\r\n\t        try {\r\n\t            this.renderer.forceContextLoss();\r\n\t        }\r\n\t        catch (wtf) {\r\n\t        }\r\n\t        this.renderer.context = null;\r\n\t        this.renderer.domElement = null;\r\n\t        this.renderer = null;\r\n\t    };\r\n\t    Chart.prototype.getState = function () {\r\n\t        return this.state.data;\r\n\t    };\r\n\t    /**\r\n\t     * shortcut for Chart.state.getTrend\r\n\t     */\r\n\t    Chart.prototype.getTrend = function (trendName) {\r\n\t        return this.state.getTrend(trendName);\r\n\t    };\r\n\t    /**\r\n\t     * shortcut for Chart.state.setState\r\n\t     */\r\n\t    Chart.prototype.setState = function (state) {\r\n\t        return this.state.setState(state);\r\n\t    };\r\n\t    Chart.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        var $el = this.$el;\r\n\t        if (this.state.data.controls.enabled) {\r\n\t            $el.addEventListener('mousewheel', function (ev) {\r\n\t                _this.onMouseWheel(ev);\r\n\t            });\r\n\t            $el.addEventListener('mousemove', function (ev) {\r\n\t                _this.onMouseMove(ev);\r\n\t            });\r\n\t            $el.addEventListener('mousedown', function (ev) { return _this.onMouseDown(ev); });\r\n\t            $el.addEventListener('mouseup', function (ev) { return _this.onMouseUp(ev); });\r\n\t            $el.addEventListener('touchmove', function (ev) {\r\n\t                _this.onTouchMove(ev);\r\n\t            });\r\n\t            $el.addEventListener('touchend', function (ev) {\r\n\t                _this.onTouchEnd(ev);\r\n\t            });\r\n\t        }\r\n\t        if (this.state.data.autoResize) {\r\n\t            this.resizeSensor = new deps_1.ResizeSensor(this.$container, function () {\r\n\t                _this.onChartContainerResizeHandler(_this.$container.clientWidth, _this.$container.clientHeight);\r\n\t            });\r\n\t        }\r\n\t        this.unsubscribers = [\r\n\t            this.state.onTrendsChange(function () { return _this.autoscroll(); }),\r\n\t            this.state.screen.onTransformationFrame(function (options) { return _this.onScreenTransformHandler(options); }),\r\n\t            this.state.onResize(function (options) { return _this.onChartResize(); })\r\n\t        ];\r\n\t    };\r\n\t    Chart.prototype.unbindEvents = function () {\r\n\t        // TODO: unbind events correctly\r\n\t        try {\r\n\t            this.resizeSensor && this.resizeSensor.detach();\r\n\t        }\r\n\t        catch (e) {\r\n\t        }\r\n\t        this.$el.remove();\r\n\t        this.unsubscribers.forEach(function (unsubscribe) { return unsubscribe(); });\r\n\t    };\r\n\t    Chart.prototype.setupCamera = function () {\r\n\t        var camSettings = this.state.screen.getCameraSettings();\r\n\t        if (!this.camera) {\r\n\t            this.camera = new PerspectiveCamera(camSettings.FOV, camSettings.aspect, camSettings.near, camSettings.far);\r\n\t            this.scene.add(this.camera);\r\n\t        }\r\n\t        else {\r\n\t            this.camera.fov = camSettings.FOV;\r\n\t            this.camera.aspect = camSettings.aspect;\r\n\t            this.camera.far = camSettings.far;\r\n\t            this.camera.near = camSettings.near;\r\n\t            this.camera.updateProjectionMatrix();\r\n\t        }\r\n\t        this.camera.position.set(camSettings.x, camSettings.y, camSettings.z);\r\n\t        this.cameraInitialPosition = this.camera.position.clone();\r\n\t        this.onScreenTransformHandler(this.state.screen.options);\r\n\t    };\r\n\t    Chart.prototype.onScreenTransformHandler = function (options) {\r\n\t        if (options.scrollX != void 0) {\r\n\t            var scrollX_1 = this.cameraInitialPosition.x + options.scrollX;\r\n\t            // scrollX =  Math.round(scrollX); // prevent to set camera beetween pixels\r\n\t            this.camera.position.setX(scrollX_1);\r\n\t        }\r\n\t        if (options.scrollY != void 0) {\r\n\t            var scrollY_1 = this.cameraInitialPosition.y + options.scrollY;\r\n\t            // scrollY = Math.round(scrollY); // prevent to set camera beetween pixels\r\n\t            this.camera.position.setY(scrollY_1);\r\n\t        }\r\n\t    };\r\n\t    Chart.prototype.autoscroll = function () {\r\n\t        var state = this.state;\r\n\t        if (!state.data.autoScroll)\r\n\t            return;\r\n\t        var oldTrendsMaxX = state.data.prevState.computedData.trends.maxXVal;\r\n\t        var trendsMaxXDelta = state.data.computedData.trends.maxXVal - oldTrendsMaxX;\r\n\t        if (trendsMaxXDelta > 0) {\r\n\t            var maxVisibleX = this.state.screen.getScreenRightVal();\r\n\t            var paddingRightX = this.state.getPaddingRight();\r\n\t            var currentScroll = state.data.xAxis.range.scroll;\r\n\t            if (oldTrendsMaxX < paddingRightX || oldTrendsMaxX > maxVisibleX) {\r\n\t                return;\r\n\t            }\r\n\t            var scrollDelta = trendsMaxXDelta;\r\n\t            this.setState({ xAxis: { range: { scroll: currentScroll + scrollDelta } } });\r\n\t        }\r\n\t    };\r\n\t    Chart.prototype.onScrollStop = function () {\r\n\t        // var tendsXMax = this.state.data.computedData.trends.maxX;\r\n\t        // var paddingRightX = this.state.getPaddingRight();\r\n\t        // if (tendsXMax < paddingRightX) {\r\n\t        // \tthis.state.scrollToEnd();\r\n\t        // }\r\n\t    };\r\n\t    Chart.prototype.onMouseDown = function (ev) {\r\n\t        this.setState({ cursor: { dragMode: true, x: ev.clientX, y: ev.clientY } });\r\n\t    };\r\n\t    Chart.prototype.onMouseUp = function (ev) {\r\n\t        this.setState({ cursor: { dragMode: false } });\r\n\t    };\r\n\t    Chart.prototype.onMouseMove = function (ev) {\r\n\t        if (this.state.data.cursor.dragMode) {\r\n\t            this.setState({ cursor: { dragMode: true, x: ev.clientX, y: ev.clientY } });\r\n\t        }\r\n\t    };\r\n\t    Chart.prototype.onMouseWheel = function (ev) {\r\n\t        ev.stopPropagation();\r\n\t        ev.preventDefault();\r\n\t        var zoomOrigin = ev.layerX / this.state.data.width;\r\n\t        var zoomValue = 1 + ev.wheelDeltaY * 0.001;\r\n\t        this.zoom(zoomValue, zoomOrigin);\r\n\t    };\r\n\t    Chart.prototype.onTouchMove = function (ev) {\r\n\t        this.setState({ cursor: { dragMode: true, x: ev.touches[0].clientX, y: ev.touches[0].clientY } });\r\n\t    };\r\n\t    Chart.prototype.onTouchEnd = function (ev) {\r\n\t        this.setState({ cursor: { dragMode: false } });\r\n\t    };\r\n\t    Chart.prototype.onChartContainerResizeHandler = function (width, height) {\r\n\t        this.setState({ width: width, height: height });\r\n\t    };\r\n\t    Chart.prototype.onChartResize = function () {\r\n\t        var _a = this.state.data, width = _a.width, height = _a.height;\r\n\t        this.renderer.setSize(width, height);\r\n\t        this.setupCamera();\r\n\t    };\r\n\t    Chart.prototype.zoom = function (zoomValue, zoomOrigin) {\r\n\t        var _this = this;\r\n\t        var MAX_ZOOM_VALUE = 1.5;\r\n\t        var MIN_ZOOM_VALUE = 0.7;\r\n\t        zoomValue = Math.min(zoomValue, MAX_ZOOM_VALUE);\r\n\t        zoomValue = Math.max(zoomValue, MIN_ZOOM_VALUE);\r\n\t        var autoScrollIsEnabled = this.state.data.autoScroll;\r\n\t        if (autoScrollIsEnabled)\r\n\t            this.state.setState({ autoScroll: false });\r\n\t        this.state.zoom(zoomValue, zoomOrigin).then(function () {\r\n\t            if (autoScrollIsEnabled)\r\n\t                _this.setState({ autoScroll: true });\r\n\t        });\r\n\t    };\r\n\t    /**\r\n\t     * creates simple chart without animations and minimal widgets set\r\n\t     */\r\n\t    Chart.createPreviewChart = function (userOptions, $el) {\r\n\t        var previewChartOptions = {\r\n\t            animations: { enabled: false },\r\n\t            widgets: {\r\n\t                Grid: { enabled: false },\r\n\t                Axis: { enabled: false },\r\n\t                TrendsGradient: { enabled: false }\r\n\t            }\r\n\t        };\r\n\t        var options = Utils_1.Utils.deepMerge(userOptions, previewChartOptions);\r\n\t        return new Chart(options, $el);\r\n\t    };\r\n\t    Chart.devicePixelRatio = window.devicePixelRatio;\r\n\t    Chart.installedWidgets = {};\r\n\t    Chart.renderers = {\r\n\t        CanvasRenderer: THREE.CanvasRenderer,\r\n\t        WebGLRenderer: THREE.WebGLRenderer\r\n\t    };\r\n\t    return Chart;\r\n\t}());\r\n\texports.Chart = Chart;\r\n\t// install built-in widgets\r\n\tChart.installWidget(TrendsLineWidget_1.TrendsLineWidget);\r\n\tChart.installWidget(TrendsCandleWidget_1.TrendsCandlesWidget);\r\n\tChart.installWidget(AxisWidget_1.AxisWidget);\r\n\tChart.installWidget(GridWidget_1.GridWidget);\r\n\tChart.installWidget(TrendsBeaconWidget_1.TrendsBeaconWidget);\r\n\tChart.installWidget(TrendsIndicatorWidget_1.TrendsIndicatorWidget);\r\n\t// Chart.installWidget(TrendsGradientWidget);\r\n\tChart.installWidget(TrendsLoadingWidget_1.TrendsLoadingWidget);\r\n\tChart.installWidget(AxisMarksWidget_1.AxisMarksWidget);\r\n\tChart.installWidget(BorderWidget_1.BorderWidget);\r\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/// <reference path=\"./ResizeSensor.ts\" />\r\n\t\"use strict\";\r\n\twindow.Stats = __webpack_require__(4);\r\n\t//require('gsap/src/uncompressed/easing/EasePack.js');\r\n\t__webpack_require__(5);\r\n\t__webpack_require__(6);\r\n\texports.isPlainObject = __webpack_require__(7);\r\n\texports.EE2 = __webpack_require__(9);\r\n\tvar es6_promise_1 = __webpack_require__(10);\r\n\texports.Promise = es6_promise_1.Promise;\r\n\texports.ResizeSensor = __webpack_require__(11);\r\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t// stats.js - http://github.com/mrdoob/stats.js\r\n\tvar Stats=function(){function h(a){c.appendChild(a.dom);return a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?\"block\":\"none\";l=a}var l=0,c=document.createElement(\"div\");c.style.cssText=\"position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000\";c.addEventListener(\"click\",function(a){a.preventDefault();k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel(\"FPS\",\"#0ff\",\"#002\")),f=h(new Stats.Panel(\"MS\",\"#0f0\",\"#020\"));\r\n\tif(self.performance&&self.performance.memory)var t=h(new Stats.Panel(\"MB\",\"#f08\",\"#201\"));k(0);return{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();f.update(c-g,200);if(c>e+1E3&&(r.update(1E3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};\r\n\tStats.Panel=function(h,k,l){var c=Infinity,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement(\"canvas\");q.width=r;q.height=f;q.style.cssText=\"width:80px;height:48px\";var b=q.getContext(\"2d\");b.font=\"bold \"+9*a+\"px Helvetica,Arial,sans-serif\";b.textBaseline=\"top\";b.fillStyle=l;b.fillRect(0,0,r,f);b.fillStyle=k;b.fillText(h,t,u);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(f,\r\n\tv){c=Math.min(c,f);g=Math.max(g,f);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=k;b.fillText(e(f)+\" \"+h+\" (\"+e(c)+\"-\"+e(g)+\")\",t,u);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}};\"object\"===typeof module&&(module.exports=Stats);\r\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t/**\r\n\t * @author mrdoob / http://mrdoob.com/\r\n\t */\r\n\t\r\n\tTHREE.SpriteCanvasMaterial = function ( parameters ) {\r\n\t\r\n\t\tTHREE.Material.call( this );\r\n\t\r\n\t\tthis.type = 'SpriteCanvasMaterial';\r\n\t\r\n\t\tthis.color = new THREE.Color( 0xffffff );\r\n\t\tthis.program = function ( context, color ) {};\r\n\t\r\n\t\tthis.setValues( parameters );\r\n\t\r\n\t};\r\n\t\r\n\tTHREE.SpriteCanvasMaterial.prototype = Object.create( THREE.Material.prototype );\r\n\tTHREE.SpriteCanvasMaterial.prototype.constructor = THREE.SpriteCanvasMaterial;\r\n\t\r\n\tTHREE.SpriteCanvasMaterial.prototype.clone = function () {\r\n\t\r\n\t\tvar material = new THREE.SpriteCanvasMaterial();\r\n\t\r\n\t\tmaterial.copy( this );\r\n\t\tmaterial.color.copy( this.color );\r\n\t\tmaterial.program = this.program;\r\n\t\r\n\t\treturn material;\r\n\t\r\n\t};\r\n\t\r\n\t//\r\n\t\r\n\tTHREE.CanvasRenderer = function ( parameters ) {\r\n\t\r\n\t\tconsole.log( 'THREE.CanvasRenderer', THREE.REVISION );\r\n\t\r\n\t\tparameters = parameters || {};\r\n\t\r\n\t\tvar _this = this,\r\n\t\t_renderData, _elements, _lights,\r\n\t\t_projector = new THREE.Projector(),\r\n\t\r\n\t\t_canvas = parameters.canvas !== undefined\r\n\t\t\t\t ? parameters.canvas\r\n\t\t\t\t : document.createElement( 'canvas' ),\r\n\t\r\n\t\t_canvasWidth = _canvas.width,\r\n\t\t_canvasHeight = _canvas.height,\r\n\t\t_canvasWidthHalf = Math.floor( _canvasWidth / 2 ),\r\n\t\t_canvasHeightHalf = Math.floor( _canvasHeight / 2 ),\r\n\t\r\n\t\t_viewportX = 0,\r\n\t\t_viewportY = 0,\r\n\t\t_viewportWidth = _canvasWidth,\r\n\t\t_viewportHeight = _canvasHeight,\r\n\t\r\n\t\t_pixelRatio = 1,\r\n\t\r\n\t\t_context = _canvas.getContext( '2d', {\r\n\t\t\talpha: parameters.alpha === true\r\n\t\t} ),\r\n\t\r\n\t\t_clearColor = new THREE.Color( 0x000000 ),\r\n\t\t_clearAlpha = parameters.alpha === true ? 0 : 1,\r\n\t\r\n\t\t_contextGlobalAlpha = 1,\r\n\t\t_contextGlobalCompositeOperation = 0,\r\n\t\t_contextStrokeStyle = null,\r\n\t\t_contextFillStyle = null,\r\n\t\t_contextLineWidth = null,\r\n\t\t_contextLineCap = null,\r\n\t\t_contextLineJoin = null,\r\n\t\t_contextLineDash = [],\r\n\t\r\n\t\t_camera,\r\n\t\r\n\t\t_v1, _v2, _v3, _v4,\r\n\t\t_v5 = new THREE.RenderableVertex(),\r\n\t\t_v6 = new THREE.RenderableVertex(),\r\n\t\r\n\t\t_v1x, _v1y, _v2x, _v2y, _v3x, _v3y,\r\n\t\t_v4x, _v4y, _v5x, _v5y, _v6x, _v6y,\r\n\t\r\n\t\t_color = new THREE.Color(),\r\n\t\t_color1 = new THREE.Color(),\r\n\t\t_color2 = new THREE.Color(),\r\n\t\t_color3 = new THREE.Color(),\r\n\t\t_color4 = new THREE.Color(),\r\n\t\r\n\t\t_diffuseColor = new THREE.Color(),\r\n\t\t_emissiveColor = new THREE.Color(),\r\n\t\r\n\t\t_lightColor = new THREE.Color(),\r\n\t\r\n\t\t_patterns = {},\r\n\t\r\n\t\t_image, _uvs,\r\n\t\t_uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y,\r\n\t\r\n\t\t_clipBox = new THREE.Box2(),\r\n\t\t_clearBox = new THREE.Box2(),\r\n\t\t_elemBox = new THREE.Box2(),\r\n\t\r\n\t\t_ambientLight = new THREE.Color(),\r\n\t\t_directionalLights = new THREE.Color(),\r\n\t\t_pointLights = new THREE.Color(),\r\n\t\r\n\t\t_vector3 = new THREE.Vector3(), // Needed for PointLight\r\n\t\t_centroid = new THREE.Vector3(),\r\n\t\t_normal = new THREE.Vector3(),\r\n\t\t_normalViewMatrix = new THREE.Matrix3();\r\n\t\r\n\t\t/* TODO\r\n\t\t_canvas.mozImageSmoothingEnabled = false;\r\n\t\t_canvas.webkitImageSmoothingEnabled = false;\r\n\t\t_canvas.msImageSmoothingEnabled = false;\r\n\t\t_canvas.imageSmoothingEnabled = false;\r\n\t\t*/\r\n\t\r\n\t\t// dash+gap fallbacks for Firefox and everything else\r\n\t\r\n\t\tif ( _context.setLineDash === undefined ) {\r\n\t\r\n\t\t\t_context.setLineDash = function () {};\r\n\t\r\n\t\t}\r\n\t\r\n\t\tthis.domElement = _canvas;\r\n\t\r\n\t\tthis.autoClear = true;\r\n\t\tthis.sortObjects = true;\r\n\t\tthis.sortElements = true;\r\n\t\r\n\t\tthis.info = {\r\n\t\r\n\t\t\trender: {\r\n\t\r\n\t\t\t\tvertices: 0,\r\n\t\t\t\tfaces: 0\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t};\r\n\t\r\n\t\t// WebGLRenderer compatibility\r\n\t\r\n\t\tthis.supportsVertexTextures = function () {};\r\n\t\tthis.setFaceCulling = function () {};\r\n\t\r\n\t\t// API\r\n\t\r\n\t\tthis.getContext = function () {\r\n\t\r\n\t\t\treturn _context;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.getContextAttributes = function () {\r\n\t\r\n\t\t\treturn _context.getContextAttributes();\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.getPixelRatio = function () {\r\n\t\r\n\t\t\treturn _pixelRatio;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.setPixelRatio = function ( value ) {\r\n\t\r\n\t\t\tif ( value !== undefined ) _pixelRatio = value;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.setSize = function ( width, height, updateStyle ) {\r\n\t\r\n\t\t\t_canvasWidth = width * _pixelRatio;\r\n\t\t\t_canvasHeight = height * _pixelRatio;\r\n\t\r\n\t\t\t_canvas.width = _canvasWidth;\r\n\t\t\t_canvas.height = _canvasHeight;\r\n\t\r\n\t\t\t_canvasWidthHalf = Math.floor( _canvasWidth / 2 );\r\n\t\t\t_canvasHeightHalf = Math.floor( _canvasHeight / 2 );\r\n\t\r\n\t\t\tif ( updateStyle !== false ) {\r\n\t\r\n\t\t\t\t_canvas.style.width = width + 'px';\r\n\t\t\t\t_canvas.style.height = height + 'px';\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\t_clipBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t\t_clipBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\t\r\n\t\t\t_clearBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t\t_clearBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\t\r\n\t\t\t_contextGlobalAlpha = 1;\r\n\t\t\t_contextGlobalCompositeOperation = 0;\r\n\t\t\t_contextStrokeStyle = null;\r\n\t\t\t_contextFillStyle = null;\r\n\t\t\t_contextLineWidth = null;\r\n\t\t\t_contextLineCap = null;\r\n\t\t\t_contextLineJoin = null;\r\n\t\r\n\t\t\tthis.setViewport( 0, 0, width, height );\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.setViewport = function ( x, y, width, height ) {\r\n\t\r\n\t\t\t_viewportX = x * _pixelRatio;\r\n\t\t\t_viewportY = y * _pixelRatio;\r\n\t\r\n\t\t\t_viewportWidth = width * _pixelRatio;\r\n\t\t\t_viewportHeight = height * _pixelRatio;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.setScissor = function () {};\r\n\t\tthis.setScissorTest = function () {};\r\n\t\r\n\t\tthis.setClearColor = function ( color, alpha ) {\r\n\t\r\n\t\t\t_clearColor.set( color );\r\n\t\t\t_clearAlpha = alpha !== undefined ? alpha : 1;\r\n\t\r\n\t\t\t_clearBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t\t_clearBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.setClearColorHex = function ( hex, alpha ) {\r\n\t\r\n\t\t\tconsole.warn( 'THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.' );\r\n\t\t\tthis.setClearColor( hex, alpha );\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.getClearColor = function () {\r\n\t\r\n\t\t\treturn _clearColor;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.getClearAlpha = function () {\r\n\t\r\n\t\t\treturn _clearAlpha;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.getMaxAnisotropy = function () {\r\n\t\r\n\t\t\treturn 0;\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.clear = function () {\r\n\t\r\n\t\t\tif ( _clearBox.isEmpty() === false ) {\r\n\t\r\n\t\t\t\t_clearBox.intersect( _clipBox );\r\n\t\t\t\t_clearBox.expandByScalar( 2 );\r\n\t\r\n\t\t\t\t_clearBox.min.x = _clearBox.min.x + _canvasWidthHalf;\r\n\t\t\t\t_clearBox.min.y =  - _clearBox.min.y + _canvasHeightHalf;\t\t// higher y value !\r\n\t\t\t\t_clearBox.max.x = _clearBox.max.x + _canvasWidthHalf;\r\n\t\t\t\t_clearBox.max.y =  - _clearBox.max.y + _canvasHeightHalf;\t\t// lower y value !\r\n\t\r\n\t\t\t\tif ( _clearAlpha < 1 ) {\r\n\t\r\n\t\t\t\t\t_context.clearRect(\r\n\t\t\t\t\t\t_clearBox.min.x | 0,\r\n\t\t\t\t\t\t_clearBox.max.y | 0,\r\n\t\t\t\t\t\t( _clearBox.max.x - _clearBox.min.x ) | 0,\r\n\t\t\t\t\t\t( _clearBox.min.y - _clearBox.max.y ) | 0\r\n\t\t\t\t\t);\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif ( _clearAlpha > 0 ) {\r\n\t\r\n\t\t\t\t\tsetBlending( THREE.NormalBlending );\r\n\t\t\t\t\tsetOpacity( 1 );\r\n\t\r\n\t\t\t\t\tsetFillStyle( 'rgba(' + Math.floor( _clearColor.r * 255 ) + ',' + Math.floor( _clearColor.g * 255 ) + ',' + Math.floor( _clearColor.b * 255 ) + ',' + _clearAlpha + ')' );\r\n\t\r\n\t\t\t\t\t_context.fillRect(\r\n\t\t\t\t\t\t_clearBox.min.x | 0,\r\n\t\t\t\t\t\t_clearBox.max.y | 0,\r\n\t\t\t\t\t\t( _clearBox.max.x - _clearBox.min.x ) | 0,\r\n\t\t\t\t\t\t( _clearBox.min.y - _clearBox.max.y ) | 0\r\n\t\t\t\t\t);\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t_clearBox.makeEmpty();\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t};\r\n\t\r\n\t\t// compatibility\r\n\t\r\n\t\tthis.clearColor = function () {};\r\n\t\tthis.clearDepth = function () {};\r\n\t\tthis.clearStencil = function () {};\r\n\t\r\n\t\tthis.render = function ( scene, camera ) {\r\n\t\r\n\t\t\tif ( camera instanceof THREE.Camera === false ) {\r\n\t\r\n\t\t\t\tconsole.error( 'THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.' );\r\n\t\t\t\treturn;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tif ( this.autoClear === true ) this.clear();\r\n\t\r\n\t\t\t_this.info.render.vertices = 0;\r\n\t\t\t_this.info.render.faces = 0;\r\n\t\r\n\t\t\t_context.setTransform( _viewportWidth / _canvasWidth, 0, 0, - _viewportHeight / _canvasHeight, _viewportX, _canvasHeight - _viewportY );\r\n\t\t\t_context.translate( _canvasWidthHalf, _canvasHeightHalf );\r\n\t\r\n\t\t\t_renderData = _projector.projectScene( scene, camera, this.sortObjects, this.sortElements );\r\n\t\t\t_elements = _renderData.elements;\r\n\t\t\t_lights = _renderData.lights;\r\n\t\t\t_camera = camera;\r\n\t\r\n\t\t\t_normalViewMatrix.getNormalMatrix( camera.matrixWorldInverse );\r\n\t\r\n\t\t\t/* DEBUG\r\n\t\t\tsetFillStyle( 'rgba( 0, 255, 255, 0.5 )' );\r\n\t\t\t_context.fillRect( _clipBox.min.x, _clipBox.min.y, _clipBox.max.x - _clipBox.min.x, _clipBox.max.y - _clipBox.min.y );\r\n\t\t\t*/\r\n\t\r\n\t\t\tcalculateLights();\r\n\t\r\n\t\t\tfor ( var e = 0, el = _elements.length; e < el; e ++ ) {\r\n\t\r\n\t\t\t\tvar element = _elements[ e ];\r\n\t\r\n\t\t\t\tvar material = element.material;\r\n\t\r\n\t\t\t\tif ( material === undefined || material.opacity === 0 ) continue;\r\n\t\r\n\t\t\t\t_elemBox.makeEmpty();\r\n\t\r\n\t\t\t\tif ( element instanceof THREE.RenderableSprite ) {\r\n\t\r\n\t\t\t\t\t_v1 = element;\r\n\t\t\t\t\t_v1.x *= _canvasWidthHalf; _v1.y *= _canvasHeightHalf;\r\n\t\r\n\t\t\t\t\trenderSprite( _v1, element, material );\r\n\t\r\n\t\t\t\t} else if ( element instanceof THREE.RenderableLine ) {\r\n\t\r\n\t\t\t\t\t_v1 = element.v1; _v2 = element.v2;\r\n\t\r\n\t\t\t\t\t_v1.positionScreen.x *= _canvasWidthHalf; _v1.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t\t_v2.positionScreen.x *= _canvasWidthHalf; _v2.positionScreen.y *= _canvasHeightHalf;\r\n\t\r\n\t\t\t\t\t_elemBox.setFromPoints( [\r\n\t\t\t\t\t\t_v1.positionScreen,\r\n\t\t\t\t\t\t_v2.positionScreen\r\n\t\t\t\t\t] );\r\n\t\r\n\t\t\t\t\tif ( _clipBox.intersectsBox( _elemBox ) === true ) {\r\n\t\r\n\t\t\t\t\t\trenderLine( _v1, _v2, element, material );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t} else if ( element instanceof THREE.RenderableFace ) {\r\n\t\r\n\t\t\t\t\t_v1 = element.v1; _v2 = element.v2; _v3 = element.v3;\r\n\t\r\n\t\t\t\t\tif ( _v1.positionScreen.z < - 1 || _v1.positionScreen.z > 1 ) continue;\r\n\t\t\t\t\tif ( _v2.positionScreen.z < - 1 || _v2.positionScreen.z > 1 ) continue;\r\n\t\t\t\t\tif ( _v3.positionScreen.z < - 1 || _v3.positionScreen.z > 1 ) continue;\r\n\t\r\n\t\t\t\t\t_v1.positionScreen.x *= _canvasWidthHalf; _v1.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t\t_v2.positionScreen.x *= _canvasWidthHalf; _v2.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t\t_v3.positionScreen.x *= _canvasWidthHalf; _v3.positionScreen.y *= _canvasHeightHalf;\r\n\t\r\n\t\t\t\t\tif ( material.overdraw > 0 ) {\r\n\t\r\n\t\t\t\t\t\texpand( _v1.positionScreen, _v2.positionScreen, material.overdraw );\r\n\t\t\t\t\t\texpand( _v2.positionScreen, _v3.positionScreen, material.overdraw );\r\n\t\t\t\t\t\texpand( _v3.positionScreen, _v1.positionScreen, material.overdraw );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t_elemBox.setFromPoints( [\r\n\t\t\t\t\t\t_v1.positionScreen,\r\n\t\t\t\t\t\t_v2.positionScreen,\r\n\t\t\t\t\t\t_v3.positionScreen\r\n\t\t\t\t\t] );\r\n\t\r\n\t\t\t\t\tif ( _clipBox.intersectsBox( _elemBox ) === true ) {\r\n\t\r\n\t\t\t\t\t\trenderFace3( _v1, _v2, _v3, 0, 1, 2, element, material );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t/* DEBUG\r\n\t\t\t\tsetLineWidth( 1 );\r\n\t\t\t\tsetStrokeStyle( 'rgba( 0, 255, 0, 0.5 )' );\r\n\t\t\t\t_context.strokeRect( _elemBox.min.x, _elemBox.min.y, _elemBox.max.x - _elemBox.min.x, _elemBox.max.y - _elemBox.min.y );\r\n\t\t\t\t*/\r\n\t\r\n\t\t\t\t_clearBox.union( _elemBox );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\t/* DEBUG\r\n\t\t\tsetLineWidth( 1 );\r\n\t\t\tsetStrokeStyle( 'rgba( 255, 0, 0, 0.5 )' );\r\n\t\t\t_context.strokeRect( _clearBox.min.x, _clearBox.min.y, _clearBox.max.x - _clearBox.min.x, _clearBox.max.y - _clearBox.min.y );\r\n\t\t\t*/\r\n\t\r\n\t\t\t_context.setTransform( 1, 0, 0, 1, 0, 0 );\r\n\t\r\n\t\t};\r\n\t\r\n\t\t//\r\n\t\r\n\t\tfunction calculateLights() {\r\n\t\r\n\t\t\t_ambientLight.setRGB( 0, 0, 0 );\r\n\t\t\t_directionalLights.setRGB( 0, 0, 0 );\r\n\t\t\t_pointLights.setRGB( 0, 0, 0 );\r\n\t\r\n\t\t\tfor ( var l = 0, ll = _lights.length; l < ll; l ++ ) {\r\n\t\r\n\t\t\t\tvar light = _lights[ l ];\r\n\t\t\t\tvar lightColor = light.color;\r\n\t\r\n\t\t\t\tif ( light instanceof THREE.AmbientLight ) {\r\n\t\r\n\t\t\t\t\t_ambientLight.add( lightColor );\r\n\t\r\n\t\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\t\r\n\t\t\t\t\t// for sprites\r\n\t\r\n\t\t\t\t\t_directionalLights.add( lightColor );\r\n\t\r\n\t\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\t\r\n\t\t\t\t\t// for sprites\r\n\t\r\n\t\t\t\t\t_pointLights.add( lightColor );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction calculateLight( position, normal, color ) {\r\n\t\r\n\t\t\tfor ( var l = 0, ll = _lights.length; l < ll; l ++ ) {\r\n\t\r\n\t\t\t\tvar light = _lights[ l ];\r\n\t\r\n\t\t\t\t_lightColor.copy( light.color );\r\n\t\r\n\t\t\t\tif ( light instanceof THREE.DirectionalLight ) {\r\n\t\r\n\t\t\t\t\tvar lightPosition = _vector3.setFromMatrixPosition( light.matrixWorld ).normalize();\r\n\t\r\n\t\t\t\t\tvar amount = normal.dot( lightPosition );\r\n\t\r\n\t\t\t\t\tif ( amount <= 0 ) continue;\r\n\t\r\n\t\t\t\t\tamount *= light.intensity;\r\n\t\r\n\t\t\t\t\tcolor.add( _lightColor.multiplyScalar( amount ) );\r\n\t\r\n\t\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\t\r\n\t\t\t\t\tvar lightPosition = _vector3.setFromMatrixPosition( light.matrixWorld );\r\n\t\r\n\t\t\t\t\tvar amount = normal.dot( _vector3.subVectors( lightPosition, position ).normalize() );\r\n\t\r\n\t\t\t\t\tif ( amount <= 0 ) continue;\r\n\t\r\n\t\t\t\t\tamount *= light.distance == 0 ? 1 : 1 - Math.min( position.distanceTo( lightPosition ) / light.distance, 1 );\r\n\t\r\n\t\t\t\t\tif ( amount == 0 ) continue;\r\n\t\r\n\t\t\t\t\tamount *= light.intensity;\r\n\t\r\n\t\t\t\t\tcolor.add( _lightColor.multiplyScalar( amount ) );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction renderSprite( v1, element, material ) {\r\n\t\r\n\t\t\tsetOpacity( material.opacity );\r\n\t\t\tsetBlending( material.blending );\r\n\t\r\n\t\t\tvar scaleX = element.scale.x * _canvasWidthHalf;\r\n\t\t\tvar scaleY = element.scale.y * _canvasHeightHalf;\r\n\t\r\n\t\t\tvar dist = 0.5 * Math.sqrt( scaleX * scaleX + scaleY * scaleY ); // allow for rotated sprite\r\n\t\t\t_elemBox.min.set( v1.x - dist, v1.y - dist );\r\n\t\t\t_elemBox.max.set( v1.x + dist, v1.y + dist );\r\n\t\r\n\t\t\tif ( material instanceof THREE.SpriteMaterial ) {\r\n\t\r\n\t\t\t\tvar texture = material.map;\r\n\t\r\n\t\t\t\tif ( texture !== null ) {\r\n\t\r\n\t\t\t\t\tvar pattern = _patterns[ texture.id ];\r\n\t\r\n\t\t\t\t\tif ( pattern === undefined || pattern.version !== texture.version ) {\r\n\t\r\n\t\t\t\t\t\tpattern = textureToPattern( texture );\r\n\t\t\t\t\t\t_patterns[ texture.id ] = pattern;\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tif ( pattern.canvas !== undefined ) {\r\n\t\r\n\t\t\t\t\t\tsetFillStyle( pattern.canvas );\r\n\t\r\n\t\t\t\t\t\tvar bitmap = texture.image;\r\n\t\r\n\t\t\t\t\t\tvar ox = bitmap.width * texture.offset.x;\r\n\t\t\t\t\t\tvar oy = bitmap.height * texture.offset.y;\r\n\t\r\n\t\t\t\t\t\tvar sx = bitmap.width * texture.repeat.x;\r\n\t\t\t\t\t\tvar sy = bitmap.height * texture.repeat.y;\r\n\t\r\n\t\t\t\t\t\tvar cx = scaleX / sx;\r\n\t\t\t\t\t\tvar cy = scaleY / sy;\r\n\t\r\n\t\t\t\t\t\t_context.save();\r\n\t\t\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t\t\t_context.translate( - scaleX / 2, - scaleY / 2 );\r\n\t\t\t\t\t\t_context.scale( cx, cy );\r\n\t\t\t\t\t\t_context.translate( - ox, - oy );\r\n\t\t\t\t\t\t_context.fillRect( ox, oy, sx, sy );\r\n\t\t\t\t\t\t_context.restore();\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t// no texture\r\n\t\r\n\t\t\t\t\tsetFillStyle( material.color.getStyle() );\r\n\t\r\n\t\t\t\t\t_context.save();\r\n\t\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t\t_context.scale( scaleX, - scaleY );\r\n\t\t\t\t\t_context.fillRect( - 0.5, - 0.5, 1, 1 );\r\n\t\t\t\t\t_context.restore();\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t} else if ( material instanceof THREE.SpriteCanvasMaterial ) {\r\n\t\r\n\t\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\t\t\tsetFillStyle( material.color.getStyle() );\r\n\t\r\n\t\t\t\t_context.save();\r\n\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t_context.scale( scaleX, scaleY );\r\n\t\r\n\t\t\t\tmaterial.program( _context );\r\n\t\r\n\t\t\t\t_context.restore();\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\t/* DEBUG\r\n\t\t\tsetStrokeStyle( 'rgb(255,255,0)' );\r\n\t\t\t_context.beginPath();\r\n\t\t\t_context.moveTo( v1.x - 10, v1.y );\r\n\t\t\t_context.lineTo( v1.x + 10, v1.y );\r\n\t\t\t_context.moveTo( v1.x, v1.y - 10 );\r\n\t\t\t_context.lineTo( v1.x, v1.y + 10 );\r\n\t\t\t_context.stroke();\r\n\t\t\t*/\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction renderLine( v1, v2, element, material ) {\r\n\t\r\n\t\t\tsetOpacity( material.opacity );\r\n\t\t\tsetBlending( material.blending );\r\n\t\r\n\t\t\t_context.beginPath();\r\n\t\t\t_context.moveTo( v1.positionScreen.x, v1.positionScreen.y );\r\n\t\t\t_context.lineTo( v2.positionScreen.x, v2.positionScreen.y );\r\n\t\r\n\t\t\tif ( material instanceof THREE.LineBasicMaterial ) {\r\n\t\r\n\t\t\t\tsetLineWidth( material.linewidth );\r\n\t\t\t\tsetLineCap( material.linecap );\r\n\t\t\t\tsetLineJoin( material.linejoin );\r\n\t\r\n\t\t\t\tif ( material.vertexColors !== THREE.VertexColors ) {\r\n\t\r\n\t\t\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\r\n\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\tvar colorStyle1 = element.vertexColors[ 0 ].getStyle();\r\n\t\t\t\t\tvar colorStyle2 = element.vertexColors[ 1 ].getStyle();\r\n\t\r\n\t\t\t\t\tif ( colorStyle1 === colorStyle2 ) {\r\n\t\r\n\t\t\t\t\t\tsetStrokeStyle( colorStyle1 );\r\n\t\r\n\t\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t\ttry {\r\n\t\r\n\t\t\t\t\t\t\tvar grad = _context.createLinearGradient(\r\n\t\t\t\t\t\t\t\tv1.positionScreen.x,\r\n\t\t\t\t\t\t\t\tv1.positionScreen.y,\r\n\t\t\t\t\t\t\t\tv2.positionScreen.x,\r\n\t\t\t\t\t\t\t\tv2.positionScreen.y\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tgrad.addColorStop( 0, colorStyle1 );\r\n\t\t\t\t\t\t\tgrad.addColorStop( 1, colorStyle2 );\r\n\t\r\n\t\t\t\t\t\t} catch ( exception ) {\r\n\t\r\n\t\t\t\t\t\t\tgrad = colorStyle1;\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tsetStrokeStyle( grad );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t_context.stroke();\r\n\t\t\t\t_elemBox.expandByScalar( material.linewidth * 2 );\r\n\t\r\n\t\t\t} else if ( material instanceof THREE.LineDashedMaterial ) {\r\n\t\r\n\t\t\t\tsetLineWidth( material.linewidth );\r\n\t\t\t\tsetLineCap( material.linecap );\r\n\t\t\t\tsetLineJoin( material.linejoin );\r\n\t\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\t\t\tsetLineDash( [ material.dashSize, material.gapSize ] );\r\n\t\r\n\t\t\t\t_context.stroke();\r\n\t\r\n\t\t\t\t_elemBox.expandByScalar( material.linewidth * 2 );\r\n\t\r\n\t\t\t\tsetLineDash( [] );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction renderFace3( v1, v2, v3, uv1, uv2, uv3, element, material ) {\r\n\t\r\n\t\t\t_this.info.render.vertices += 3;\r\n\t\t\t_this.info.render.faces ++;\r\n\t\r\n\t\t\tsetOpacity( material.opacity );\r\n\t\t\tsetBlending( material.blending );\r\n\t\r\n\t\t\t_v1x = v1.positionScreen.x; _v1y = v1.positionScreen.y;\r\n\t\t\t_v2x = v2.positionScreen.x; _v2y = v2.positionScreen.y;\r\n\t\t\t_v3x = v3.positionScreen.x; _v3y = v3.positionScreen.y;\r\n\t\r\n\t\t\tdrawTriangle( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y );\r\n\t\r\n\t\t\tif ( ( material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshPhongMaterial ) && material.map === null ) {\r\n\t\r\n\t\t\t\t_diffuseColor.copy( material.color );\r\n\t\t\t\t_emissiveColor.copy( material.emissive );\r\n\t\r\n\t\t\t\tif ( material.vertexColors === THREE.FaceColors ) {\r\n\t\r\n\t\t\t\t\t_diffuseColor.multiply( element.color );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t_color.copy( _ambientLight );\r\n\t\r\n\t\t\t\t_centroid.copy( v1.positionWorld ).add( v2.positionWorld ).add( v3.positionWorld ).divideScalar( 3 );\r\n\t\r\n\t\t\t\tcalculateLight( _centroid, element.normalModel, _color );\r\n\t\r\n\t\t\t\t_color.multiply( _diffuseColor ).add( _emissiveColor );\r\n\t\r\n\t\t\t\tmaterial.wireframe === true\r\n\t\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t\t : fillPath( _color );\r\n\t\r\n\t\t\t} else if ( material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t\t    material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t\t    material instanceof THREE.MeshPhongMaterial ) {\r\n\t\r\n\t\t\t\tif ( material.map !== null ) {\r\n\t\r\n\t\t\t\t\tvar mapping = material.map.mapping;\r\n\t\r\n\t\t\t\t\tif ( mapping === THREE.UVMapping ) {\r\n\t\r\n\t\t\t\t\t\t_uvs = element.uvs;\r\n\t\t\t\t\t\tpatternPath( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uvs[ uv1 ].x, _uvs[ uv1 ].y, _uvs[ uv2 ].x, _uvs[ uv2 ].y, _uvs[ uv3 ].x, _uvs[ uv3 ].y, material.map );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t} else if ( material.envMap !== null ) {\r\n\t\r\n\t\t\t\t\tif ( material.envMap.mapping === THREE.SphericalReflectionMapping ) {\r\n\t\r\n\t\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv1 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t\t_uv1x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t\t_uv1y = 0.5 * _normal.y + 0.5;\r\n\t\r\n\t\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv2 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t\t_uv2x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t\t_uv2y = 0.5 * _normal.y + 0.5;\r\n\t\r\n\t\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv3 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t\t_uv3x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t\t_uv3y = 0.5 * _normal.y + 0.5;\r\n\t\r\n\t\t\t\t\t\tpatternPath( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y, material.envMap );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t_color.copy( material.color );\r\n\t\r\n\t\t\t\t\tif ( material.vertexColors === THREE.FaceColors ) {\r\n\t\r\n\t\t\t\t\t\t_color.multiply( element.color );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\tmaterial.wireframe === true\r\n\t\t\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t\t\t : fillPath( _color );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t} else if ( material instanceof THREE.MeshNormalMaterial ) {\r\n\t\r\n\t\t\t\t_normal.copy( element.normalModel ).applyMatrix3( _normalViewMatrix );\r\n\t\r\n\t\t\t\t_color.setRGB( _normal.x, _normal.y, _normal.z ).multiplyScalar( 0.5 ).addScalar( 0.5 );\r\n\t\r\n\t\t\t\tmaterial.wireframe === true\r\n\t\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t\t : fillPath( _color );\r\n\t\r\n\t\t\t} else {\r\n\t\r\n\t\t\t\t_color.setRGB( 1, 1, 1 );\r\n\t\r\n\t\t\t\tmaterial.wireframe === true\r\n\t\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t\t : fillPath( _color );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\t//\r\n\t\r\n\t\tfunction drawTriangle( x0, y0, x1, y1, x2, y2 ) {\r\n\t\r\n\t\t\t_context.beginPath();\r\n\t\t\t_context.moveTo( x0, y0 );\r\n\t\t\t_context.lineTo( x1, y1 );\r\n\t\t\t_context.lineTo( x2, y2 );\r\n\t\t\t_context.closePath();\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction strokePath( color, linewidth, linecap, linejoin ) {\r\n\t\r\n\t\t\tsetLineWidth( linewidth );\r\n\t\t\tsetLineCap( linecap );\r\n\t\t\tsetLineJoin( linejoin );\r\n\t\t\tsetStrokeStyle( color.getStyle() );\r\n\t\r\n\t\t\t_context.stroke();\r\n\t\r\n\t\t\t_elemBox.expandByScalar( linewidth * 2 );\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction fillPath( color ) {\r\n\t\r\n\t\t\tsetFillStyle( color.getStyle() );\r\n\t\t\t_context.fill();\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction textureToPattern( texture ) {\r\n\t\r\n\t\t\tif ( texture.version === 0 ||\r\n\t\t\t\ttexture instanceof THREE.CompressedTexture ||\r\n\t\t\t\ttexture instanceof THREE.DataTexture ) {\r\n\t\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcanvas: undefined,\r\n\t\t\t\t\tversion: texture.version\r\n\t\t\t\t};\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tvar image = texture.image;\r\n\t\r\n\t\t\tif ( image.complete === false ) {\r\n\t\r\n\t\t\t\treturn {\r\n\t\t\t\t\tcanvas: undefined,\r\n\t\t\t\t\tversion: 0\r\n\t\t\t\t};\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\t\tcanvas.width = image.width;\r\n\t\t\tcanvas.height = image.height;\r\n\t\r\n\t\t\tvar context = canvas.getContext( '2d' );\r\n\t\t\tcontext.setTransform( 1, 0, 0, - 1, 0, image.height );\r\n\t\t\tcontext.drawImage( image, 0, 0 );\r\n\t\r\n\t\t\tvar repeatX = texture.wrapS === THREE.RepeatWrapping;\r\n\t\t\tvar repeatY = texture.wrapT === THREE.RepeatWrapping;\r\n\t\r\n\t\t\tvar repeat = 'no-repeat';\r\n\t\r\n\t\t\tif ( repeatX === true && repeatY === true ) {\r\n\t\r\n\t\t\t\trepeat = 'repeat';\r\n\t\r\n\t\t\t} else if ( repeatX === true ) {\r\n\t\r\n\t\t\t\trepeat = 'repeat-x';\r\n\t\r\n\t\t\t} else if ( repeatY === true ) {\r\n\t\r\n\t\t\t\trepeat = 'repeat-y';\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tvar pattern = _context.createPattern( canvas, repeat );\r\n\t\r\n\t\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\tcanvas: pattern,\r\n\t\t\t\tversion: texture.version\r\n\t\t\t};\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction patternPath( x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, texture ) {\r\n\t\r\n\t\t\tvar pattern = _patterns[ texture.id ];\r\n\t\r\n\t\t\tif ( pattern === undefined || pattern.version !== texture.version ) {\r\n\t\r\n\t\t\t\tpattern = textureToPattern( texture );\r\n\t\t\t\t_patterns[ texture.id ] = pattern;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tif ( pattern.canvas !== undefined ) {\r\n\t\r\n\t\t\t\tsetFillStyle( pattern.canvas );\r\n\t\r\n\t\t\t} else {\r\n\t\r\n\t\t\t\tsetFillStyle( 'rgba( 0, 0, 0, 1)' );\r\n\t\t\t\t_context.fill();\r\n\t\t\t\treturn;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\t// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120\r\n\t\r\n\t\t\tvar a, b, c, d, e, f, det, idet,\r\n\t\t\toffsetX = texture.offset.x / texture.repeat.x,\r\n\t\t\toffsetY = texture.offset.y / texture.repeat.y,\r\n\t\t\twidth = texture.image.width * texture.repeat.x,\r\n\t\t\theight = texture.image.height * texture.repeat.y;\r\n\t\r\n\t\t\tu0 = ( u0 + offsetX ) * width;\r\n\t\t\tv0 = ( v0 + offsetY ) * height;\r\n\t\r\n\t\t\tu1 = ( u1 + offsetX ) * width;\r\n\t\t\tv1 = ( v1 + offsetY ) * height;\r\n\t\r\n\t\t\tu2 = ( u2 + offsetX ) * width;\r\n\t\t\tv2 = ( v2 + offsetY ) * height;\r\n\t\r\n\t\t\tx1 -= x0; y1 -= y0;\r\n\t\t\tx2 -= x0; y2 -= y0;\r\n\t\r\n\t\t\tu1 -= u0; v1 -= v0;\r\n\t\t\tu2 -= u0; v2 -= v0;\r\n\t\r\n\t\t\tdet = u1 * v2 - u2 * v1;\r\n\t\r\n\t\t\tif ( det === 0 ) return;\r\n\t\r\n\t\t\tidet = 1 / det;\r\n\t\r\n\t\t\ta = ( v2 * x1 - v1 * x2 ) * idet;\r\n\t\t\tb = ( v2 * y1 - v1 * y2 ) * idet;\r\n\t\t\tc = ( u1 * x2 - u2 * x1 ) * idet;\r\n\t\t\td = ( u1 * y2 - u2 * y1 ) * idet;\r\n\t\r\n\t\t\te = x0 - a * u0 - c * v0;\r\n\t\t\tf = y0 - b * u0 - d * v0;\r\n\t\r\n\t\t\t_context.save();\r\n\t\t\t_context.transform( a, b, c, d, e, f );\r\n\t\t\t_context.fill();\r\n\t\t\t_context.restore();\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction clipImage( x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, image ) {\r\n\t\r\n\t\t\t// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120\r\n\t\r\n\t\t\tvar a, b, c, d, e, f, det, idet,\r\n\t\t\twidth = image.width - 1,\r\n\t\t\theight = image.height - 1;\r\n\t\r\n\t\t\tu0 *= width; v0 *= height;\r\n\t\t\tu1 *= width; v1 *= height;\r\n\t\t\tu2 *= width; v2 *= height;\r\n\t\r\n\t\t\tx1 -= x0; y1 -= y0;\r\n\t\t\tx2 -= x0; y2 -= y0;\r\n\t\r\n\t\t\tu1 -= u0; v1 -= v0;\r\n\t\t\tu2 -= u0; v2 -= v0;\r\n\t\r\n\t\t\tdet = u1 * v2 - u2 * v1;\r\n\t\r\n\t\t\tidet = 1 / det;\r\n\t\r\n\t\t\ta = ( v2 * x1 - v1 * x2 ) * idet;\r\n\t\t\tb = ( v2 * y1 - v1 * y2 ) * idet;\r\n\t\t\tc = ( u1 * x2 - u2 * x1 ) * idet;\r\n\t\t\td = ( u1 * y2 - u2 * y1 ) * idet;\r\n\t\r\n\t\t\te = x0 - a * u0 - c * v0;\r\n\t\t\tf = y0 - b * u0 - d * v0;\r\n\t\r\n\t\t\t_context.save();\r\n\t\t\t_context.transform( a, b, c, d, e, f );\r\n\t\t\t_context.clip();\r\n\t\t\t_context.drawImage( image, 0, 0 );\r\n\t\t\t_context.restore();\r\n\t\r\n\t\t}\r\n\t\r\n\t\t// Hide anti-alias gaps\r\n\t\r\n\t\tfunction expand( v1, v2, pixels ) {\r\n\t\r\n\t\t\tvar x = v2.x - v1.x, y = v2.y - v1.y,\r\n\t\t\tdet = x * x + y * y, idet;\r\n\t\r\n\t\t\tif ( det === 0 ) return;\r\n\t\r\n\t\t\tidet = pixels / Math.sqrt( det );\r\n\t\r\n\t\t\tx *= idet; y *= idet;\r\n\t\r\n\t\t\tv2.x += x; v2.y += y;\r\n\t\t\tv1.x -= x; v1.y -= y;\r\n\t\r\n\t\t}\r\n\t\r\n\t\t// Context cached methods.\r\n\t\r\n\t\tfunction setOpacity( value ) {\r\n\t\r\n\t\t\tif ( _contextGlobalAlpha !== value ) {\r\n\t\r\n\t\t\t\t_context.globalAlpha = value;\r\n\t\t\t\t_contextGlobalAlpha = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setBlending( value ) {\r\n\t\r\n\t\t\tif ( _contextGlobalCompositeOperation !== value ) {\r\n\t\r\n\t\t\t\tif ( value === THREE.NormalBlending ) {\r\n\t\r\n\t\t\t\t\t_context.globalCompositeOperation = 'source-over';\r\n\t\r\n\t\t\t\t} else if ( value === THREE.AdditiveBlending ) {\r\n\t\r\n\t\t\t\t\t_context.globalCompositeOperation = 'lighter';\r\n\t\r\n\t\t\t\t} else if ( value === THREE.SubtractiveBlending ) {\r\n\t\r\n\t\t\t\t\t_context.globalCompositeOperation = 'darker';\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\t_contextGlobalCompositeOperation = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setLineWidth( value ) {\r\n\t\r\n\t\t\tif ( _contextLineWidth !== value ) {\r\n\t\r\n\t\t\t\t_context.lineWidth = value;\r\n\t\t\t\t_contextLineWidth = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setLineCap( value ) {\r\n\t\r\n\t\t\t// \"butt\", \"round\", \"square\"\r\n\t\r\n\t\t\tif ( _contextLineCap !== value ) {\r\n\t\r\n\t\t\t\t_context.lineCap = value;\r\n\t\t\t\t_contextLineCap = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setLineJoin( value ) {\r\n\t\r\n\t\t\t// \"round\", \"bevel\", \"miter\"\r\n\t\r\n\t\t\tif ( _contextLineJoin !== value ) {\r\n\t\r\n\t\t\t\t_context.lineJoin = value;\r\n\t\t\t\t_contextLineJoin = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setStrokeStyle( value ) {\r\n\t\r\n\t\t\tif ( _contextStrokeStyle !== value ) {\r\n\t\r\n\t\t\t\t_context.strokeStyle = value;\r\n\t\t\t\t_contextStrokeStyle = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setFillStyle( value ) {\r\n\t\r\n\t\t\tif ( _contextFillStyle !== value ) {\r\n\t\r\n\t\t\t\t_context.fillStyle = value;\r\n\t\t\t\t_contextFillStyle = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction setLineDash( value ) {\r\n\t\r\n\t\t\tif ( _contextLineDash.length !== value.length ) {\r\n\t\r\n\t\t\t\t_context.setLineDash( value );\r\n\t\t\t\t_contextLineDash = value;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t};\r\n\n\n/***/ },\n/* 6 */\n/***/ function(module, exports) {\n\n\t/**\r\n\t * @author mrdoob / http://mrdoob.com/\r\n\t * @author supereggbert / http://www.paulbrunt.co.uk/\r\n\t * @author julianwa / https://github.com/julianwa\r\n\t */\r\n\t\r\n\tTHREE.RenderableObject = function () {\r\n\t\r\n\t\tthis.id = 0;\r\n\t\r\n\t\tthis.object = null;\r\n\t\tthis.z = 0;\r\n\t\tthis.renderOrder = 0;\r\n\t\r\n\t};\r\n\t\r\n\t//\r\n\t\r\n\tTHREE.RenderableFace = function () {\r\n\t\r\n\t\tthis.id = 0;\r\n\t\r\n\t\tthis.v1 = new THREE.RenderableVertex();\r\n\t\tthis.v2 = new THREE.RenderableVertex();\r\n\t\tthis.v3 = new THREE.RenderableVertex();\r\n\t\r\n\t\tthis.normalModel = new THREE.Vector3();\r\n\t\r\n\t\tthis.vertexNormalsModel = [ new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3() ];\r\n\t\tthis.vertexNormalsLength = 0;\r\n\t\r\n\t\tthis.color = new THREE.Color();\r\n\t\tthis.material = null;\r\n\t\tthis.uvs = [ new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() ];\r\n\t\r\n\t\tthis.z = 0;\r\n\t\tthis.renderOrder = 0;\r\n\t\r\n\t};\r\n\t\r\n\t//\r\n\t\r\n\tTHREE.RenderableVertex = function () {\r\n\t\r\n\t\tthis.position = new THREE.Vector3();\r\n\t\tthis.positionWorld = new THREE.Vector3();\r\n\t\tthis.positionScreen = new THREE.Vector4();\r\n\t\r\n\t\tthis.visible = true;\r\n\t\r\n\t};\r\n\t\r\n\tTHREE.RenderableVertex.prototype.copy = function ( vertex ) {\r\n\t\r\n\t\tthis.positionWorld.copy( vertex.positionWorld );\r\n\t\tthis.positionScreen.copy( vertex.positionScreen );\r\n\t\r\n\t};\r\n\t\r\n\t//\r\n\t\r\n\tTHREE.RenderableLine = function () {\r\n\t\r\n\t\tthis.id = 0;\r\n\t\r\n\t\tthis.v1 = new THREE.RenderableVertex();\r\n\t\tthis.v2 = new THREE.RenderableVertex();\r\n\t\r\n\t\tthis.vertexColors = [ new THREE.Color(), new THREE.Color() ];\r\n\t\tthis.material = null;\r\n\t\r\n\t\tthis.z = 0;\r\n\t\tthis.renderOrder = 0;\r\n\t\r\n\t};\r\n\t\r\n\t//\r\n\t\r\n\tTHREE.RenderableSprite = function () {\r\n\t\r\n\t\tthis.id = 0;\r\n\t\r\n\t\tthis.object = null;\r\n\t\r\n\t\tthis.x = 0;\r\n\t\tthis.y = 0;\r\n\t\tthis.z = 0;\r\n\t\r\n\t\tthis.rotation = 0;\r\n\t\tthis.scale = new THREE.Vector2();\r\n\t\r\n\t\tthis.material = null;\r\n\t\tthis.renderOrder = 0;\r\n\t\r\n\t};\r\n\t\r\n\t//\r\n\t\r\n\tTHREE.Projector = function () {\r\n\t\r\n\t\tvar _object, _objectCount, _objectPool = [], _objectPoolLength = 0,\r\n\t\t_vertex, _vertexCount, _vertexPool = [], _vertexPoolLength = 0,\r\n\t\t_face, _faceCount, _facePool = [], _facePoolLength = 0,\r\n\t\t_line, _lineCount, _linePool = [], _linePoolLength = 0,\r\n\t\t_sprite, _spriteCount, _spritePool = [], _spritePoolLength = 0,\r\n\t\r\n\t\t_renderData = { objects: [], lights: [], elements: [] },\r\n\t\r\n\t\t_vector3 = new THREE.Vector3(),\r\n\t\t_vector4 = new THREE.Vector4(),\r\n\t\r\n\t\t_clipBox = new THREE.Box3( new THREE.Vector3( - 1, - 1, - 1 ), new THREE.Vector3( 1, 1, 1 ) ),\r\n\t\t_boundingBox = new THREE.Box3(),\r\n\t\t_points3 = new Array( 3 ),\r\n\t\t_points4 = new Array( 4 ),\r\n\t\r\n\t\t_viewMatrix = new THREE.Matrix4(),\r\n\t\t_viewProjectionMatrix = new THREE.Matrix4(),\r\n\t\r\n\t\t_modelMatrix,\r\n\t\t_modelViewProjectionMatrix = new THREE.Matrix4(),\r\n\t\r\n\t\t_normalMatrix = new THREE.Matrix3(),\r\n\t\r\n\t\t_frustum = new THREE.Frustum(),\r\n\t\r\n\t\t_clippedVertex1PositionScreen = new THREE.Vector4(),\r\n\t\t_clippedVertex2PositionScreen = new THREE.Vector4();\r\n\t\r\n\t\t//\r\n\t\r\n\t\tthis.projectVector = function ( vector, camera ) {\r\n\t\r\n\t\t\tconsole.warn( 'THREE.Projector: .projectVector() is now vector.project().' );\r\n\t\t\tvector.project( camera );\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.unprojectVector = function ( vector, camera ) {\r\n\t\r\n\t\t\tconsole.warn( 'THREE.Projector: .unprojectVector() is now vector.unproject().' );\r\n\t\t\tvector.unproject( camera );\r\n\t\r\n\t\t};\r\n\t\r\n\t\tthis.pickingRay = function ( vector, camera ) {\r\n\t\r\n\t\t\tconsole.error( 'THREE.Projector: .pickingRay() is now raycaster.setFromCamera().' );\r\n\t\r\n\t\t};\r\n\t\r\n\t\t//\r\n\t\r\n\t\tvar RenderList = function () {\r\n\t\r\n\t\t\tvar normals = [];\r\n\t\t\tvar uvs = [];\r\n\t\r\n\t\t\tvar object = null;\r\n\t\t\tvar material = null;\r\n\t\r\n\t\t\tvar normalMatrix = new THREE.Matrix3();\r\n\t\r\n\t\t\tfunction setObject( value ) {\r\n\t\r\n\t\t\t\tobject = value;\r\n\t\t\t\tmaterial = object.material;\r\n\t\r\n\t\t\t\tnormalMatrix.getNormalMatrix( object.matrixWorld );\r\n\t\r\n\t\t\t\tnormals.length = 0;\r\n\t\t\t\tuvs.length = 0;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction projectVertex( vertex ) {\r\n\t\r\n\t\t\t\tvar position = vertex.position;\r\n\t\t\t\tvar positionWorld = vertex.positionWorld;\r\n\t\t\t\tvar positionScreen = vertex.positionScreen;\r\n\t\r\n\t\t\t\tpositionWorld.copy( position ).applyMatrix4( _modelMatrix );\r\n\t\t\t\tpositionScreen.copy( positionWorld ).applyMatrix4( _viewProjectionMatrix );\r\n\t\r\n\t\t\t\tvar invW = 1 / positionScreen.w;\r\n\t\r\n\t\t\t\tpositionScreen.x *= invW;\r\n\t\t\t\tpositionScreen.y *= invW;\r\n\t\t\t\tpositionScreen.z *= invW;\r\n\t\r\n\t\t\t\tvertex.visible = positionScreen.x >= - 1 && positionScreen.x <= 1 &&\r\n\t\t\t\t\t\t positionScreen.y >= - 1 && positionScreen.y <= 1 &&\r\n\t\t\t\t\t\t positionScreen.z >= - 1 && positionScreen.z <= 1;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction pushVertex( x, y, z ) {\r\n\t\r\n\t\t\t\t_vertex = getNextVertexInPool();\r\n\t\t\t\t_vertex.position.set( x, y, z );\r\n\t\r\n\t\t\t\tprojectVertex( _vertex );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction pushNormal( x, y, z ) {\r\n\t\r\n\t\t\t\tnormals.push( x, y, z );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction pushUv( x, y ) {\r\n\t\r\n\t\t\t\tuvs.push( x, y );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction checkTriangleVisibility( v1, v2, v3 ) {\r\n\t\r\n\t\t\t\tif ( v1.visible === true || v2.visible === true || v3.visible === true ) return true;\r\n\t\r\n\t\t\t\t_points3[ 0 ] = v1.positionScreen;\r\n\t\t\t\t_points3[ 1 ] = v2.positionScreen;\r\n\t\t\t\t_points3[ 2 ] = v3.positionScreen;\r\n\t\r\n\t\t\t\treturn _clipBox.intersectsBox( _boundingBox.setFromPoints( _points3 ) );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction checkBackfaceCulling( v1, v2, v3 ) {\r\n\t\r\n\t\t\t\treturn ( ( v3.positionScreen.x - v1.positionScreen.x ) *\r\n\t\t\t\t\t    ( v2.positionScreen.y - v1.positionScreen.y ) -\r\n\t\t\t\t\t    ( v3.positionScreen.y - v1.positionScreen.y ) *\r\n\t\t\t\t\t    ( v2.positionScreen.x - v1.positionScreen.x ) ) < 0;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction pushLine( a, b ) {\r\n\t\r\n\t\t\t\tvar v1 = _vertexPool[ a ];\r\n\t\t\t\tvar v2 = _vertexPool[ b ];\r\n\t\r\n\t\t\t\t_line = getNextLineInPool();\r\n\t\r\n\t\t\t\t_line.id = object.id;\r\n\t\t\t\t_line.v1.copy( v1 );\r\n\t\t\t\t_line.v2.copy( v2 );\r\n\t\t\t\t_line.z = ( v1.positionScreen.z + v2.positionScreen.z ) / 2;\r\n\t\t\t\t_line.renderOrder = object.renderOrder;\r\n\t\r\n\t\t\t\t_line.material = object.material;\r\n\t\r\n\t\t\t\t_renderData.elements.push( _line );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tfunction pushTriangle( a, b, c ) {\r\n\t\r\n\t\t\t\tvar v1 = _vertexPool[ a ];\r\n\t\t\t\tvar v2 = _vertexPool[ b ];\r\n\t\t\t\tvar v3 = _vertexPool[ c ];\r\n\t\r\n\t\t\t\tif ( checkTriangleVisibility( v1, v2, v3 ) === false ) return;\r\n\t\r\n\t\t\t\tif ( material.side === THREE.DoubleSide || checkBackfaceCulling( v1, v2, v3 ) === true ) {\r\n\t\r\n\t\t\t\t\t_face = getNextFaceInPool();\r\n\t\r\n\t\t\t\t\t_face.id = object.id;\r\n\t\t\t\t\t_face.v1.copy( v1 );\r\n\t\t\t\t\t_face.v2.copy( v2 );\r\n\t\t\t\t\t_face.v3.copy( v3 );\r\n\t\t\t\t\t_face.z = ( v1.positionScreen.z + v2.positionScreen.z + v3.positionScreen.z ) / 3;\r\n\t\t\t\t\t_face.renderOrder = object.renderOrder;\r\n\t\r\n\t\t\t\t\t// use first vertex normal as face normal\r\n\t\r\n\t\t\t\t\t_face.normalModel.fromArray( normals, a * 3 );\r\n\t\t\t\t\t_face.normalModel.applyMatrix3( normalMatrix ).normalize();\r\n\t\r\n\t\t\t\t\tfor ( var i = 0; i < 3; i ++ ) {\r\n\t\r\n\t\t\t\t\t\tvar normal = _face.vertexNormalsModel[ i ];\r\n\t\t\t\t\t\tnormal.fromArray( normals, arguments[ i ] * 3 );\r\n\t\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\r\n\t\r\n\t\t\t\t\t\tvar uv = _face.uvs[ i ];\r\n\t\t\t\t\t\tuv.fromArray( uvs, arguments[ i ] * 2 );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t_face.vertexNormalsLength = 3;\r\n\t\r\n\t\t\t\t\t_face.material = object.material;\r\n\t\r\n\t\t\t\t\t_renderData.elements.push( _face );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn {\r\n\t\t\t\tsetObject: setObject,\r\n\t\t\t\tprojectVertex: projectVertex,\r\n\t\t\t\tcheckTriangleVisibility: checkTriangleVisibility,\r\n\t\t\t\tcheckBackfaceCulling: checkBackfaceCulling,\r\n\t\t\t\tpushVertex: pushVertex,\r\n\t\t\t\tpushNormal: pushNormal,\r\n\t\t\t\tpushUv: pushUv,\r\n\t\t\t\tpushLine: pushLine,\r\n\t\t\t\tpushTriangle: pushTriangle\r\n\t\t\t}\r\n\t\r\n\t\t};\r\n\t\r\n\t\tvar renderList = new RenderList();\r\n\t\r\n\t\tthis.projectScene = function ( scene, camera, sortObjects, sortElements ) {\r\n\t\r\n\t\t\t_faceCount = 0;\r\n\t\t\t_lineCount = 0;\r\n\t\t\t_spriteCount = 0;\r\n\t\r\n\t\t\t_renderData.elements.length = 0;\r\n\t\r\n\t\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\t\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\t\r\n\t\t\t_viewMatrix.copy( camera.matrixWorldInverse.getInverse( camera.matrixWorld ) );\r\n\t\t\t_viewProjectionMatrix.multiplyMatrices( camera.projectionMatrix, _viewMatrix );\r\n\t\r\n\t\t\t_frustum.setFromMatrix( _viewProjectionMatrix );\r\n\t\r\n\t\t\t//\r\n\t\r\n\t\t\t_objectCount = 0;\r\n\t\r\n\t\t\t_renderData.objects.length = 0;\r\n\t\t\t_renderData.lights.length = 0;\r\n\t\r\n\t\t\tscene.traverseVisible( function ( object ) {\r\n\t\r\n\t\t\t\tif ( object instanceof THREE.Light ) {\r\n\t\r\n\t\t\t\t\t_renderData.lights.push( object );\r\n\t\r\n\t\t\t\t} else if ( object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Sprite ) {\r\n\t\r\n\t\t\t\t\tvar material = object.material;\r\n\t\r\n\t\t\t\t\tif ( material.visible === false ) return;\r\n\t\r\n\t\t\t\t\tif ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) {\r\n\t\r\n\t\t\t\t\t\t_object = getNextObjectInPool();\r\n\t\t\t\t\t\t_object.id = object.id;\r\n\t\t\t\t\t\t_object.object = object;\r\n\t\r\n\t\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld );\r\n\t\t\t\t\t\t_vector3.applyProjection( _viewProjectionMatrix );\r\n\t\t\t\t\t\t_object.z = _vector3.z;\r\n\t\t\t\t\t\t_object.renderOrder = object.renderOrder;\r\n\t\r\n\t\t\t\t\t\t_renderData.objects.push( _object );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t} );\r\n\t\r\n\t\t\tif ( sortObjects === true ) {\r\n\t\r\n\t\t\t\t_renderData.objects.sort( painterSort );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\t//\r\n\t\r\n\t\t\tfor ( var o = 0, ol = _renderData.objects.length; o < ol; o ++ ) {\r\n\t\r\n\t\t\t\tvar object = _renderData.objects[ o ].object;\r\n\t\t\t\tvar geometry = object.geometry;\r\n\t\r\n\t\t\t\trenderList.setObject( object );\r\n\t\r\n\t\t\t\t_modelMatrix = object.matrixWorld;\r\n\t\r\n\t\t\t\t_vertexCount = 0;\r\n\t\r\n\t\t\t\tif ( object instanceof THREE.Mesh ) {\r\n\t\r\n\t\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\t\r\n\t\t\t\t\t\tvar attributes = geometry.attributes;\r\n\t\t\t\t\t\tvar groups = geometry.groups;\r\n\t\r\n\t\t\t\t\t\tif ( attributes.position === undefined ) continue;\r\n\t\r\n\t\t\t\t\t\tvar positions = attributes.position.array;\r\n\t\r\n\t\t\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 3 ) {\r\n\t\r\n\t\t\t\t\t\t\trenderList.pushVertex( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif ( attributes.normal !== undefined ) {\r\n\t\r\n\t\t\t\t\t\t\tvar normals = attributes.normal.array;\r\n\t\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = normals.length; i < l; i += 3 ) {\r\n\t\r\n\t\t\t\t\t\t\t\trenderList.pushNormal( normals[ i ], normals[ i + 1 ], normals[ i + 2 ] );\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif ( attributes.uv !== undefined ) {\r\n\t\r\n\t\t\t\t\t\t\tvar uvs = attributes.uv.array;\r\n\t\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = uvs.length; i < l; i += 2 ) {\r\n\t\r\n\t\t\t\t\t\t\t\trenderList.pushUv( uvs[ i ], uvs[ i + 1 ] );\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tif ( geometry.index !== null ) {\r\n\t\r\n\t\t\t\t\t\t\tvar indices = geometry.index.array;\r\n\t\r\n\t\t\t\t\t\t\tif ( groups.length > 0 ) {\r\n\t\r\n\t\t\t\t\t\t\t\tfor ( var o = 0; o < groups.length; o ++ ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\tvar group = groups[ o ];\r\n\t\r\n\t\t\t\t\t\t\t\t\tfor ( var i = group.start, l = group.start + group.count; i < l; i += 3 ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\t\trenderList.pushTriangle( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\t\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 3 ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\trenderList.pushTriangle( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = positions.length / 3; i < l; i += 3 ) {\r\n\t\r\n\t\t\t\t\t\t\t\trenderList.pushTriangle( i, i + 1, i + 2 );\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\t\r\n\t\t\t\t\t\tvar vertices = geometry.vertices;\r\n\t\t\t\t\t\tvar faces = geometry.faces;\r\n\t\t\t\t\t\tvar faceVertexUvs = geometry.faceVertexUvs[ 0 ];\r\n\t\r\n\t\t\t\t\t\t_normalMatrix.getNormalMatrix( _modelMatrix );\r\n\t\r\n\t\t\t\t\t\tvar material = object.material;\r\n\t\r\n\t\t\t\t\t\tvar isFaceMaterial = material instanceof THREE.MultiMaterial;\r\n\t\t\t\t\t\tvar objectMaterials = isFaceMaterial === true ? object.material : null;\r\n\t\r\n\t\t\t\t\t\tfor ( var v = 0, vl = vertices.length; v < vl; v ++ ) {\r\n\t\r\n\t\t\t\t\t\t\tvar vertex = vertices[ v ];\r\n\t\r\n\t\t\t\t\t\t\t_vector3.copy( vertex );\r\n\t\r\n\t\t\t\t\t\t\tif ( material.morphTargets === true ) {\r\n\t\r\n\t\t\t\t\t\t\t\tvar morphTargets = geometry.morphTargets;\r\n\t\t\t\t\t\t\t\tvar morphInfluences = object.morphTargetInfluences;\r\n\t\r\n\t\t\t\t\t\t\t\tfor ( var t = 0, tl = morphTargets.length; t < tl; t ++ ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\tvar influence = morphInfluences[ t ];\r\n\t\r\n\t\t\t\t\t\t\t\t\tif ( influence === 0 ) continue;\r\n\t\r\n\t\t\t\t\t\t\t\t\tvar target = morphTargets[ t ];\r\n\t\t\t\t\t\t\t\t\tvar targetVertex = target.vertices[ v ];\r\n\t\r\n\t\t\t\t\t\t\t\t\t_vector3.x += ( targetVertex.x - vertex.x ) * influence;\r\n\t\t\t\t\t\t\t\t\t_vector3.y += ( targetVertex.y - vertex.y ) * influence;\r\n\t\t\t\t\t\t\t\t\t_vector3.z += ( targetVertex.z - vertex.z ) * influence;\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\trenderList.pushVertex( _vector3.x, _vector3.y, _vector3.z );\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\tfor ( var f = 0, fl = faces.length; f < fl; f ++ ) {\r\n\t\r\n\t\t\t\t\t\t\tvar face = faces[ f ];\r\n\t\r\n\t\t\t\t\t\t\tmaterial = isFaceMaterial === true\r\n\t\t\t\t\t\t\t\t ? objectMaterials.materials[ face.materialIndex ]\r\n\t\t\t\t\t\t\t\t : object.material;\r\n\t\r\n\t\t\t\t\t\t\tif ( material === undefined ) continue;\r\n\t\r\n\t\t\t\t\t\t\tvar side = material.side;\r\n\t\r\n\t\t\t\t\t\t\tvar v1 = _vertexPool[ face.a ];\r\n\t\t\t\t\t\t\tvar v2 = _vertexPool[ face.b ];\r\n\t\t\t\t\t\t\tvar v3 = _vertexPool[ face.c ];\r\n\t\r\n\t\t\t\t\t\t\tif ( renderList.checkTriangleVisibility( v1, v2, v3 ) === false ) continue;\r\n\t\r\n\t\t\t\t\t\t\tvar visible = renderList.checkBackfaceCulling( v1, v2, v3 );\r\n\t\r\n\t\t\t\t\t\t\tif ( side !== THREE.DoubleSide ) {\r\n\t\r\n\t\t\t\t\t\t\t\tif ( side === THREE.FrontSide && visible === false ) continue;\r\n\t\t\t\t\t\t\t\tif ( side === THREE.BackSide && visible === true ) continue;\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t_face = getNextFaceInPool();\r\n\t\r\n\t\t\t\t\t\t\t_face.id = object.id;\r\n\t\t\t\t\t\t\t_face.v1.copy( v1 );\r\n\t\t\t\t\t\t\t_face.v2.copy( v2 );\r\n\t\t\t\t\t\t\t_face.v3.copy( v3 );\r\n\t\r\n\t\t\t\t\t\t\t_face.normalModel.copy( face.normal );\r\n\t\r\n\t\t\t\t\t\t\tif ( visible === false && ( side === THREE.BackSide || side === THREE.DoubleSide ) ) {\r\n\t\r\n\t\t\t\t\t\t\t\t_face.normalModel.negate();\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t_face.normalModel.applyMatrix3( _normalMatrix ).normalize();\r\n\t\r\n\t\t\t\t\t\t\tvar faceVertexNormals = face.vertexNormals;\r\n\t\r\n\t\t\t\t\t\t\tfor ( var n = 0, nl = Math.min( faceVertexNormals.length, 3 ); n < nl; n ++ ) {\r\n\t\r\n\t\t\t\t\t\t\t\tvar normalModel = _face.vertexNormalsModel[ n ];\r\n\t\t\t\t\t\t\t\tnormalModel.copy( faceVertexNormals[ n ] );\r\n\t\r\n\t\t\t\t\t\t\t\tif ( visible === false && ( side === THREE.BackSide || side === THREE.DoubleSide ) ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\tnormalModel.negate();\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t\tnormalModel.applyMatrix3( _normalMatrix ).normalize();\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t_face.vertexNormalsLength = faceVertexNormals.length;\r\n\t\r\n\t\t\t\t\t\t\tvar vertexUvs = faceVertexUvs[ f ];\r\n\t\r\n\t\t\t\t\t\t\tif ( vertexUvs !== undefined ) {\r\n\t\r\n\t\t\t\t\t\t\t\tfor ( var u = 0; u < 3; u ++ ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\t_face.uvs[ u ].copy( vertexUvs[ u ] );\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t_face.color = face.color;\r\n\t\t\t\t\t\t\t_face.material = material;\r\n\t\r\n\t\t\t\t\t\t\t_face.z = ( v1.positionScreen.z + v2.positionScreen.z + v3.positionScreen.z ) / 3;\r\n\t\t\t\t\t\t\t_face.renderOrder = object.renderOrder;\r\n\t\r\n\t\t\t\t\t\t\t_renderData.elements.push( _face );\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t} else if ( object instanceof THREE.Line ) {\r\n\t\r\n\t\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\t\r\n\t\t\t\t\t\tvar attributes = geometry.attributes;\r\n\t\r\n\t\t\t\t\t\tif ( attributes.position !== undefined ) {\r\n\t\r\n\t\t\t\t\t\t\tvar positions = attributes.position.array;\r\n\t\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 3 ) {\r\n\t\r\n\t\t\t\t\t\t\t\trenderList.pushVertex( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\tif ( geometry.index !== null ) {\r\n\t\r\n\t\t\t\t\t\t\t\tvar indices = geometry.index.array;\r\n\t\r\n\t\t\t\t\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 2 ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\trenderList.pushLine( indices[ i ], indices[ i + 1 ] );\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t\t\t\tvar step = object instanceof THREE.LineSegments ? 2 : 1;\r\n\t\r\n\t\t\t\t\t\t\t\tfor ( var i = 0, l = ( positions.length / 3 ) - 1; i < l; i += step ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\trenderList.pushLine( i, i + 1 );\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\t\r\n\t\t\t\t\t\t_modelViewProjectionMatrix.multiplyMatrices( _viewProjectionMatrix, _modelMatrix );\r\n\t\r\n\t\t\t\t\t\tvar vertices = object.geometry.vertices;\r\n\t\r\n\t\t\t\t\t\tif ( vertices.length === 0 ) continue;\r\n\t\r\n\t\t\t\t\t\tv1 = getNextVertexInPool();\r\n\t\t\t\t\t\tv1.positionScreen.copy( vertices[ 0 ] ).applyMatrix4( _modelViewProjectionMatrix );\r\n\t\r\n\t\t\t\t\t\tvar step = object instanceof THREE.LineSegments ? 2 : 1;\r\n\t\r\n\t\t\t\t\t\tfor ( var v = 1, vl = vertices.length; v < vl; v ++ ) {\r\n\t\r\n\t\t\t\t\t\t\tv1 = getNextVertexInPool();\r\n\t\t\t\t\t\t\tv1.positionScreen.copy( vertices[ v ] ).applyMatrix4( _modelViewProjectionMatrix );\r\n\t\r\n\t\t\t\t\t\t\tif ( ( v + 1 ) % step > 0 ) continue;\r\n\t\r\n\t\t\t\t\t\t\tv2 = _vertexPool[ _vertexCount - 2 ];\r\n\t\r\n\t\t\t\t\t\t\t_clippedVertex1PositionScreen.copy( v1.positionScreen );\r\n\t\t\t\t\t\t\t_clippedVertex2PositionScreen.copy( v2.positionScreen );\r\n\t\r\n\t\t\t\t\t\t\tif ( clipLine( _clippedVertex1PositionScreen, _clippedVertex2PositionScreen ) === true ) {\r\n\t\r\n\t\t\t\t\t\t\t\t// Perform the perspective divide\r\n\t\t\t\t\t\t\t\t_clippedVertex1PositionScreen.multiplyScalar( 1 / _clippedVertex1PositionScreen.w );\r\n\t\t\t\t\t\t\t\t_clippedVertex2PositionScreen.multiplyScalar( 1 / _clippedVertex2PositionScreen.w );\r\n\t\r\n\t\t\t\t\t\t\t\t_line = getNextLineInPool();\r\n\t\r\n\t\t\t\t\t\t\t\t_line.id = object.id;\r\n\t\t\t\t\t\t\t\t_line.v1.positionScreen.copy( _clippedVertex1PositionScreen );\r\n\t\t\t\t\t\t\t\t_line.v2.positionScreen.copy( _clippedVertex2PositionScreen );\r\n\t\r\n\t\t\t\t\t\t\t\t_line.z = Math.max( _clippedVertex1PositionScreen.z, _clippedVertex2PositionScreen.z );\r\n\t\t\t\t\t\t\t\t_line.renderOrder = object.renderOrder;\r\n\t\r\n\t\t\t\t\t\t\t\t_line.material = object.material;\r\n\t\r\n\t\t\t\t\t\t\t\tif ( object.material.vertexColors === THREE.VertexColors ) {\r\n\t\r\n\t\t\t\t\t\t\t\t\t_line.vertexColors[ 0 ].copy( object.geometry.colors[ v ] );\r\n\t\t\t\t\t\t\t\t\t_line.vertexColors[ 1 ].copy( object.geometry.colors[ v - 1 ] );\r\n\t\r\n\t\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t\t\t_renderData.elements.push( _line );\r\n\t\r\n\t\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t\t}\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t} else if ( object instanceof THREE.Sprite ) {\r\n\t\r\n\t\t\t\t\t_vector4.set( _modelMatrix.elements[ 12 ], _modelMatrix.elements[ 13 ], _modelMatrix.elements[ 14 ], 1 );\r\n\t\t\t\t\t_vector4.applyMatrix4( _viewProjectionMatrix );\r\n\t\r\n\t\t\t\t\tvar invW = 1 / _vector4.w;\r\n\t\r\n\t\t\t\t\t_vector4.z *= invW;\r\n\t\r\n\t\t\t\t\tif ( _vector4.z >= - 1 && _vector4.z <= 1 ) {\r\n\t\r\n\t\t\t\t\t\t_sprite = getNextSpriteInPool();\r\n\t\t\t\t\t\t_sprite.id = object.id;\r\n\t\t\t\t\t\t_sprite.x = _vector4.x * invW;\r\n\t\t\t\t\t\t_sprite.y = _vector4.y * invW;\r\n\t\t\t\t\t\t_sprite.z = _vector4.z;\r\n\t\t\t\t\t\t_sprite.renderOrder = object.renderOrder;\r\n\t\t\t\t\t\t_sprite.object = object;\r\n\t\r\n\t\t\t\t\t\t_sprite.rotation = object.rotation;\r\n\t\r\n\t\t\t\t\t\t_sprite.scale.x = object.scale.x * Math.abs( _sprite.x - ( _vector4.x + camera.projectionMatrix.elements[ 0 ] ) / ( _vector4.w + camera.projectionMatrix.elements[ 12 ] ) );\r\n\t\t\t\t\t\t_sprite.scale.y = object.scale.y * Math.abs( _sprite.y - ( _vector4.y + camera.projectionMatrix.elements[ 5 ] ) / ( _vector4.w + camera.projectionMatrix.elements[ 13 ] ) );\r\n\t\r\n\t\t\t\t\t\t_sprite.material = object.material;\r\n\t\r\n\t\t\t\t\t\t_renderData.elements.push( _sprite );\r\n\t\r\n\t\t\t\t\t}\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\tif ( sortElements === true ) {\r\n\t\r\n\t\t\t\t_renderData.elements.sort( painterSort );\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn _renderData;\r\n\t\r\n\t\t};\r\n\t\r\n\t\t// Pools\r\n\t\r\n\t\tfunction getNextObjectInPool() {\r\n\t\r\n\t\t\tif ( _objectCount === _objectPoolLength ) {\r\n\t\r\n\t\t\t\tvar object = new THREE.RenderableObject();\r\n\t\t\t\t_objectPool.push( object );\r\n\t\t\t\t_objectPoolLength ++;\r\n\t\t\t\t_objectCount ++;\r\n\t\t\t\treturn object;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn _objectPool[ _objectCount ++ ];\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction getNextVertexInPool() {\r\n\t\r\n\t\t\tif ( _vertexCount === _vertexPoolLength ) {\r\n\t\r\n\t\t\t\tvar vertex = new THREE.RenderableVertex();\r\n\t\t\t\t_vertexPool.push( vertex );\r\n\t\t\t\t_vertexPoolLength ++;\r\n\t\t\t\t_vertexCount ++;\r\n\t\t\t\treturn vertex;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn _vertexPool[ _vertexCount ++ ];\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction getNextFaceInPool() {\r\n\t\r\n\t\t\tif ( _faceCount === _facePoolLength ) {\r\n\t\r\n\t\t\t\tvar face = new THREE.RenderableFace();\r\n\t\t\t\t_facePool.push( face );\r\n\t\t\t\t_facePoolLength ++;\r\n\t\t\t\t_faceCount ++;\r\n\t\t\t\treturn face;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn _facePool[ _faceCount ++ ];\r\n\t\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction getNextLineInPool() {\r\n\t\r\n\t\t\tif ( _lineCount === _linePoolLength ) {\r\n\t\r\n\t\t\t\tvar line = new THREE.RenderableLine();\r\n\t\t\t\t_linePool.push( line );\r\n\t\t\t\t_linePoolLength ++;\r\n\t\t\t\t_lineCount ++;\r\n\t\t\t\treturn line;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn _linePool[ _lineCount ++ ];\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction getNextSpriteInPool() {\r\n\t\r\n\t\t\tif ( _spriteCount === _spritePoolLength ) {\r\n\t\r\n\t\t\t\tvar sprite = new THREE.RenderableSprite();\r\n\t\t\t\t_spritePool.push( sprite );\r\n\t\t\t\t_spritePoolLength ++;\r\n\t\t\t\t_spriteCount ++;\r\n\t\t\t\treturn sprite;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t\treturn _spritePool[ _spriteCount ++ ];\r\n\t\r\n\t\t}\r\n\t\r\n\t\t//\r\n\t\r\n\t\tfunction painterSort( a, b ) {\r\n\t\r\n\t\t\tif ( a.renderOrder !== b.renderOrder ) {\r\n\t\r\n\t\t\t\treturn a.renderOrder - b.renderOrder;\r\n\t\r\n\t\t\t} else if ( a.z !== b.z ) {\r\n\t\r\n\t\t\t\treturn b.z - a.z;\r\n\t\r\n\t\t\t} else if ( a.id !== b.id ) {\r\n\t\r\n\t\t\t\treturn a.id - b.id;\r\n\t\r\n\t\t\t} else {\r\n\t\r\n\t\t\t\treturn 0;\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t\tfunction clipLine( s1, s2 ) {\r\n\t\r\n\t\t\tvar alpha1 = 0, alpha2 = 1,\r\n\t\r\n\t\t\t// Calculate the boundary coordinate of each vertex for the near and far clip planes,\r\n\t\t\t// Z = -1 and Z = +1, respectively.\r\n\t\t\tbc1near =  s1.z + s1.w,\r\n\t\t\tbc2near =  s2.z + s2.w,\r\n\t\t\tbc1far =  - s1.z + s1.w,\r\n\t\t\tbc2far =  - s2.z + s2.w;\r\n\t\r\n\t\t\tif ( bc1near >= 0 && bc2near >= 0 && bc1far >= 0 && bc2far >= 0 ) {\r\n\t\r\n\t\t\t\t// Both vertices lie entirely within all clip planes.\r\n\t\t\t\treturn true;\r\n\t\r\n\t\t\t} else if ( ( bc1near < 0 && bc2near < 0 ) || ( bc1far < 0 && bc2far < 0 ) ) {\r\n\t\r\n\t\t\t\t// Both vertices lie entirely outside one of the clip planes.\r\n\t\t\t\treturn false;\r\n\t\r\n\t\t\t} else {\r\n\t\r\n\t\t\t\t// The line segment spans at least one clip plane.\r\n\t\r\n\t\t\t\tif ( bc1near < 0 ) {\r\n\t\r\n\t\t\t\t\t// v1 lies outside the near plane, v2 inside\r\n\t\t\t\t\talpha1 = Math.max( alpha1, bc1near / ( bc1near - bc2near ) );\r\n\t\r\n\t\t\t\t} else if ( bc2near < 0 ) {\r\n\t\r\n\t\t\t\t\t// v2 lies outside the near plane, v1 inside\r\n\t\t\t\t\talpha2 = Math.min( alpha2, bc1near / ( bc1near - bc2near ) );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif ( bc1far < 0 ) {\r\n\t\r\n\t\t\t\t\t// v1 lies outside the far plane, v2 inside\r\n\t\t\t\t\talpha1 = Math.max( alpha1, bc1far / ( bc1far - bc2far ) );\r\n\t\r\n\t\t\t\t} else if ( bc2far < 0 ) {\r\n\t\r\n\t\t\t\t\t// v2 lies outside the far plane, v2 inside\r\n\t\t\t\t\talpha2 = Math.min( alpha2, bc1far / ( bc1far - bc2far ) );\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\tif ( alpha2 < alpha1 ) {\r\n\t\r\n\t\t\t\t\t// The line segment spans two boundaries, but is outside both of them.\r\n\t\t\t\t\t// (This can't happen when we're only clipping against just near/far but good\r\n\t\t\t\t\t//  to leave the check here for future usage if other clip planes are added.)\r\n\t\t\t\t\treturn false;\r\n\t\r\n\t\t\t\t} else {\r\n\t\r\n\t\t\t\t\t// Update the s1 and s2 vertices to match the clipped line segment.\r\n\t\t\t\t\ts1.lerp( s2, alpha1 );\r\n\t\t\t\t\ts2.lerp( s1, 1 - alpha2 );\r\n\t\r\n\t\t\t\t\treturn true;\r\n\t\r\n\t\t\t\t}\r\n\t\r\n\t\t\t}\r\n\t\r\n\t\t}\r\n\t\r\n\t};\r\n\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t/*!\n\t * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n\t *\n\t * Copyright (c) 2014-2015, Jon Schlinkert.\n\t * Licensed under the MIT License.\n\t */\n\t\n\t'use strict';\n\t\n\tvar isObject = __webpack_require__(8);\n\t\n\tfunction isObjectObject(o) {\n\t  return isObject(o) === true\n\t    && Object.prototype.toString.call(o) === '[object Object]';\n\t}\n\t\n\tmodule.exports = function isPlainObject(o) {\n\t  var ctor,prot;\n\t  \n\t  if (isObjectObject(o) === false) return false;\n\t  \n\t  // If has modified constructor\n\t  ctor = o.constructor;\n\t  if (typeof ctor !== 'function') return false;\n\t  \n\t  // If has modified prototype\n\t  prot = ctor.prototype;\n\t  if (isObjectObject(prot) === false) return false;\n\t  \n\t  // If constructor does not have an Object-specific method\n\t  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n\t    return false;\n\t  }\n\t  \n\t  // Most likely a plain Object\n\t  return true;\n\t};\n\n\n/***/ },\n/* 8 */\n/***/ function(module, exports) {\n\n\t/*!\n\t * isobject <https://github.com/jonschlinkert/isobject>\n\t *\n\t * Copyright (c) 2014-2015, Jon Schlinkert.\n\t * Licensed under the MIT License.\n\t */\n\t\n\t'use strict';\n\t\n\tmodule.exports = function isObject(val) {\n\t  return val != null && typeof val === 'object'\n\t    && !Array.isArray(val);\n\t};\n\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __WEBPACK_AMD_DEFINE_RESULT__;/*!\n\t * EventEmitter2\n\t * https://github.com/hij1nx/EventEmitter2\n\t *\n\t * Copyright (c) 2013 hij1nx\n\t * Licensed under the MIT license.\n\t */\n\t;!function(undefined) {\n\t\n\t  var isArray = Array.isArray ? Array.isArray : function _isArray(obj) {\n\t    return Object.prototype.toString.call(obj) === \"[object Array]\";\n\t  };\n\t  var defaultMaxListeners = 10;\n\t\n\t  function init() {\n\t    this._events = {};\n\t    if (this._conf) {\n\t      configure.call(this, this._conf);\n\t    }\n\t  }\n\t\n\t  function configure(conf) {\n\t    if (conf) {\n\t\n\t      this._conf = conf;\n\t\n\t      conf.delimiter && (this.delimiter = conf.delimiter);\n\t      conf.maxListeners && (this._events.maxListeners = conf.maxListeners);\n\t      conf.wildcard && (this.wildcard = conf.wildcard);\n\t      conf.newListener && (this.newListener = conf.newListener);\n\t\n\t      if (this.wildcard) {\n\t        this.listenerTree = {};\n\t      }\n\t    }\n\t  }\n\t\n\t  function EventEmitter(conf) {\n\t    this._events = {};\n\t    this.newListener = false;\n\t    configure.call(this, conf);\n\t  }\n\t\n\t  //\n\t  // Attention, function return type now is array, always !\n\t  // It has zero elements if no any matches found and one or more\n\t  // elements (leafs) if there are matches\n\t  //\n\t  function searchListenerTree(handlers, type, tree, i) {\n\t    if (!tree) {\n\t      return [];\n\t    }\n\t    var listeners=[], leaf, len, branch, xTree, xxTree, isolatedBranch, endReached,\n\t        typeLength = type.length, currentType = type[i], nextType = type[i+1];\n\t    if (i === typeLength && tree._listeners) {\n\t      //\n\t      // If at the end of the event(s) list and the tree has listeners\n\t      // invoke those listeners.\n\t      //\n\t      if (typeof tree._listeners === 'function') {\n\t        handlers && handlers.push(tree._listeners);\n\t        return [tree];\n\t      } else {\n\t        for (leaf = 0, len = tree._listeners.length; leaf < len; leaf++) {\n\t          handlers && handlers.push(tree._listeners[leaf]);\n\t        }\n\t        return [tree];\n\t      }\n\t    }\n\t\n\t    if ((currentType === '*' || currentType === '**') || tree[currentType]) {\n\t      //\n\t      // If the event emitted is '*' at this part\n\t      // or there is a concrete match at this patch\n\t      //\n\t      if (currentType === '*') {\n\t        for (branch in tree) {\n\t          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\n\t            listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+1));\n\t          }\n\t        }\n\t        return listeners;\n\t      } else if(currentType === '**') {\n\t        endReached = (i+1 === typeLength || (i+2 === typeLength && nextType === '*'));\n\t        if(endReached && tree._listeners) {\n\t          // The next element has a _listeners, add it to the handlers.\n\t          listeners = listeners.concat(searchListenerTree(handlers, type, tree, typeLength));\n\t        }\n\t\n\t        for (branch in tree) {\n\t          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\n\t            if(branch === '*' || branch === '**') {\n\t              if(tree[branch]._listeners && !endReached) {\n\t                listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], typeLength));\n\t              }\n\t              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\n\t            } else if(branch === nextType) {\n\t              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+2));\n\t            } else {\n\t              // No match on this one, shift into the tree but not in the type array.\n\t              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\n\t            }\n\t          }\n\t        }\n\t        return listeners;\n\t      }\n\t\n\t      listeners = listeners.concat(searchListenerTree(handlers, type, tree[currentType], i+1));\n\t    }\n\t\n\t    xTree = tree['*'];\n\t    if (xTree) {\n\t      //\n\t      // If the listener tree will allow any match for this part,\n\t      // then recursively explore all branches of the tree\n\t      //\n\t      searchListenerTree(handlers, type, xTree, i+1);\n\t    }\n\t\n\t    xxTree = tree['**'];\n\t    if(xxTree) {\n\t      if(i < typeLength) {\n\t        if(xxTree._listeners) {\n\t          // If we have a listener on a '**', it will catch all, so add its handler.\n\t          searchListenerTree(handlers, type, xxTree, typeLength);\n\t        }\n\t\n\t        // Build arrays of matching next branches and others.\n\t        for(branch in xxTree) {\n\t          if(branch !== '_listeners' && xxTree.hasOwnProperty(branch)) {\n\t            if(branch === nextType) {\n\t              // We know the next element will match, so jump twice.\n\t              searchListenerTree(handlers, type, xxTree[branch], i+2);\n\t            } else if(branch === currentType) {\n\t              // Current node matches, move into the tree.\n\t              searchListenerTree(handlers, type, xxTree[branch], i+1);\n\t            } else {\n\t              isolatedBranch = {};\n\t              isolatedBranch[branch] = xxTree[branch];\n\t              searchListenerTree(handlers, type, { '**': isolatedBranch }, i+1);\n\t            }\n\t          }\n\t        }\n\t      } else if(xxTree._listeners) {\n\t        // We have reached the end and still on a '**'\n\t        searchListenerTree(handlers, type, xxTree, typeLength);\n\t      } else if(xxTree['*'] && xxTree['*']._listeners) {\n\t        searchListenerTree(handlers, type, xxTree['*'], typeLength);\n\t      }\n\t    }\n\t\n\t    return listeners;\n\t  }\n\t\n\t  function growListenerTree(type, listener) {\n\t\n\t    type = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n\t\n\t    //\n\t    // Looks for two consecutive '**', if so, don't add the event at all.\n\t    //\n\t    for(var i = 0, len = type.length; i+1 < len; i++) {\n\t      if(type[i] === '**' && type[i+1] === '**') {\n\t        return;\n\t      }\n\t    }\n\t\n\t    var tree = this.listenerTree;\n\t    var name = type.shift();\n\t\n\t    while (name) {\n\t\n\t      if (!tree[name]) {\n\t        tree[name] = {};\n\t      }\n\t\n\t      tree = tree[name];\n\t\n\t      if (type.length === 0) {\n\t\n\t        if (!tree._listeners) {\n\t          tree._listeners = listener;\n\t        }\n\t        else if(typeof tree._listeners === 'function') {\n\t          tree._listeners = [tree._listeners, listener];\n\t        }\n\t        else if (isArray(tree._listeners)) {\n\t\n\t          tree._listeners.push(listener);\n\t\n\t          if (!tree._listeners.warned) {\n\t\n\t            var m = defaultMaxListeners;\n\t\n\t            if (typeof this._events.maxListeners !== 'undefined') {\n\t              m = this._events.maxListeners;\n\t            }\n\t\n\t            if (m > 0 && tree._listeners.length > m) {\n\t\n\t              tree._listeners.warned = true;\n\t              console.error('(node) warning: possible EventEmitter memory ' +\n\t                            'leak detected. %d listeners added. ' +\n\t                            'Use emitter.setMaxListeners() to increase limit.',\n\t                            tree._listeners.length);\n\t              console.trace();\n\t            }\n\t          }\n\t        }\n\t        return true;\n\t      }\n\t      name = type.shift();\n\t    }\n\t    return true;\n\t  }\n\t\n\t  // By default EventEmitters will print a warning if more than\n\t  // 10 listeners are added to it. This is a useful default which\n\t  // helps finding memory leaks.\n\t  //\n\t  // Obviously not all Emitters should be limited to 10. This function allows\n\t  // that to be increased. Set to zero for unlimited.\n\t\n\t  EventEmitter.prototype.delimiter = '.';\n\t\n\t  EventEmitter.prototype.setMaxListeners = function(n) {\n\t    this._events || init.call(this);\n\t    this._events.maxListeners = n;\n\t    if (!this._conf) this._conf = {};\n\t    this._conf.maxListeners = n;\n\t  };\n\t\n\t  EventEmitter.prototype.event = '';\n\t\n\t  EventEmitter.prototype.once = function(event, fn) {\n\t    this.many(event, 1, fn);\n\t    return this;\n\t  };\n\t\n\t  EventEmitter.prototype.many = function(event, ttl, fn) {\n\t    var self = this;\n\t\n\t    if (typeof fn !== 'function') {\n\t      throw new Error('many only accepts instances of Function');\n\t    }\n\t\n\t    function listener() {\n\t      if (--ttl === 0) {\n\t        self.off(event, listener);\n\t      }\n\t      fn.apply(this, arguments);\n\t    }\n\t\n\t    listener._origin = fn;\n\t\n\t    this.on(event, listener);\n\t\n\t    return self;\n\t  };\n\t\n\t  EventEmitter.prototype.emit = function() {\n\t\n\t    this._events || init.call(this);\n\t\n\t    var type = arguments[0];\n\t\n\t    if (type === 'newListener' && !this.newListener) {\n\t      if (!this._events.newListener) { return false; }\n\t    }\n\t\n\t    // Loop through the *_all* functions and invoke them.\n\t    if (this._all) {\n\t      var l = arguments.length;\n\t      var args = new Array(l - 1);\n\t      for (var i = 1; i < l; i++) args[i - 1] = arguments[i];\n\t      for (i = 0, l = this._all.length; i < l; i++) {\n\t        this.event = type;\n\t        this._all[i].apply(this, args);\n\t      }\n\t    }\n\t\n\t    // If there is no 'error' event listener then throw.\n\t    if (type === 'error') {\n\t\n\t      if (!this._all &&\n\t        !this._events.error &&\n\t        !(this.wildcard && this.listenerTree.error)) {\n\t\n\t        if (arguments[1] instanceof Error) {\n\t          throw arguments[1]; // Unhandled 'error' event\n\t        } else {\n\t          throw new Error(\"Uncaught, unspecified 'error' event.\");\n\t        }\n\t        return false;\n\t      }\n\t    }\n\t\n\t    var handler;\n\t\n\t    if(this.wildcard) {\n\t      handler = [];\n\t      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n\t      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);\n\t    }\n\t    else {\n\t      handler = this._events[type];\n\t    }\n\t\n\t    if (typeof handler === 'function') {\n\t      this.event = type;\n\t      if (arguments.length === 1) {\n\t        handler.call(this);\n\t      }\n\t      else if (arguments.length > 1)\n\t        switch (arguments.length) {\n\t          case 2:\n\t            handler.call(this, arguments[1]);\n\t            break;\n\t          case 3:\n\t            handler.call(this, arguments[1], arguments[2]);\n\t            break;\n\t          // slower\n\t          default:\n\t            var l = arguments.length;\n\t            var args = new Array(l - 1);\n\t            for (var i = 1; i < l; i++) args[i - 1] = arguments[i];\n\t            handler.apply(this, args);\n\t        }\n\t      return true;\n\t    }\n\t    else if (handler) {\n\t      var l = arguments.length;\n\t      var args = new Array(l - 1);\n\t      for (var i = 1; i < l; i++) args[i - 1] = arguments[i];\n\t\n\t      var listeners = handler.slice();\n\t      for (var i = 0, l = listeners.length; i < l; i++) {\n\t        this.event = type;\n\t        listeners[i].apply(this, args);\n\t      }\n\t      return (listeners.length > 0) || !!this._all;\n\t    }\n\t    else {\n\t      return !!this._all;\n\t    }\n\t\n\t  };\n\t\n\t  EventEmitter.prototype.on = function(type, listener) {\n\t\n\t    if (typeof type === 'function') {\n\t      this.onAny(type);\n\t      return this;\n\t    }\n\t\n\t    if (typeof listener !== 'function') {\n\t      throw new Error('on only accepts instances of Function');\n\t    }\n\t    this._events || init.call(this);\n\t\n\t    // To avoid recursion in the case that type == \"newListeners\"! Before\n\t    // adding it to the listeners, first emit \"newListeners\".\n\t    this.emit('newListener', type, listener);\n\t\n\t    if(this.wildcard) {\n\t      growListenerTree.call(this, type, listener);\n\t      return this;\n\t    }\n\t\n\t    if (!this._events[type]) {\n\t      // Optimize the case of one listener. Don't need the extra array object.\n\t      this._events[type] = listener;\n\t    }\n\t    else if(typeof this._events[type] === 'function') {\n\t      // Adding the second element, need to change to array.\n\t      this._events[type] = [this._events[type], listener];\n\t    }\n\t    else if (isArray(this._events[type])) {\n\t      // If we've already got an array, just append.\n\t      this._events[type].push(listener);\n\t\n\t      // Check for listener leak\n\t      if (!this._events[type].warned) {\n\t\n\t        var m = defaultMaxListeners;\n\t\n\t        if (typeof this._events.maxListeners !== 'undefined') {\n\t          m = this._events.maxListeners;\n\t        }\n\t\n\t        if (m > 0 && this._events[type].length > m) {\n\t\n\t          this._events[type].warned = true;\n\t          console.error('(node) warning: possible EventEmitter memory ' +\n\t                        'leak detected. %d listeners added. ' +\n\t                        'Use emitter.setMaxListeners() to increase limit.',\n\t                        this._events[type].length);\n\t          console.trace();\n\t        }\n\t      }\n\t    }\n\t    return this;\n\t  };\n\t\n\t  EventEmitter.prototype.onAny = function(fn) {\n\t\n\t    if (typeof fn !== 'function') {\n\t      throw new Error('onAny only accepts instances of Function');\n\t    }\n\t\n\t    if(!this._all) {\n\t      this._all = [];\n\t    }\n\t\n\t    // Add the function to the event listener collection.\n\t    this._all.push(fn);\n\t    return this;\n\t  };\n\t\n\t  EventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\t\n\t  EventEmitter.prototype.off = function(type, listener) {\n\t    if (typeof listener !== 'function') {\n\t      throw new Error('removeListener only takes instances of Function');\n\t    }\n\t\n\t    var handlers,leafs=[];\n\t\n\t    if(this.wildcard) {\n\t      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n\t      leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\n\t    }\n\t    else {\n\t      // does not use listeners(), so no side effect of creating _events[type]\n\t      if (!this._events[type]) return this;\n\t      handlers = this._events[type];\n\t      leafs.push({_listeners:handlers});\n\t    }\n\t\n\t    for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {\n\t      var leaf = leafs[iLeaf];\n\t      handlers = leaf._listeners;\n\t      if (isArray(handlers)) {\n\t\n\t        var position = -1;\n\t\n\t        for (var i = 0, length = handlers.length; i < length; i++) {\n\t          if (handlers[i] === listener ||\n\t            (handlers[i].listener && handlers[i].listener === listener) ||\n\t            (handlers[i]._origin && handlers[i]._origin === listener)) {\n\t            position = i;\n\t            break;\n\t          }\n\t        }\n\t\n\t        if (position < 0) {\n\t          continue;\n\t        }\n\t\n\t        if(this.wildcard) {\n\t          leaf._listeners.splice(position, 1);\n\t        }\n\t        else {\n\t          this._events[type].splice(position, 1);\n\t        }\n\t\n\t        if (handlers.length === 0) {\n\t          if(this.wildcard) {\n\t            delete leaf._listeners;\n\t          }\n\t          else {\n\t            delete this._events[type];\n\t          }\n\t        }\n\t        return this;\n\t      }\n\t      else if (handlers === listener ||\n\t        (handlers.listener && handlers.listener === listener) ||\n\t        (handlers._origin && handlers._origin === listener)) {\n\t        if(this.wildcard) {\n\t          delete leaf._listeners;\n\t        }\n\t        else {\n\t          delete this._events[type];\n\t        }\n\t      }\n\t    }\n\t\n\t    return this;\n\t  };\n\t\n\t  EventEmitter.prototype.offAny = function(fn) {\n\t    var i = 0, l = 0, fns;\n\t    if (fn && this._all && this._all.length > 0) {\n\t      fns = this._all;\n\t      for(i = 0, l = fns.length; i < l; i++) {\n\t        if(fn === fns[i]) {\n\t          fns.splice(i, 1);\n\t          return this;\n\t        }\n\t      }\n\t    } else {\n\t      this._all = [];\n\t    }\n\t    return this;\n\t  };\n\t\n\t  EventEmitter.prototype.removeListener = EventEmitter.prototype.off;\n\t\n\t  EventEmitter.prototype.removeAllListeners = function(type) {\n\t    if (arguments.length === 0) {\n\t      !this._events || init.call(this);\n\t      return this;\n\t    }\n\t\n\t    if(this.wildcard) {\n\t      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n\t      var leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\n\t\n\t      for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {\n\t        var leaf = leafs[iLeaf];\n\t        leaf._listeners = null;\n\t      }\n\t    }\n\t    else {\n\t      if (!this._events[type]) return this;\n\t      this._events[type] = null;\n\t    }\n\t    return this;\n\t  };\n\t\n\t  EventEmitter.prototype.listeners = function(type) {\n\t    if(this.wildcard) {\n\t      var handlers = [];\n\t      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n\t      searchListenerTree.call(this, handlers, ns, this.listenerTree, 0);\n\t      return handlers;\n\t    }\n\t\n\t    this._events || init.call(this);\n\t\n\t    if (!this._events[type]) this._events[type] = [];\n\t    if (!isArray(this._events[type])) {\n\t      this._events[type] = [this._events[type]];\n\t    }\n\t    return this._events[type];\n\t  };\n\t\n\t  EventEmitter.prototype.listenersAny = function() {\n\t\n\t    if(this._all) {\n\t      return this._all;\n\t    }\n\t    else {\n\t      return [];\n\t    }\n\t\n\t  };\n\t\n\t  if (true) {\n\t     // AMD. Register as an anonymous module.\n\t    !(__WEBPACK_AMD_DEFINE_RESULT__ = function() {\n\t      return EventEmitter;\n\t    }.call(exports, __webpack_require__, exports, module), __WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n\t  } else if (typeof exports === 'object') {\n\t    // CommonJS\n\t    exports.EventEmitter2 = EventEmitter;\n\t  }\n\t  else {\n\t    // Browser global.\n\t    window.EventEmitter2 = EventEmitter;\n\t  }\n\t}();\n\n\n/***/ },\n/* 10 */\n/***/ function(module, exports) {\n\n\tmodule.exports = {Promise: window['Promise']}\n\n/***/ },\n/* 11 */\n/***/ function(module, exports) {\n\n\t/**\n\t * Copyright Marc J. Schmidt. See the LICENSE file at the top-level\n\t * directory of this distribution and at\n\t * https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n\t */\n\t;\n\t(function() {\n\t\n\t    /**\n\t     * Class for dimension change detection.\n\t     *\n\t     * @param {Element|Element[]|Elements|jQuery} element\n\t     * @param {Function} callback\n\t     *\n\t     * @constructor\n\t     */\n\t    var ResizeSensor = function(element, callback) {\n\t        /**\n\t         *\n\t         * @constructor\n\t         */\n\t        function EventQueue() {\n\t            this.q = [];\n\t            this.add = function(ev) {\n\t                this.q.push(ev);\n\t            };\n\t\n\t            var i, j;\n\t            this.call = function() {\n\t                for (i = 0, j = this.q.length; i < j; i++) {\n\t                    this.q[i].call();\n\t                }\n\t            };\n\t        }\n\t\n\t        /**\n\t         * @param {HTMLElement} element\n\t         * @param {String}      prop\n\t         * @returns {String|Number}\n\t         */\n\t        function getComputedStyle(element, prop) {\n\t            if (element.currentStyle) {\n\t                return element.currentStyle[prop];\n\t            } else if (window.getComputedStyle) {\n\t                return window.getComputedStyle(element, null).getPropertyValue(prop);\n\t            } else {\n\t                return element.style[prop];\n\t            }\n\t        }\n\t\n\t        /**\n\t         *\n\t         * @param {HTMLElement} element\n\t         * @param {Function}    resized\n\t         */\n\t        function attachResizeEvent(element, resized) {\n\t            if (!element.resizedAttached) {\n\t                element.resizedAttached = new EventQueue();\n\t                element.resizedAttached.add(resized);\n\t            } else if (element.resizedAttached) {\n\t                element.resizedAttached.add(resized);\n\t                return;\n\t            }\n\t\n\t            element.resizeSensor = document.createElement('div');\n\t            element.resizeSensor.className = 'resize-sensor';\n\t            var style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;';\n\t            var styleChild = 'position: absolute; left: 0; top: 0; transition: 0s;';\n\t\n\t            element.resizeSensor.style.cssText = style;\n\t            element.resizeSensor.innerHTML =\n\t                '<div class=\"resize-sensor-expand\" style=\"' + style + '\">' +\n\t                    '<div style=\"' + styleChild + '\"></div>' +\n\t                '</div>' +\n\t                '<div class=\"resize-sensor-shrink\" style=\"' + style + '\">' +\n\t                    '<div style=\"' + styleChild + ' width: 200%; height: 200%\"></div>' +\n\t                '</div>';\n\t            element.appendChild(element.resizeSensor);\n\t\n\t            if (!{fixed: 1, absolute: 1}[getComputedStyle(element, 'position')]) {\n\t                element.style.position = 'relative';\n\t            }\n\t\n\t            var expand = element.resizeSensor.childNodes[0];\n\t            var expandChild = expand.childNodes[0];\n\t            var shrink = element.resizeSensor.childNodes[1];\n\t            var shrinkChild = shrink.childNodes[0];\n\t\n\t            var lastWidth, lastHeight;\n\t\n\t            var reset = function() {\n\t                expandChild.style.width = expand.offsetWidth + 10 + 'px';\n\t                expandChild.style.height = expand.offsetHeight + 10 + 'px';\n\t                expand.scrollLeft = expand.scrollWidth;\n\t                expand.scrollTop = expand.scrollHeight;\n\t                shrink.scrollLeft = shrink.scrollWidth;\n\t                shrink.scrollTop = shrink.scrollHeight;\n\t                lastWidth = element.offsetWidth;\n\t                lastHeight = element.offsetHeight;\n\t            };\n\t\n\t            reset();\n\t\n\t            var changed = function() {\n\t                if (element.resizedAttached) {\n\t                    element.resizedAttached.call();\n\t                }\n\t            };\n\t\n\t            var addEvent = function(el, name, cb) {\n\t                if (el.attachEvent) {\n\t                    el.attachEvent('on' + name, cb);\n\t                } else {\n\t                    el.addEventListener(name, cb);\n\t                }\n\t            };\n\t\n\t            var onScroll = function() {\n\t              if (element.offsetWidth != lastWidth || element.offsetHeight != lastHeight) {\n\t                  changed();\n\t              }\n\t              reset();\n\t            };\n\t\n\t            addEvent(expand, 'scroll', onScroll);\n\t            addEvent(shrink, 'scroll', onScroll);\n\t        }\n\t\n\t        var elementType = Object.prototype.toString.call(element);\n\t        var isCollectionTyped = ('[object Array]' === elementType\n\t            || ('[object NodeList]' === elementType)\n\t            || ('[object HTMLCollection]' === elementType)\n\t            || ('undefined' !== typeof jQuery && element instanceof jQuery) //jquery\n\t            || ('undefined' !== typeof Elements && element instanceof Elements) //mootools\n\t        );\n\t\n\t        if (isCollectionTyped) {\n\t            var i = 0, j = element.length;\n\t            for (; i < j; i++) {\n\t                attachResizeEvent(element[i], callback);\n\t            }\n\t        } else {\n\t            attachResizeEvent(element, callback);\n\t        }\n\t\n\t        this.detach = function() {\n\t            if (isCollectionTyped) {\n\t                var i = 0, j = element.length;\n\t                for (; i < j; i++) {\n\t                    ResizeSensor.detach(element[i]);\n\t                }\n\t            } else {\n\t                ResizeSensor.detach(element);\n\t            }\n\t        };\n\t    };\n\t\n\t    ResizeSensor.detach = function(element) {\n\t        if (element.resizeSensor) {\n\t            element.removeChild(element.resizeSensor);\n\t            delete element.resizeSensor;\n\t            delete element.resizedAttached;\n\t        }\n\t    };\n\t\n\t    // make available to common module loader\n\t    if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n\t        module.exports = ResizeSensor;\n\t    }\n\t    else {\n\t        window.ResizeSensor = ResizeSensor;\n\t    }\n\t\n\t})();\n\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar Widget_1 = __webpack_require__(15);\r\n\tvar TrendsManager_1 = __webpack_require__(16);\r\n\tvar Screen_1 = __webpack_require__(19);\r\n\tvar AxisMarks_1 = __webpack_require__(20);\r\n\tvar interfaces_1 = __webpack_require__(21);\r\n\tvar deps_1 = __webpack_require__(3);\r\n\tvar CHART_STATE_EVENTS = {\r\n\t    INITIAL_STATE_APPLIED: 'initialStateApplied',\r\n\t    READY: 'ready',\r\n\t    DESTROY: 'destroy',\r\n\t    CHANGE: 'change',\r\n\t    TREND_CHANGE: 'trendChange',\r\n\t    TRENDS_CHANGE: 'trendsChange',\r\n\t    ZOOM: 'zoom',\r\n\t    RESIZE: 'resize',\r\n\t    SCROLL: 'scroll',\r\n\t    SCROLL_STOP: 'scrollStop',\r\n\t    PLUGINS_STATE_CHANGED: 'pluginsStateChanged'\r\n\t};\r\n\t/**\r\n\t *  class for manage chart state, all state changes caused only by State.setState method\r\n\t */\r\n\tvar ChartState = (function () {\r\n\t    function ChartState(initialState, widgetsClasses, plugins) {\r\n\t        if (widgetsClasses === void 0) { widgetsClasses = {}; }\r\n\t        if (plugins === void 0) { plugins = []; }\r\n\t        this.data = {\r\n\t            prevState: {},\r\n\t            $el: null,\r\n\t            zoom: 0,\r\n\t            xAxis: {\r\n\t                range: {\r\n\t                    type: interfaces_1.AXIS_RANGE_TYPE.ALL,\r\n\t                    from: 0,\r\n\t                    to: 0,\r\n\t                    scroll: 0,\r\n\t                    zoom: 1,\r\n\t                    padding: { start: 0, end: 5 },\r\n\t                    margin: { start: 0, end: 5 }\r\n\t                },\r\n\t                dataType: interfaces_1.AXIS_DATA_TYPE.NUMBER,\r\n\t                gridMinSize: 100,\r\n\t                autoScroll: true,\r\n\t                marks: [],\r\n\t            },\r\n\t            yAxis: {\r\n\t                range: {\r\n\t                    type: interfaces_1.AXIS_RANGE_TYPE.RELATIVE_END,\r\n\t                    from: 0,\r\n\t                    to: 0,\r\n\t                    zoom: 1,\r\n\t                    padding: { start: 5, end: 5 },\r\n\t                    margin: { start: 5, end: 5 }\r\n\t                },\r\n\t                dataType: interfaces_1.AXIS_DATA_TYPE.NUMBER,\r\n\t                gridMinSize: 50,\r\n\t                marks: []\r\n\t            },\r\n\t            animations: {\r\n\t                enabled: true,\r\n\t                trendChangeSpeed: 0.5,\r\n\t                trendChangeEase: void 0,\r\n\t                zoomSpeed: 0.25,\r\n\t                zoomEase: Linear.easeNone,\r\n\t                scrollSpeed: 0.5,\r\n\t                scrollEase: Linear.easeNone,\r\n\t                autoScrollSpeed: 1,\r\n\t                autoScrollEase: Linear.easeNone,\r\n\t            },\r\n\t            autoRender: { enabled: true, fps: 0 },\r\n\t            autoResize: true,\r\n\t            renderer: 'WebGLRenderer',\r\n\t            autoScroll: true,\r\n\t            controls: { enabled: true },\r\n\t            cursor: {\r\n\t                dragMode: false,\r\n\t                x: 0,\r\n\t                y: 0\r\n\t            },\r\n\t            backgroundColor: 0x000000,\r\n\t            backgroundOpacity: 1,\r\n\t            showStats: false,\r\n\t            pluginsState: {},\r\n\t            eventEmitterMaxListeners: 20\r\n\t        };\r\n\t        this.widgetsClasses = {};\r\n\t        this.plugins = {};\r\n\t        /**\r\n\t         * true then chartState was initialized and ready to use\r\n\t         */\r\n\t        this.isReady = false;\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.ee.setMaxListeners(initialState.eventEmitterMaxListeners || this.data.eventEmitterMaxListeners);\r\n\t        this.widgetsClasses = widgetsClasses;\r\n\t        this.trendsManager = new TrendsManager_1.TrendsManager(this, initialState);\r\n\t        initialState.trends = this.trendsManager.calculatedOptions;\r\n\t        initialState = this.installPlugins(plugins, initialState);\r\n\t        this.setState(initialState);\r\n\t        this.setState({ computedData: this.getComputedData() });\r\n\t        this.savePrevState();\r\n\t        this.screen = new Screen_1.Screen(this);\r\n\t        this.xAxisMarks = new AxisMarks_1.AxisMarks(this, interfaces_1.AXIS_TYPE.X);\r\n\t        this.yAxisMarks = new AxisMarks_1.AxisMarks(this, interfaces_1.AXIS_TYPE.Y);\r\n\t        this.initListeners();\r\n\t        // message to other modules that ChartState.data is ready for use \r\n\t        this.ee.emit(CHART_STATE_EVENTS.INITIAL_STATE_APPLIED, initialState);\r\n\t        // message to other modules that ChartState is ready for use\r\n\t        this.isReady = true;\r\n\t        this.ee.emit(CHART_STATE_EVENTS.READY, initialState);\r\n\t    }\r\n\t    /**\r\n\t     * destroy state, use Chart.destroy to completely destroy chart\r\n\t     */\r\n\t    ChartState.prototype.destroy = function () {\r\n\t        this.ee.emit(CHART_STATE_EVENTS.DESTROY);\r\n\t        this.ee.removeAllListeners();\r\n\t        this.data = {};\r\n\t    };\r\n\t    ChartState.prototype.onDestroy = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.DESTROY, cb);\r\n\t    };\r\n\t    ChartState.prototype.onInitialStateApplied = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.INITIAL_STATE_APPLIED, cb);\r\n\t    };\r\n\t    ChartState.prototype.onReady = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.READY, cb);\r\n\t    };\r\n\t    ChartState.prototype.onChange = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.CHANGE, cb);\r\n\t    };\r\n\t    ChartState.prototype.onTrendChange = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.TREND_CHANGE, cb);\r\n\t    };\r\n\t    ChartState.prototype.onTrendsChange = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.TRENDS_CHANGE, cb);\r\n\t    };\r\n\t    ChartState.prototype.onScrollStop = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.SCROLL_STOP, cb);\r\n\t    };\r\n\t    ChartState.prototype.onScroll = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.SCROLL, cb);\r\n\t    };\r\n\t    ChartState.prototype.onZoom = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.ZOOM, cb);\r\n\t    };\r\n\t    ChartState.prototype.onResize = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.RESIZE, cb);\r\n\t    };\r\n\t    ChartState.prototype.onPluginsStateChange = function (cb) {\r\n\t        return this.ee.subscribe(CHART_STATE_EVENTS.PLUGINS_STATE_CHANGED, cb);\r\n\t    };\r\n\t    ChartState.prototype.getTrend = function (trendName) {\r\n\t        return this.trendsManager.getTrend(trendName);\r\n\t    };\r\n\t    ChartState.prototype.setState = function (newState, eventData, silent) {\r\n\t        if (silent === void 0) { silent = false; }\r\n\t        var stateData = this.data;\r\n\t        var changedProps = {};\r\n\t        for (var key in newState) {\r\n\t            if (stateData[key] !== newState[key]) {\r\n\t                changedProps[key] = newState[key];\r\n\t            }\r\n\t        }\r\n\t        this.savePrevState(changedProps);\r\n\t        // temporary remove trends data from newState by performance reasons\r\n\t        var trendsData = {};\r\n\t        if (newState.trends)\r\n\t            for (var trendName in newState.trends) {\r\n\t                var trendOptions = newState.trends[trendName];\r\n\t                if (trendOptions.data)\r\n\t                    trendsData[trendName] = trendOptions.data;\r\n\t                delete trendOptions.data;\r\n\t            }\r\n\t        var newStateContainsData = Object.keys(trendsData).length > 0;\r\n\t        this.data = Utils_1.Utils.deepMerge(this.data, newState, false);\r\n\t        // return data to state\r\n\t        if (newStateContainsData)\r\n\t            for (var trendName in trendsData) {\r\n\t                this.data.trends[trendName].data = trendsData[trendName];\r\n\t            }\r\n\t        if (silent)\r\n\t            return;\r\n\t        // recalculate all dynamic state props\r\n\t        var recalculateResult = this.recalculateState(changedProps);\r\n\t        changedProps = recalculateResult.changedProps;\r\n\t        this.emitChangedStateEvents(changedProps, eventData);\r\n\t    };\r\n\t    /**\r\n\t     * recalculate all computed state props\r\n\t     */\r\n\t    ChartState.prototype.recalculateState = function (changedProps) {\r\n\t        var data = this.data;\r\n\t        var patch = {};\r\n\t        var actualData = Utils_1.Utils.deepMerge({}, data);\r\n\t        // recalculate widgets\r\n\t        if (changedProps.widgets || !data.widgets) {\r\n\t            patch.widgets = {};\r\n\t            var widgetsOptions = data.widgets || {};\r\n\t            for (var widgetName in this.widgetsClasses) {\r\n\t                var WidgetClass = this.widgetsClasses[widgetName];\r\n\t                var userOptions = widgetsOptions[widgetName] || {};\r\n\t                var defaultOptions = WidgetClass.getDefaultOptions() || Widget_1.ChartWidget.getDefaultOptions();\r\n\t                patch.widgets[widgetName] = Utils_1.Utils.deepMerge(defaultOptions, userOptions);\r\n\t            }\r\n\t        }\r\n\t        // recalculate scroll position by changed cursor options\r\n\t        var cursorOptions = changedProps.cursor;\r\n\t        var isMouseDrag = cursorOptions && data.cursor.dragMode && data.prevState.cursor.dragMode;\r\n\t        if (isMouseDrag) {\r\n\t            var oldX = data.prevState.cursor.x;\r\n\t            var currentX = cursorOptions.x;\r\n\t            var currentScroll = data.xAxis.range.scroll;\r\n\t            var deltaXVal = this.pxToValueByXAxis(oldX - currentX);\r\n\t            patch.xAxis = { range: { scroll: currentScroll + deltaXVal } };\r\n\t            actualData = Utils_1.Utils.deepMerge(actualData, { xAxis: patch.xAxis });\r\n\t        }\r\n\t        var chartWasResized = changedProps.width != void 0 || changedProps.height != void 0;\r\n\t        var scrollXChanged = false;\r\n\t        var needToRecalculateXAxis = (isMouseDrag ||\r\n\t            chartWasResized ||\r\n\t            (changedProps.xAxis && (changedProps.xAxis.range)) ||\r\n\t            this.data.xAxis.range.zeroVal == void 0);\r\n\t        if (needToRecalculateXAxis) {\r\n\t            var xAxisPatch = this.recalculateXAxis(actualData, changedProps);\r\n\t            if (xAxisPatch) {\r\n\t                scrollXChanged = true;\r\n\t                patch = Utils_1.Utils.deepMerge(patch, { xAxis: xAxisPatch });\r\n\t                actualData = Utils_1.Utils.deepMerge(actualData, { xAxis: xAxisPatch });\r\n\t            }\r\n\t        }\r\n\t        // recalculate axis \"from\" and \"to\" for dynamics AXIS_RANGE_TYPE\r\n\t        var needToRecalculateYAxis = (chartWasResized ||\r\n\t            (data.yAxis.range.type === interfaces_1.AXIS_RANGE_TYPE.RELATIVE_END ||\r\n\t                data.yAxis.range.type === interfaces_1.AXIS_RANGE_TYPE.AUTO ||\r\n\t                data.yAxis.range.isMirrorMode) &&\r\n\t                (scrollXChanged || changedProps.trends || changedProps.yAxis) ||\r\n\t            this.data.yAxis.range.zeroVal == void 0);\r\n\t        if (needToRecalculateYAxis) {\r\n\t            var yAxisPatch = this.recalculateYAxis(actualData);\r\n\t            if (yAxisPatch) {\r\n\t                patch = Utils_1.Utils.deepMerge(patch, { yAxis: yAxisPatch });\r\n\t                actualData = Utils_1.Utils.deepMerge(actualData, { yAxis: yAxisPatch });\r\n\t            }\r\n\t        }\r\n\t        this.savePrevState(patch);\r\n\t        var allChangedProps = Utils_1.Utils.deepMerge(changedProps, patch);\r\n\t        patch.computedData = this.getComputedData(allChangedProps);\r\n\t        this.savePrevState(patch);\r\n\t        this.data = Utils_1.Utils.deepMerge(this.data, patch);\r\n\t        return { changedProps: allChangedProps, patch: patch };\r\n\t    };\r\n\t    ChartState.prototype.getComputedData = function (changedProps) {\r\n\t        var computeAll = !changedProps;\r\n\t        var computedData = {};\r\n\t        if (computeAll || changedProps.trends && this.trendsManager) {\r\n\t            computedData.trends = {\r\n\t                maxXVal: this.trendsManager.getEndXVal(),\r\n\t                minXVal: this.trendsManager.getStartXVal()\r\n\t            };\r\n\t        }\r\n\t        return computedData;\r\n\t    };\r\n\t    ChartState.prototype.savePrevState = function (changedProps) {\r\n\t        // var propsToSave = changedProps ? Object.keys(changedProps) : Object.keys(this.data);\r\n\t        if (!changedProps)\r\n\t            changedProps = this.data;\r\n\t        var prevState = this.data.prevState;\r\n\t        // prevent to store prev trend data by performance reasons\r\n\t        Utils_1.Utils.copyProps(this.data, prevState, changedProps, ['trends']);\r\n\t    };\r\n\t    ChartState.prototype.emitChangedStateEvents = function (changedProps, eventData) {\r\n\t        var prevState = this.data.prevState;\r\n\t        // emit common change event\r\n\t        this.ee.emit(CHART_STATE_EVENTS.CHANGE, changedProps, eventData);\r\n\t        // emit event for each changed state property\r\n\t        for (var key in changedProps) {\r\n\t            this.ee.emit(key + 'Change', changedProps[key], eventData);\r\n\t        }\r\n\t        if (!this.isReady)\r\n\t            return;\r\n\t        // emit special events based on changed state\r\n\t        var scrollStopEventNeeded = (changedProps.cursor &&\r\n\t            changedProps.cursor.dragMode === false &&\r\n\t            prevState.cursor.dragMode === true);\r\n\t        scrollStopEventNeeded && this.ee.emit(CHART_STATE_EVENTS.SCROLL_STOP, changedProps);\r\n\t        var scrollChangeEventsNeeded = (changedProps.xAxis &&\r\n\t            changedProps.xAxis.range &&\r\n\t            changedProps.xAxis.range.scroll !== void 0);\r\n\t        scrollChangeEventsNeeded && this.ee.emit(CHART_STATE_EVENTS.SCROLL, changedProps);\r\n\t        var zoomEventsNeeded = ((changedProps.xAxis && changedProps.xAxis.range && changedProps.xAxis.range.zoom) ||\r\n\t            (changedProps.yAxis && changedProps.yAxis.range && changedProps.yAxis.range.zoom));\r\n\t        zoomEventsNeeded && this.ee.emit(CHART_STATE_EVENTS.ZOOM, changedProps);\r\n\t        var resizeEventNeeded = (changedProps.width || changedProps.height);\r\n\t        resizeEventNeeded && this.ee.emit(CHART_STATE_EVENTS.RESIZE, changedProps);\r\n\t        var pluginStateChangedEventNeeded = !!(changedProps.pluginsState);\r\n\t        pluginStateChangedEventNeeded && this.ee.emit(CHART_STATE_EVENTS.PLUGINS_STATE_CHANGED, changedProps.pluginsState);\r\n\t    };\r\n\t    /**\r\n\t     * init plugins and save plugins options in initialState\r\n\t     */\r\n\t    ChartState.prototype.installPlugins = function (plugins, initialState) {\r\n\t        var _this = this;\r\n\t        initialState.pluginsState = {};\r\n\t        plugins.forEach(function (plugin) {\r\n\t            var PluginClass = plugin.constructor;\r\n\t            var pluginName = PluginClass.NAME;\r\n\t            PluginClass.pluginWidgets.forEach(function (PluginWidget) { return _this.widgetsClasses[PluginWidget.widgetName] = PluginWidget; });\r\n\t            initialState.pluginsState[pluginName] = Utils_1.Utils.deepMerge({}, plugin.initialState);\r\n\t            _this.plugins[pluginName] = plugin;\r\n\t            plugin.setupChartState(_this);\r\n\t        });\r\n\t        return initialState;\r\n\t    };\r\n\t    /**\r\n\t     * returns plugin instance by plugin name\r\n\t     * @example\r\n\t     */\r\n\t    ChartState.prototype.getPlugin = function (pluginName) {\r\n\t        return this.plugins[pluginName];\r\n\t    };\r\n\t    ChartState.prototype.initListeners = function () {\r\n\t        var _this = this;\r\n\t        this.ee.on(CHART_STATE_EVENTS.TRENDS_CHANGE, function (changedTrends, newData) {\r\n\t            _this.handleTrendsChange(changedTrends, newData);\r\n\t        });\r\n\t    };\r\n\t    ChartState.prototype.handleTrendsChange = function (changedTrends, newData) {\r\n\t        for (var trendName in changedTrends) {\r\n\t            this.ee.emit(CHART_STATE_EVENTS.TREND_CHANGE, trendName, changedTrends[trendName], newData);\r\n\t        }\r\n\t    };\r\n\t    ChartState.prototype.recalculateXAxis = function (actualData, changedProps) {\r\n\t        var axisRange = actualData.xAxis.range;\r\n\t        var patch = { range: {} };\r\n\t        var isInitialize = axisRange.zeroVal == void 0;\r\n\t        var zeroVal, scaleFactor;\r\n\t        var zoom = axisRange.zoom;\r\n\t        if (axisRange.isMirrorMode) {\r\n\t            Utils_1.Utils.error('range.isMirrorMode available only for yAxis.range');\r\n\t        }\r\n\t        if (isInitialize) {\r\n\t            zeroVal = axisRange.from;\r\n\t            scaleFactor = actualData.width / (axisRange.to - axisRange.from);\r\n\t            patch = { range: { zeroVal: zeroVal, scaleFactor: scaleFactor } };\r\n\t        }\r\n\t        else {\r\n\t            zeroVal = axisRange.zeroVal;\r\n\t            scaleFactor = axisRange.scaleFactor;\r\n\t            // recalculate range.zoom and range.scroll then range.from or range.to was changed\r\n\t            if (changedProps.xAxis &&\r\n\t                (changedProps.xAxis.range.from != void 0 || changedProps.xAxis.range.to)) {\r\n\t                if (changedProps.xAxis.range.zoom) {\r\n\t                    Utils_1.Utils.error('Impossible to change \"range.zoom\" then \"range.from\" or \"range.to\" present');\r\n\t                }\r\n\t                var currentScaleFactor = actualData.width / (axisRange.to - axisRange.from);\r\n\t                patch.range.scroll = axisRange.from - zeroVal;\r\n\t                patch.range.zoom = currentScaleFactor / scaleFactor;\r\n\t                return patch;\r\n\t            }\r\n\t        }\r\n\t        // recalculate range.from and range.to then range.zoom or range.scroll was changed\r\n\t        do {\r\n\t            var from = zeroVal + axisRange.scroll;\r\n\t            var to = from + actualData.width / (scaleFactor * zoom);\r\n\t            var rangeLength = to - from;\r\n\t            var needToRecalculateZoom = false;\r\n\t            var rangeMoreThenMaxValue = (axisRange.maxLength && rangeLength > axisRange.maxLength);\r\n\t            var rangeLessThenMinValue = (axisRange.minLength && rangeLength < axisRange.minLength);\r\n\t            needToRecalculateZoom = rangeMoreThenMaxValue || rangeLessThenMinValue;\r\n\t            if (needToRecalculateZoom) {\r\n\t                var fixScale = rangeLength > axisRange.maxLength ?\r\n\t                    rangeLength / axisRange.maxLength :\r\n\t                    rangeLength / axisRange.minLength;\r\n\t                var zoom = zoom * fixScale;\r\n\t                patch.range.zoom = zoom;\r\n\t            }\r\n\t        } while (needToRecalculateZoom);\r\n\t        patch.range.from = from;\r\n\t        patch.range.to = to;\r\n\t        return patch;\r\n\t    };\r\n\t    ChartState.prototype.recalculateYAxis = function (actualData) {\r\n\t        var patch = { range: {} };\r\n\t        var yAxisRange = actualData.yAxis.range;\r\n\t        var isInitialize = yAxisRange.scaleFactor == void 0;\r\n\t        var trends = this.trendsManager;\r\n\t        var trendsEndXVal = trends.getEndXVal();\r\n\t        var trendsStartXVal = trends.getStartXVal();\r\n\t        var xRange = actualData.xAxis.range;\r\n\t        var xFrom = xRange.from, xTo = xRange.to;\r\n\t        var xRangeLength = xTo - xFrom;\r\n\t        var zeroVal, scaleFactor, scroll, zoom, needToZoom;\r\n\t        // check situation when chart was scrolled behind trends end or before trends start\r\n\t        if (xTo > trendsEndXVal) {\r\n\t            xTo = trendsEndXVal;\r\n\t            xFrom = xTo - xRangeLength;\r\n\t        }\r\n\t        else if (xFrom < trendsStartXVal) {\r\n\t            xFrom = trendsStartXVal;\r\n\t            xTo = xFrom + xRangeLength;\r\n\t        }\r\n\t        var maxY = trends.getMaxYVal(xFrom, xTo);\r\n\t        var minY = trends.getMinYVal(xFrom, xTo);\r\n\t        var trendLastY = trends.getMaxYVal(trendsEndXVal, trendsEndXVal);\r\n\t        if (yAxisRange.type == interfaces_1.AXIS_RANGE_TYPE.RELATIVE_END) {\r\n\t            if (trendLastY > maxY)\r\n\t                maxY = trendLastY;\r\n\t            if (trendLastY < minY)\r\n\t                minY = trendLastY;\r\n\t        }\r\n\t        if (yAxisRange.isMirrorMode) {\r\n\t            if (yAxisRange.zeroVal == void 0)\r\n\t                Utils_1.Utils.error('range.zeroVal must be set when range.isMirrorMode');\r\n\t            var distanceFromZeroValForMaxY = Math.abs(yAxisRange.zeroVal - maxY);\r\n\t            var distanceFromZeroValForMinY = Math.abs(yAxisRange.zeroVal - minY);\r\n\t            var maxDistanceFromZeroVal = Math.max(distanceFromZeroValForMaxY, distanceFromZeroValForMinY);\r\n\t            maxY = yAxisRange.zeroVal + maxDistanceFromZeroVal;\r\n\t            minY = yAxisRange.zeroVal - maxDistanceFromZeroVal;\r\n\t        }\r\n\t        var margin = yAxisRange.margin;\r\n\t        var padding = {\r\n\t            start: yAxisRange.padding.start + margin.start,\r\n\t            end: yAxisRange.padding.end + margin.end\r\n\t        };\r\n\t        if (padding.end + padding.start >= actualData.height) {\r\n\t            Utils_1.Utils.warn('Sum of padding and margins of yAxi more then available chart height. Trends can be rendered incorrectly');\r\n\t        }\r\n\t        var rangeLength = maxY - minY;\r\n\t        var paddingTopInPercents = padding.end / actualData.height;\r\n\t        var paddingBottomInPercents = padding.start / actualData.height;\r\n\t        var rangeLengthInPercents = 1 - paddingTopInPercents - paddingBottomInPercents;\r\n\t        var visibleRangeLength = rangeLength / rangeLengthInPercents;\r\n\t        var fromVal = minY - visibleRangeLength * paddingBottomInPercents;\r\n\t        var toVal = maxY + visibleRangeLength * paddingTopInPercents;\r\n\t        if (isInitialize) {\r\n\t            zeroVal = yAxisRange.zeroVal != void 0 ? yAxisRange.zeroVal : fromVal;\r\n\t            scaleFactor = actualData.height / (toVal - fromVal);\r\n\t            patch = { range: { zeroVal: zeroVal, scaleFactor: scaleFactor } };\r\n\t            needToZoom = true;\r\n\t        }\r\n\t        else {\r\n\t            scaleFactor = yAxisRange.scaleFactor;\r\n\t            zeroVal = yAxisRange.zeroVal;\r\n\t            var maxScreenY = Math.round(this.getScreenYByValue(maxY));\r\n\t            var minScreenY = Math.round(this.getScreenYByValue(minY));\r\n\t            needToZoom = (maxScreenY > actualData.height - margin.end ||\r\n\t                maxScreenY < actualData.height - padding.end ||\r\n\t                minScreenY < margin.start ||\r\n\t                minScreenY > padding.start);\r\n\t        }\r\n\t        if (!needToZoom)\r\n\t            return null;\r\n\t        scroll = fromVal - zeroVal;\r\n\t        zoom = (actualData.height / (toVal - fromVal)) / scaleFactor;\r\n\t        var currentAxisRange = this.data.yAxis.range;\r\n\t        if (currentAxisRange.from !== fromVal)\r\n\t            patch.range.from = fromVal;\r\n\t        if (currentAxisRange.to !== toVal)\r\n\t            patch.range.to = toVal;\r\n\t        if (currentAxisRange.scroll !== scroll)\r\n\t            patch.range.scroll = scroll;\r\n\t        if (currentAxisRange.zoom !== zoom)\r\n\t            patch.range.zoom = zoom;\r\n\t        return patch;\r\n\t    };\r\n\t    ChartState.prototype.zoom = function (zoomValue, origin) {\r\n\t        var _this = this;\r\n\t        if (origin === void 0) { origin = 0.5; }\r\n\t        var _a = this.data.xAxis.range, zoom = _a.zoom, scroll = _a.scroll, scaleFactor = _a.scaleFactor;\r\n\t        var newZoom = zoom * zoomValue;\r\n\t        var currentRange = this.data.width / (scaleFactor * zoom);\r\n\t        var nextRange = this.data.width / (scaleFactor * newZoom);\r\n\t        var newScroll = scroll + (currentRange - nextRange) * origin;\r\n\t        this.setState({ xAxis: { range: { zoom: newZoom, scroll: newScroll } } });\r\n\t        return new deps_1.Promise(function (resolve) {\r\n\t            var animationTime = _this.data.animations.enabled ? _this.data.animations.zoomSpeed : 0;\r\n\t            setTimeout(resolve, animationTime * 1000);\r\n\t        });\r\n\t    };\r\n\t    ChartState.prototype.zoomToRange = function (range, origin) {\r\n\t        var _a = this.data.xAxis.range, scaleFactor = _a.scaleFactor, zoom = _a.zoom;\r\n\t        var currentRange = this.data.width / (scaleFactor * zoom);\r\n\t        return this.zoom(currentRange / range, origin);\r\n\t    };\r\n\t    ChartState.prototype.scrollToEnd = function () {\r\n\t        var _this = this;\r\n\t        var state = this.data;\r\n\t        var endXVal = this.trendsManager.getEndXVal();\r\n\t        var range = state.xAxis.range;\r\n\t        var scroll = endXVal - this.pxToValueByXAxis(state.width) + this.pxToValueByXAxis(range.padding.end) - range.zeroVal;\r\n\t        this.setState({ xAxis: { range: { scroll: scroll } } });\r\n\t        return new deps_1.Promise(function (resolve) {\r\n\t            var animationTime = _this.data.animations.enabled ? _this.data.animations.scrollSpeed : 0;\r\n\t            setTimeout(resolve, animationTime * 1000);\r\n\t        });\r\n\t    };\r\n\t    /**\r\n\t     *  returns offset in pixels from xAxis.range.zeroVal to xVal\r\n\t     */\r\n\t    ChartState.prototype.getPointOnXAxis = function (xVal) {\r\n\t        var _a = this.data.xAxis.range, scaleFactor = _a.scaleFactor, zoom = _a.zoom, zeroVal = _a.zeroVal;\r\n\t        return (xVal - zeroVal) * scaleFactor * zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  returns offset in pixels from yAxis.range.zeroVal to yVal\r\n\t     */\r\n\t    ChartState.prototype.getPointOnYAxis = function (yVal) {\r\n\t        var _a = this.data.yAxis.range, scaleFactor = _a.scaleFactor, zoom = _a.zoom, zeroVal = _a.zeroVal;\r\n\t        return (yVal - zeroVal) * scaleFactor * zoom;\r\n\t    };\r\n\t    /**\r\n\t     * returns value by offset in pixels from xAxis.range.zeroVal\r\n\t     */\r\n\t    ChartState.prototype.getValueOnXAxis = function (x) {\r\n\t        return this.data.xAxis.range.zeroVal + this.pxToValueByXAxis(x);\r\n\t    };\r\n\t    /**\r\n\t     *  convert value to pixels by using settings from xAxis.range\r\n\t     */\r\n\t    ChartState.prototype.valueToPxByXAxis = function (xVal) {\r\n\t        return xVal * this.data.xAxis.range.scaleFactor * this.data.xAxis.range.zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  convert value to pixels by using settings from yAxis.range\r\n\t     */\r\n\t    ChartState.prototype.valueToPxByYAxis = function (yVal) {\r\n\t        return yVal * this.data.yAxis.range.scaleFactor * this.data.yAxis.range.zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  convert pixels to value by using settings from xAxis.range\r\n\t     */\r\n\t    ChartState.prototype.pxToValueByXAxis = function (xVal) {\r\n\t        return xVal / this.data.xAxis.range.scaleFactor / this.data.xAxis.range.zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  convert pixels to value by using settings from yAxis.range\r\n\t     */\r\n\t    ChartState.prototype.pxToValueByYAxis = function (yVal) {\r\n\t        return yVal / this.data.yAxis.range.scaleFactor / this.data.yAxis.range.zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  returns x value by screen x coordinate\r\n\t     */\r\n\t    ChartState.prototype.getValueByScreenX = function (x) {\r\n\t        var _a = this.data.xAxis.range, zeroVal = _a.zeroVal, scroll = _a.scroll;\r\n\t        return zeroVal + scroll + this.pxToValueByXAxis(x);\r\n\t    };\r\n\t    /**\r\n\t     *  returns y value by screen y coordinate\r\n\t     */\r\n\t    ChartState.prototype.getValueByScreenY = function (y) {\r\n\t        var _a = this.data.yAxis.range, zeroVal = _a.zeroVal, scroll = _a.scroll;\r\n\t        return zeroVal + scroll + this.pxToValueByYAxis(y);\r\n\t    };\r\n\t    /**\r\n\t     *  returns screen x value by screen y coordinate\r\n\t     */\r\n\t    ChartState.prototype.getScreenXByValue = function (xVal) {\r\n\t        var _a = this.data.xAxis.range, scroll = _a.scroll, zeroVal = _a.zeroVal;\r\n\t        return this.valueToPxByXAxis(xVal - zeroVal - scroll);\r\n\t    };\r\n\t    /**\r\n\t     *  returns screen y value by screen y coordinate\r\n\t     */\r\n\t    ChartState.prototype.getScreenYByValue = function (yVal) {\r\n\t        var _a = this.data.yAxis.range, scroll = _a.scroll, zeroVal = _a.zeroVal;\r\n\t        return this.valueToPxByYAxis(yVal - zeroVal - scroll);\r\n\t    };\r\n\t    /**\r\n\t     * returns screen x coordinate by offset in pixels from xAxis.range.zeroVal value\r\n\t     */\r\n\t    ChartState.prototype.getScreenXByPoint = function (xVal) {\r\n\t        return this.getScreenXByValue(this.getValueOnXAxis(xVal));\r\n\t    };\r\n\t    /**\r\n\t     * returns offset in pixels from xAxis.range.zeroVal value by screen x coordinate\r\n\t     */\r\n\t    ChartState.prototype.getPointByScreenX = function (screenX) {\r\n\t        return this.getPointOnXAxis(this.getValueByScreenX(screenX));\r\n\t    };\r\n\t    ChartState.prototype.getPointOnChart = function (xVal, yVal) {\r\n\t        return new Vector3(this.getPointOnXAxis(xVal), this.getPointOnYAxis(yVal), 0);\r\n\t    };\r\n\t    ChartState.prototype.getScreenLeftVal = function () {\r\n\t        return this.getValueByScreenX(0);\r\n\t    };\r\n\t    ChartState.prototype.getScreenRightVal = function () {\r\n\t        return this.getValueByScreenX(this.data.width);\r\n\t    };\r\n\t    ChartState.prototype.getPaddingRight = function () {\r\n\t        return this.getValueByScreenX(this.data.width - this.data.xAxis.range.padding.end);\r\n\t    };\r\n\t    return ChartState;\r\n\t}());\r\n\texports.ChartState = ChartState;\r\n\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar deps_1 = __webpack_require__(3);\r\n\t/**\r\n\t * this class uses as proxy for EventEmitter2\r\n\t */\r\n\tvar EventEmitter = (function () {\r\n\t    function EventEmitter() {\r\n\t        this.ee = new deps_1.EE2();\r\n\t    }\r\n\t    EventEmitter.prototype.emit = function (eventName) {\r\n\t        var args = [];\r\n\t        for (var _i = 1; _i < arguments.length; _i++) {\r\n\t            args[_i - 1] = arguments[_i];\r\n\t        }\r\n\t        (_a = this.ee).emit.apply(_a, [eventName].concat(args));\r\n\t        var _a;\r\n\t    };\r\n\t    EventEmitter.prototype.on = function (eventName, callback) {\r\n\t        return this.ee.on(eventName, callback);\r\n\t    };\r\n\t    EventEmitter.prototype.off = function (eventName, callback) {\r\n\t        return this.ee.off(eventName, callback);\r\n\t    };\r\n\t    EventEmitter.prototype.subscribe = function (eventName, callback) {\r\n\t        var _this = this;\r\n\t        this.on(eventName, callback);\r\n\t        return function () { return _this.off(eventName, callback); };\r\n\t    };\r\n\t    EventEmitter.prototype.setMaxListeners = function (listenersCount) {\r\n\t        this.ee.setMaxListeners(listenersCount);\r\n\t    };\r\n\t    EventEmitter.prototype.removeAllListeners = function (eventName) {\r\n\t        this.ee.removeAllListeners(eventName);\r\n\t    };\r\n\t    return EventEmitter;\r\n\t}());\r\n\texports.EventEmitter = EventEmitter;\r\n\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar deps_1 = __webpack_require__(3);\r\n\tfunction deepmerge(target, src, mergeArrays) {\r\n\t    if (mergeArrays === void 0) { mergeArrays = true; }\r\n\t    var array = Array.isArray(src);\r\n\t    var dst = array && [] || {};\r\n\t    if (array) {\r\n\t        target = target || [];\r\n\t        if (mergeArrays) {\r\n\t            dst = dst.concat(target);\r\n\t        }\r\n\t        src.forEach(function (e, i) {\r\n\t            if (typeof dst[i] === 'undefined') {\r\n\t                dst[i] = e;\r\n\t            }\r\n\t            else if (typeof e === 'object') {\r\n\t                dst[i] = deepmerge(target[i], e, mergeArrays);\r\n\t            }\r\n\t            else {\r\n\t                if (target.indexOf(e) === -1) {\r\n\t                    dst.push(e);\r\n\t                }\r\n\t            }\r\n\t        });\r\n\t    }\r\n\t    else {\r\n\t        if (target && typeof target === 'object') {\r\n\t            Object.keys(target).forEach(function (key) {\r\n\t                dst[key] = target[key];\r\n\t            });\r\n\t        }\r\n\t        Object.keys(src).forEach(function (key) {\r\n\t            if (typeof src[key] !== 'object' || !src[key]) {\r\n\t                dst[key] = src[key];\r\n\t            }\r\n\t            else {\r\n\t                if (!target[key]) {\r\n\t                    dst[key] = src[key];\r\n\t                }\r\n\t                else {\r\n\t                    dst[key] = deepmerge(target[key], src[key], mergeArrays);\r\n\t                }\r\n\t            }\r\n\t        });\r\n\t    }\r\n\t    return dst;\r\n\t}\r\n\t/**\r\n\t * project utils static class\r\n\t */\r\n\tvar Utils = (function () {\r\n\t    function Utils() {\r\n\t    }\r\n\t    /**\r\n\t     * deepMerge based on https://www.npmjs.com/package/deepmerge\r\n\t     */\r\n\t    Utils.deepMerge = function (obj1, obj2, mergeArrays) {\r\n\t        return deepmerge(obj1, obj2, mergeArrays);\r\n\t    };\r\n\t    /**\r\n\t     * deepCopy based on JSON.stringify function\r\n\t     * @deprecated\r\n\t     */\r\n\t    Utils.deepCopy = function (obj) {\r\n\t        // TODO: use deepMerge function to copy\r\n\t        return JSON.parse(JSON.stringify(obj));\r\n\t    };\r\n\t    /**\r\n\t     *\r\n\t     * @example\r\n\t     * // returns \"000015\"\r\n\t     * Utils.toFixed(15, 6);\r\n\t     */\r\n\t    Utils.toFixed = function (num, digitsCount) {\r\n\t        var maxDigits = 15;\r\n\t        var result = '';\r\n\t        var intVal = Math.floor(num);\r\n\t        var intStr = intVal.toString();\r\n\t        var lengthDiff = digitsCount - intStr.length;\r\n\t        if (lengthDiff > 0) {\r\n\t            result = '0'.repeat(lengthDiff) + intStr;\r\n\t        }\r\n\t        else {\r\n\t            result = intStr;\r\n\t        }\r\n\t        var afterPointDigitsCount = maxDigits - intStr.length;\r\n\t        var afterPointStr = num.toString().split('.')[1];\r\n\t        if (afterPointStr) {\r\n\t            result += '.' + afterPointStr.substr(0, afterPointDigitsCount);\r\n\t        }\r\n\t        return result;\r\n\t    };\r\n\t    Utils.bindEvent = function () {\r\n\t    };\r\n\t    /**\r\n\t     * generate texture from canvas context\r\n\t     * @example\r\n\t     * \t// create texture with rect\r\n\t     *  var texture = Utils.createTexture(20, 20, (ctx) => {ctx.fillRect(0, 0, 10, 10)});\r\n\t     */\r\n\t    Utils.createTexture = function (width, height, fn) {\r\n\t        var canvas = document.createElement('canvas');\r\n\t        canvas.width = width;\r\n\t        canvas.height = height;\r\n\t        var ctx = canvas.getContext('2d');\r\n\t        fn(ctx);\r\n\t        var texture = new THREE.Texture(canvas);\r\n\t        texture.needsUpdate = true;\r\n\t        return texture;\r\n\t    };\r\n\t    /**\r\n\t     * generate texture from canvas context with NearestFilter\r\n\t     * @example\r\n\t     * \t// create texture with rect\r\n\t     *  var texture = Utils.createTexture(20, 20, (ctx) => {ctx.fillRect(0, 0, 10, 10)});\r\n\t     */\r\n\t    Utils.createPixelPerfectTexture = function (width, height, fn) {\r\n\t        var texture = this.createTexture(width, height, fn);\r\n\t        // texture.magFilter = THREE.NearestFilter;\r\n\t        texture.minFilter = THREE.NearestFilter;\r\n\t        return texture;\r\n\t    };\r\n\t    /**\r\n\t     * throw error\r\n\t     */\r\n\t    Utils.error = function (msg) {\r\n\t        console.error('Chart error: ' + msg);\r\n\t        throw 'Chart: ' + msg;\r\n\t    };\r\n\t    /**\r\n\t     * throw error\r\n\t     */\r\n\t    Utils.warn = function (msg) {\r\n\t        console.warn('Chart warning: ' + msg);\r\n\t    };\r\n\t    /**\r\n\t     * @returns new unique id\r\n\t     */\r\n\t    Utils.getUid = function () {\r\n\t        return this.currentId++;\r\n\t    };\r\n\t    /**\r\n\t     * @returns distance between numbers\r\n\t     */\r\n\t    Utils.getDistance = function (num1, num2) {\r\n\t        return Math.max(num1, num2) - Math.min(num1, num2);\r\n\t    };\r\n\t    Utils.binarySearchClosestInd = function (arr, num, key) {\r\n\t        var mid;\r\n\t        var lo = 0;\r\n\t        var hi = arr.length - 1;\r\n\t        while (hi - lo > 1) {\r\n\t            mid = Math.floor((lo + hi) / 2);\r\n\t            if (arr[mid][key] < num) {\r\n\t                lo = mid;\r\n\t            }\r\n\t            else {\r\n\t                hi = mid;\r\n\t            }\r\n\t        }\r\n\t        if (num - arr[lo][key] <= arr[hi][key] - num) {\r\n\t            return lo;\r\n\t        }\r\n\t        return hi;\r\n\t    };\r\n\t    Utils.binarySearchClosest = function (arr, num, key) {\r\n\t        var ind = this.binarySearchClosestInd(arr, num, key);\r\n\t        return arr[ind];\r\n\t    };\r\n\t    Utils.rectsIntersect = function (r1, r2) {\r\n\t        var left1 = r1[0], top1 = r1[1], width1 = r1[2], height1 = r1[3];\r\n\t        var left2 = r2[0], top2 = r2[1], width2 = r2[2], height2 = r2[3];\r\n\t        var _a = [left1 + width1, left2 + width2, top1 + height1, top2 + height2], right1 = _a[0], right2 = _a[1], bottom1 = _a[2], bottom2 = _a[3];\r\n\t        return !(left2 > right1 ||\r\n\t            right2 < left1 ||\r\n\t            top2 > bottom1 ||\r\n\t            bottom2 < top1);\r\n\t    };\r\n\t    /**!\r\n\t     * @preserve $.parseColor\r\n\t     * Copyright 2011 THEtheChad Elliott\r\n\t     * Released under the MIT and GPL licenses.\r\n\t     */\r\n\t    // Parse hex/rgb{a} color syntax.\r\n\t    // @input string\r\n\t    // @returns array [r,g,b{,o}]\r\n\t    Utils.parseColor = function (color) {\r\n\t        var cache, p = parseInt // Use p as a byte saving reference to parseInt\r\n\t        , color = color.replace(/\\s\\s*/g, ''); //var\r\n\t        // Checks for 6 digit hex and converts string to integer\r\n\t        if (cache = /^#([\\da-fA-F]{2})([\\da-fA-F]{2})([\\da-fA-F]{2})/.exec(color))\r\n\t            cache = [p(cache[1], 16), p(cache[2], 16), p(cache[3], 16)];\r\n\t        else if (cache = /^#([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])/.exec(color))\r\n\t            cache = [p(cache[1], 16) * 17, p(cache[2], 16) * 17, p(cache[3], 16) * 17];\r\n\t        else if (cache = /^rgba\\(([\\d]+),([\\d]+),([\\d]+),([\\d]+|[\\d]*.[\\d]+)\\)/.exec(color))\r\n\t            cache = [+cache[1], +cache[2], +cache[3], +cache[4]];\r\n\t        else if (cache = /^rgb\\(([\\d]+),([\\d]+),([\\d]+)\\)/.exec(color))\r\n\t            cache = [+cache[1], +cache[2], +cache[3]];\r\n\t        else\r\n\t            throw Error(color + ' is not supported by $.parseColor');\r\n\t        // Performs RGBA conversion by default\r\n\t        isNaN(cache[3]) && (cache[3] = 1);\r\n\t        return cache;\r\n\t        // Adds or removes 4th value based on rgba support\r\n\t        // Support is flipped twice to prevent erros if\r\n\t        // it's not defined\r\n\t        //return cache.slice(0,3 + !!$.support.rgba);\r\n\t    };\r\n\t    Utils.getHexColor = function (str) {\r\n\t        var rgb = this.parseColor(str);\r\n\t        return (rgb[0] << (8 * 2)) + (rgb[1] << 8) + rgb[2];\r\n\t    };\r\n\t    Utils.throttle = function (func, ms) {\r\n\t        var isThrottled = false, savedArgs, savedThis;\r\n\t        function wrapper() {\r\n\t            if (isThrottled) {\r\n\t                savedArgs = arguments;\r\n\t                savedThis = this;\r\n\t                return;\r\n\t            }\r\n\t            func.apply(this, arguments); // (1)\r\n\t            isThrottled = true;\r\n\t            setTimeout(function () {\r\n\t                isThrottled = false; // (3)\r\n\t                if (savedArgs) {\r\n\t                    wrapper.apply(savedThis, savedArgs);\r\n\t                    savedArgs = savedThis = null;\r\n\t                }\r\n\t            }, ms);\r\n\t        }\r\n\t        return wrapper;\r\n\t    };\r\n\t    Utils.msToTimeString = function (timestamp) {\r\n\t        var h = Math.floor(timestamp / 360000);\r\n\t        var m = Math.floor(timestamp / 60000);\r\n\t        var s = Math.floor(timestamp / 1000);\r\n\t        return h + ':' + m + ':' + s;\r\n\t    };\r\n\t    Utils.getRandomItem = function (arr) {\r\n\t        var ind = Math.floor(Math.random() * arr.length);\r\n\t        return arr[ind];\r\n\t    };\r\n\t    Utils.copyProps = function (srcObject, dstObject, props, excludeProps) {\r\n\t        if (excludeProps === void 0) { excludeProps = []; }\r\n\t        for (var key in props) {\r\n\t            if (excludeProps.indexOf(key) !== -1)\r\n\t                continue;\r\n\t            if (srcObject[key] == void 0)\r\n\t                continue;\r\n\t            if (deps_1.isPlainObject(props[key]) && dstObject[key] !== void 0) {\r\n\t                this.copyProps(srcObject[key], dstObject[key], props[key]);\r\n\t            }\r\n\t            else {\r\n\t                dstObject[key] = this.deepCopy(srcObject[key]);\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    Utils.currentId = 1;\r\n\t    return Utils;\r\n\t}());\r\n\texports.Utils = Utils;\r\n\n\n/***/ },\n/* 15 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\t/**\r\n\t * base class for all widgets\r\n\t * each widget must have widgetName static property\r\n\t */\r\n\tvar ChartWidget = (function () {\r\n\t    function ChartWidget(chartState) {\r\n\t        this.unsubscribers = [];\r\n\t        this.chartState = chartState;\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    ChartWidget.prototype.bindEvents = function () { };\r\n\t    ChartWidget.prototype.bindEvent = function () {\r\n\t        var args = [];\r\n\t        for (var _i = 0; _i < arguments.length; _i++) {\r\n\t            args[_i - 0] = arguments[_i];\r\n\t        }\r\n\t        var unsubscribers = [];\r\n\t        if (!Array.isArray(args[0])) {\r\n\t            unsubscribers.push(args[0]);\r\n\t        }\r\n\t        else {\r\n\t            unsubscribers.push.apply(unsubscribers, (args));\r\n\t        }\r\n\t        (_a = this.unsubscribers).push.apply(_a, unsubscribers);\r\n\t        var _a;\r\n\t    };\r\n\t    ChartWidget.prototype.unbindEvents = function () {\r\n\t        this.unsubscribers.forEach(function (unsubscriber) { return unsubscriber(); });\r\n\t        this.unsubscribers.length = 0;\r\n\t    };\r\n\t    ChartWidget.getDefaultOptions = function () {\r\n\t        return { enabled: true };\r\n\t    };\r\n\t    ChartWidget.widgetName = '';\r\n\t    return ChartWidget;\r\n\t}());\r\n\texports.ChartWidget = ChartWidget;\r\n\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar Trend_1 = __webpack_require__(17);\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\tvar EVENTS = {\r\n\t    SEGMENTS_REBUILDED: 'segmentsRebuilded'\r\n\t};\r\n\t/**\r\n\t * Trends manager\r\n\t */\r\n\tvar TrendsManager = (function () {\r\n\t    function TrendsManager(state, initialState) {\r\n\t        this.trends = {};\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.chartState = state;\r\n\t        var trendsCalculatedOptions = {};\r\n\t        for (var trendName in initialState.trends) {\r\n\t            var trend = this.createTrend(state, trendName, initialState);\r\n\t            trendsCalculatedOptions[trendName] = trend.getCalculatedOptions();\r\n\t        }\r\n\t        this.calculatedOptions = trendsCalculatedOptions;\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    TrendsManager.prototype.getTrend = function (trendName) {\r\n\t        return this.trends[trendName];\r\n\t    };\r\n\t    TrendsManager.prototype.getEnabledTrends = function () {\r\n\t        var enabledTrends = [];\r\n\t        var allTrends = this.trends;\r\n\t        for (var trendName in allTrends) {\r\n\t            var trend = allTrends[trendName];\r\n\t            trend.getOptions().enabled && enabledTrends.push(trend);\r\n\t        }\r\n\t        return enabledTrends;\r\n\t    };\r\n\t    TrendsManager.prototype.getStartXVal = function () {\r\n\t        var trends = this.getEnabledTrends();\r\n\t        return trends[0].getData()[0].xVal;\r\n\t    };\r\n\t    TrendsManager.prototype.getEndXVal = function () {\r\n\t        var trends = this.getEnabledTrends();\r\n\t        var firstTrendData = trends[0].getData();\r\n\t        return firstTrendData[firstTrendData.length - 1].xVal;\r\n\t    };\r\n\t    TrendsManager.prototype.getExtremumYVal = function (extremumIsMax, fromX, toX) {\r\n\t        var trends = this.getEnabledTrends();\r\n\t        var compareFn;\r\n\t        var result;\r\n\t        if (extremumIsMax) {\r\n\t            result = -Infinity;\r\n\t            compareFn = Math.max;\r\n\t        }\r\n\t        else {\r\n\t            result = Infinity;\r\n\t            compareFn = Math.min;\r\n\t        }\r\n\t        for (var _i = 0, trends_1 = trends; _i < trends_1.length; _i++) {\r\n\t            var trend = trends_1[_i];\r\n\t            var trendData = trend.getData(fromX, toX);\r\n\t            var trendYValues = trendData.map(function (dataItem) { return dataItem.yVal; });\r\n\t            result = compareFn.apply(void 0, [result].concat(trendYValues));\r\n\t        }\r\n\t        if (result == Infinity || result == -Infinity)\r\n\t            result = NaN;\r\n\t        return result;\r\n\t    };\r\n\t    TrendsManager.prototype.getMaxYVal = function (fromX, toX) { return this.getExtremumYVal(true, fromX, toX); };\r\n\t    TrendsManager.prototype.getMinYVal = function (fromX, toX) { return this.getExtremumYVal(false, fromX, toX); };\r\n\t    TrendsManager.prototype.onSegmentsRebuilded = function (cb) {\r\n\t        return this.ee.subscribe(EVENTS.SEGMENTS_REBUILDED, cb);\r\n\t    };\r\n\t    TrendsManager.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.chartState.onInitialStateApplied(function () { return _this.onInitialStateAppliedHandler(); });\r\n\t    };\r\n\t    TrendsManager.prototype.onInitialStateAppliedHandler = function () {\r\n\t        var _this = this;\r\n\t        var _loop_1 = function(trendName) {\r\n\t            this_1.trends[trendName].segments.onRebuild(function () { return _this.ee.emit(EVENTS.SEGMENTS_REBUILDED, trendName); });\r\n\t        };\r\n\t        var this_1 = this;\r\n\t        for (var trendName in this.trends) {\r\n\t            _loop_1(trendName);\r\n\t        }\r\n\t    };\r\n\t    TrendsManager.prototype.createTrend = function (state, trendName, initialState) {\r\n\t        var trend = new Trend_1.Trend(state, trendName, initialState);\r\n\t        this.trends[trendName] = trend;\r\n\t        return trend;\r\n\t    };\r\n\t    return TrendsManager;\r\n\t}());\r\n\texports.TrendsManager = TrendsManager;\r\n\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar TrendSegments_1 = __webpack_require__(18);\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\tvar deps_1 = __webpack_require__(3);\r\n\tvar EVENTS = {\r\n\t    CHANGE: 'Change',\r\n\t    PREPEND_REQUEST: 'prependRequest'\r\n\t};\r\n\t(function (TREND_TYPE) {\r\n\t    TREND_TYPE[TREND_TYPE[\"LINE\"] = 0] = \"LINE\";\r\n\t    TREND_TYPE[TREND_TYPE[\"CANDLE\"] = 1] = \"CANDLE\";\r\n\t})(exports.TREND_TYPE || (exports.TREND_TYPE = {}));\r\n\tvar TREND_TYPE = exports.TREND_TYPE;\r\n\tvar DEFAULT_OPTIONS = {\r\n\t    enabled: true,\r\n\t    type: TREND_TYPE.LINE,\r\n\t    data: [],\r\n\t    maxSegmentLength: 1000,\r\n\t    lineWidth: 2,\r\n\t    lineColor: 0xFFFFFF,\r\n\t    hasGradient: true,\r\n\t    hasBeacon: false,\r\n\t    settingsForTypes: {\r\n\t        CANDLE: {\r\n\t            minSegmentLengthInPx: 20,\r\n\t            maxSegmentLengthInPx: 40,\r\n\t        },\r\n\t        LINE: {\r\n\t            minSegmentLengthInPx: 2,\r\n\t            maxSegmentLengthInPx: 10,\r\n\t        }\r\n\t    }\r\n\t};\r\n\tvar Trend = (function () {\r\n\t    function Trend(chartState, trendName, initialState) {\r\n\t        this.minXVal = Infinity;\r\n\t        this.minYVal = Infinity;\r\n\t        this.maxXVal = -Infinity;\r\n\t        this.maxYVal = -Infinity;\r\n\t        var options = initialState.trends[trendName];\r\n\t        this.name = trendName;\r\n\t        this.chartState = chartState;\r\n\t        this.calculatedOptions = Utils_1.Utils.deepMerge(DEFAULT_OPTIONS, options);\r\n\t        this.calculatedOptions.name = trendName;\r\n\t        if (options.dataset)\r\n\t            this.calculatedOptions.data = Trend.prepareData(options.dataset);\r\n\t        this.calculatedOptions.dataset = [];\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    Trend.prototype.onInitialStateApplied = function () {\r\n\t        this.segments = new TrendSegments_1.TrendSegments(this.chartState, this);\r\n\t    };\r\n\t    Trend.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        var chartState = this.chartState;\r\n\t        chartState.onInitialStateApplied(function () { return _this.onInitialStateApplied(); });\r\n\t        chartState.onScrollStop(function () { return _this.checkForPrependRequest(); });\r\n\t        chartState.onZoom(function () { return _this.checkForPrependRequest(); });\r\n\t        chartState.onTrendChange(function (trendName, changedOptions, newData) { return _this.ee.emit(EVENTS.CHANGE, changedOptions, newData); });\r\n\t        chartState.onDestroy(function () { return _this.ee.removeAllListeners(); });\r\n\t    };\r\n\t    Trend.prototype.getCalculatedOptions = function () {\r\n\t        return this.calculatedOptions;\r\n\t    };\r\n\t    Trend.prototype.appendData = function (rawData) {\r\n\t        var options = this.getOptions();\r\n\t        var newData = Trend.prepareData(rawData, this.getData());\r\n\t        var updatedTrendData = options.data.concat(newData);\r\n\t        this.changeData(updatedTrendData, newData);\r\n\t    };\r\n\t    Trend.prototype.prependData = function (rawData) {\r\n\t        var options = this.getOptions();\r\n\t        var newData = Trend.prepareData(rawData, this.getData(), true);\r\n\t        var updatedTrendData = newData.concat(options.data);\r\n\t        this.changeData(updatedTrendData, newData);\r\n\t    };\r\n\t    Trend.prototype.changeData = function (allData, newData) {\r\n\t        for (var _i = 0, newData_1 = newData; _i < newData_1.length; _i++) {\r\n\t            var item = newData_1[_i];\r\n\t            if (item.xVal < this.minXVal)\r\n\t                this.minXVal = item.xVal;\r\n\t            if (item.xVal > this.maxXVal)\r\n\t                this.maxXVal = item.xVal;\r\n\t            if (item.yVal < this.minYVal)\r\n\t                this.minYVal = item.yVal;\r\n\t            if (item.yVal > this.maxYVal)\r\n\t                this.maxYVal = item.yVal;\r\n\t        }\r\n\t        var options = this.getOptions();\r\n\t        var statePatch = { trends: (_a = {}, _a[options.name] = { data: allData }, _a) };\r\n\t        this.chartState.setState(statePatch, newData);\r\n\t        var _a;\r\n\t    };\r\n\t    Trend.prototype.getData = function (fromX, toX) {\r\n\t        var data = this.getOptions().data;\r\n\t        if (fromX == void 0 && toX == void 0)\r\n\t            return data;\r\n\t        fromX = fromX !== void 0 ? fromX : data[0].xVal;\r\n\t        toX = toX !== void 0 ? toX : data[data.length].xVal;\r\n\t        var filteredData = [];\r\n\t        for (var _i = 0, data_1 = data; _i < data_1.length; _i++) {\r\n\t            var item = data_1[_i];\r\n\t            if (item.xVal < fromX)\r\n\t                continue;\r\n\t            if (item.xVal > toX)\r\n\t                break;\r\n\t            filteredData.push(item);\r\n\t        }\r\n\t        return filteredData;\r\n\t    };\r\n\t    Trend.prototype.getFirstItem = function () {\r\n\t        return this.getOptions().data[0];\r\n\t    };\r\n\t    Trend.prototype.getLastItem = function () {\r\n\t        var data = this.getOptions().data;\r\n\t        return data[data.length - 1];\r\n\t    };\r\n\t    Trend.prototype.getOptions = function () {\r\n\t        return this.chartState.data.trends[this.name];\r\n\t    };\r\n\t    Trend.prototype.setOptions = function (options) {\r\n\t        this.chartState.setState({ trends: (_a = {}, _a[this.name] = options, _a) });\r\n\t        var _a;\r\n\t    };\r\n\t    Trend.prototype.onPrependRequest = function (cb) {\r\n\t        var _this = this;\r\n\t        this.ee.on(EVENTS.PREPEND_REQUEST, cb);\r\n\t        return function () {\r\n\t            _this.ee.off(EVENTS.PREPEND_REQUEST, cb);\r\n\t        };\r\n\t    };\r\n\t    /**\r\n\t     * shortcut for ChartState.onTrendChange\r\n\t     */\r\n\t    Trend.prototype.onChange = function (cb) {\r\n\t        var _this = this;\r\n\t        this.ee.on(EVENTS.CHANGE, cb);\r\n\t        return function () { _this.ee.off(EVENTS.CHANGE, cb); };\r\n\t    };\r\n\t    Trend.prototype.onDataChange = function (cb) {\r\n\t        var _this = this;\r\n\t        var onChangeCb = function (changedOptions, newData) {\r\n\t            if (newData)\r\n\t                cb(newData);\r\n\t        };\r\n\t        this.ee.on(EVENTS.CHANGE, onChangeCb);\r\n\t        return function () {\r\n\t            _this.ee.off(EVENTS.CHANGE, onChangeCb);\r\n\t        };\r\n\t    };\r\n\t    Trend.prototype.checkForPrependRequest = function () {\r\n\t        var _this = this;\r\n\t        if (this.prependRequest)\r\n\t            return;\r\n\t        var chartState = this.chartState;\r\n\t        var minXVal = chartState.data.computedData.trends.minXVal;\r\n\t        var minScreenX = chartState.getScreenXByValue(minXVal);\r\n\t        var needToRequest = minScreenX > 0;\r\n\t        var _a = chartState.data.xAxis.range, from = _a.from, to = _a.to;\r\n\t        var requestedDataLength = to - from;\r\n\t        if (!needToRequest)\r\n\t            return;\r\n\t        this.prependRequest = new deps_1.Promise(function (resolve, reject) {\r\n\t            _this.ee.emit(EVENTS.PREPEND_REQUEST, requestedDataLength, resolve, reject);\r\n\t        });\r\n\t        this.prependRequest.then(function (newData) {\r\n\t            _this.prependData(newData);\r\n\t            _this.prependRequest = null;\r\n\t        }, function () {\r\n\t            _this.prependRequest = null;\r\n\t        });\r\n\t    };\r\n\t    Trend.prepareData = function (newData, currentData, isPrepend) {\r\n\t        if (isPrepend === void 0) { isPrepend = false; }\r\n\t        var data = [];\r\n\t        if (typeof newData[0] == 'number') {\r\n\t            currentData = currentData || [];\r\n\t            var initialItem = void 0;\r\n\t            var xVal = void 0;\r\n\t            if (isPrepend) {\r\n\t                initialItem = currentData[0];\r\n\t                xVal = initialItem.xVal - newData.length;\r\n\t            }\r\n\t            else {\r\n\t                initialItem = currentData[currentData.length - 1];\r\n\t                xVal = initialItem ? initialItem.xVal + 1 : 0;\r\n\t            }\r\n\t            for (var _i = 0, _a = newData; _i < _a.length; _i++) {\r\n\t                var yVal = _a[_i];\r\n\t                data.push({ xVal: xVal, yVal: yVal, id: Utils_1.Utils.getUid() });\r\n\t                xVal++;\r\n\t            }\r\n\t        }\r\n\t        else {\r\n\t            data = newData;\r\n\t        }\r\n\t        return data;\r\n\t    };\r\n\t    return Trend;\r\n\t}());\r\n\texports.Trend = Trend;\r\n\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar Trend_1 = __webpack_require__(17);\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar MAX_ANIMATED_SEGMENTS = 100;\r\n\tvar EVENTS = {\r\n\t    REBUILD: 'rebuild',\r\n\t    DISLPAYED_RANGE_CHANGED: 'displayedRangeChanged',\r\n\t    ANIMATION_FRAME: 'animationFrame'\r\n\t};\r\n\t/**\r\n\t *  Class helps to display and animate trends segments\r\n\t */\r\n\tvar TrendSegments = (function () {\r\n\t    function TrendSegments(chartState, trend) {\r\n\t        this.segmentsById = {};\r\n\t        this.segments = [];\r\n\t        this.animatedSegmentsIds = [];\r\n\t        this.segmentsLength = 0;\r\n\t        this.animatedSegmentsForAppend = [];\r\n\t        this.animatedSegmentsForPrepend = [];\r\n\t        this.nextEmptyId = 0;\r\n\t        this.startSegmentId = 0;\r\n\t        this.endSegmentId = 0;\r\n\t        this.chartState = chartState;\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.trend = trend;\r\n\t        this.maxSegmentLength = trend.getOptions().maxSegmentLength;\r\n\t        this.tryToRebuildSegments();\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    TrendSegments.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.trend.onChange(function (changedOptions, newData) { return _this.onTrendChangeHandler(changedOptions, newData); });\r\n\t        this.chartState.onZoom(function () { return _this.onZoomHandler(); });\r\n\t        this.chartState.onScroll(function () { return _this.recalculateDisplayedRange(); });\r\n\t        this.chartState.onDestroy(function () { return _this.onDestroyHandler(); });\r\n\t    };\r\n\t    TrendSegments.prototype.onDestroyHandler = function () {\r\n\t        this.ee.removeAllListeners();\r\n\t        this.appendAnimation && this.appendAnimation.kill();\r\n\t        this.prependAnimation && this.prependAnimation.kill();\r\n\t    };\r\n\t    TrendSegments.prototype.onZoomHandler = function () {\r\n\t        var segmentsRebuilded = this.tryToRebuildSegments();\r\n\t        if (!segmentsRebuilded) {\r\n\t            this.recalculateDisplayedRange();\r\n\t        }\r\n\t    };\r\n\t    TrendSegments.prototype.onTrendChangeHandler = function (changedOptions, newData) {\r\n\t        var needToRebuildSegments = (changedOptions.type != void 0 ||\r\n\t            changedOptions.maxSegmentLength != void 0);\r\n\t        if (needToRebuildSegments) {\r\n\t            this.tryToRebuildSegments(true);\r\n\t            return;\r\n\t        }\r\n\t        if (!newData)\r\n\t            return;\r\n\t        var data = this.trend.getData();\r\n\t        var isAppend = (!data.length || data[0].xVal < newData[0].xVal);\r\n\t        isAppend ? this.appendData(newData) : this.prependData(newData);\r\n\t        this.recalculateDisplayedRange();\r\n\t    };\r\n\t    TrendSegments.prototype.getEndSegment = function () {\r\n\t        return this.segmentsById[this.endSegmentId];\r\n\t    };\r\n\t    TrendSegments.prototype.getStartSegment = function () {\r\n\t        return this.segmentsById[this.startSegmentId];\r\n\t    };\r\n\t    TrendSegments.prototype.tryToRebuildSegments = function (force) {\r\n\t        if (force === void 0) { force = false; }\r\n\t        var options = this.trend.getOptions();\r\n\t        var trendTypeName = Trend_1.TREND_TYPE[options.type];\r\n\t        var trendTypesSettings = options.settingsForTypes;\r\n\t        var trendTypeSettings = trendTypesSettings[trendTypeName];\r\n\t        var minSegmentLengthInPx = trendTypeSettings.minSegmentLengthInPx, maxSegmentLengthInPx = trendTypeSettings.maxSegmentLengthInPx;\r\n\t        var needToRebuild = this.segments.length === 0 || force;\r\n\t        var segmentLength = this.maxSegmentLength;\r\n\t        // call toFixed(2) to prevent floating segment error compare\r\n\t        var currentSegmentLengthInPx = Number(this.chartState.valueToPxByXAxis(segmentLength).toFixed(2));\r\n\t        var currentMaxSegmentLengthInPx = Number(this.chartState.valueToPxByXAxis(this.maxSegmentLength).toFixed(2));\r\n\t        if (currentSegmentLengthInPx < minSegmentLengthInPx) {\r\n\t            needToRebuild = true;\r\n\t            segmentLength = Math.ceil(this.chartState.pxToValueByXAxis(maxSegmentLengthInPx));\r\n\t        }\r\n\t        else if (currentMaxSegmentLengthInPx > maxSegmentLengthInPx) {\r\n\t            needToRebuild = true;\r\n\t            segmentLength = this.chartState.pxToValueByXAxis(minSegmentLengthInPx);\r\n\t        }\r\n\t        if (!needToRebuild)\r\n\t            return false;\r\n\t        this.maxSegmentLength = segmentLength;\r\n\t        this.segmentsById = {};\r\n\t        this.segments = [];\r\n\t        this.nextEmptyId = 0;\r\n\t        this.startSegmentId = 0;\r\n\t        this.endSegmentId = 0;\r\n\t        this.segmentsLength = 0;\r\n\t        this.stopAllAnimations();\r\n\t        this.appendData(null, true);\r\n\t        this.recalculateDisplayedRange(true);\r\n\t        this.ee.emit(EVENTS.REBUILD);\r\n\t    };\r\n\t    TrendSegments.prototype.stopAllAnimations = function () {\r\n\t        this.animatedSegmentsIds = [];\r\n\t        this.animatedSegmentsForAppend = [];\r\n\t        this.animatedSegmentsForAppend = [];\r\n\t        if (this.prependAnimation)\r\n\t            this.prependAnimation.kill();\r\n\t        if (this.appendAnimation)\r\n\t            this.appendAnimation.kill();\r\n\t    };\r\n\t    TrendSegments.prototype.recalculateDisplayedRange = function (segmentsAreRebuilded) {\r\n\t        if (segmentsAreRebuilded === void 0) { segmentsAreRebuilded = false; }\r\n\t        var _a = this.chartState.data.xAxis.range, from = _a.from, to = _a.to;\r\n\t        var _b = this, firstDisplayedSegment = _b.firstDisplayedSegment, lastDisplayedSegment = _b.lastDisplayedSegment;\r\n\t        var displayedRange = to - from;\r\n\t        this.firstDisplayedSegment = Utils_1.Utils.binarySearchClosest(this.segments, from - displayedRange, 'startXVal');\r\n\t        this.lastDisplayedSegment = Utils_1.Utils.binarySearchClosest(this.segments, to + displayedRange, 'endXVal');\r\n\t        if (segmentsAreRebuilded)\r\n\t            return;\r\n\t        var displayedRangeChanged = (firstDisplayedSegment.id !== this.firstDisplayedSegment.id ||\r\n\t            lastDisplayedSegment.id !== this.lastDisplayedSegment.id);\r\n\t        if (displayedRangeChanged)\r\n\t            this.ee.emit(EVENTS.DISLPAYED_RANGE_CHANGED);\r\n\t    };\r\n\t    // getSegments(fromX?: number, toX?: number): TrendSegment[] {\r\n\t    // \tvar segments = this.segments;\r\n\t    // \tif (fromX == void 0 && toX == void 0) return segments;\r\n\t    // \tfromX = fromX !== void 0 ? fromX : segments[0].startXVal;\r\n\t    // \ttoX = toX !== void 0 ? toX : segments[this.segmentsLength].endXVal;\r\n\t    // \tvar startSegmentInd = Utils.closestBinarySearch(segments, fromX, 'xVal');\r\n\t    // \tvar endSegmentInd = Utils.closestBinarySearch(segments, toX, 'xVal');\r\n\t    // \treturn segments.slice(startSegmentInd, endSegmentInd);\r\n\t    // }\r\n\t    /**\r\n\t     * returns array of segments for values array\r\n\t     * values must be sorted!\r\n\t     */\r\n\t    TrendSegments.prototype.getSegmentsForXValues = function (values) {\r\n\t        var valueInd = 0;\r\n\t        var value = values[valueInd];\r\n\t        var lastValueInd = values.length - 1;\r\n\t        var results = [];\r\n\t        var segment = this.getStartSegment();\r\n\t        if (!segment.hasValue)\r\n\t            return [];\r\n\t        while (segment) {\r\n\t            while (value < segment.startXVal) {\r\n\t                results.push(void 0);\r\n\t                value = values[++valueInd];\r\n\t            }\r\n\t            while (value > segment.endXVal) {\r\n\t                segment = segment.getNext();\r\n\t                if (!segment)\r\n\t                    break;\r\n\t            }\r\n\t            var valueInPoint = (segment.startXVal == value || segment.endXVal == value ||\r\n\t                (segment.startXVal < value && segment.endXVal > value));\r\n\t            if (valueInPoint) {\r\n\t                results.push(segment);\r\n\t                value = values[++valueInd];\r\n\t            }\r\n\t            if (valueInd > lastValueInd)\r\n\t                break;\r\n\t        }\r\n\t        return results;\r\n\t    };\r\n\t    TrendSegments.prototype.onAnimationFrame = function (cb) {\r\n\t        return this.ee.subscribe(EVENTS.ANIMATION_FRAME, cb);\r\n\t    };\r\n\t    TrendSegments.prototype.onRebuild = function (cb) {\r\n\t        return this.ee.subscribe(EVENTS.REBUILD, cb);\r\n\t    };\r\n\t    TrendSegments.prototype.onDisplayedRangeChanged = function (cb) {\r\n\t        return this.ee.subscribe(EVENTS.DISLPAYED_RANGE_CHANGED, cb);\r\n\t    };\r\n\t    TrendSegments.prototype.allocateNextSegment = function () {\r\n\t        var id = this.nextEmptyId++;\r\n\t        var segment = new TrendSegment(this, id);\r\n\t        var prevSegment = this.segmentsById[this.endSegmentId];\r\n\t        if (prevSegment && prevSegment.hasValue) {\r\n\t            prevSegment.nextId = id;\r\n\t            segment.prevId = prevSegment.id;\r\n\t        }\r\n\t        this.endSegmentId = id;\r\n\t        this.segmentsLength++;\r\n\t        this.segmentsById[id] = segment;\r\n\t        this.segments.push(segment);\r\n\t        return segment;\r\n\t    };\r\n\t    TrendSegments.prototype.allocatePrevSegment = function () {\r\n\t        var id = this.nextEmptyId++;\r\n\t        var segment = new TrendSegment(this, id);\r\n\t        var nextSegment = this.segmentsById[this.startSegmentId];\r\n\t        if (nextSegment && nextSegment.hasValue) {\r\n\t            nextSegment.prevId = id;\r\n\t            segment.nextId = nextSegment.id;\r\n\t        }\r\n\t        this.startSegmentId = id;\r\n\t        this.segmentsLength++;\r\n\t        this.segmentsById[id] = segment;\r\n\t        this.segments.unshift(segment);\r\n\t        return segment;\r\n\t    };\r\n\t    TrendSegments.prototype.appendData = function (newData, needRebuildSegments) {\r\n\t        // WARNING: bottleneck method!\r\n\t        if (needRebuildSegments === void 0) { needRebuildSegments = false; }\r\n\t        // var t1 = performance.now();\r\n\t        var trendData = this.trend.getData();\r\n\t        if (needRebuildSegments) {\r\n\t            newData = trendData;\r\n\t            this.animatedSegmentsForAppend = [];\r\n\t        }\r\n\t        var startItemInd = trendData.length - newData.length;\r\n\t        var segment = this.getEndSegment() || this.allocateNextSegment();\r\n\t        var initialSegment = segment.hasValue ? segment : null;\r\n\t        var initialAnimationState = segment.createAnimationState();\r\n\t        var itemInd = 0;\r\n\t        while (itemInd < newData.length) {\r\n\t            var item = newData[itemInd];\r\n\t            var itemIsInserted = segment.appendItem(item);\r\n\t            var isLastItem = itemInd == newData.length - 1;\r\n\t            if (itemIsInserted) {\r\n\t                if (!isLastItem)\r\n\t                    itemInd++;\r\n\t            }\r\n\t            else {\r\n\t                if (!segment.isCompleted)\r\n\t                    segment.complete();\r\n\t            }\r\n\t            if (isLastItem && itemIsInserted) {\r\n\t                segment.recalculateItems();\r\n\t            }\r\n\t            var segmentIsReadyForAnimate = segment.isCompleted || (isLastItem && itemIsInserted);\r\n\t            if (segmentIsReadyForAnimate) {\r\n\t                var id = segment.id;\r\n\t                if (!initialSegment)\r\n\t                    initialSegment = segment;\r\n\t                if (!initialAnimationState)\r\n\t                    initialAnimationState = initialSegment.createAnimationState();\r\n\t                segment.initialAnimationState = Utils_1.Utils.deepMerge({}, initialAnimationState);\r\n\t                if (this.animatedSegmentsForAppend.length > 0) {\r\n\t                    segment.initialAnimationState.startXVal = initialAnimationState.endXVal;\r\n\t                    segment.initialAnimationState.startYVal = initialAnimationState.endYVal;\r\n\t                }\r\n\t                segment.targetAnimationState = segment.createAnimationState();\r\n\t                this.animatedSegmentsForAppend.push(id);\r\n\t            }\r\n\t            if (isLastItem && itemIsInserted)\r\n\t                break;\r\n\t            if (!segment.isCompleted)\r\n\t                continue;\r\n\t            segment = this.allocateNextSegment();\r\n\t            var prevItem = trendData[startItemInd + itemInd - 1];\r\n\t            segment.appendItem(prevItem);\r\n\t        }\r\n\t        var animationsOptions = this.chartState.data.animations;\r\n\t        var time = animationsOptions.enabled ? animationsOptions.trendChangeSpeed : 0;\r\n\t        // var t2 = performance.now();\r\n\t        // console.log(t2 - t1);\r\n\t        // do not create animation if segments was rebuilded\r\n\t        if (needRebuildSegments) {\r\n\t            for (var _i = 0, _a = this.animatedSegmentsForAppend; _i < _a.length; _i++) {\r\n\t                var segmentId = _a[_i];\r\n\t                var segment_1 = this.segmentsById[segmentId];\r\n\t                segment_1.currentAnimationState = segment_1.createAnimationState();\r\n\t            }\r\n\t            this.animatedSegmentsForAppend = [];\r\n\t            return;\r\n\t        }\r\n\t        if (this.animatedSegmentsForAppend.length > MAX_ANIMATED_SEGMENTS)\r\n\t            time = 0;\r\n\t        this.animate(time);\r\n\t    };\r\n\t    // TODO: refactor duplicated code from appendData\r\n\t    TrendSegments.prototype.prependData = function (newData) {\r\n\t        var trendData = this.trend.getData();\r\n\t        var segment = this.getStartSegment() || this.segmentsById[0];\r\n\t        var initialSegment = segment.hasValue ? segment : null;\r\n\t        var itemInd = newData.length - 1;\r\n\t        var initialAnimationState = segment.createAnimationState();\r\n\t        while (itemInd >= 0) {\r\n\t            var item = newData[itemInd];\r\n\t            var itemIsInserted = segment.prependItem(item);\r\n\t            var isLastItem = itemInd == 0;\r\n\t            if (itemIsInserted) {\r\n\t                if (!isLastItem)\r\n\t                    itemInd--;\r\n\t            }\r\n\t            else {\r\n\t                if (!segment.isCompleted)\r\n\t                    segment.complete();\r\n\t            }\r\n\t            if (isLastItem && itemIsInserted) {\r\n\t                segment.recalculateItems();\r\n\t            }\r\n\t            var segmentIsReadyForAnimate = segment.isCompleted || (isLastItem && itemIsInserted);\r\n\t            if (segmentIsReadyForAnimate) {\r\n\t                var id = segment.id;\r\n\t                if (!initialSegment)\r\n\t                    initialSegment = segment;\r\n\t                if (!initialAnimationState)\r\n\t                    initialAnimationState = initialSegment.createAnimationState();\r\n\t                segment.initialAnimationState = Utils_1.Utils.deepMerge({}, initialAnimationState);\r\n\t                if (this.animatedSegmentsForPrepend.length > 0) {\r\n\t                    segment.initialAnimationState.endXVal = initialAnimationState.startXVal;\r\n\t                    segment.initialAnimationState.endYVal = initialAnimationState.startYVal;\r\n\t                }\r\n\t                segment.targetAnimationState = segment.createAnimationState();\r\n\t                this.animatedSegmentsForPrepend.push(id);\r\n\t            }\r\n\t            if (isLastItem && itemIsInserted)\r\n\t                break;\r\n\t            if (!segment.isCompleted)\r\n\t                continue;\r\n\t            segment = this.allocatePrevSegment();\r\n\t            var nextItem = trendData[itemInd + 1];\r\n\t            segment.prependItem(nextItem);\r\n\t        }\r\n\t        var animationsOptions = this.chartState.data.animations;\r\n\t        var time = animationsOptions.enabled ? animationsOptions.trendChangeSpeed : 0;\r\n\t        if (this.animatedSegmentsForPrepend.length > MAX_ANIMATED_SEGMENTS)\r\n\t            time = 0;\r\n\t        this.animate(time, true);\r\n\t    };\r\n\t    TrendSegments.prototype.animate = function (time, isPrepend) {\r\n\t        var _this = this;\r\n\t        if (isPrepend === void 0) { isPrepend = false; }\r\n\t        var animatedSegmentsIds = isPrepend ? this.animatedSegmentsForPrepend : this.animatedSegmentsForAppend;\r\n\t        var animation = isPrepend ? this.prependAnimation : this.appendAnimation;\r\n\t        if ((animation && animation.isActive()) || time == 0) {\r\n\t            if (animation)\r\n\t                animation.kill();\r\n\t            this.onAnimationFrameHandler(1, isPrepend);\r\n\t            animatedSegmentsIds.length = 0;\r\n\t            return;\r\n\t        }\r\n\t        var animationsOptions = this.chartState.data.animations;\r\n\t        var ease = animationsOptions.trendChangeEase;\r\n\t        var objectToAnimate = { animationValue: 0 };\r\n\t        animation = TweenLite.to(objectToAnimate, time, { animationValue: 1, ease: ease });\r\n\t        animation.eventCallback('onUpdate', function () { return _this.onAnimationFrameHandler(objectToAnimate.animationValue, isPrepend); });\r\n\t        animation.eventCallback('onComplete', function () {\r\n\t            animatedSegmentsIds.length = 0;\r\n\t            _this.appendAnimation = null;\r\n\t        });\r\n\t        if (isPrepend) {\r\n\t            this.prependAnimation = animation;\r\n\t        }\r\n\t        else {\r\n\t            this.appendAnimation = animation;\r\n\t        }\r\n\t    };\r\n\t    TrendSegments.prototype.onAnimationFrameHandler = function (coefficient, isPrepend) {\r\n\t        if (isPrepend === void 0) { isPrepend = false; }\r\n\t        var animatedSegmentsIds = isPrepend ? this.animatedSegmentsForPrepend : this.animatedSegmentsForAppend;\r\n\t        for (var _i = 0, animatedSegmentsIds_1 = animatedSegmentsIds; _i < animatedSegmentsIds_1.length; _i++) {\r\n\t            var segmentId = animatedSegmentsIds_1[_i];\r\n\t            var segment = this.segmentsById[segmentId];\r\n\t            for (var key in segment.targetAnimationState) {\r\n\t                var targetValue = segment.targetAnimationState[key];\r\n\t                var initialValue = segment.initialAnimationState[key];\r\n\t                var currentValue = initialValue + (targetValue - initialValue) * coefficient;\r\n\t                segment.currentAnimationState[key] = currentValue;\r\n\t            }\r\n\t        }\r\n\t        this.animatedSegmentsIds = this.animatedSegmentsForAppend.concat(this.animatedSegmentsForPrepend);\r\n\t        this.ee.emit(EVENTS.ANIMATION_FRAME, this);\r\n\t    };\r\n\t    return TrendSegments;\r\n\t}());\r\n\texports.TrendSegments = TrendSegments;\r\n\tvar TrendSegment = (function () {\r\n\t    function TrendSegment(trendPoints, id) {\r\n\t        this.isCompleted = false;\r\n\t        this.items = [];\r\n\t        this.initialAnimationState = {};\r\n\t        this.targetAnimationState = {};\r\n\t        this.currentAnimationState = {};\r\n\t        this.trendSegments = trendPoints;\r\n\t        this.id = id;\r\n\t        this.maxLength = trendPoints.maxSegmentLength;\r\n\t    }\r\n\t    TrendSegment.prototype.createAnimationState = function () {\r\n\t        var _a = this, xVal = _a.xVal, yVal = _a.yVal, startXVal = _a.startXVal, startYVal = _a.startYVal, endXVal = _a.endXVal, endYVal = _a.endYVal, maxYVal = _a.maxYVal, minYVal = _a.minYVal, maxLength = _a.maxLength;\r\n\t        return {\r\n\t            xVal: xVal,\r\n\t            yVal: yVal,\r\n\t            startXVal: startXVal,\r\n\t            startYVal: startYVal,\r\n\t            endXVal: endXVal,\r\n\t            endYVal: endYVal,\r\n\t            maxYVal: maxYVal,\r\n\t            minYVal: minYVal,\r\n\t            maxLength: maxLength\r\n\t        };\r\n\t    };\r\n\t    ;\r\n\t    TrendSegment.prototype.appendItem = function (item) {\r\n\t        if (this.isCompleted)\r\n\t            return false;\r\n\t        var items = this.items;\r\n\t        if (items.length < 2) {\r\n\t            this.items.push(item);\r\n\t            this.hasValue = true;\r\n\t            return true;\r\n\t        }\r\n\t        var startXVal = items[0].xVal;\r\n\t        if (item.xVal - startXVal > this.maxLength)\r\n\t            return false;\r\n\t        items.push(item);\r\n\t        return true;\r\n\t    };\r\n\t    TrendSegment.prototype.prependItem = function (item) {\r\n\t        if (this.isCompleted)\r\n\t            return false;\r\n\t        var items = this.items;\r\n\t        if (items.length < 2) {\r\n\t            this.items.unshift(item);\r\n\t            this.hasValue = true;\r\n\t            return true;\r\n\t        }\r\n\t        var endXVal = items[items.length - 1].xVal;\r\n\t        if (endXVal - item.xVal > this.maxLength)\r\n\t            return false;\r\n\t        items.unshift(item);\r\n\t        return true;\r\n\t    };\r\n\t    TrendSegment.prototype.complete = function () {\r\n\t        this.isCompleted = true;\r\n\t        this.recalculateItems();\r\n\t        this.items = []; // free memory for completed ranges\r\n\t    };\r\n\t    TrendSegment.prototype.recalculateItems = function () {\r\n\t        var items = this.items;\r\n\t        var itemsLength = items.length;\r\n\t        if (itemsLength === 0)\r\n\t            Utils_1.Utils.error('Unable to create TrendSegment without TrendItems');\r\n\t        var endItem = items[itemsLength - 1];\r\n\t        var endXVal = endItem.xVal, endYVal = endItem.yVal;\r\n\t        var startXVal, startYVal;\r\n\t        var startItem = items[0];\r\n\t        startXVal = startItem.xVal;\r\n\t        startYVal = startItem.yVal;\r\n\t        var minX = Math.min(startXVal, endXVal);\r\n\t        var maxX = Math.max(startXVal, endXVal);\r\n\t        var middleXVal = minX + (maxX - minX) / 2;\r\n\t        var minY = Math.min(startYVal, endYVal);\r\n\t        var maxY = Math.max(startYVal, endYVal);\r\n\t        var middleYVal = minY + (maxY - minY) / 2;\r\n\t        var yVals = items.map(function (item) { return item.yVal; });\r\n\t        this.startXVal = startXVal;\r\n\t        this.startYVal = startYVal;\r\n\t        this.endXVal = endXVal;\r\n\t        this.endYVal = endYVal;\r\n\t        this.xVal = middleXVal;\r\n\t        this.yVal = middleYVal;\r\n\t        this.maxYVal = Math.max.apply(Math, yVals);\r\n\t        this.minYVal = Math.min.apply(Math, yVals);\r\n\t        if (!this.currentAnimationState)\r\n\t            this.currentAnimationState = this.createAnimationState();\r\n\t    };\r\n\t    TrendSegment.prototype.getNext = function () {\r\n\t        var nextPoint = this.trendSegments.segmentsById[this.nextId];\r\n\t        return nextPoint && nextPoint.hasValue ? nextPoint : null;\r\n\t    };\r\n\t    TrendSegment.prototype.getPrev = function () {\r\n\t        var prevPoint = this.trendSegments.segmentsById[this.prevId];\r\n\t        return prevPoint && prevPoint.hasValue ? prevPoint : null;\r\n\t    };\r\n\t    TrendSegment.prototype.getFrameVal = function () {\r\n\t        var _a = this.createAnimationState(), xVal = _a.xVal, yVal = _a.yVal;\r\n\t        return new Vector3(xVal, yVal, 0);\r\n\t    };\r\n\t    TrendSegment.prototype.getFramePoint = function () {\r\n\t        var frameVal = this.getFrameVal();\r\n\t        return this.trendSegments.chartState.screen.getPointOnChart(frameVal.x, frameVal.y);\r\n\t    };\r\n\t    return TrendSegment;\r\n\t}());\r\n\texports.TrendSegment = TrendSegment;\r\n\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\t/**\r\n\t * manage camera, and contains methods for transforming pixels to values\r\n\t */\r\n\tvar Screen = (function () {\r\n\t    function Screen(chartState) {\r\n\t        this.options = { scrollXVal: 0, scrollX: 0, scrollYVal: 0, scrollY: 0, zoomX: 1, zoomY: 1 };\r\n\t        this.currentScrollX = { x: 0 };\r\n\t        this.currentScrollY = { y: 0 };\r\n\t        this.currentZoomX = { val: 1 };\r\n\t        this.currentZoomY = { val: 1 };\r\n\t        this.chartState = chartState;\r\n\t        var _a = chartState.data, w = _a.width, h = _a.height;\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.transform({\r\n\t            scrollY: this.valueToPxByYAxis(this.chartState.data.yAxis.range.scroll),\r\n\t            zoomY: 1\r\n\t        });\r\n\t        this.bindEvents();\r\n\t        //camera.position.z = 1500;\r\n\t    }\r\n\t    Screen.prototype.getCameraSettings = function () {\r\n\t        var _a = this.chartState.data, w = _a.width, h = _a.height;\r\n\t        // settings for pixel-perfect camera\r\n\t        var FOV = 75;\r\n\t        var vFOV = FOV * (Math.PI / 180);\r\n\t        return {\r\n\t            FOV: FOV,\r\n\t            aspect: w / h,\r\n\t            near: 0.1,\r\n\t            far: 5000,\r\n\t            z: h / (2 * Math.tan(vFOV / 2)),\r\n\t            // move 0,0 to left-bottom corner\r\n\t            x: w / 2,\r\n\t            y: h / 2\r\n\t        };\r\n\t    };\r\n\t    Screen.prototype.onZoomFrame = function (cb) {\r\n\t        var _this = this;\r\n\t        var eventName = 'zoomFrame';\r\n\t        this.ee.on(eventName, cb);\r\n\t        return function () {\r\n\t            _this.ee.off(eventName, cb);\r\n\t        };\r\n\t    };\r\n\t    Screen.prototype.onScrollFrame = function (cb) {\r\n\t        var _this = this;\r\n\t        var eventName = 'scrollFrame';\r\n\t        this.ee.on(eventName, cb);\r\n\t        return function () {\r\n\t            _this.ee.off(eventName, cb);\r\n\t        };\r\n\t    };\r\n\t    Screen.prototype.onTransformationFrame = function (cb) {\r\n\t        var _this = this;\r\n\t        var eventName = 'transformationFrame';\r\n\t        this.ee.on(eventName, cb);\r\n\t        return function () {\r\n\t            _this.ee.off(eventName, cb);\r\n\t        };\r\n\t    };\r\n\t    Screen.prototype.cameraIsMoving = function () {\r\n\t        return !!(this.scrollXAnimation && this.scrollXAnimation.isActive() ||\r\n\t            this.zoomXAnimation && this.zoomXAnimation.isActive());\r\n\t    };\r\n\t    Screen.prototype.transform = function (options, silent) {\r\n\t        if (silent === void 0) { silent = false; }\r\n\t        var scrollX = options.scrollX, scrollY = options.scrollY, zoomX = options.zoomX, zoomY = options.zoomY;\r\n\t        if (scrollX != void 0)\r\n\t            this.options.scrollX = scrollX;\r\n\t        if (scrollY != void 0)\r\n\t            this.options.scrollY = scrollY;\r\n\t        if (zoomX != void 0)\r\n\t            this.options.zoomX = zoomX;\r\n\t        if (zoomY != void 0)\r\n\t            this.options.zoomY = zoomY;\r\n\t        if (scrollX != void 0 || zoomX) {\r\n\t            options.scrollXVal = this.pxToValueByXAxis(scrollX != void 0 ? scrollX : this.options.scrollX);\r\n\t            this.options.scrollXVal = options.scrollXVal;\r\n\t        }\r\n\t        if (scrollY != void 0 || zoomY) {\r\n\t            options.scrollYVal = this.pxToValueByYAxis(scrollY != void 0 ? scrollY : this.options.scrollY);\r\n\t            this.options.scrollYVal = options.scrollYVal;\r\n\t        }\r\n\t        if (silent)\r\n\t            return;\r\n\t        this.ee.emit('transformationFrame', options);\r\n\t        if (options.scrollXVal != void 0 || options.scrollYVal != void 0) {\r\n\t            this.ee.emit('scrollFrame', options);\r\n\t        }\r\n\t        if (options.zoomX != void 0 || options.zoomY != void 0) {\r\n\t            this.ee.emit('zoomFrame', options);\r\n\t        }\r\n\t    };\r\n\t    Screen.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        // handle scroll and zoom\r\n\t        state.onChange(function (changedProps) {\r\n\t            if (changedProps.xAxis && changedProps.xAxis.range) {\r\n\t                if (changedProps.xAxis.range.scroll != void 0)\r\n\t                    _this.onScrollXHandler(changedProps);\r\n\t                if (changedProps.xAxis.range.zoom)\r\n\t                    _this.onZoomXHandler();\r\n\t            }\r\n\t            if (changedProps.yAxis && changedProps.yAxis.range) {\r\n\t                if (changedProps.yAxis.range.scroll != void 0)\r\n\t                    _this.onScrollYHandler();\r\n\t                if (changedProps.yAxis.range.zoom)\r\n\t                    _this.onZoomYHandler();\r\n\t            }\r\n\t        });\r\n\t        state.onDestroy(function () { return _this.onDestroyHandler(); });\r\n\t    };\r\n\t    Screen.prototype.onDestroyHandler = function () {\r\n\t        this.ee.removeAllListeners();\r\n\t        this.scrollXAnimation && this.scrollXAnimation.kill();\r\n\t        this.scrollYAnimation && this.scrollYAnimation.kill();\r\n\t        this.zoomXAnimation && this.zoomXAnimation.kill();\r\n\t        this.zoomYAnimation && this.zoomYAnimation.kill();\r\n\t    };\r\n\t    Screen.prototype.onScrollXHandler = function (changedProps) {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        var isDragMode = state.data.cursor.dragMode;\r\n\t        var animations = state.data.animations;\r\n\t        var canAnimate = animations.enabled && !isDragMode;\r\n\t        var zoomXChanged = changedProps.xAxis.range.zoom;\r\n\t        var isAutoscroll = state.data.autoScroll && !isDragMode && !zoomXChanged;\r\n\t        var time = isAutoscroll ? animations.autoScrollSpeed : animations.zoomSpeed;\r\n\t        var ease = isAutoscroll ? animations.autoScrollEase : animations.zoomEase;\r\n\t        if (this.scrollXAnimation)\r\n\t            this.scrollXAnimation.pause();\r\n\t        var range = state.data.xAxis.range;\r\n\t        var targetX = range.scroll * range.scaleFactor * range.zoom;\r\n\t        this.currentScrollX.x = this.options.scrollX;\r\n\t        var cb = function () {\r\n\t            _this.transform({ scrollX: _this.currentScrollX.x });\r\n\t        };\r\n\t        if (canAnimate) {\r\n\t            this.scrollXAnimation = TweenLite.to(this.currentScrollX, time, {\r\n\t                x: targetX, ease: ease\r\n\t            });\r\n\t            this.scrollXAnimation.eventCallback('onUpdate', cb);\r\n\t        }\r\n\t        else {\r\n\t            this.currentScrollX.x = targetX;\r\n\t            cb();\r\n\t        }\r\n\t    };\r\n\t    Screen.prototype.onScrollYHandler = function () {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        var animations = state.data.animations;\r\n\t        var canAnimate = animations.enabled;\r\n\t        var time = animations.zoomSpeed;\r\n\t        if (this.scrollYAnimation)\r\n\t            this.scrollYAnimation.pause();\r\n\t        var range = state.data.yAxis.range;\r\n\t        var targetY = range.scroll * range.scaleFactor * range.zoom;\r\n\t        this.currentScrollY.y = this.options.scrollY;\r\n\t        var cb = function () {\r\n\t            _this.transform({ scrollY: _this.currentScrollY.y });\r\n\t        };\r\n\t        if (canAnimate) {\r\n\t            this.scrollYAnimation = TweenLite.to(this.currentScrollY, time, {\r\n\t                y: targetY, ease: animations.zoomEase\r\n\t            });\r\n\t            this.scrollYAnimation.eventCallback('onUpdate', cb);\r\n\t        }\r\n\t        else {\r\n\t            this.currentScrollY.y = targetY;\r\n\t            cb();\r\n\t        }\r\n\t    };\r\n\t    Screen.prototype.onZoomXHandler = function () {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        var animations = state.data.animations;\r\n\t        var canAnimate = animations.enabled;\r\n\t        var time = animations.zoomSpeed;\r\n\t        var targetZoom = state.data.xAxis.range.zoom;\r\n\t        if (this.zoomXAnimation)\r\n\t            this.zoomXAnimation.pause();\r\n\t        var cb = function () {\r\n\t            _this.transform({ zoomX: _this.currentZoomX.val });\r\n\t        };\r\n\t        if (canAnimate) {\r\n\t            this.zoomXAnimation = TweenLite.to(this.currentZoomX, time, {\r\n\t                val: targetZoom, ease: animations.zoomEase\r\n\t            });\r\n\t            this.zoomXAnimation.eventCallback('onUpdate', cb);\r\n\t        }\r\n\t        else {\r\n\t            this.currentZoomX.val = targetZoom;\r\n\t            cb();\r\n\t        }\r\n\t    };\r\n\t    Screen.prototype.onZoomYHandler = function () {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        var animations = state.data.animations;\r\n\t        var canAnimate = animations.enabled;\r\n\t        var time = animations.zoomSpeed;\r\n\t        var targetZoom = state.data.yAxis.range.zoom;\r\n\t        if (this.zoomYAnimation)\r\n\t            this.zoomYAnimation.pause();\r\n\t        var cb = function () {\r\n\t            _this.transform({ zoomY: _this.currentZoomY.val });\r\n\t        };\r\n\t        if (canAnimate) {\r\n\t            this.zoomYAnimation = TweenLite.to(this.currentZoomY, time, {\r\n\t                val: targetZoom, ease: animations.zoomEase\r\n\t            });\r\n\t            this.zoomYAnimation.eventCallback('onUpdate', cb);\r\n\t        }\r\n\t        else {\r\n\t            this.currentZoomY.val = targetZoom;\r\n\t            cb();\r\n\t        }\r\n\t    };\r\n\t    /**\r\n\t     *  returns offset in pixels from xAxis.range.zeroVal to scrollXVal\r\n\t     */\r\n\t    Screen.prototype.getPointOnXAxis = function (xVal) {\r\n\t        var _a = this.chartState.data.xAxis.range, scaleFactor = _a.scaleFactor, zeroVal = _a.zeroVal;\r\n\t        var zoom = this.options.zoomX;\r\n\t        return (xVal - zeroVal) * scaleFactor * zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  returns offset in pixels from yAxis.range.zeroVal to scrollYVal\r\n\t     */\r\n\t    Screen.prototype.getPointOnYAxis = function (yVal) {\r\n\t        var _a = this.chartState.data.yAxis.range, scaleFactor = _a.scaleFactor, zeroVal = _a.zeroVal;\r\n\t        var zoom = this.options.zoomY;\r\n\t        return (yVal - zeroVal) * scaleFactor * zoom;\r\n\t    };\r\n\t    /**\r\n\t     *  returns offset in pixels from xAxis.range.zeroVal and from yAxis.range.zeroVal to scrollXVal and scrollYVal\r\n\t     */\r\n\t    Screen.prototype.getPointOnChart = function (xVal, yVal) {\r\n\t        return new Vector3(this.getPointOnXAxis(xVal), this.getPointOnYAxis(yVal), 0);\r\n\t    };\r\n\t    /**\r\n\t     * returns value by offset in pixels from xAxis.range.zeroVal\r\n\t     */\r\n\t    Screen.prototype.getValueOnXAxis = function (x) {\r\n\t        return this.chartState.data.xAxis.range.zeroVal + this.pxToValueByXAxis(x);\r\n\t    };\r\n\t    /**\r\n\t     *  convert value to pixels by using settings from xAxis.range\r\n\t     */\r\n\t    Screen.prototype.valueToPxByXAxis = function (xVal) {\r\n\t        return xVal * this.chartState.data.xAxis.range.scaleFactor * this.options.zoomX;\r\n\t    };\r\n\t    /**\r\n\t     *  convert value to pixels by using settings from yAxis.range\r\n\t     */\r\n\t    Screen.prototype.valueToPxByYAxis = function (yVal) {\r\n\t        return yVal * this.chartState.data.yAxis.range.scaleFactor * this.options.zoomY;\r\n\t    };\r\n\t    /**\r\n\t     *  convert pixels to value by using settings from xAxis.range\r\n\t     */\r\n\t    Screen.prototype.pxToValueByXAxis = function (xVal) {\r\n\t        return xVal / this.chartState.data.xAxis.range.scaleFactor / this.options.zoomX;\r\n\t    };\r\n\t    /**\r\n\t     *  convert pixels to value by using settings from yAxis.range\r\n\t     */\r\n\t    Screen.prototype.pxToValueByYAxis = function (yVal) {\r\n\t        return yVal / this.chartState.data.yAxis.range.scaleFactor / this.options.zoomY;\r\n\t    };\r\n\t    /**\r\n\t     *  returns scrollX value by screen scrollX coordinate\r\n\t     */\r\n\t    Screen.prototype.getValueByScreenX = function (x) {\r\n\t        return this.chartState.data.xAxis.range.zeroVal + this.options.scrollXVal + this.pxToValueByXAxis(x);\r\n\t    };\r\n\t    /**\r\n\t     *  returns scrollY value by screen scrollY coordinate\r\n\t     */\r\n\t    Screen.prototype.getValueByScreenY = function (y) {\r\n\t        return this.chartState.data.yAxis.range.zeroVal + this.options.scrollYVal + this.pxToValueByYAxis(y);\r\n\t    };\r\n\t    //\r\n\t    /**\r\n\t     *  returns screen scrollX value by screen scrollY coordinate\r\n\t     */\r\n\t    Screen.prototype.getScreenXByValue = function (xVal) {\r\n\t        var _a = this.chartState.data.xAxis.range, scroll = _a.scroll, zeroVal = _a.zeroVal;\r\n\t        return this.valueToPxByXAxis(xVal - zeroVal - scroll);\r\n\t    };\r\n\t    // /**\r\n\t    //  *  returns screen scrollY value by screen scrollY coordinate\r\n\t    //  */\r\n\t    // getScreenYByValue(scrollYVal: number): number {\r\n\t    // \tvar {scroll, zeroVal} = this.data.yAxis.range;\r\n\t    // \treturn this.valueToPxByYAxis(scrollYVal - zeroVal - scroll)\r\n\t    // }\r\n\t    //\r\n\t    //\r\n\t    /**\r\n\t     * returns screen scrollX coordinate by offset in pixels from xAxis.range.zeroVal value\r\n\t     */\r\n\t    Screen.prototype.getScreenXByPoint = function (xVal) {\r\n\t        return this.getScreenXByValue(this.getValueOnXAxis(xVal));\r\n\t    };\r\n\t    /**\r\n\t     * returns offset in pixels from xAxis.range.zeroVal value by screen scrollX coordinate\r\n\t     */\r\n\t    Screen.prototype.getPointByScreenX = function (screenX) {\r\n\t        return this.getPointOnXAxis(this.getValueByScreenX(screenX));\r\n\t    };\r\n\t    /**\r\n\t     * returns offset in pixels from yAxis.range.zeroVal value by screen scrollY coordinate\r\n\t     */\r\n\t    Screen.prototype.getPointByScreenY = function (screenY) {\r\n\t        return this.getPointOnYAxis(this.getValueByScreenY(screenY));\r\n\t    };\r\n\t    Screen.prototype.getTop = function () {\r\n\t        return this.getPointByScreenY(this.chartState.data.height);\r\n\t    };\r\n\t    Screen.prototype.getBottom = function () {\r\n\t        return this.getPointByScreenY(0);\r\n\t    };\r\n\t    Screen.prototype.getLeft = function () {\r\n\t        return this.getPointByScreenX(0);\r\n\t    };\r\n\t    Screen.prototype.getScreenRightVal = function () {\r\n\t        return this.getValueByScreenX(this.chartState.data.width);\r\n\t    };\r\n\t    Screen.prototype.getTopVal = function () {\r\n\t        return this.getValueByScreenY(this.chartState.data.height);\r\n\t    };\r\n\t    Screen.prototype.getBottomVal = function () {\r\n\t        return this.getValueByScreenY(0);\r\n\t    };\r\n\t    Screen.prototype.getCenterYVal = function () {\r\n\t        return this.getValueByScreenY(this.chartState.data.height / 2);\r\n\t    };\r\n\t    return Screen;\r\n\t}());\r\n\texports.Screen = Screen;\r\n\n\n/***/ },\n/* 20 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar interfaces_1 = __webpack_require__(21);\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\tvar AXIS_MARK_DEFAULT_OPTIONS = {\r\n\t    type: 'simple',\r\n\t    lineWidth: 1,\r\n\t    value: 0,\r\n\t    showValue: false,\r\n\t    stickToEdges: false,\r\n\t    lineColor: '#FFFFFF',\r\n\t    title: ''\r\n\t};\r\n\tvar AxisMarks = (function () {\r\n\t    function AxisMarks(chartState, axisType) {\r\n\t        this.items = {};\r\n\t        this.chartState = chartState;\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.axisType = axisType;\r\n\t        var marks = this.items;\r\n\t        var axisMarksOptions = axisType == interfaces_1.AXIS_TYPE.X ? chartState.data.xAxis.marks : chartState.data.yAxis.marks;\r\n\t        for (var _i = 0, axisMarksOptions_1 = axisMarksOptions; _i < axisMarksOptions_1.length; _i++) {\r\n\t            var options = axisMarksOptions_1[_i];\r\n\t            var axisMark = void 0;\r\n\t            options = Utils_1.Utils.deepMerge(AXIS_MARK_DEFAULT_OPTIONS, options);\r\n\t            // set mark name\r\n\t            if (!options.name)\r\n\t                options.name = Utils_1.Utils.getUid().toString();\r\n\t            if (marks[options.name])\r\n\t                Utils_1.Utils.error('duplicated mark name ' + options.name);\r\n\t            // create mark instance based on type option\r\n\t            if (options.type == 'timeleft') {\r\n\t                axisMark = new AxisTimeleftMark(chartState, axisType, options);\r\n\t            }\r\n\t            else {\r\n\t                axisMark = new AxisMark(chartState, axisType, options);\r\n\t            }\r\n\t            marks[options.name] = axisMark;\r\n\t        }\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    AxisMarks.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.chartState.onTrendChange(function (trendName, changedOptions, newData) {\r\n\t            _this.onTrendChange(trendName, newData);\r\n\t        });\r\n\t        this.chartState.onDestroy(function () { return _this.ee.removeAllListeners(); });\r\n\t    };\r\n\t    AxisMarks.prototype.onTrendChange = function (trendName, newData) {\r\n\t        if (!newData)\r\n\t            return;\r\n\t        var startVal = newData[0].xVal;\r\n\t        var endVal = newData[newData.length - 1].xVal;\r\n\t        var marks = this.items;\r\n\t        for (var markName in marks) {\r\n\t            var mark = marks[markName];\r\n\t            var markVal = mark.options.value;\r\n\t            var markWasCrossed = (startVal == markVal || endVal == markVal || (startVal < markVal && endVal > markVal));\r\n\t            if (markWasCrossed)\r\n\t                this.ee.emit('markCrossed', trendName, newData);\r\n\t        }\r\n\t    };\r\n\t    AxisMarks.prototype.getItems = function () {\r\n\t        return this.items;\r\n\t    };\r\n\t    AxisMarks.prototype.getItem = function (markName) {\r\n\t        return this.items[markName];\r\n\t    };\r\n\t    return AxisMarks;\r\n\t}());\r\n\texports.AxisMarks = AxisMarks;\r\n\tvar AxisMark = (function () {\r\n\t    function AxisMark(chartState, axisType, options) {\r\n\t        this.renderOnTrendsChange = false;\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.options = options;\r\n\t        this.axisType = axisType;\r\n\t        this.chartState = chartState;\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    AxisMark.prototype.bindEvents = function () { };\r\n\t    AxisMark.prototype.setOptions = function (newOptions) {\r\n\t        var value = this.options.value;\r\n\t        this.options = Utils_1.Utils.deepMerge(this.options, newOptions);\r\n\t        if (this.options.value !== value)\r\n\t            this.ee.emit('valueChange');\r\n\t        this.ee.emit('onDisplayedValueChange');\r\n\t    };\r\n\t    AxisMark.prototype.getDisplayedVal = function () {\r\n\t        var _a = this.options, value = _a.value, displayedValue = _a.displayedValue;\r\n\t        return String(displayedValue !== void 0 ? displayedValue : value);\r\n\t    };\r\n\t    AxisMark.prototype.onMarkCrossed = function (cb) {\r\n\t        var _this = this;\r\n\t        this.ee.on('markCrossed', cb);\r\n\t        return function () {\r\n\t            _this.ee.off('markCrossed', cb);\r\n\t        };\r\n\t    };\r\n\t    AxisMark.prototype.onValueChange = function (cb) {\r\n\t        var _this = this;\r\n\t        this.ee.on('valueChange', cb);\r\n\t        return function () {\r\n\t            _this.ee.off('valueChange', cb);\r\n\t        };\r\n\t    };\r\n\t    AxisMark.prototype.onDisplayedValueChange = function (cb) {\r\n\t        var _this = this;\r\n\t        this.ee.on('onDisplayedValueChange', cb);\r\n\t        return function () {\r\n\t            _this.ee.off('onDisplayedValueChange', cb);\r\n\t        };\r\n\t    };\r\n\t    AxisMark.typeName = 'simple';\r\n\t    return AxisMark;\r\n\t}());\r\n\texports.AxisMark = AxisMark;\r\n\tvar AxisTimeleftMark = (function (_super) {\r\n\t    __extends(AxisTimeleftMark, _super);\r\n\t    function AxisTimeleftMark() {\r\n\t        _super.apply(this, arguments);\r\n\t        this.renderOnTrendsChange = true;\r\n\t    }\r\n\t    AxisTimeleftMark.prototype.getDisplayedVal = function () {\r\n\t        var markVal = this.options.value;\r\n\t        var maxXVal = this.chartState.data.computedData.trends.maxXVal;\r\n\t        var time = markVal - maxXVal;\r\n\t        if (time < 0)\r\n\t            time = 0;\r\n\t        return Utils_1.Utils.msToTimeString(time);\r\n\t    };\r\n\t    AxisTimeleftMark.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.chartState.onTrendsChange(function () { return _this.onTrendsChange(); });\r\n\t    };\r\n\t    AxisTimeleftMark.prototype.onTrendsChange = function () {\r\n\t        this.ee.emit('onDisplayedValueChange');\r\n\t    };\r\n\t    AxisTimeleftMark.typeName = 'timeleft';\r\n\t    return AxisTimeleftMark;\r\n\t}(AxisMark));\r\n\texports.AxisTimeleftMark = AxisTimeleftMark;\r\n\n\n/***/ },\n/* 21 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\t(function (AXIS_RANGE_TYPE) {\r\n\t    AXIS_RANGE_TYPE[AXIS_RANGE_TYPE[\"FIXED\"] = 0] = \"FIXED\";\r\n\t    AXIS_RANGE_TYPE[AXIS_RANGE_TYPE[\"RELATIVE_END\"] = 1] = \"RELATIVE_END\";\r\n\t    AXIS_RANGE_TYPE[AXIS_RANGE_TYPE[\"AUTO\"] = 2] = \"AUTO\";\r\n\t    AXIS_RANGE_TYPE[AXIS_RANGE_TYPE[\"ALL\"] = 3] = \"ALL\"; // TODO: AXIS_RANGE_TYPE.ALL\r\n\t})(exports.AXIS_RANGE_TYPE || (exports.AXIS_RANGE_TYPE = {}));\r\n\tvar AXIS_RANGE_TYPE = exports.AXIS_RANGE_TYPE;\r\n\t;\r\n\t(function (AXIS_TYPE) {\r\n\t    AXIS_TYPE[AXIS_TYPE[\"X\"] = 0] = \"X\";\r\n\t    AXIS_TYPE[AXIS_TYPE[\"Y\"] = 1] = \"Y\";\r\n\t})(exports.AXIS_TYPE || (exports.AXIS_TYPE = {}));\r\n\tvar AXIS_TYPE = exports.AXIS_TYPE;\r\n\t(function (AXIS_DATA_TYPE) {\r\n\t    AXIS_DATA_TYPE[AXIS_DATA_TYPE[\"NUMBER\"] = 0] = \"NUMBER\";\r\n\t    AXIS_DATA_TYPE[AXIS_DATA_TYPE[\"DATE\"] = 1] = \"DATE\";\r\n\t})(exports.AXIS_DATA_TYPE || (exports.AXIS_DATA_TYPE = {}));\r\n\tvar AXIS_DATA_TYPE = exports.AXIS_DATA_TYPE;\r\n\n\n/***/ },\n/* 22 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar Object3D = THREE.Object3D;\r\n\tvar Widget_1 = __webpack_require__(15);\r\n\tvar GridWidget_1 = __webpack_require__(23);\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar interfaces_1 = __webpack_require__(21);\r\n\t/**\r\n\t * widget for drawing axis\r\n\t */\r\n\tvar AxisWidget = (function (_super) {\r\n\t    __extends(AxisWidget, _super);\r\n\t    function AxisWidget(state) {\r\n\t        var _this = this;\r\n\t        _super.call(this, state);\r\n\t        this.isDestroyed = false;\r\n\t        this.object3D = new Object3D();\r\n\t        this.axisXObject = new Object3D();\r\n\t        this.axisYObject = new Object3D();\r\n\t        this.object3D.add(this.axisXObject);\r\n\t        this.object3D.add(this.axisYObject);\r\n\t        this.setupAxis(interfaces_1.AXIS_TYPE.X);\r\n\t        this.setupAxis(interfaces_1.AXIS_TYPE.Y);\r\n\t        // canvas drawing is expensive operation, so when we scroll, redraw must be called only once per second\r\n\t        this.updateAxisXRequest = Utils_1.Utils.throttle(function () { return _this.updateAxis(interfaces_1.AXIS_TYPE.X); }, 1000);\r\n\t        this.onScrollChange(state.screen.options.scrollX, state.screen.options.scrollY);\r\n\t    }\r\n\t    AxisWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        this.bindEvent(state.screen.onTransformationFrame(function (options) {\r\n\t            _this.onScrollChange(options.scrollX, options.scrollY);\r\n\t        }), state.screen.onZoomFrame(function (options) { _this.onZoomFrame(options); }), state.onDestroy(function () { return _this.onDestroy(); }), state.onResize(function () { return _this.onResize(); }));\r\n\t    };\r\n\t    AxisWidget.prototype.onDestroy = function () {\r\n\t        this.isDestroyed = true;\r\n\t        this.unbindEvents();\r\n\t    };\r\n\t    AxisWidget.prototype.onScrollChange = function (x, y) {\r\n\t        if (y != void 0) {\r\n\t            this.axisYObject.position.y = y;\r\n\t            this.axisXObject.position.y = y;\r\n\t        }\r\n\t        if (x != void 0) {\r\n\t            this.axisYObject.position.x = x;\r\n\t            this.updateAxisXRequest();\r\n\t        }\r\n\t    };\r\n\t    AxisWidget.prototype.onResize = function () {\r\n\t        this.setupAxis(interfaces_1.AXIS_TYPE.X);\r\n\t        this.setupAxis(interfaces_1.AXIS_TYPE.Y);\r\n\t    };\r\n\t    AxisWidget.prototype.setupAxis = function (orientation) {\r\n\t        var _this = this;\r\n\t        var isXAxis = orientation == interfaces_1.AXIS_TYPE.X;\r\n\t        var _a = this.chartState.data, visibleWidth = _a.width, visibleHeight = _a.height;\r\n\t        var canvasWidth = 0, canvasHeight = 0;\r\n\t        // clean meshes\r\n\t        if (isXAxis) {\r\n\t            this.axisXObject.traverse(function (obj) { return _this.axisXObject.remove(obj); });\r\n\t            canvasWidth = visibleWidth * 3;\r\n\t            canvasHeight = 50;\r\n\t        }\r\n\t        else {\r\n\t            this.axisYObject.traverse(function (obj) { return _this.axisYObject.remove(obj); });\r\n\t            canvasWidth = 50;\r\n\t            canvasHeight = visibleHeight * 3;\r\n\t        }\r\n\t        var texture = Utils_1.Utils.createPixelPerfectTexture(canvasWidth, canvasHeight, function (ctx) {\r\n\t            ctx.beginPath();\r\n\t            ctx.font = \"10px Arial\";\r\n\t            ctx.fillStyle = \"rgba(255,255,255,0.5)\";\r\n\t            ctx.strokeStyle = \"rgba(255,255,255,0.1)\";\r\n\t        });\r\n\t        var material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.FrontSide });\r\n\t        material.transparent = true;\r\n\t        var axisMesh = new Mesh(new THREE.PlaneGeometry(canvasWidth, canvasHeight), material);\r\n\t        if (isXAxis) {\r\n\t            axisMesh.position.set(canvasWidth / 2, canvasHeight / 2, 0);\r\n\t            this.axisXObject.add(axisMesh);\r\n\t        }\r\n\t        else {\r\n\t            axisMesh.position.set(visibleWidth - canvasWidth / 2, canvasHeight / 2, 0);\r\n\t            this.axisYObject.add(axisMesh);\r\n\t        }\r\n\t        this.updateAxis(orientation);\r\n\t    };\r\n\t    AxisWidget.prototype.getObject3D = function () {\r\n\t        return this.object3D;\r\n\t    };\r\n\t    AxisWidget.prototype.updateAxis = function (orientation) {\r\n\t        if (this.isDestroyed)\r\n\t            return;\r\n\t        var isXAxis = orientation == interfaces_1.AXIS_TYPE.X;\r\n\t        var _a = this.chartState.data, visibleWidth = _a.width, visibleHeight = _a.height;\r\n\t        var _b = this.chartState.screen.options, scrollX = _b.scrollX, scrollY = _b.scrollY, zoomX = _b.zoomX, zoomY = _b.zoomY;\r\n\t        var axisOptions;\r\n\t        var axisMesh;\r\n\t        var axisGridParams;\r\n\t        if (isXAxis) {\r\n\t            axisMesh = this.axisXObject.children[0];\r\n\t            axisOptions = this.chartState.data.xAxis;\r\n\t            axisGridParams = GridWidget_1.GridWidget.getGridParamsForAxis(axisOptions, visibleWidth, zoomX);\r\n\t        }\r\n\t        else {\r\n\t            axisMesh = this.axisYObject.children[0];\r\n\t            axisOptions = this.chartState.data.yAxis;\r\n\t            axisGridParams = GridWidget_1.GridWidget.getGridParamsForAxis(axisOptions, visibleHeight, zoomY);\r\n\t        }\r\n\t        var geometry = axisMesh.geometry;\r\n\t        var canvasWidth = geometry.parameters.width;\r\n\t        var canvasHeight = geometry.parameters.height;\r\n\t        var texture = axisMesh.material.map;\r\n\t        var ctx = texture.image.getContext('2d');\r\n\t        ctx.clearRect(0, 0, canvasWidth, canvasHeight);\r\n\t        if (isXAxis) {\r\n\t            axisMesh.position.x = canvasWidth / 2 - visibleWidth + scrollX;\r\n\t        }\r\n\t        // TODO: draw text and lines in different loops\r\n\t        var edgeOffset = axisGridParams.segmentsCount * axisGridParams.step;\r\n\t        var startVal = axisGridParams.start - edgeOffset;\r\n\t        var endVal = axisGridParams.end + edgeOffset;\r\n\t        ctx.beginPath();\r\n\t        for (var val = startVal; val <= endVal; val += axisGridParams.step) {\r\n\t            var displayedValue = '';\r\n\t            if (isXAxis) {\r\n\t                var pxVal = this.chartState.screen.getPointOnXAxis(val) - scrollX + visibleWidth;\r\n\t                ctx.textAlign = \"center\";\r\n\t                // uncomment for dots\r\n\t                // ctx.moveTo(pxVal + 0.5, canvasHeight);\r\n\t                // ctx.lineTo(pxVal + 0.5, canvasHeight - 5);\r\n\t                if (axisOptions.dataType == interfaces_1.AXIS_DATA_TYPE.DATE) {\r\n\t                    displayedValue = AxisWidget.getDateStr(val, axisGridParams);\r\n\t                }\r\n\t                else {\r\n\t                    displayedValue = Number(val.toFixed(14)).toString();\r\n\t                }\r\n\t                ctx.fillText(displayedValue, pxVal, canvasHeight - 10);\r\n\t            }\r\n\t            else {\r\n\t                var pxVal = canvasHeight - this.chartState.screen.getPointOnYAxis(val) + scrollY;\r\n\t                ctx.textAlign = \"right\";\r\n\t                // uncomment for dots\r\n\t                // ctx.moveTo(canvasWidth, pxVal + 0.5);\r\n\t                // ctx.lineTo(canvasWidth - 5, pxVal + 0.5);\r\n\t                displayedValue = Number(val.toFixed(14)).toString();\r\n\t                ctx.fillText(displayedValue, canvasWidth - 15, pxVal + 3);\r\n\t            }\r\n\t            ctx.stroke();\r\n\t        }\r\n\t        // uncomment to preview canvas borders\r\n\t        // ctx.fillRect(0, 0, canvasWidth, canvasHeight);\r\n\t        ctx.stroke();\r\n\t        ctx.closePath();\r\n\t        texture.needsUpdate = true;\r\n\t    };\r\n\t    AxisWidget.prototype.onZoomFrame = function (options) {\r\n\t        if (options.zoomX) {\r\n\t            this.updateAxis(interfaces_1.AXIS_TYPE.X);\r\n\t        }\r\n\t        if (options.zoomY) {\r\n\t            this.updateAxis(interfaces_1.AXIS_TYPE.Y);\r\n\t        }\r\n\t    };\r\n\t    // private temporaryHideAxis(orientation: AXIS_TYPE) {\r\n\t    // \tvar isXAxis = orientation == AXIS_TYPE.X;\r\n\t    // \tvar timeoutId = setTimeout(() => {\r\n\t    // \t\t\tthis.showAxis(orientation);\r\n\t    // \t}, 200);\r\n\t    //\r\n\t    // \tif (isXAxis) {\r\n\t    // \t\t(this.axisXObject.children[0] as Mesh).material.opacity = 0;\r\n\t    // \t\tclearTimeout(this.showAxisXTimeout);\r\n\t    // \t\tthis.showAxisXTimeout =\ttimeoutId;\r\n\t    // \t} else {\r\n\t    // \t\tclearTimeout(this.showAxisYTimeout);\r\n\t    // \t\t(this.axisYObject.children[0] as Mesh).material.opacity = 0;\r\n\t    // \t\tthis.showAxisYTimeout = timeoutId;\r\n\t    // \t}\r\n\t    // }\r\n\t    // private showAxis(orientation: AXIS_TYPE) {\r\n\t    // \tvar isXAxis = orientation == AXIS_TYPE.X;\r\n\t    // \tvar material: MeshBasicMaterial;\r\n\t    // \tif (isXAxis) {\r\n\t    // \t\tmaterial = (this.axisXObject.children[0] as Mesh).material as MeshBasicMaterial;\r\n\t    // \t} else {\r\n\t    // \t\tmaterial = (this.axisYObject.children[0] as Mesh).material as MeshBasicMaterial;\r\n\t    // \t}\r\n\t    // \tthis.updateAxis(orientation);\r\n\t    // \tTweenLite.to(material, 0.3, {opacity: 1});\r\n\t    // }\r\n\t    AxisWidget.getDateStr = function (timestamp, gridParams) {\r\n\t        var sec = 1000;\r\n\t        var min = sec * 60;\r\n\t        var hour = min * 60;\r\n\t        var day = hour * 60;\r\n\t        var step = gridParams.step;\r\n\t        var d = new Date(timestamp);\r\n\t        var tf = function (num) { return Utils_1.Utils.toFixed(num, 2); };\r\n\t        return tf(d.getHours()) + ':' + tf(d.getMinutes()) + ':' + tf(d.getSeconds());\r\n\t    };\r\n\t    AxisWidget.widgetName = 'Axis';\r\n\t    return AxisWidget;\r\n\t}(Widget_1.ChartWidget));\r\n\texports.AxisWidget = AxisWidget;\r\n\n\n/***/ },\n/* 23 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar Widget_1 = __webpack_require__(15);\r\n\tvar LineSegments = THREE.LineSegments;\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\t/**\r\n\t * widget for drawing chart grid\r\n\t */\r\n\tvar GridWidget = (function (_super) {\r\n\t    __extends(GridWidget, _super);\r\n\t    function GridWidget(chartState) {\r\n\t        _super.call(this, chartState);\r\n\t        this.isDestroyed = false;\r\n\t        var _a = chartState.data, width = _a.width, height = _a.height, xAxis = _a.xAxis, yAxis = _a.yAxis;\r\n\t        this.gridSizeH = Math.floor(width / xAxis.gridMinSize) * 3;\r\n\t        this.gridSizeV = Math.floor(height / yAxis.gridMinSize) * 3;\r\n\t        this.initGrid();\r\n\t        this.updateGrid();\r\n\t    }\r\n\t    GridWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        // grid is bigger then screen, so it's no need to update it on each scroll event\r\n\t        var updateGridThrottled = Utils_1.Utils.throttle(function () { return _this.updateGrid(); }, 1000);\r\n\t        this.bindEvent(this.chartState.onScroll(function () { return updateGridThrottled(); }), this.chartState.screen.onZoomFrame(function (options) {\r\n\t            updateGridThrottled();\r\n\t            _this.onZoomFrame(options);\r\n\t        }), this.chartState.onDestroy(function () {\r\n\t            _this.isDestroyed = true;\r\n\t            _this.unbindEvents();\r\n\t        }), this.chartState.onResize(function () {\r\n\t            _this.updateGrid();\r\n\t        }));\r\n\t    };\r\n\t    GridWidget.prototype.initGrid = function () {\r\n\t        var geometry = new THREE.Geometry();\r\n\t        var material = new THREE.LineBasicMaterial({ linewidth: 1, opacity: 0.1, transparent: true });\r\n\t        var xLinesCount = this.gridSizeH;\r\n\t        var yLinesCount = this.gridSizeV;\r\n\t        while (xLinesCount--)\r\n\t            geometry.vertices.push(new Vector3(), new Vector3());\r\n\t        while (yLinesCount--)\r\n\t            geometry.vertices.push(new Vector3(), new Vector3());\r\n\t        this.lineSegments = new LineSegments(geometry, material);\r\n\t        this.lineSegments.position.setZ(-1);\r\n\t        this.lineSegments.frustumCulled = false;\r\n\t    };\r\n\t    GridWidget.prototype.updateGrid = function () {\r\n\t        if (this.isDestroyed)\r\n\t            return;\r\n\t        var _a = this.chartState.data, yAxis = _a.yAxis, xAxis = _a.xAxis, width = _a.width, height = _a.height;\r\n\t        var axisXGrid = GridWidget.getGridParamsForAxis(xAxis, width, xAxis.range.zoom);\r\n\t        var axisYGrid = GridWidget.getGridParamsForAxis(yAxis, height, yAxis.range.zoom);\r\n\t        var scrollXInSegments = Math.ceil(xAxis.range.scroll / axisXGrid.step);\r\n\t        var scrollYInSegments = Math.ceil(yAxis.range.scroll / axisYGrid.step);\r\n\t        var gridScrollXVal = scrollXInSegments * axisXGrid.step;\r\n\t        var gridScrollYVal = scrollYInSegments * axisYGrid.step;\r\n\t        var startXVal = axisXGrid.start + gridScrollXVal;\r\n\t        var startYVal = axisYGrid.start + gridScrollYVal;\r\n\t        var geometry = this.lineSegments.geometry;\r\n\t        var vertices = geometry.vertices;\r\n\t        var lineInd = 0;\r\n\t        for (var i = -this.gridSizeH / 3; i < this.gridSizeH * 2 / 3; i++) {\r\n\t            var value = startXVal + i * axisXGrid.step;\r\n\t            var lineSegment = this.getVerticalLineSegment(value, gridScrollXVal, gridScrollYVal);\r\n\t            vertices[lineInd * 2].set(lineSegment[0].x, lineSegment[0].y, 0);\r\n\t            vertices[lineInd * 2 + 1].set(lineSegment[1].x, lineSegment[1].y, 0);\r\n\t            lineInd++;\r\n\t        }\r\n\t        for (var i = -this.gridSizeV / 3; i < this.gridSizeV * 2 / 3; i++) {\r\n\t            var value = startYVal + i * axisYGrid.step;\r\n\t            var lineSegment = this.getHorizontalLineSegment(value, gridScrollXVal, gridScrollYVal);\r\n\t            vertices[lineInd * 2].set(lineSegment[0].x, lineSegment[0].y, 0);\r\n\t            vertices[lineInd * 2 + 1].set(lineSegment[1].x, lineSegment[1].y, 0);\r\n\t            lineInd++;\r\n\t        }\r\n\t        geometry.verticesNeedUpdate = true;\r\n\t        this.lineSegments.scale.set(xAxis.range.scaleFactor * xAxis.range.zoom, yAxis.range.scaleFactor * yAxis.range.zoom, 1);\r\n\t    };\r\n\t    GridWidget.prototype.getHorizontalLineSegment = function (yVal, scrollXVal, scrollYVal) {\r\n\t        var chartState = this.chartState;\r\n\t        var localYVal = yVal - chartState.data.yAxis.range.zeroVal - scrollYVal;\r\n\t        var widthVal = chartState.pxToValueByXAxis(chartState.data.width);\r\n\t        return [\r\n\t            new THREE.Vector3(widthVal * 2 + scrollXVal, localYVal, 0),\r\n\t            new THREE.Vector3(-widthVal + scrollXVal, localYVal, 0)\r\n\t        ];\r\n\t    };\r\n\t    GridWidget.prototype.getVerticalLineSegment = function (xVal, scrollXVal, scrollYVal) {\r\n\t        var chartState = this.chartState;\r\n\t        var localXVal = xVal - chartState.data.xAxis.range.zeroVal - scrollXVal;\r\n\t        var heightVal = chartState.pxToValueByYAxis(chartState.data.height);\r\n\t        return [\r\n\t            new THREE.Vector3(localXVal, heightVal * 2 + scrollYVal, 0),\r\n\t            new THREE.Vector3(localXVal, -heightVal + scrollYVal, 0)\r\n\t        ];\r\n\t    };\r\n\t    GridWidget.prototype.onZoomFrame = function (options) {\r\n\t        var _a = this.chartState.data, xAxis = _a.xAxis, yAxis = _a.yAxis;\r\n\t        if (options.zoomX)\r\n\t            this.lineSegments.scale.setX(xAxis.range.scaleFactor * options.zoomX);\r\n\t        if (options.zoomY)\r\n\t            this.lineSegments.scale.setY(yAxis.range.scaleFactor * options.zoomY);\r\n\t    };\r\n\t    // TODO: move this code to core\r\n\t    GridWidget.getGridParamsForAxis = function (axisOptions, axisWidth, zoom) {\r\n\t        var axisRange = axisOptions.range;\r\n\t        var from = axisRange.from; //var from = axisOptions.range.zeroVal + scroll;\r\n\t        var to = axisRange.to; //var to = from + axisWidth / (axisRange.scaleFactor * zoom);\r\n\t        var axisLength = to - from;\r\n\t        var gridStep = 0;\r\n\t        var gridStepInPixels = 0;\r\n\t        var minGridStepInPixels = axisOptions.gridMinSize;\r\n\t        var axisLengthStr = String(axisLength);\r\n\t        var axisLengthPointPosition = axisLengthStr.indexOf('.');\r\n\t        var intPartLength = axisLengthPointPosition !== -1 ? axisLengthPointPosition : axisLengthStr.length;\r\n\t        var gridStepFound = false;\r\n\t        var digitPos = 0;\r\n\t        while (!gridStepFound) {\r\n\t            var power = intPartLength - digitPos - 1;\r\n\t            var multiplier = (Math.pow(10, power) || 1);\r\n\t            var dividers = [1, 2, 5];\r\n\t            for (var dividerInd = 0; dividerInd < dividers.length; dividerInd++) {\r\n\t                var nextGridStep = multiplier / dividers[dividerInd];\r\n\t                var nextGridStepInPixels = nextGridStep / axisLength * axisWidth;\r\n\t                if (nextGridStepInPixels >= minGridStepInPixels) {\r\n\t                    gridStep = nextGridStep;\r\n\t                    gridStepInPixels = nextGridStepInPixels;\r\n\t                }\r\n\t                else {\r\n\t                    gridStepFound = true;\r\n\t                    if (gridStep === 0) {\r\n\t                        gridStep = nextGridStep;\r\n\t                        gridStepInPixels = nextGridStepInPixels;\r\n\t                    }\r\n\t                    break;\r\n\t                }\r\n\t            }\r\n\t            if (!gridStepFound)\r\n\t                digitPos++;\r\n\t        }\r\n\t        var gridStart = Math.floor(from / gridStep) * gridStep;\r\n\t        var gridEnd = Math.floor(to / gridStep) * gridStep;\r\n\t        return {\r\n\t            start: gridStart,\r\n\t            end: gridEnd,\r\n\t            step: gridStep,\r\n\t            stepInPx: gridStepInPixels,\r\n\t            length: gridEnd - gridStart,\r\n\t            segmentsCount: Math.round((gridEnd - gridStart) / gridStep)\r\n\t        };\r\n\t    };\r\n\t    GridWidget.prototype.getObject3D = function () {\r\n\t        return this.lineSegments;\r\n\t    };\r\n\t    GridWidget.widgetName = 'Grid';\r\n\t    return GridWidget;\r\n\t}(Widget_1.ChartWidget));\r\n\texports.GridWidget = GridWidget;\r\n\n\n/***/ },\n/* 24 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar PlaneBufferGeometry = THREE.PlaneBufferGeometry;\r\n\tvar MeshBasicMaterial = THREE.MeshBasicMaterial;\r\n\tvar TrendsWidget_1 = __webpack_require__(25);\r\n\tvar Trend_1 = __webpack_require__(17);\r\n\t/**\r\n\t * widget adds loading indicator\r\n\t * activated when animations enabled\r\n\t */\r\n\tvar TrendsLoadingWidget = (function (_super) {\r\n\t    __extends(TrendsLoadingWidget, _super);\r\n\t    function TrendsLoadingWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsLoadingWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendLoading;\r\n\t    };\r\n\t    TrendsLoadingWidget.widgetName = 'TrendsLoading';\r\n\t    return TrendsLoadingWidget;\r\n\t}(TrendsWidget_1.TrendsWidget));\r\n\texports.TrendsLoadingWidget = TrendsLoadingWidget;\r\n\tvar TrendLoading = (function (_super) {\r\n\t    __extends(TrendLoading, _super);\r\n\t    function TrendLoading(state, trendName) {\r\n\t        _super.call(this, state, trendName);\r\n\t        this.isActive = false;\r\n\t        // add beacon\r\n\t        this.mesh = new Mesh(new PlaneBufferGeometry(32, 32), new MeshBasicMaterial({ map: TrendLoading.createTexture(), transparent: true }));\r\n\t        this.deactivate();\r\n\t    }\r\n\t    TrendLoading.widgetIsEnabled = function (trendOptions, chartState) {\r\n\t        return trendOptions.enabled && chartState.data.animations.enabled;\r\n\t    };\r\n\t    TrendLoading.prototype.getObject3D = function () {\r\n\t        return this.mesh;\r\n\t    };\r\n\t    TrendLoading.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        _super.prototype.bindEvents.call(this);\r\n\t        this.bindEvent(this.trend.onPrependRequest(function () { return _this.activate(); }));\r\n\t    };\r\n\t    TrendLoading.prototype.prependData = function () {\r\n\t        this.deactivate();\r\n\t    };\r\n\t    TrendLoading.prototype.activate = function () {\r\n\t        var mesh = this.mesh;\r\n\t        mesh.material.opacity = 1;\r\n\t        mesh.rotation.z = 0;\r\n\t        var animation = TweenLite.to(this.mesh.rotation, 0.5, { z: Math.PI * 2 });\r\n\t        animation.eventCallback('onComplete', function () {\r\n\t            animation.restart();\r\n\t        });\r\n\t        this.animation = animation;\r\n\t        this.isActive = true;\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendLoading.prototype.deactivate = function () {\r\n\t        this.animation && this.animation.kill();\r\n\t        this.mesh.material.opacity = 0;\r\n\t        this.isActive = false;\r\n\t    };\r\n\t    TrendLoading.createTexture = function () {\r\n\t        var h = 64, w = 64;\r\n\t        return Utils_1.Utils.createTexture(h, w, function (ctx) {\r\n\t            ctx.strokeStyle = \"rgba(255,255,255,0.95)\";\r\n\t            ctx.lineWidth = 5;\r\n\t            var center = h / 2;\r\n\t            ctx.beginPath();\r\n\t            ctx.arc(center, center, 22, 0, Math.PI / 2);\r\n\t            ctx.stroke();\r\n\t            ctx.beginPath();\r\n\t            ctx.arc(center, center, 22, Math.PI, Math.PI + Math.PI / 2);\r\n\t            ctx.stroke();\r\n\t            ctx.beginPath();\r\n\t            ctx.arc(center, center, 3, 0, Math.PI * 2);\r\n\t            ctx.stroke();\r\n\t        });\r\n\t    };\r\n\t    TrendLoading.prototype.onZoomFrame = function () {\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendLoading.prototype.updatePosition = function () {\r\n\t        if (!this.isActive)\r\n\t            return;\r\n\t        var trend = this.trend;\r\n\t        // set new widget position\r\n\t        var segment = trend.segments.getStartSegment();\r\n\t        var x, y;\r\n\t        if (trend.getOptions().type == Trend_1.TREND_TYPE.LINE) {\r\n\t            x = segment.currentAnimationState.startXVal;\r\n\t            y = segment.currentAnimationState.startYVal;\r\n\t        }\r\n\t        else {\r\n\t            x = segment.currentAnimationState.xVal - segment.maxLength;\r\n\t            y = segment.currentAnimationState.yVal;\r\n\t        }\r\n\t        var pointVector = this.chartState.screen.getPointOnChart(x, y);\r\n\t        this.mesh.position.set(pointVector.x, pointVector.y, 0);\r\n\t    };\r\n\t    return TrendLoading;\r\n\t}(TrendsWidget_1.TrendWidget));\r\n\texports.TrendLoading = TrendLoading;\r\n\n\n/***/ },\n/* 25 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Widget_1 = __webpack_require__(15);\r\n\tvar Object3D = THREE.Object3D;\r\n\t/**\r\n\t * abstract manager class for all trends widgets\r\n\t */\r\n\tvar TrendsWidget = (function (_super) {\r\n\t    __extends(TrendsWidget, _super);\r\n\t    function TrendsWidget(state) {\r\n\t        _super.call(this, state);\r\n\t        this.widgets = {};\r\n\t        this.object3D = new Object3D();\r\n\t        this.onTrendsChange();\r\n\t    }\r\n\t    TrendsWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        var state = this.chartState;\r\n\t        state.onTrendsChange(function () { return _this.onTrendsChange(); });\r\n\t        state.onTrendChange(function (trendName, changedOptions, newData) {\r\n\t            _this.onTrendChange(trendName, changedOptions, newData);\r\n\t        });\r\n\t    };\r\n\t    TrendsWidget.prototype.onTrendsChange = function () {\r\n\t        var trendsOptions = this.chartState.data.trends;\r\n\t        var TrendWidgetClass = this.getTrendWidgetClass();\r\n\t        for (var trendName in trendsOptions) {\r\n\t            var trendOptions = trendsOptions[trendName];\r\n\t            var widgetCanBeEnabled = TrendWidgetClass.widgetIsEnabled(trendOptions, this.chartState);\r\n\t            if (widgetCanBeEnabled && !this.widgets[trendName]) {\r\n\t                this.createTrendWidget(trendName);\r\n\t            }\r\n\t            else if (!widgetCanBeEnabled && this.widgets[trendName]) {\r\n\t                this.destroyTrendWidget(trendName);\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    TrendsWidget.prototype.onTrendChange = function (trendName, changedOptions, newData) {\r\n\t        var widget = this.widgets[trendName];\r\n\t        if (!widget)\r\n\t            return;\r\n\t        widget.onTrendChange(changedOptions);\r\n\t        if (newData) {\r\n\t            var data = this.chartState.getTrend(trendName).getData();\r\n\t            var isAppend = (!data.length || data[0].xVal < newData[0].xVal);\r\n\t            isAppend ? widget.appendData(newData) : widget.prependData(newData);\r\n\t        }\r\n\t    };\r\n\t    TrendsWidget.prototype.getObject3D = function () {\r\n\t        return this.object3D;\r\n\t    };\r\n\t    TrendsWidget.prototype.createTrendWidget = function (trendName) {\r\n\t        var WidgetConstructor = this.getTrendWidgetClass();\r\n\t        var widget = new WidgetConstructor(this.chartState, trendName);\r\n\t        this.widgets[trendName] = widget;\r\n\t        var widgetObject = widget.getObject3D();\r\n\t        widgetObject.name = trendName;\r\n\t        this.object3D.add(widget.getObject3D());\r\n\t    };\r\n\t    TrendsWidget.prototype.destroyTrendWidget = function (trendName) {\r\n\t        this.widgets[trendName].onDestroy();\r\n\t        delete this.widgets[trendName];\r\n\t        var widgetObject = this.object3D.getObjectByName(trendName);\r\n\t        this.object3D.remove(widgetObject);\r\n\t    };\r\n\t    return TrendsWidget;\r\n\t}(Widget_1.ChartWidget));\r\n\texports.TrendsWidget = TrendsWidget;\r\n\t/**\r\n\t * based class for all trends widgets\r\n\t */\r\n\tvar TrendWidget = (function () {\r\n\t    function TrendWidget(chartState, trendName) {\r\n\t        this.chartState = chartState;\r\n\t        this.trendName = trendName;\r\n\t        this.unsubscribers = [];\r\n\t        this.trend = chartState.trendsManager.getTrend(trendName);\r\n\t        this.chartState = chartState;\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    TrendWidget.widgetIsEnabled = function (trendOptions, chartState) {\r\n\t        return trendOptions.enabled;\r\n\t    };\r\n\t    TrendWidget.prototype.appendData = function (newData) { };\r\n\t    ;\r\n\t    TrendWidget.prototype.prependData = function (newData) { };\r\n\t    ;\r\n\t    TrendWidget.prototype.onTrendChange = function (changedOptions) { };\r\n\t    TrendWidget.prototype.onDestroy = function () {\r\n\t        for (var _i = 0, _a = this.unsubscribers; _i < _a.length; _i++) {\r\n\t            var unsubscriber = _a[_i];\r\n\t            unsubscriber();\r\n\t        }\r\n\t    };\r\n\t    TrendWidget.prototype.onSegmentsAnimate = function (segments) {\r\n\t    };\r\n\t    TrendWidget.prototype.onZoomFrame = function (options) {\r\n\t    };\r\n\t    TrendWidget.prototype.onTransformationFrame = function (options) {\r\n\t    };\r\n\t    TrendWidget.prototype.onZoom = function () {\r\n\t    };\r\n\t    TrendWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.bindEvent(this.trend.segments.onAnimationFrame(function (trendPoints) { return _this.onSegmentsAnimate(trendPoints); }));\r\n\t        this.bindEvent(this.chartState.screen.onTransformationFrame(function (options) { return _this.onTransformationFrame(options); }));\r\n\t        this.bindEvent(this.chartState.screen.onZoomFrame(function (options) { return _this.onZoomFrame(options); }));\r\n\t        this.bindEvent(this.chartState.onZoom(function () { return _this.onZoom(); }));\r\n\t    };\r\n\t    ;\r\n\t    TrendWidget.prototype.bindEvent = function (unsubscriber) {\r\n\t        this.unsubscribers.push(unsubscriber);\r\n\t    };\r\n\t    return TrendWidget;\r\n\t}());\r\n\texports.TrendWidget = TrendWidget;\r\n\n\n/***/ },\n/* 26 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Widget_1 = __webpack_require__(15);\r\n\tvar Object3D = THREE.Object3D;\r\n\tvar Geometry = THREE.Geometry;\r\n\tvar LineBasicMaterial = THREE.LineBasicMaterial;\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar Line = THREE.Line;\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar interfaces_1 = __webpack_require__(21);\r\n\t/**\r\n\t * widget for shows marks on axis\r\n\t */\r\n\tvar AxisMarksWidget = (function (_super) {\r\n\t    __extends(AxisMarksWidget, _super);\r\n\t    function AxisMarksWidget(chartState) {\r\n\t        _super.call(this, chartState);\r\n\t        this.axisMarksWidgets = [];\r\n\t        this.object3D = new Object3D();\r\n\t        var xAxisMarks = chartState.xAxisMarks, yAxisMarks = chartState.yAxisMarks;\r\n\t        var items = xAxisMarks.getItems();\r\n\t        for (var markName in items) {\r\n\t            this.createAxisMark(items[markName]);\r\n\t        }\r\n\t        items = yAxisMarks.getItems();\r\n\t        for (var markName in items) {\r\n\t            this.createAxisMark(items[markName]);\r\n\t        }\r\n\t    }\r\n\t    AxisMarksWidget.prototype.createAxisMark = function (axisMark) {\r\n\t        var axisMarkWidget = new AxisMarkWidget(this.chartState, axisMark);\r\n\t        this.axisMarksWidgets.push(axisMarkWidget);\r\n\t        this.object3D.add(axisMarkWidget.getObject3D());\r\n\t    };\r\n\t    AxisMarksWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.bindEvent(this.chartState.screen.onTransformationFrame(function () { return _this.updateMarksPositions(); }), this.chartState.onResize(function () { return _this.updateMarksPositions(); }));\r\n\t    };\r\n\t    AxisMarksWidget.prototype.updateMarksPositions = function () {\r\n\t        for (var _i = 0, _a = this.axisMarksWidgets; _i < _a.length; _i++) {\r\n\t            var widget = _a[_i];\r\n\t            widget.updatePosition();\r\n\t        }\r\n\t    };\r\n\t    AxisMarksWidget.prototype.getObject3D = function () {\r\n\t        return this.object3D;\r\n\t    };\r\n\t    AxisMarksWidget.widgetName = 'AxisMarks';\r\n\t    return AxisMarksWidget;\r\n\t}(Widget_1.ChartWidget));\r\n\texports.AxisMarksWidget = AxisMarksWidget;\r\n\tvar DEFAULT_INDICATOR_RENDER_FUNCTION = function (axisMarkWidget, ctx) {\r\n\t    var axisMark = axisMarkWidget.axisMark;\r\n\t    ctx.fillStyle = axisMark.options.lineColor;\r\n\t    ctx.clearRect(0, 0, axisMarkWidget.indicatorWidth, axisMarkWidget.indicatorHeight);\r\n\t    var xCoord = 15;\r\n\t    if (axisMark.axisType == interfaces_1.AXIS_TYPE.Y) {\r\n\t        ctx.textAlign = 'end';\r\n\t        xCoord = axisMarkWidget.indicatorWidth;\r\n\t    }\r\n\t    ctx.fillText(axisMark.options.title, xCoord, 20);\r\n\t    if (!axisMark.options.showValue)\r\n\t        return;\r\n\t    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';\r\n\t    ctx.fillText(axisMark.getDisplayedVal(), 16, 34);\r\n\t};\r\n\tvar INDICATOR_POS_Z = 0.1;\r\n\tvar AxisMarkWidget = (function () {\r\n\t    function AxisMarkWidget(chartState, axisMark) {\r\n\t        this.indicatorWidth = 128;\r\n\t        this.indicatorHeight = 64;\r\n\t        this.indicatorRenderFunction = DEFAULT_INDICATOR_RENDER_FUNCTION;\r\n\t        this.chartState = chartState;\r\n\t        this.axisMark = axisMark;\r\n\t        this.axisType = axisMark.axisType;\r\n\t        this.frameValue = axisMark.options.value;\r\n\t        this.object3D = new Object3D();\r\n\t        this.object3D.position.setZ(-0.1);\r\n\t        this.line = this.createLine();\r\n\t        this.object3D.add(this.line);\r\n\t        this.indicator = this.createIndicator();\r\n\t        this.object3D.add(this.indicator);\r\n\t        this.renderIndicator();\r\n\t        this.updatePosition();\r\n\t        this.bindEvents();\r\n\t    }\r\n\t    AxisMarkWidget.prototype.getObject3D = function () {\r\n\t        return this.object3D;\r\n\t    };\r\n\t    AxisMarkWidget.prototype.createLine = function () {\r\n\t        var _a = this.axisMark.options, lineWidth = _a.lineWidth, lineColor = _a.lineColor;\r\n\t        var lineGeometry = new Geometry();\r\n\t        lineGeometry.vertices.push(new Vector3(0, 0, 0), new Vector3(0, 0, 0));\r\n\t        return new Line(lineGeometry, new LineBasicMaterial({ color: Utils_1.Utils.getHexColor(lineColor), linewidth: lineWidth }));\r\n\t    };\r\n\t    AxisMarkWidget.prototype.createIndicator = function () {\r\n\t        var _a = this, width = _a.indicatorWidth, height = _a.indicatorHeight;\r\n\t        var texture = Utils_1.Utils.createPixelPerfectTexture(width, height, function (ctx) {\r\n\t            ctx.beginPath();\r\n\t            ctx.font = \"10px Arial\";\r\n\t        });\r\n\t        var material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.FrontSide });\r\n\t        material.transparent = true;\r\n\t        return new Mesh(new THREE.PlaneGeometry(width, height), material);\r\n\t    };\r\n\t    AxisMarkWidget.prototype.renderIndicator = function () {\r\n\t        var texture = this.indicator.material.map;\r\n\t        var ctx = texture.image.getContext('2d');\r\n\t        DEFAULT_INDICATOR_RENDER_FUNCTION(this, ctx);\r\n\t        texture.needsUpdate = true;\r\n\t    };\r\n\t    AxisMarkWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        this.axisMark.onDisplayedValueChange(function () { return _this.renderIndicator(); });\r\n\t        this.axisMark.onValueChange(function () { return _this.onValueChangeHandler(); });\r\n\t    };\r\n\t    AxisMarkWidget.prototype.onValueChangeHandler = function () {\r\n\t        var _this = this;\r\n\t        // move mark to new position with animation\r\n\t        if (this.moveAnimation)\r\n\t            this.moveAnimation.kill();\r\n\t        var animations = this.chartState.data.animations;\r\n\t        var targetValue = this.axisMark.options.value;\r\n\t        var cb = function () {\r\n\t            _this.updatePosition();\r\n\t        };\r\n\t        if (animations.enabled) {\r\n\t            this.moveAnimation = TweenLite.to(this, animations.trendChangeSpeed, { frameValue: targetValue, ease: animations.trendChangeEase });\r\n\t            this.moveAnimation.eventCallback('onUpdate', cb);\r\n\t        }\r\n\t        else {\r\n\t            this.frameValue = targetValue;\r\n\t            cb();\r\n\t        }\r\n\t    };\r\n\t    AxisMarkWidget.prototype.updatePosition = function () {\r\n\t        var chartState = this.chartState;\r\n\t        var screen = chartState.screen;\r\n\t        var isXAxis = this.axisType == interfaces_1.AXIS_TYPE.X;\r\n\t        var lineGeometry = this.line.geometry;\r\n\t        var hasStickMode = this.axisMark.options.stickToEdges;\r\n\t        var _a = this.chartState.data, width = _a.width, height = _a.height;\r\n\t        if (isXAxis) {\r\n\t            // TODO: make stickToEdges mode for AXIS_TYPE.X \r\n\t            this.object3D.position.x = screen.getPointOnXAxis(this.frameValue);\r\n\t            this.object3D.position.y = screen.getBottom();\r\n\t            lineGeometry.vertices[1].setY(height);\r\n\t            this.indicator.position.set(this.indicatorWidth / 2, chartState.data.height - this.indicatorHeight / 2, INDICATOR_POS_Z);\r\n\t        }\r\n\t        else {\r\n\t            var val = this.frameValue;\r\n\t            var bottomVal = screen.getBottomVal();\r\n\t            var topVal = screen.getTopVal();\r\n\t            var needToStickOnTop = hasStickMode && val > topVal;\r\n\t            var needToStickOnBottom = hasStickMode && val < bottomVal;\r\n\t            var centerYVal = screen.getCenterYVal();\r\n\t            this.object3D.position.x = screen.getLeft();\r\n\t            if (needToStickOnTop) {\r\n\t                this.object3D.position.y = screen.getTop();\r\n\t            }\r\n\t            else if (needToStickOnBottom) {\r\n\t                this.object3D.position.y = screen.getBottom();\r\n\t            }\r\n\t            else {\r\n\t                this.object3D.position.y = screen.getPointOnYAxis(this.frameValue);\r\n\t            }\r\n\t            lineGeometry.vertices[1].setX(width);\r\n\t            var indicatorPosY = val > centerYVal ? -35 : 10;\r\n\t            this.indicator.position.set(width - this.indicatorWidth / 2 - 50, indicatorPosY, INDICATOR_POS_Z);\r\n\t        }\r\n\t        lineGeometry.verticesNeedUpdate = true;\r\n\t    };\r\n\t    AxisMarkWidget.typeName = 'simple';\r\n\t    return AxisMarkWidget;\r\n\t}());\r\n\n\n/***/ },\n/* 27 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Widget_1 = __webpack_require__(15);\r\n\tvar LineSegments = THREE.LineSegments;\r\n\tvar Vector3 = THREE.Vector3;\r\n\t/**\r\n\t * widget for drawing chart grid\r\n\t */\r\n\tvar BorderWidget = (function (_super) {\r\n\t    __extends(BorderWidget, _super);\r\n\t    function BorderWidget(chartState) {\r\n\t        _super.call(this, chartState);\r\n\t        var _a = chartState.data, width = _a.width, height = _a.height;\r\n\t        var geometry = new THREE.Geometry();\r\n\t        var material = new THREE.LineBasicMaterial({ linewidth: 1, opacity: 0.0, transparent: true });\r\n\t        geometry.vertices.push(new Vector3(0, 0, 0), new Vector3(0, height, 0), new Vector3(0, height, 0), new Vector3(width, height, 0), new Vector3(width, height, 0), new Vector3(width, 0, 0), new Vector3(width, 0, 0), new Vector3(0, 0, 0), new Vector3(width / 2, height, 0), new Vector3(width / 2, 0, 0));\r\n\t        this.lineSegments = new LineSegments(geometry, material);\r\n\t    }\r\n\t    BorderWidget.prototype.getObject3D = function () {\r\n\t        return this.lineSegments;\r\n\t    };\r\n\t    BorderWidget.widgetName = 'Border';\r\n\t    return BorderWidget;\r\n\t}(Widget_1.ChartWidget));\r\n\texports.BorderWidget = BorderWidget;\r\n\n\n/***/ },\n/* 28 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar TrendsWidget_1 = __webpack_require__(25);\r\n\tvar Color = THREE.Color;\r\n\tvar CANVAS_WIDTH = 128;\r\n\tvar CANVAS_HEIGHT = 64;\r\n\tvar OFFSET_X = 15;\r\n\tvar TrendsIndicatorWidget = (function (_super) {\r\n\t    __extends(TrendsIndicatorWidget, _super);\r\n\t    function TrendsIndicatorWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsIndicatorWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendIndicator;\r\n\t    };\r\n\t    TrendsIndicatorWidget.widgetName = 'TrendsIndicator';\r\n\t    return TrendsIndicatorWidget;\r\n\t}(TrendsWidget_1.TrendsWidget));\r\n\texports.TrendsIndicatorWidget = TrendsIndicatorWidget;\r\n\tvar TrendIndicator = (function (_super) {\r\n\t    __extends(TrendIndicator, _super);\r\n\t    function TrendIndicator(state, trendName) {\r\n\t        _super.call(this, state, trendName);\r\n\t        this.initObject();\r\n\t        this.onTrendChange();\r\n\t    }\r\n\t    TrendIndicator.widgetIsEnabled = function (trendOptions) {\r\n\t        return trendOptions.enabled && trendOptions.hasIndicator;\r\n\t    };\r\n\t    TrendIndicator.prototype.getObject3D = function () {\r\n\t        return this.mesh;\r\n\t    };\r\n\t    TrendIndicator.prototype.onTrendChange = function () {\r\n\t        // update canvas value\r\n\t        var trendData = this.trend.getData();\r\n\t        var lastItem = trendData[trendData.length - 1];\r\n\t        var texture = this.mesh.material.map;\r\n\t        var ctx = texture.image.getContext('2d');\r\n\t        ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);\r\n\t        // uncomment to preview indicator rect\r\n\t        // ctx.fillStyle = \"rgba(255,255,255,0.5)\";\r\n\t        // ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);\r\n\t        ctx.fillText(lastItem.yVal.toFixed(4), 0, 15);\r\n\t        texture.needsUpdate = true;\r\n\t    };\r\n\t    TrendIndicator.prototype.initObject = function () {\r\n\t        var color = new Color(this.trend.getOptions().lineColor);\r\n\t        var texture = Utils_1.Utils.createPixelPerfectTexture(CANVAS_WIDTH, CANVAS_HEIGHT, function (ctx) {\r\n\t            ctx.beginPath();\r\n\t            ctx.font = \"15px Arial\";\r\n\t            ctx.fillStyle = color.getStyle();\r\n\t            ctx.strokeStyle = \"rgba(255,255,255,0.95)\";\r\n\t        });\r\n\t        var material = new THREE.MeshBasicMaterial({ map: texture, side: THREE.FrontSide });\r\n\t        material.transparent = true;\r\n\t        this.mesh = new Mesh(new THREE.PlaneGeometry(CANVAS_WIDTH, CANVAS_HEIGHT), material);\r\n\t    };\r\n\t    TrendIndicator.prototype.onTransformationFrame = function () {\r\n\t        // set new widget position\r\n\t        this.segment = this.trend.segments.getEndSegment();\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendIndicator.prototype.onSegmentsAnimate = function (segments) {\r\n\t        // set new widget position\r\n\t        this.segment = segments.getEndSegment();\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendIndicator.prototype.updatePosition = function () {\r\n\t        var state = this.chartState;\r\n\t        var _a = this.segment.currentAnimationState, segmentEndXVal = _a.endXVal, segmentEndYVal = _a.endYVal;\r\n\t        var endPointVector = state.screen.getPointOnChart(segmentEndXVal, segmentEndYVal);\r\n\t        var screenWidth = state.data.width;\r\n\t        var x = endPointVector.x + OFFSET_X;\r\n\t        var y = endPointVector.y;\r\n\t        var screenX = state.screen.getScreenXByPoint(endPointVector.x);\r\n\t        var indicatorIsOutOfScreen = screenX < 0 || screenX > screenWidth;\r\n\t        if (indicatorIsOutOfScreen) {\r\n\t            if (screenX < 0)\r\n\t                x = state.screen.getPointByScreenX(0) + 20;\r\n\t            if (screenX > screenWidth)\r\n\t                x = state.screen.getPointByScreenX(screenWidth) - CANVAS_WIDTH / 2 - 10;\r\n\t            y -= 25;\r\n\t        }\r\n\t        this.mesh.position.set(x + CANVAS_WIDTH / 2, y + CANVAS_HEIGHT / 2 - 30, 0.1);\r\n\t    };\r\n\t    return TrendIndicator;\r\n\t}(TrendsWidget_1.TrendWidget));\r\n\texports.TrendIndicator = TrendIndicator;\r\n\n\n/***/ },\n/* 29 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Geometry = THREE.Geometry;\r\n\tvar LineBasicMaterial = THREE.LineBasicMaterial;\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar TrendsWidget_1 = __webpack_require__(25);\r\n\tvar LineSegments = THREE.LineSegments;\r\n\tvar Trend_1 = __webpack_require__(17);\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar MAX_DISPLAYED_SEGMENTS = 2000;\r\n\t/**\r\n\t * widget for drawing trends lines\r\n\t */\r\n\tvar TrendsLineWidget = (function (_super) {\r\n\t    __extends(TrendsLineWidget, _super);\r\n\t    function TrendsLineWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsLineWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendLine;\r\n\t    };\r\n\t    TrendsLineWidget.widgetName = \"TrendsLine\";\r\n\t    return TrendsLineWidget;\r\n\t}(TrendsWidget_1.TrendsWidget));\r\n\texports.TrendsLineWidget = TrendsLineWidget;\r\n\tvar TrendLine = (function (_super) {\r\n\t    __extends(TrendLine, _super);\r\n\t    function TrendLine(chartState, trendName) {\r\n\t        _super.call(this, chartState, trendName);\r\n\t        // contains indexes of free segments\r\n\t        this.freeSegmentsInds = [];\r\n\t        // contains segments to display\r\n\t        this.displayedSegments = {};\r\n\t        var options = this.trend.getOptions();\r\n\t        this.material = new LineBasicMaterial({ color: options.lineColor, linewidth: options.lineWidth });\r\n\t        this.initLine();\r\n\t    }\r\n\t    TrendLine.widgetIsEnabled = function (trendOptions) {\r\n\t        return trendOptions.enabled && trendOptions.type == Trend_1.TREND_TYPE.LINE;\r\n\t    };\r\n\t    TrendLine.prototype.getObject3D = function () {\r\n\t        return this.lineSegments;\r\n\t    };\r\n\t    TrendLine.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        _super.prototype.bindEvents.call(this);\r\n\t        this.bindEvent(this.trend.segments.onRebuild(function () {\r\n\t            _this.destroySegments();\r\n\t            _this.setupSegments();\r\n\t        }));\r\n\t        this.bindEvent(this.trend.segments.onDisplayedRangeChanged(function () {\r\n\t            _this.setupSegments();\r\n\t        }));\r\n\t    };\r\n\t    TrendLine.prototype.initLine = function () {\r\n\t        var geometry = new Geometry();\r\n\t        var _a = this.chartState.data.xAxis.range, scaleXFactor = _a.scaleFactor, zoomX = _a.zoom;\r\n\t        var _b = this.chartState.data.yAxis.range, scaleYFactor = _b.scaleFactor, zoomY = _b.zoom;\r\n\t        this.scaleXFactor = scaleXFactor;\r\n\t        this.scaleYFactor = scaleYFactor;\r\n\t        this.lineSegments = new LineSegments(geometry, this.material);\r\n\t        this.lineSegments.scale.set(scaleXFactor * zoomX, scaleYFactor * zoomY, 1);\r\n\t        this.lineSegments.frustumCulled = false;\r\n\t        for (var i = 0; i < MAX_DISPLAYED_SEGMENTS; i++) {\r\n\t            geometry.vertices.push(new Vector3(), new Vector3());\r\n\t            this.freeSegmentsInds.push(i);\r\n\t        }\r\n\t        this.vertices = geometry.vertices;\r\n\t        this.setupSegments();\r\n\t    };\r\n\t    TrendLine.prototype.setupSegments = function () {\r\n\t        var geometry = this.lineSegments.geometry;\r\n\t        var _a = this.trend.segments, firstDisplayedSegment = _a.firstDisplayedSegment, lastDisplayedSegment = _a.lastDisplayedSegment;\r\n\t        for (var segmentId in this.displayedSegments) {\r\n\t            var lineSegment = this.displayedSegments[segmentId];\r\n\t            var segment_1 = this.trend.segments.segments[lineSegment.segmentId];\r\n\t            var segmentIsNotDisplayed = (segment_1.startXVal < firstDisplayedSegment.startXVal ||\r\n\t                segment_1.endXVal > lastDisplayedSegment.endXVal);\r\n\t            if (segmentIsNotDisplayed)\r\n\t                this.destroySegment(Number(segmentId));\r\n\t        }\r\n\t        var segment = firstDisplayedSegment;\r\n\t        while (segment && segment.xVal <= lastDisplayedSegment.xVal) {\r\n\t            this.setupSegment(segment.id, segment.currentAnimationState);\r\n\t            segment = segment.getNext();\r\n\t        }\r\n\t        geometry.verticesNeedUpdate = true;\r\n\t    };\r\n\t    TrendLine.prototype.setupSegment = function (segmentId, segmentState) {\r\n\t        var lineSegment = this.displayedSegments[segmentId];\r\n\t        if (!lineSegment) {\r\n\t            if (this.freeSegmentsInds.length == 0)\r\n\t                Utils_1.Utils.error('Max allocated segments reached');\r\n\t            var ind = this.freeSegmentsInds.pop();\r\n\t            lineSegment = this.displayedSegments[segmentId] = { segmentId: segmentId, ind: ind };\r\n\t        }\r\n\t        var segmentInd = lineSegment.ind;\r\n\t        var lineStartVertex = this.vertices[segmentInd * 2];\r\n\t        var lineEndVertex = this.vertices[segmentInd * 2 + 1];\r\n\t        lineStartVertex.set(this.toLocalX(segmentState.startXVal), this.toLocalY(segmentState.startYVal), 0);\r\n\t        lineEndVertex.set(this.toLocalX(segmentState.endXVal), this.toLocalY(segmentState.endYVal), 0);\r\n\t    };\r\n\t    TrendLine.prototype.destroySegments = function () {\r\n\t        for (var segmentId in this.displayedSegments)\r\n\t            this.destroySegment(Number(segmentId));\r\n\t    };\r\n\t    TrendLine.prototype.destroySegment = function (segmentId) {\r\n\t        var lineSegment = this.displayedSegments[segmentId];\r\n\t        var lineStartVertex = this.vertices[lineSegment.ind * 2];\r\n\t        var lineEndVertex = this.vertices[lineSegment.ind * 2 + 1];\r\n\t        lineStartVertex.set(0, 0, 0);\r\n\t        lineEndVertex.set(0, 0, 0);\r\n\t        delete this.displayedSegments[segmentId];\r\n\t        this.freeSegmentsInds.push(lineSegment.ind);\r\n\t    };\r\n\t    TrendLine.prototype.onZoomFrame = function (options) {\r\n\t        var currentScale = this.lineSegments.scale;\r\n\t        if (options.zoomX)\r\n\t            currentScale.setX(this.scaleXFactor * options.zoomX);\r\n\t        if (options.zoomY)\r\n\t            currentScale.setY(this.scaleYFactor * options.zoomY);\r\n\t    };\r\n\t    TrendLine.prototype.onSegmentsAnimate = function (trendSegments) {\r\n\t        var geometry = this.lineSegments.geometry;\r\n\t        for (var _i = 0, _a = trendSegments.animatedSegmentsIds; _i < _a.length; _i++) {\r\n\t            var segmentId = _a[_i];\r\n\t            if (!this.displayedSegments[segmentId])\r\n\t                continue;\r\n\t            this.setupSegment(segmentId, trendSegments.segmentsById[segmentId].currentAnimationState);\r\n\t        }\r\n\t        geometry.verticesNeedUpdate = true;\r\n\t    };\r\n\t    TrendLine.prototype.toLocalX = function (xVal) {\r\n\t        return xVal - this.chartState.data.xAxis.range.zeroVal;\r\n\t    };\r\n\t    TrendLine.prototype.toLocalY = function (yVal) {\r\n\t        return yVal - this.chartState.data.yAxis.range.zeroVal;\r\n\t    };\r\n\t    TrendLine.prototype.toLocalVec = function (vec) {\r\n\t        return new Vector3(this.toLocalX(vec.x), this.toLocalY(vec.y), 0);\r\n\t    };\r\n\t    return TrendLine;\r\n\t}(TrendsWidget_1.TrendWidget));\r\n\texports.TrendLine = TrendLine;\r\n\n\n/***/ },\n/* 30 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar TrendsWidget_1 = __webpack_require__(25);\r\n\tvar Object3D = THREE.Object3D;\r\n\tvar Geometry = THREE.Geometry;\r\n\tvar Vector3 = THREE.Vector3;\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar Line = THREE.Line;\r\n\tvar MeshBasicMaterial = THREE.MeshBasicMaterial;\r\n\tvar PlaneGeometry = THREE.PlaneGeometry;\r\n\tvar Trend_1 = __webpack_require__(17);\r\n\tvar LineBasicMaterial = THREE.LineBasicMaterial;\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar RISE_COLOR = 0x2CAC40;\r\n\tvar FALL_COLOR = 0xEE5533;\r\n\tvar MARGIN_PERCENT = 0.3;\r\n\tvar MAX_CANDLES = 100;\r\n\t/**\r\n\t * widget for drawing trends candles\r\n\t */\r\n\tvar TrendsCandlesWidget = (function (_super) {\r\n\t    __extends(TrendsCandlesWidget, _super);\r\n\t    function TrendsCandlesWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsCandlesWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendCandlesWidget;\r\n\t    };\r\n\t    TrendsCandlesWidget.widgetName = \"TrendsCandles\";\r\n\t    return TrendsCandlesWidget;\r\n\t}(TrendsWidget_1.TrendsWidget));\r\n\texports.TrendsCandlesWidget = TrendsCandlesWidget;\r\n\tvar TrendCandlesWidget = (function (_super) {\r\n\t    __extends(TrendCandlesWidget, _super);\r\n\t    function TrendCandlesWidget(chartState, trendName) {\r\n\t        _super.call(this, chartState, trendName);\r\n\t        // contains indexes of free candles\r\n\t        this.freeCandlesInds = [];\r\n\t        this.candlesPool = [];\r\n\t        this.candles = {};\r\n\t        this.initObject();\r\n\t    }\r\n\t    TrendCandlesWidget.widgetIsEnabled = function (trendOptions) {\r\n\t        return trendOptions.enabled && trendOptions.type == Trend_1.TREND_TYPE.CANDLE;\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.getObject3D = function () {\r\n\t        return this.object3D;\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        _super.prototype.bindEvents.call(this);\r\n\t        this.bindEvent(this.trend.segments.onRebuild(function () {\r\n\t            _this.destroyCandles();\r\n\t            _this.setupCandles();\r\n\t        }));\r\n\t        this.bindEvent(this.trend.segments.onDisplayedRangeChanged(function () {\r\n\t            _this.setupCandles();\r\n\t        }));\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.initObject = function () {\r\n\t        var stateData = this.chartState.data;\r\n\t        var _a = stateData.xAxis.range, scaleXFactor = _a.scaleFactor, zoomX = _a.zoom;\r\n\t        var _b = stateData.yAxis.range, scaleYFactor = _b.scaleFactor, zoomY = _b.zoom;\r\n\t        this.scaleXFactor = scaleXFactor;\r\n\t        this.scaleYFactor = scaleYFactor;\r\n\t        this.object3D = new Object3D();\r\n\t        this.object3D.scale.set(scaleXFactor * zoomX, scaleYFactor * zoomY, 1);\r\n\t        this.object3D.frustumCulled = false;\r\n\t        for (var i = 0; i < MAX_CANDLES; i++)\r\n\t            this.freeCandlesInds.push(i);\r\n\t        this.setupCandles();\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.setupCandles = function () {\r\n\t        // remove invisible\r\n\t        var _a = this.trend.segments, firstDisplayedSegment = _a.firstDisplayedSegment, lastDisplayedSegment = _a.lastDisplayedSegment;\r\n\t        for (var segmentId in this.candles) {\r\n\t            var segment_1 = this.candles[segmentId].segment;\r\n\t            var segmentIsNotDisplayed = (segment_1.startXVal < firstDisplayedSegment.startXVal ||\r\n\t                segment_1.endXVal > lastDisplayedSegment.endXVal);\r\n\t            if (segmentIsNotDisplayed)\r\n\t                this.destroyCandle(Number(segmentId));\r\n\t        }\r\n\t        var segment = firstDisplayedSegment;\r\n\t        while (segment && segment.xVal <= lastDisplayedSegment.xVal) {\r\n\t            this.setupCandle(segment.id, segment.currentAnimationState);\r\n\t            segment = segment.getNext();\r\n\t        }\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.destroyCandles = function () {\r\n\t        for (var segmentId in this.candles)\r\n\t            this.destroyCandle(Number(segmentId));\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.destroyCandle = function (segmentId) {\r\n\t        var candle = this.candles[segmentId];\r\n\t        this.object3D.remove(candle.getObject3D());\r\n\t        delete this.candles[segmentId];\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.onZoomFrame = function (options) {\r\n\t        var currentScale = this.object3D.scale;\r\n\t        if (options.zoomX)\r\n\t            currentScale.setX(this.scaleXFactor * options.zoomX);\r\n\t        if (options.zoomY)\r\n\t            currentScale.setY(this.scaleYFactor * options.zoomY);\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.onSegmentsAnimate = function (trendSegments) {\r\n\t        for (var _i = 0, _a = trendSegments.animatedSegmentsIds; _i < _a.length; _i++) {\r\n\t            var segmentId = _a[_i];\r\n\t            if (!this.candles[segmentId])\r\n\t                continue;\r\n\t            var segmentState = trendSegments.segmentsById[segmentId].currentAnimationState;\r\n\t            this.setupCandle(segmentId, segmentState);\r\n\t        }\r\n\t    };\r\n\t    /**\r\n\t     * create or modify candle\r\n\t     */\r\n\t    TrendCandlesWidget.prototype.setupCandle = function (candleId, segmentState) {\r\n\t        var candleInd = candleId % MAX_CANDLES;\r\n\t        // get candle from candlesPool to avoid creating new Objects by performance reasons\r\n\t        var candle = this.candlesPool[candleInd];\r\n\t        if (!candle) {\r\n\t            candle = this.candlesPool[candleInd] = new CandleWidget();\r\n\t        }\r\n\t        if (!this.candles[candleId]) {\r\n\t            this.candles[candleId] = candle;\r\n\t            this.object3D.add(candle.getObject3D());\r\n\t        }\r\n\t        candle.getObject3D().position.set(this.toLocalX(segmentState.xVal), this.toLocalY(segmentState.yVal), 0);\r\n\t        candle.setSegment(segmentState);\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.toLocalX = function (xVal) {\r\n\t        return xVal - this.chartState.data.xAxis.range.zeroVal;\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.toLocalY = function (yVal) {\r\n\t        return yVal - this.chartState.data.yAxis.range.zeroVal;\r\n\t    };\r\n\t    TrendCandlesWidget.prototype.toLocalVec = function (vec) {\r\n\t        return new Vector3(this.toLocalX(vec.x), this.toLocalY(vec.y), 0);\r\n\t    };\r\n\t    return TrendCandlesWidget;\r\n\t}(TrendsWidget_1.TrendWidget));\r\n\texports.TrendCandlesWidget = TrendCandlesWidget;\r\n\tvar CandleWidget = (function () {\r\n\t    function CandleWidget() {\r\n\t        this.initObject();\r\n\t    }\r\n\t    CandleWidget.prototype.getObject3D = function () {\r\n\t        return this.rect;\r\n\t    };\r\n\t    CandleWidget.prototype.setSegment = function (segment) {\r\n\t        this.segment = segment;\r\n\t        var color = segment.endYVal < segment.startYVal ? FALL_COLOR : RISE_COLOR;\r\n\t        // update rect\r\n\t        var geometry = this.rect.geometry;\r\n\t        var material = this.rect.material;\r\n\t        var width = segment.endXVal - segment.startXVal;\r\n\t        width -= width * MARGIN_PERCENT;\r\n\t        var height = Math.max(segment.startYVal, segment.endYVal) - Math.min(segment.startYVal, segment.endYVal);\r\n\t        var _a = geometry.vertices, leftTop = _a[0], rightTop = _a[1], leftBottom = _a[2], rightBottom = _a[3];\r\n\t        leftTop.set(-width / 2, height / 2, 0);\r\n\t        rightTop.set(width / 2, height / 2, 0);\r\n\t        leftBottom.set(-width / 2, -height / 2, 0);\r\n\t        rightBottom.set(width / 2, -height / 2, 0);\r\n\t        // prevent to draw bars with height < 1px\r\n\t        if (Utils_1.Utils.getDistance(leftTop.y, leftBottom.y) < 1) {\r\n\t            leftBottom.setY(leftBottom.y + 1);\r\n\t            rightBottom.setY(rightBottom.y + 1);\r\n\t        }\r\n\t        material.color.set(color);\r\n\t        geometry.verticesNeedUpdate = true;\r\n\t        // update lines\r\n\t        var vLineGeometry = this.vLine.geometry;\r\n\t        var vLineMaterial = this.vLine.material;\r\n\t        var lineTop = segment.maxYVal - segment.yVal;\r\n\t        var lineBottom = segment.minYVal - segment.yVal;\r\n\t        vLineGeometry.vertices[0].set(0, lineTop, 0);\r\n\t        vLineGeometry.vertices[1].set(0, lineBottom, 0);\r\n\t        vLineMaterial.color.set(color);\r\n\t        vLineGeometry.verticesNeedUpdate = true;\r\n\t        var hLineGeometry = this.hLine.geometry;\r\n\t        var hLineMaterial = this.hLine.material;\r\n\t        var lineLeft = (-width) / 2;\r\n\t        var lineRight = width / 2;\r\n\t        hLineGeometry.vertices[0].set(lineLeft, 0, 0);\r\n\t        hLineGeometry.vertices[1].set(lineRight, 0, 0);\r\n\t        hLineMaterial.color.set(color);\r\n\t        hLineGeometry.verticesNeedUpdate = true;\r\n\t    };\r\n\t    CandleWidget.prototype.initObject = function () {\r\n\t        this.rect = new Mesh(new PlaneGeometry(1, 1), new MeshBasicMaterial());\r\n\t        var vLineGeometry = new Geometry();\r\n\t        var hLineGeometry = new Geometry();\r\n\t        vLineGeometry.vertices.push(new Vector3(), new Vector3);\r\n\t        hLineGeometry.vertices.push(new Vector3(), new Vector3);\r\n\t        this.vLine = new Line(vLineGeometry, new LineBasicMaterial({ linewidth: 1 }));\r\n\t        this.hLine = new Line(hLineGeometry, new LineBasicMaterial({ linewidth: 1 }));\r\n\t        this.rect.add(this.vLine);\r\n\t        this.rect.add(this.hLine);\r\n\t    };\r\n\t    return CandleWidget;\r\n\t}());\r\n\n\n/***/ },\n/* 31 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar Mesh = THREE.Mesh;\r\n\tvar PlaneBufferGeometry = THREE.PlaneBufferGeometry;\r\n\tvar MeshBasicMaterial = THREE.MeshBasicMaterial;\r\n\tvar TrendsWidget_1 = __webpack_require__(25);\r\n\tvar Trend_1 = __webpack_require__(17);\r\n\t/**\r\n\t * widget adds blinking beacon on trends end\r\n\t * activated when trend.hasBeacon = true\r\n\t */\r\n\tvar TrendsBeaconWidget = (function (_super) {\r\n\t    __extends(TrendsBeaconWidget, _super);\r\n\t    function TrendsBeaconWidget() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    TrendsBeaconWidget.prototype.getTrendWidgetClass = function () {\r\n\t        return TrendBeacon;\r\n\t    };\r\n\t    TrendsBeaconWidget.widgetName = 'TrendsBeacon';\r\n\t    return TrendsBeaconWidget;\r\n\t}(TrendsWidget_1.TrendsWidget));\r\n\texports.TrendsBeaconWidget = TrendsBeaconWidget;\r\n\tvar TrendBeacon = (function (_super) {\r\n\t    __extends(TrendBeacon, _super);\r\n\t    function TrendBeacon(state, trendName) {\r\n\t        _super.call(this, state, trendName);\r\n\t        this.initObject();\r\n\t        if (state.data.animations.enabled) {\r\n\t            this.animate();\r\n\t        }\r\n\t        this.updatePosition();\r\n\t    }\r\n\t    TrendBeacon.widgetIsEnabled = function (trendOptions) {\r\n\t        return trendOptions.enabled && trendOptions.hasBeacon && trendOptions.type == Trend_1.TREND_TYPE.LINE;\r\n\t    };\r\n\t    TrendBeacon.prototype.getObject3D = function () {\r\n\t        return this.mesh;\r\n\t    };\r\n\t    TrendBeacon.prototype.onTrendChange = function () {\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendBeacon.prototype.bindEvents = function () {\r\n\t        var _this = this;\r\n\t        _super.prototype.bindEvents.call(this);\r\n\t        this.bindEvent(this.chartState.onScroll(function () { return _this.updatePosition(); }));\r\n\t        this.bindEvent(this.chartState.onChange(function (changedProps) { return _this.onStateChange(changedProps); }));\r\n\t        this.bindEvent(this.chartState.onDestroy(function () { return _this.stopAnimation(); }));\r\n\t    };\r\n\t    TrendBeacon.prototype.initObject = function () {\r\n\t        // add beacon\r\n\t        var light = this.mesh = new Mesh(new PlaneBufferGeometry(32, 32), new MeshBasicMaterial({ map: TrendBeacon.createTexture(), transparent: true }));\r\n\t        light.scale.set(0.2, 0.2, 1);\r\n\t        // add dot\r\n\t        light.add(new Mesh(new PlaneBufferGeometry(5, 5), new MeshBasicMaterial({ map: TrendBeacon.createTexture() })));\r\n\t        this.segment = this.trend.segments.getEndSegment();\r\n\t    };\r\n\t    TrendBeacon.prototype.animate = function () {\r\n\t        var _this = this;\r\n\t        this.animated = true;\r\n\t        var object = this.mesh;\r\n\t        var animationObject = {\r\n\t            scale: object.scale.x,\r\n\t            opacity: object.material.opacity\r\n\t        };\r\n\t        this.mesh.scale.set(0.1, 0.1, 1);\r\n\t        setTimeout(function () {\r\n\t            var animation = _this.animation = TweenLite.to(animationObject, 1, { scale: 1, opacity: 0 });\r\n\t            animation.eventCallback('onUpdate', function () {\r\n\t                object.scale.set(animationObject.scale, animationObject.scale, 1);\r\n\t                object.material.opacity = animationObject.opacity;\r\n\t            }).eventCallback('onComplete', function () {\r\n\t                _this.animation && animation.restart();\r\n\t            });\r\n\t        }, 500);\r\n\t    };\r\n\t    TrendBeacon.prototype.stopAnimation = function () {\r\n\t        this.animated = false;\r\n\t        this.animation && this.animation.kill();\r\n\t        this.animation = null;\r\n\t    };\r\n\t    TrendBeacon.createTexture = function () {\r\n\t        var h = 32, w = 32;\r\n\t        return Utils_1.Utils.createTexture(h, w, function (ctx) {\r\n\t            ctx.beginPath();\r\n\t            ctx.arc(w / 2, h / 2, w / 2, 0, 2 * Math.PI, false);\r\n\t            ctx.fillStyle = 'white';\r\n\t            ctx.fill();\r\n\t        });\r\n\t    };\r\n\t    TrendBeacon.prototype.onTransformationFrame = function () {\r\n\t        this.segment = this.trend.segments.getEndSegment();\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendBeacon.prototype.onSegmentsAnimate = function (trendsSegments) {\r\n\t        this.segment = trendsSegments.getEndSegment();\r\n\t        this.updatePosition();\r\n\t    };\r\n\t    TrendBeacon.prototype.onStateChange = function (changedProps) {\r\n\t        if (!changedProps.animations)\r\n\t            return;\r\n\t        if (changedProps.animations.enabled == void 0 || changedProps.animations.enabled == this.animated)\r\n\t            return;\r\n\t        if (changedProps.animations.enabled) {\r\n\t            this.animate();\r\n\t        }\r\n\t        else {\r\n\t            this.stopAnimation();\r\n\t        }\r\n\t    };\r\n\t    TrendBeacon.prototype.updatePosition = function () {\r\n\t        var state = this.chartState;\r\n\t        var xVal, yVal;\r\n\t        var currentAnimationState = this.segment.currentAnimationState;\r\n\t        if (this.trend.getOptions().type == Trend_1.TREND_TYPE.LINE) {\r\n\t            xVal = currentAnimationState.endXVal;\r\n\t            yVal = currentAnimationState.endYVal;\r\n\t        }\r\n\t        else {\r\n\t            xVal = currentAnimationState.xVal;\r\n\t            yVal = currentAnimationState.endYVal;\r\n\t        }\r\n\t        var endPointVector = state.screen.getPointOnChart(xVal, yVal);\r\n\t        var screenWidth = state.data.width;\r\n\t        var x = endPointVector.x;\r\n\t        var screenX = state.screen.getScreenXByPoint(endPointVector.x);\r\n\t        if (screenX < 0)\r\n\t            x = state.screen.getPointByScreenX(0);\r\n\t        if (screenX > screenWidth)\r\n\t            x = state.screen.getPointByScreenX(screenWidth);\r\n\t        this.mesh.position.set(x, endPointVector.y, 0.1);\r\n\t    };\r\n\t    return TrendBeacon;\r\n\t}(TrendsWidget_1.TrendWidget));\r\n\texports.TrendBeacon = TrendBeacon;\r\n\n\n/***/ },\n/* 32 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tfunction __export(m) {\r\n\t    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n\t}\r\n\t__export(__webpack_require__(3));\r\n\n\n/***/ },\n/* 33 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar Utils_1 = __webpack_require__(14);\r\n\tvar EventEmmiter_1 = __webpack_require__(13);\r\n\texports.DEFAULT_CONFIG = {\r\n\t    installPluginWidgets: true\r\n\t};\r\n\t/**\r\n\t * base class for all plugins\r\n\t * NAME is mandatory\r\n\t */\r\n\tvar ChartPlugin = (function () {\r\n\t    function ChartPlugin(options, config) {\r\n\t        if (config === void 0) { config = {}; }\r\n\t        this.unsubscribers = [];\r\n\t        this.initialState = options;\r\n\t        this.config = Utils_1.Utils.deepMerge(exports.DEFAULT_CONFIG, config);\r\n\t        this.name = this.constructor.NAME;\r\n\t        if (!this.name)\r\n\t            Utils_1.Utils.error('Unnamed plugin detected');\r\n\t    }\r\n\t    ChartPlugin.prototype.setupChartState = function (chartState) {\r\n\t        var _this = this;\r\n\t        this.chartState = chartState;\r\n\t        this.ee = new EventEmmiter_1.EventEmitter();\r\n\t        this.bindEvent(this.chartState.onInitialStateApplied(function (initialState) { return _this.onInitialStateAppliedHandler(initialState); }), this.chartState.onReady(function () { return _this.onChartReadyHandler(); }), this.chartState.onDestroy(function () { return _this.onDestroyHandler(); }), this.chartState.onPluginsStateChange(function (changedPluginsStates) { return changedPluginsStates[_this.name] && _this.onStateChanged(changedPluginsStates[_this.name]); }));\r\n\t    };\r\n\t    ChartPlugin.prototype.getOptions = function () {\r\n\t        return this.chartState.data.pluginsState[this.name];\r\n\t    };\r\n\t    ChartPlugin.prototype.onInitialStateAppliedHandler = function (initialState) {\r\n\t    };\r\n\t    ChartPlugin.prototype.onChartReadyHandler = function () {\r\n\t    };\r\n\t    ChartPlugin.prototype.onStateChanged = function (changedState) {\r\n\t    };\r\n\t    ChartPlugin.prototype.onDestroyHandler = function () {\r\n\t        this.ee.removeAllListeners();\r\n\t    };\r\n\t    ChartPlugin.prototype.bindEvent = function () {\r\n\t        var args = [];\r\n\t        for (var _i = 0; _i < arguments.length; _i++) {\r\n\t            args[_i - 0] = arguments[_i];\r\n\t        }\r\n\t        var unsubscribers = [];\r\n\t        if (!Array.isArray(args[0])) {\r\n\t            unsubscribers.push(args[0]);\r\n\t        }\r\n\t        else {\r\n\t            unsubscribers.push.apply(unsubscribers, (args));\r\n\t        }\r\n\t        (_a = this.unsubscribers).push.apply(_a, unsubscribers);\r\n\t        var _a;\r\n\t    };\r\n\t    ChartPlugin.prototype.unbindEvents = function () {\r\n\t        this.unsubscribers.forEach(function (unsubscriber) { return unsubscriber(); });\r\n\t        this.unsubscribers.length = 0;\r\n\t    };\r\n\t    ChartPlugin.NAME = '';\r\n\t    ChartPlugin.pluginWidgets = [];\r\n\t    return ChartPlugin;\r\n\t}());\r\n\texports.ChartPlugin = ChartPlugin;\r\n\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** ThreeChart.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 1b961503305d2600f90b\n **/","export * from './src/index';\n\n\n/** WEBPACK FOOTER **\n ** ./index.ts\n **/","export * from './Chart';\nexport * from './interfaces';\nexport * from './AxisMarks';\nexport * from './Screen';\nexport * from './State';\nexport * from './Trend';\nexport * from './TrendSegments';\nexport * from './TrendsManager';\nexport * from './Utils';\nexport * from './Widget';\nexport * from './Plugin';\nexport * from './widgets/TrendsWidget';\n\n\n/** WEBPACK FOOTER **\n ** ./src/index.ts\n **/","// deps must be always on top\nimport { ChartPlugin } from './Plugin';\nrequire('./deps/deps');\n\nimport { Trend } from \"./Trend\";\nimport Vector3 = THREE.Vector3;\nimport PerspectiveCamera = THREE.PerspectiveCamera;\nimport Renderer = THREE.Renderer;\nimport Scene = THREE.Scene;\nimport WebGLRenderer = THREE.WebGLRenderer;\nimport Object3D = THREE.Object3D;\nimport { ChartState, IChartState } from \"./State\";\nimport { ChartWidget, IChartWidgetConstructor } from \"./Widget\";\nimport { Utils } from \"./Utils\";\nimport { IScreenTransformOptions } from \"./Screen\";\nimport { AxisWidget } from \"./widgets/AxisWidget\";\nimport { GridWidget } from \"./widgets/GridWidget\";\nimport { TrendsGradientWidget } from \"./widgets/TrendsGradientWidget\";\nimport { TrendsLoadingWidget } from \"./widgets/TrendsLoadingWidget\";\nimport { AxisMarksWidget } from \"./widgets/AxisMarksWidget\";\nimport { BorderWidget } from \"./widgets/BorderWidget\";\nimport { TrendsIndicatorWidget } from \"./widgets/TrendsIndicatorWidget\";\nimport { TrendsLineWidget } from \"./widgets/TrendsLineWidget\";\nimport { TrendsCandlesWidget } from './widgets/TrendsCandleWidget';\nimport { TrendsBeaconWidget } from \"./widgets/TrendsBeaconWidget\";\nimport { ResizeSensor, ResizeSensorType } from './deps';\n\n\nexport const MAX_DATA_LENGTH = 2692000;\n\nexport class Chart {\n\tstate: ChartState;\n\tisStopped: boolean;\n\tisDestroyed: boolean;\n\tprivate $container: Element;\n\tprivate $el: HTMLElement;\n\tprivate renderer: Renderer;\n\tprivate scene: Scene;\n\tprivate camera: PerspectiveCamera;\n\tprivate cameraInitialPosition: Vector3;\n\tprivate widgets: Array<ChartWidget> = [];\n\tprivate stats: Stats;\n\tprivate zoomThrottled: Function;\n\tprivate unsubscribers: Function[];\n\tprivate resizeSensor: ResizeSensorType;\n\n\tstatic devicePixelRatio = window.devicePixelRatio;\n\tstatic installedWidgets: {[name: string]: typeof ChartWidget} = {};\n\tstatic renderers: {[rendererName: string]: Renderer} = {\n\t\tCanvasRenderer: (THREE as any).CanvasRenderer,\n\t\tWebGLRenderer: THREE.WebGLRenderer\n\t};\n\n\tconstructor(state: IChartState, $container: Element, plugins: ChartPlugin[] = []) {\n\n\t\tif (!THREE || !THREE.REVISION) Utils.error('three.js not found');\n\n\t\tif (!$container) {\n\t\t\tUtils.error('$el must be set');\n\t\t}\n\t\t// calculate chart size\n\t\tlet style = getComputedStyle($container);\n\t\tstate.width = parseInt(style.width);\n\t\tstate.height = parseInt(style.height);\n\n\t\tthis.state = new ChartState(state, Chart.installedWidgets, plugins);\n\t\tthis.zoomThrottled = Utils.throttle((zoomValue: number, origin: number) => this.zoom(zoomValue, origin), 200);\n\t\tthis.$container = $container;\n\t\tthis.init($container);\n\t};\n\n\tstatic installWidget<WidgetClass extends typeof ChartWidget>(Widget: WidgetClass) {\n\t\tif (!Widget.widgetName) {\n\t\t\tUtils.error('unnamed widget');\n\t\t}\n\t\tthis.installedWidgets[Widget.widgetName] = Widget;\n\t}\n\n\tprivate init($container: Element) {\n\t\tvar state = this.state;\n\t\tvar {width: w, height: h, showStats, autoRender} = state.data;\n\t\tthis.scene = new THREE.Scene();\n\t\tthis.isStopped = !autoRender.enabled;\n\n\t\tvar renderer = this.renderer = new (Chart.renderers[this.state.data.renderer] as any)({\n\t\t\tantialias: true,\n\t\t\talpha: true\n\t\t});\n\t\trenderer.setPixelRatio(Chart.devicePixelRatio);\n\t\trenderer.setClearColor(state.data.backgroundColor, state.data.backgroundOpacity);\n\t\trenderer.setSize(w, h);\n\t\t$container.appendChild(renderer.domElement);\n\t\tthis.$el = renderer.domElement;\n\t\tthis.$el.style.display = 'block';\n\n\t\tif (showStats) {\n\t\t\tthis.stats = new Stats();\n\t\t\t$container.appendChild(this.stats.domElement);\n\t\t}\n\n\t\tthis.setupCamera();\n\n\t\t// init widgets\n\t\tlet widgetsClasses = this.state.widgetsClasses;\n\t\tfor (let widgetName in widgetsClasses) {\n\t\t\tlet widgetOptions = this.state.data.widgets[widgetName];\n\t\t\tif (!widgetOptions.enabled) continue;\n\t\t\tlet WidgetConstructor = widgetsClasses[widgetName] as IChartWidgetConstructor;\n\t\t\tlet widget = new WidgetConstructor(this.state);\n\t\t\tthis.scene.add(widget.getObject3D());\n\t\t\tthis.widgets.push(widget);\n\t\t}\n\n\t\tthis.bindEvents();\n\t\tthis.renderLoop();\n\t}\n\n\tprivate renderLoop() {\n\t\tif (this.isDestroyed) return;\n\t\tthis.stats && this.stats.begin();\n\t\tthis.render();\n\t\tif (this.isStopped) return;\n\t\tvar fpsLimit = this.state.data.autoRender.fps;\n\n\t\tif (fpsLimit) {\n\t\t\tlet delay = 1000 / fpsLimit;\n\t\t\tsetTimeout(() => requestAnimationFrame(() => this.renderLoop()), delay);\n\t\t} else {\n\t\t\trequestAnimationFrame(() => this.renderLoop());\n\t\t}\n\t\tthis.stats && this.stats.end();\n\t}\n\n\trender() {\n\t\tthis.renderer.render(this.scene, this.camera);\n\t}\n\n\tstop() {\n\t\tthis.isStopped = true;\n\t}\n\n\trun() {\n\t\tthis.isStopped = false;\n\t\tthis.renderLoop();\n\t}\n\n\t/**\n\t * call to destroy chart an init garbage collection\n\t */\n\tdestroy() {\n\t\tthis.isDestroyed = true;\n\t\tthis.stop();\n\t\tthis.state.destroy();\n\t\tthis.unbindEvents();\n\t\t// WARNING! undocumented method for free webgl context\n\t\ttry {\n\t\t\t(this.renderer as any).forceContextLoss();\n\t\t} catch (wtf) {\n\t\t\t// sometimes with many chart instances forceContextLoss not working\n\t\t}\n\t\t(this.renderer as any).context = null;\n\t\tthis.renderer.domElement = null;\n\t\tthis.renderer = null;\n\t}\n\n\tgetState(): IChartState {\n\t\treturn this.state.data\n\t}\n\n\t/**\n\t * shortcut for Chart.state.getTrend\n\t */\n\tgetTrend(trendName: string): Trend {\n\t\treturn this.state.getTrend(trendName);\n\t}\n\n\t/**\n\t * shortcut for Chart.state.setState\n\t */\n\tsetState(state: IChartState) {\n\t\treturn this.state.setState(state);\n\t}\n\n\n\tprivate bindEvents() {\n\t\tvar $el = this.$el;\n\t\tif (this.state.data.controls.enabled) {\n\t\t\t$el.addEventListener('mousewheel', (ev: MouseWheelEvent) => {\n\t\t\t\tthis.onMouseWheel(ev)\n\t\t\t});\n\t\t\t$el.addEventListener('mousemove', (ev: MouseEvent) => {\n\t\t\t\tthis.onMouseMove(ev)\n\t\t\t});\n\t\t\t$el.addEventListener('mousedown', (ev: MouseEvent) => this.onMouseDown(ev));\n\t\t\t$el.addEventListener('mouseup', (ev: MouseEvent) => this.onMouseUp(ev));\n\t\t\t$el.addEventListener('touchmove', (ev: TouchEvent) => {\n\t\t\t\tthis.onTouchMove(ev)\n\t\t\t});\n\t\t\t$el.addEventListener('touchend', (ev: TouchEvent) => {\n\t\t\t\tthis.onTouchEnd(ev)\n\t\t\t});\n\t\t}\n\t\tif (this.state.data.autoResize) {\n\t\t\tthis.resizeSensor = new ResizeSensor(this.$container, () => {\n\t\t\t\tthis.onChartContainerResizeHandler(this.$container.clientWidth, this.$container.clientHeight);\n\t\t\t});\n\t\t}\n\n\t\tthis.unsubscribers = [\n\t\t\tthis.state.onTrendsChange(() => this.autoscroll()),\n\t\t\tthis.state.screen.onTransformationFrame((options) => this.onScreenTransformHandler(options)),\n\t\t\tthis.state.onResize((options) => this.onChartResize())\n\t\t];\n\t}\n\n\tprivate unbindEvents() {\n\t\t// TODO: unbind events correctly\n\t\ttry {\n\t\t\tthis.resizeSensor && this.resizeSensor.detach();\n\t\t} catch (e) {\n\t\t\t// ups.. somebody already removed resizeSensor childNode\n\t\t\t// detected in angular2 apps\n\t\t}\n\t\tthis.$el.remove();\n\t\tthis.unsubscribers.forEach(unsubscribe => unsubscribe());\n\t}\n\n\tprivate setupCamera() {\n\t\tlet camSettings = this.state.screen.getCameraSettings();\n\t\tif (!this.camera) {\n\t\t\tthis.camera = new PerspectiveCamera(camSettings.FOV, camSettings.aspect, camSettings.near, camSettings.far);\n\t\t\tthis.scene.add(this.camera);\n\t\t} else {\n\t\t\tthis.camera.fov = camSettings.FOV;\n\t\t\tthis.camera.aspect = camSettings.aspect;\n\t\t\tthis.camera.far = camSettings.far;\n\t\t\tthis.camera.near = camSettings.near;\n\t\t\tthis.camera.updateProjectionMatrix();\n\t\t}\n\t\tthis.camera.position.set(camSettings.x, camSettings.y, camSettings.z);\n\t\tthis.cameraInitialPosition = this.camera.position.clone();\n\t\tthis.onScreenTransformHandler(this.state.screen.options);\n\t}\n\n\tprivate onScreenTransformHandler(options: IScreenTransformOptions) {\n\t\tif (options.scrollX != void 0) {\n\t\t\tlet scrollX = this.cameraInitialPosition.x + options.scrollX;\n\t\t\t// scrollX =  Math.round(scrollX); // prevent to set camera beetween pixels\n\t\t\tthis.camera.position.setX(scrollX);\n\t\t}\n\t\tif (options.scrollY != void 0) {\n\t\t\tlet scrollY = this.cameraInitialPosition.y + options.scrollY;\n\t\t\t// scrollY = Math.round(scrollY); // prevent to set camera beetween pixels\n\t\t\tthis.camera.position.setY(scrollY);\n\t\t}\n\t}\n\n\tprivate autoscroll() {\n\t\tvar state = this.state;\n\t\tif (!state.data.autoScroll) return;\n\t\tvar oldTrendsMaxX = state.data.prevState.computedData.trends.maxXVal;\n\t\tvar trendsMaxXDelta = state.data.computedData.trends.maxXVal - oldTrendsMaxX;\n\t\tif (trendsMaxXDelta > 0) {\n\t\t\tvar maxVisibleX = this.state.screen.getScreenRightVal();\n\t\t\tvar paddingRightX = this.state.getPaddingRight();\n\t\t\tvar currentScroll = state.data.xAxis.range.scroll;\n\t\t\tif (oldTrendsMaxX < paddingRightX || oldTrendsMaxX > maxVisibleX) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar scrollDelta = trendsMaxXDelta;\n\t\t\tthis.setState({xAxis: {range: {scroll: currentScroll + scrollDelta}}});\n\t\t}\n\t}\n\n\tprivate onScrollStop() {\n\t\t// var tendsXMax = this.state.data.computedData.trends.maxX;\n\t\t// var paddingRightX = this.state.getPaddingRight();\n\t\t// if (tendsXMax < paddingRightX) {\n\t\t// \tthis.state.scrollToEnd();\n\t\t// }\n\t}\n\n\tprivate onMouseDown(ev: MouseEvent) {\n\t\tthis.setState({cursor: {dragMode: true, x: ev.clientX, y: ev.clientY}});\n\t}\n\n\tprivate onMouseUp(ev: MouseEvent) {\n\t\tthis.setState({cursor: {dragMode: false}});\n\t}\n\n\tprivate onMouseMove(ev: MouseEvent) {\n\t\tif (this.state.data.cursor.dragMode) {\n\t\t\tthis.setState({cursor: {dragMode: true, x: ev.clientX, y: ev.clientY}});\n\t\t}\n\t}\n\n\tprivate onMouseWheel(ev: MouseWheelEvent) {\n\t\tev.stopPropagation();\n\t\tev.preventDefault();\n\t\tlet zoomOrigin = ev.layerX / this.state.data.width;\n\t\tlet zoomValue = 1 + ev.wheelDeltaY * 0.001;\n\t\tthis.zoom(zoomValue, zoomOrigin);\n\t}\n\n\tprivate onTouchMove(ev: TouchEvent) {\n\t\tthis.setState({cursor: {dragMode: true, x: ev.touches[0].clientX, y: ev.touches[0].clientY}});\n\t}\n\n\tprivate onTouchEnd(ev: TouchEvent) {\n\t\tthis.setState({cursor: {dragMode: false}});\n\t}\n\n\tprivate onChartContainerResizeHandler(width: number, height: number) {\n\t\tthis.setState({width, height});\n\t}\n\n\tprivate onChartResize() {\n\t\tlet {width, height} = this.state.data;\n\t\tthis.renderer.setSize(width, height);\n\t\tthis.setupCamera();\n\t}\n\n\tprivate zoom(zoomValue: number, zoomOrigin: number) {\n\t\tconst MAX_ZOOM_VALUE = 1.5;\n\t\tconst MIN_ZOOM_VALUE = 0.7;\n\t\tzoomValue = Math.min(zoomValue, MAX_ZOOM_VALUE);\n\t\tzoomValue = Math.max(zoomValue, MIN_ZOOM_VALUE);\n\t\tlet autoScrollIsEnabled = this.state.data.autoScroll;\n\t\tif (autoScrollIsEnabled) this.state.setState({autoScroll: false});\n\t\tthis.state.zoom(zoomValue, zoomOrigin).then(() => {\n\t\t\tif (autoScrollIsEnabled) this.setState({autoScroll: true});\n\t\t});\n\t}\n\n\t/**\n\t * creates simple chart without animations and minimal widgets set\n\t */\n\tstatic createPreviewChart(userOptions: IChartState, $el: Element): Chart {\n\t\tvar previewChartOptions: IChartState = {\n\t\t\tanimations: {enabled: false},\n\t\t\twidgets: {\n\t\t\t\tGrid: {enabled: false},\n\t\t\t\tAxis: {enabled: false},\n\t\t\t\tTrendsGradient: {enabled: false}\n\t\t\t}\n\t\t};\n\t\tvar options = Utils.deepMerge(userOptions, previewChartOptions);\n\t\treturn new Chart(options, $el);\n\t}\n\n\n}\n\n// install built-in widgets\nChart.installWidget(TrendsLineWidget);\nChart.installWidget(TrendsCandlesWidget);\nChart.installWidget(AxisWidget);\nChart.installWidget(GridWidget);\nChart.installWidget(TrendsBeaconWidget);\nChart.installWidget(TrendsIndicatorWidget);\n// Chart.installWidget(TrendsGradientWidget);\nChart.installWidget(TrendsLoadingWidget);\nChart.installWidget(AxisMarksWidget);\nChart.installWidget(BorderWidget);\n\n\n/** WEBPACK FOOTER **\n ** ./src/Chart.ts\n **/","/// <reference path=\"./ResizeSensor.ts\" />\n\n// TODO: think about different bundles\n\nimport { ResizeSensorType } from './ResizeSensor';\n(<any>window).Stats = require('three/examples/js/libs/stats.min');\n\n//require('gsap/src/uncompressed/easing/EasePack.js');\nrequire('three/examples/js/renderers/CanvasRenderer.js');\nrequire('three/examples/js/renderers/Projector.js');\nexport const isPlainObject = require('is-plain-object') as Function;\nexport const EE2 = require('EventEmitter2') as typeof EventEmitter2;\n\n\nexport { Promise } from '../polyfills/es6-promise';\n\nexport * from './ResizeSensor';\nexport const ResizeSensor = require('css-element-queries/src/ResizeSensor') as ResizeSensorType;\n\n\n/** WEBPACK FOOTER **\n ** ./src/deps/deps.ts\n **/","// stats.js - http://github.com/mrdoob/stats.js\r\nvar Stats=function(){function h(a){c.appendChild(a.dom);return a}function k(a){for(var d=0;d<c.children.length;d++)c.children[d].style.display=d===a?\"block\":\"none\";l=a}var l=0,c=document.createElement(\"div\");c.style.cssText=\"position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000\";c.addEventListener(\"click\",function(a){a.preventDefault();k(++l%c.children.length)},!1);var g=(performance||Date).now(),e=g,a=0,r=h(new Stats.Panel(\"FPS\",\"#0ff\",\"#002\")),f=h(new Stats.Panel(\"MS\",\"#0f0\",\"#020\"));\r\nif(self.performance&&self.performance.memory)var t=h(new Stats.Panel(\"MB\",\"#f08\",\"#201\"));k(0);return{REVISION:16,dom:c,addPanel:h,showPanel:k,begin:function(){g=(performance||Date).now()},end:function(){a++;var c=(performance||Date).now();f.update(c-g,200);if(c>e+1E3&&(r.update(1E3*a/(c-e),100),e=c,a=0,t)){var d=performance.memory;t.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return c},update:function(){g=this.end()},domElement:c,setMode:k}};\r\nStats.Panel=function(h,k,l){var c=Infinity,g=0,e=Math.round,a=e(window.devicePixelRatio||1),r=80*a,f=48*a,t=3*a,u=2*a,d=3*a,m=15*a,n=74*a,p=30*a,q=document.createElement(\"canvas\");q.width=r;q.height=f;q.style.cssText=\"width:80px;height:48px\";var b=q.getContext(\"2d\");b.font=\"bold \"+9*a+\"px Helvetica,Arial,sans-serif\";b.textBaseline=\"top\";b.fillStyle=l;b.fillRect(0,0,r,f);b.fillStyle=k;b.fillText(h,t,u);b.fillRect(d,m,n,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d,m,n,p);return{dom:q,update:function(f,\r\nv){c=Math.min(c,f);g=Math.max(g,f);b.fillStyle=l;b.globalAlpha=1;b.fillRect(0,0,r,m);b.fillStyle=k;b.fillText(e(f)+\" \"+h+\" (\"+e(c)+\"-\"+e(g)+\")\",t,u);b.drawImage(q,d+a,m,n-a,p,d,m,n-a,p);b.fillRect(d+n-a,m,a,p);b.fillStyle=l;b.globalAlpha=.9;b.fillRect(d+n-a,m,a,e((1-f/v)*p))}}};\"object\"===typeof module&&(module.exports=Stats);\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/three/examples/js/libs/stats.min.js\n ** module id = 4\n ** module chunks = 0\n **/","/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nTHREE.SpriteCanvasMaterial = function ( parameters ) {\r\n\r\n\tTHREE.Material.call( this );\r\n\r\n\tthis.type = 'SpriteCanvasMaterial';\r\n\r\n\tthis.color = new THREE.Color( 0xffffff );\r\n\tthis.program = function ( context, color ) {};\r\n\r\n\tthis.setValues( parameters );\r\n\r\n};\r\n\r\nTHREE.SpriteCanvasMaterial.prototype = Object.create( THREE.Material.prototype );\r\nTHREE.SpriteCanvasMaterial.prototype.constructor = THREE.SpriteCanvasMaterial;\r\n\r\nTHREE.SpriteCanvasMaterial.prototype.clone = function () {\r\n\r\n\tvar material = new THREE.SpriteCanvasMaterial();\r\n\r\n\tmaterial.copy( this );\r\n\tmaterial.color.copy( this.color );\r\n\tmaterial.program = this.program;\r\n\r\n\treturn material;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.CanvasRenderer = function ( parameters ) {\r\n\r\n\tconsole.log( 'THREE.CanvasRenderer', THREE.REVISION );\r\n\r\n\tparameters = parameters || {};\r\n\r\n\tvar _this = this,\r\n\t_renderData, _elements, _lights,\r\n\t_projector = new THREE.Projector(),\r\n\r\n\t_canvas = parameters.canvas !== undefined\r\n\t\t\t ? parameters.canvas\r\n\t\t\t : document.createElement( 'canvas' ),\r\n\r\n\t_canvasWidth = _canvas.width,\r\n\t_canvasHeight = _canvas.height,\r\n\t_canvasWidthHalf = Math.floor( _canvasWidth / 2 ),\r\n\t_canvasHeightHalf = Math.floor( _canvasHeight / 2 ),\r\n\r\n\t_viewportX = 0,\r\n\t_viewportY = 0,\r\n\t_viewportWidth = _canvasWidth,\r\n\t_viewportHeight = _canvasHeight,\r\n\r\n\t_pixelRatio = 1,\r\n\r\n\t_context = _canvas.getContext( '2d', {\r\n\t\talpha: parameters.alpha === true\r\n\t} ),\r\n\r\n\t_clearColor = new THREE.Color( 0x000000 ),\r\n\t_clearAlpha = parameters.alpha === true ? 0 : 1,\r\n\r\n\t_contextGlobalAlpha = 1,\r\n\t_contextGlobalCompositeOperation = 0,\r\n\t_contextStrokeStyle = null,\r\n\t_contextFillStyle = null,\r\n\t_contextLineWidth = null,\r\n\t_contextLineCap = null,\r\n\t_contextLineJoin = null,\r\n\t_contextLineDash = [],\r\n\r\n\t_camera,\r\n\r\n\t_v1, _v2, _v3, _v4,\r\n\t_v5 = new THREE.RenderableVertex(),\r\n\t_v6 = new THREE.RenderableVertex(),\r\n\r\n\t_v1x, _v1y, _v2x, _v2y, _v3x, _v3y,\r\n\t_v4x, _v4y, _v5x, _v5y, _v6x, _v6y,\r\n\r\n\t_color = new THREE.Color(),\r\n\t_color1 = new THREE.Color(),\r\n\t_color2 = new THREE.Color(),\r\n\t_color3 = new THREE.Color(),\r\n\t_color4 = new THREE.Color(),\r\n\r\n\t_diffuseColor = new THREE.Color(),\r\n\t_emissiveColor = new THREE.Color(),\r\n\r\n\t_lightColor = new THREE.Color(),\r\n\r\n\t_patterns = {},\r\n\r\n\t_image, _uvs,\r\n\t_uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y,\r\n\r\n\t_clipBox = new THREE.Box2(),\r\n\t_clearBox = new THREE.Box2(),\r\n\t_elemBox = new THREE.Box2(),\r\n\r\n\t_ambientLight = new THREE.Color(),\r\n\t_directionalLights = new THREE.Color(),\r\n\t_pointLights = new THREE.Color(),\r\n\r\n\t_vector3 = new THREE.Vector3(), // Needed for PointLight\r\n\t_centroid = new THREE.Vector3(),\r\n\t_normal = new THREE.Vector3(),\r\n\t_normalViewMatrix = new THREE.Matrix3();\r\n\r\n\t/* TODO\r\n\t_canvas.mozImageSmoothingEnabled = false;\r\n\t_canvas.webkitImageSmoothingEnabled = false;\r\n\t_canvas.msImageSmoothingEnabled = false;\r\n\t_canvas.imageSmoothingEnabled = false;\r\n\t*/\r\n\r\n\t// dash+gap fallbacks for Firefox and everything else\r\n\r\n\tif ( _context.setLineDash === undefined ) {\r\n\r\n\t\t_context.setLineDash = function () {};\r\n\r\n\t}\r\n\r\n\tthis.domElement = _canvas;\r\n\r\n\tthis.autoClear = true;\r\n\tthis.sortObjects = true;\r\n\tthis.sortElements = true;\r\n\r\n\tthis.info = {\r\n\r\n\t\trender: {\r\n\r\n\t\t\tvertices: 0,\r\n\t\t\tfaces: 0\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// WebGLRenderer compatibility\r\n\r\n\tthis.supportsVertexTextures = function () {};\r\n\tthis.setFaceCulling = function () {};\r\n\r\n\t// API\r\n\r\n\tthis.getContext = function () {\r\n\r\n\t\treturn _context;\r\n\r\n\t};\r\n\r\n\tthis.getContextAttributes = function () {\r\n\r\n\t\treturn _context.getContextAttributes();\r\n\r\n\t};\r\n\r\n\tthis.getPixelRatio = function () {\r\n\r\n\t\treturn _pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setPixelRatio = function ( value ) {\r\n\r\n\t\tif ( value !== undefined ) _pixelRatio = value;\r\n\r\n\t};\r\n\r\n\tthis.setSize = function ( width, height, updateStyle ) {\r\n\r\n\t\t_canvasWidth = width * _pixelRatio;\r\n\t\t_canvasHeight = height * _pixelRatio;\r\n\r\n\t\t_canvas.width = _canvasWidth;\r\n\t\t_canvas.height = _canvasHeight;\r\n\r\n\t\t_canvasWidthHalf = Math.floor( _canvasWidth / 2 );\r\n\t\t_canvasHeightHalf = Math.floor( _canvasHeight / 2 );\r\n\r\n\t\tif ( updateStyle !== false ) {\r\n\r\n\t\t\t_canvas.style.width = width + 'px';\r\n\t\t\t_canvas.style.height = height + 'px';\r\n\r\n\t\t}\r\n\r\n\t\t_clipBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t_clipBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\r\n\t\t_clearBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t_clearBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\r\n\t\t_contextGlobalAlpha = 1;\r\n\t\t_contextGlobalCompositeOperation = 0;\r\n\t\t_contextStrokeStyle = null;\r\n\t\t_contextFillStyle = null;\r\n\t\t_contextLineWidth = null;\r\n\t\t_contextLineCap = null;\r\n\t\t_contextLineJoin = null;\r\n\r\n\t\tthis.setViewport( 0, 0, width, height );\r\n\r\n\t};\r\n\r\n\tthis.setViewport = function ( x, y, width, height ) {\r\n\r\n\t\t_viewportX = x * _pixelRatio;\r\n\t\t_viewportY = y * _pixelRatio;\r\n\r\n\t\t_viewportWidth = width * _pixelRatio;\r\n\t\t_viewportHeight = height * _pixelRatio;\r\n\r\n\t};\r\n\r\n\tthis.setScissor = function () {};\r\n\tthis.setScissorTest = function () {};\r\n\r\n\tthis.setClearColor = function ( color, alpha ) {\r\n\r\n\t\t_clearColor.set( color );\r\n\t\t_clearAlpha = alpha !== undefined ? alpha : 1;\r\n\r\n\t\t_clearBox.min.set( - _canvasWidthHalf, - _canvasHeightHalf );\r\n\t\t_clearBox.max.set(   _canvasWidthHalf,   _canvasHeightHalf );\r\n\r\n\t};\r\n\r\n\tthis.setClearColorHex = function ( hex, alpha ) {\r\n\r\n\t\tconsole.warn( 'THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.' );\r\n\t\tthis.setClearColor( hex, alpha );\r\n\r\n\t};\r\n\r\n\tthis.getClearColor = function () {\r\n\r\n\t\treturn _clearColor;\r\n\r\n\t};\r\n\r\n\tthis.getClearAlpha = function () {\r\n\r\n\t\treturn _clearAlpha;\r\n\r\n\t};\r\n\r\n\tthis.getMaxAnisotropy = function () {\r\n\r\n\t\treturn 0;\r\n\r\n\t};\r\n\r\n\tthis.clear = function () {\r\n\r\n\t\tif ( _clearBox.isEmpty() === false ) {\r\n\r\n\t\t\t_clearBox.intersect( _clipBox );\r\n\t\t\t_clearBox.expandByScalar( 2 );\r\n\r\n\t\t\t_clearBox.min.x = _clearBox.min.x + _canvasWidthHalf;\r\n\t\t\t_clearBox.min.y =  - _clearBox.min.y + _canvasHeightHalf;\t\t// higher y value !\r\n\t\t\t_clearBox.max.x = _clearBox.max.x + _canvasWidthHalf;\r\n\t\t\t_clearBox.max.y =  - _clearBox.max.y + _canvasHeightHalf;\t\t// lower y value !\r\n\r\n\t\t\tif ( _clearAlpha < 1 ) {\r\n\r\n\t\t\t\t_context.clearRect(\r\n\t\t\t\t\t_clearBox.min.x | 0,\r\n\t\t\t\t\t_clearBox.max.y | 0,\r\n\t\t\t\t\t( _clearBox.max.x - _clearBox.min.x ) | 0,\r\n\t\t\t\t\t( _clearBox.min.y - _clearBox.max.y ) | 0\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( _clearAlpha > 0 ) {\r\n\r\n\t\t\t\tsetBlending( THREE.NormalBlending );\r\n\t\t\t\tsetOpacity( 1 );\r\n\r\n\t\t\t\tsetFillStyle( 'rgba(' + Math.floor( _clearColor.r * 255 ) + ',' + Math.floor( _clearColor.g * 255 ) + ',' + Math.floor( _clearColor.b * 255 ) + ',' + _clearAlpha + ')' );\r\n\r\n\t\t\t\t_context.fillRect(\r\n\t\t\t\t\t_clearBox.min.x | 0,\r\n\t\t\t\t\t_clearBox.max.y | 0,\r\n\t\t\t\t\t( _clearBox.max.x - _clearBox.min.x ) | 0,\r\n\t\t\t\t\t( _clearBox.min.y - _clearBox.max.y ) | 0\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_clearBox.makeEmpty();\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\t// compatibility\r\n\r\n\tthis.clearColor = function () {};\r\n\tthis.clearDepth = function () {};\r\n\tthis.clearStencil = function () {};\r\n\r\n\tthis.render = function ( scene, camera ) {\r\n\r\n\t\tif ( camera instanceof THREE.Camera === false ) {\r\n\r\n\t\t\tconsole.error( 'THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.' );\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.autoClear === true ) this.clear();\r\n\r\n\t\t_this.info.render.vertices = 0;\r\n\t\t_this.info.render.faces = 0;\r\n\r\n\t\t_context.setTransform( _viewportWidth / _canvasWidth, 0, 0, - _viewportHeight / _canvasHeight, _viewportX, _canvasHeight - _viewportY );\r\n\t\t_context.translate( _canvasWidthHalf, _canvasHeightHalf );\r\n\r\n\t\t_renderData = _projector.projectScene( scene, camera, this.sortObjects, this.sortElements );\r\n\t\t_elements = _renderData.elements;\r\n\t\t_lights = _renderData.lights;\r\n\t\t_camera = camera;\r\n\r\n\t\t_normalViewMatrix.getNormalMatrix( camera.matrixWorldInverse );\r\n\r\n\t\t/* DEBUG\r\n\t\tsetFillStyle( 'rgba( 0, 255, 255, 0.5 )' );\r\n\t\t_context.fillRect( _clipBox.min.x, _clipBox.min.y, _clipBox.max.x - _clipBox.min.x, _clipBox.max.y - _clipBox.min.y );\r\n\t\t*/\r\n\r\n\t\tcalculateLights();\r\n\r\n\t\tfor ( var e = 0, el = _elements.length; e < el; e ++ ) {\r\n\r\n\t\t\tvar element = _elements[ e ];\r\n\r\n\t\t\tvar material = element.material;\r\n\r\n\t\t\tif ( material === undefined || material.opacity === 0 ) continue;\r\n\r\n\t\t\t_elemBox.makeEmpty();\r\n\r\n\t\t\tif ( element instanceof THREE.RenderableSprite ) {\r\n\r\n\t\t\t\t_v1 = element;\r\n\t\t\t\t_v1.x *= _canvasWidthHalf; _v1.y *= _canvasHeightHalf;\r\n\r\n\t\t\t\trenderSprite( _v1, element, material );\r\n\r\n\t\t\t} else if ( element instanceof THREE.RenderableLine ) {\r\n\r\n\t\t\t\t_v1 = element.v1; _v2 = element.v2;\r\n\r\n\t\t\t\t_v1.positionScreen.x *= _canvasWidthHalf; _v1.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t_v2.positionScreen.x *= _canvasWidthHalf; _v2.positionScreen.y *= _canvasHeightHalf;\r\n\r\n\t\t\t\t_elemBox.setFromPoints( [\r\n\t\t\t\t\t_v1.positionScreen,\r\n\t\t\t\t\t_v2.positionScreen\r\n\t\t\t\t] );\r\n\r\n\t\t\t\tif ( _clipBox.intersectsBox( _elemBox ) === true ) {\r\n\r\n\t\t\t\t\trenderLine( _v1, _v2, element, material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( element instanceof THREE.RenderableFace ) {\r\n\r\n\t\t\t\t_v1 = element.v1; _v2 = element.v2; _v3 = element.v3;\r\n\r\n\t\t\t\tif ( _v1.positionScreen.z < - 1 || _v1.positionScreen.z > 1 ) continue;\r\n\t\t\t\tif ( _v2.positionScreen.z < - 1 || _v2.positionScreen.z > 1 ) continue;\r\n\t\t\t\tif ( _v3.positionScreen.z < - 1 || _v3.positionScreen.z > 1 ) continue;\r\n\r\n\t\t\t\t_v1.positionScreen.x *= _canvasWidthHalf; _v1.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t_v2.positionScreen.x *= _canvasWidthHalf; _v2.positionScreen.y *= _canvasHeightHalf;\r\n\t\t\t\t_v3.positionScreen.x *= _canvasWidthHalf; _v3.positionScreen.y *= _canvasHeightHalf;\r\n\r\n\t\t\t\tif ( material.overdraw > 0 ) {\r\n\r\n\t\t\t\t\texpand( _v1.positionScreen, _v2.positionScreen, material.overdraw );\r\n\t\t\t\t\texpand( _v2.positionScreen, _v3.positionScreen, material.overdraw );\r\n\t\t\t\t\texpand( _v3.positionScreen, _v1.positionScreen, material.overdraw );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_elemBox.setFromPoints( [\r\n\t\t\t\t\t_v1.positionScreen,\r\n\t\t\t\t\t_v2.positionScreen,\r\n\t\t\t\t\t_v3.positionScreen\r\n\t\t\t\t] );\r\n\r\n\t\t\t\tif ( _clipBox.intersectsBox( _elemBox ) === true ) {\r\n\r\n\t\t\t\t\trenderFace3( _v1, _v2, _v3, 0, 1, 2, element, material );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t/* DEBUG\r\n\t\t\tsetLineWidth( 1 );\r\n\t\t\tsetStrokeStyle( 'rgba( 0, 255, 0, 0.5 )' );\r\n\t\t\t_context.strokeRect( _elemBox.min.x, _elemBox.min.y, _elemBox.max.x - _elemBox.min.x, _elemBox.max.y - _elemBox.min.y );\r\n\t\t\t*/\r\n\r\n\t\t\t_clearBox.union( _elemBox );\r\n\r\n\t\t}\r\n\r\n\t\t/* DEBUG\r\n\t\tsetLineWidth( 1 );\r\n\t\tsetStrokeStyle( 'rgba( 255, 0, 0, 0.5 )' );\r\n\t\t_context.strokeRect( _clearBox.min.x, _clearBox.min.y, _clearBox.max.x - _clearBox.min.x, _clearBox.max.y - _clearBox.min.y );\r\n\t\t*/\r\n\r\n\t\t_context.setTransform( 1, 0, 0, 1, 0, 0 );\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tfunction calculateLights() {\r\n\r\n\t\t_ambientLight.setRGB( 0, 0, 0 );\r\n\t\t_directionalLights.setRGB( 0, 0, 0 );\r\n\t\t_pointLights.setRGB( 0, 0, 0 );\r\n\r\n\t\tfor ( var l = 0, ll = _lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = _lights[ l ];\r\n\t\t\tvar lightColor = light.color;\r\n\r\n\t\t\tif ( light instanceof THREE.AmbientLight ) {\r\n\r\n\t\t\t\t_ambientLight.add( lightColor );\r\n\r\n\t\t\t} else if ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\t// for sprites\r\n\r\n\t\t\t\t_directionalLights.add( lightColor );\r\n\r\n\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\t// for sprites\r\n\r\n\t\t\t\t_pointLights.add( lightColor );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction calculateLight( position, normal, color ) {\r\n\r\n\t\tfor ( var l = 0, ll = _lights.length; l < ll; l ++ ) {\r\n\r\n\t\t\tvar light = _lights[ l ];\r\n\r\n\t\t\t_lightColor.copy( light.color );\r\n\r\n\t\t\tif ( light instanceof THREE.DirectionalLight ) {\r\n\r\n\t\t\t\tvar lightPosition = _vector3.setFromMatrixPosition( light.matrixWorld ).normalize();\r\n\r\n\t\t\t\tvar amount = normal.dot( lightPosition );\r\n\r\n\t\t\t\tif ( amount <= 0 ) continue;\r\n\r\n\t\t\t\tamount *= light.intensity;\r\n\r\n\t\t\t\tcolor.add( _lightColor.multiplyScalar( amount ) );\r\n\r\n\t\t\t} else if ( light instanceof THREE.PointLight ) {\r\n\r\n\t\t\t\tvar lightPosition = _vector3.setFromMatrixPosition( light.matrixWorld );\r\n\r\n\t\t\t\tvar amount = normal.dot( _vector3.subVectors( lightPosition, position ).normalize() );\r\n\r\n\t\t\t\tif ( amount <= 0 ) continue;\r\n\r\n\t\t\t\tamount *= light.distance == 0 ? 1 : 1 - Math.min( position.distanceTo( lightPosition ) / light.distance, 1 );\r\n\r\n\t\t\t\tif ( amount == 0 ) continue;\r\n\r\n\t\t\t\tamount *= light.intensity;\r\n\r\n\t\t\t\tcolor.add( _lightColor.multiplyScalar( amount ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderSprite( v1, element, material ) {\r\n\r\n\t\tsetOpacity( material.opacity );\r\n\t\tsetBlending( material.blending );\r\n\r\n\t\tvar scaleX = element.scale.x * _canvasWidthHalf;\r\n\t\tvar scaleY = element.scale.y * _canvasHeightHalf;\r\n\r\n\t\tvar dist = 0.5 * Math.sqrt( scaleX * scaleX + scaleY * scaleY ); // allow for rotated sprite\r\n\t\t_elemBox.min.set( v1.x - dist, v1.y - dist );\r\n\t\t_elemBox.max.set( v1.x + dist, v1.y + dist );\r\n\r\n\t\tif ( material instanceof THREE.SpriteMaterial ) {\r\n\r\n\t\t\tvar texture = material.map;\r\n\r\n\t\t\tif ( texture !== null ) {\r\n\r\n\t\t\t\tvar pattern = _patterns[ texture.id ];\r\n\r\n\t\t\t\tif ( pattern === undefined || pattern.version !== texture.version ) {\r\n\r\n\t\t\t\t\tpattern = textureToPattern( texture );\r\n\t\t\t\t\t_patterns[ texture.id ] = pattern;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( pattern.canvas !== undefined ) {\r\n\r\n\t\t\t\t\tsetFillStyle( pattern.canvas );\r\n\r\n\t\t\t\t\tvar bitmap = texture.image;\r\n\r\n\t\t\t\t\tvar ox = bitmap.width * texture.offset.x;\r\n\t\t\t\t\tvar oy = bitmap.height * texture.offset.y;\r\n\r\n\t\t\t\t\tvar sx = bitmap.width * texture.repeat.x;\r\n\t\t\t\t\tvar sy = bitmap.height * texture.repeat.y;\r\n\r\n\t\t\t\t\tvar cx = scaleX / sx;\r\n\t\t\t\t\tvar cy = scaleY / sy;\r\n\r\n\t\t\t\t\t_context.save();\r\n\t\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t\t_context.translate( - scaleX / 2, - scaleY / 2 );\r\n\t\t\t\t\t_context.scale( cx, cy );\r\n\t\t\t\t\t_context.translate( - ox, - oy );\r\n\t\t\t\t\t_context.fillRect( ox, oy, sx, sy );\r\n\t\t\t\t\t_context.restore();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// no texture\r\n\r\n\t\t\t\tsetFillStyle( material.color.getStyle() );\r\n\r\n\t\t\t\t_context.save();\r\n\t\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t\t_context.scale( scaleX, - scaleY );\r\n\t\t\t\t_context.fillRect( - 0.5, - 0.5, 1, 1 );\r\n\t\t\t\t_context.restore();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material instanceof THREE.SpriteCanvasMaterial ) {\r\n\r\n\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\t\tsetFillStyle( material.color.getStyle() );\r\n\r\n\t\t\t_context.save();\r\n\t\t\t_context.translate( v1.x, v1.y );\r\n\t\t\tif ( material.rotation !== 0 ) _context.rotate( material.rotation );\r\n\t\t\t_context.scale( scaleX, scaleY );\r\n\r\n\t\t\tmaterial.program( _context );\r\n\r\n\t\t\t_context.restore();\r\n\r\n\t\t}\r\n\r\n\t\t/* DEBUG\r\n\t\tsetStrokeStyle( 'rgb(255,255,0)' );\r\n\t\t_context.beginPath();\r\n\t\t_context.moveTo( v1.x - 10, v1.y );\r\n\t\t_context.lineTo( v1.x + 10, v1.y );\r\n\t\t_context.moveTo( v1.x, v1.y - 10 );\r\n\t\t_context.lineTo( v1.x, v1.y + 10 );\r\n\t\t_context.stroke();\r\n\t\t*/\r\n\r\n\t}\r\n\r\n\tfunction renderLine( v1, v2, element, material ) {\r\n\r\n\t\tsetOpacity( material.opacity );\r\n\t\tsetBlending( material.blending );\r\n\r\n\t\t_context.beginPath();\r\n\t\t_context.moveTo( v1.positionScreen.x, v1.positionScreen.y );\r\n\t\t_context.lineTo( v2.positionScreen.x, v2.positionScreen.y );\r\n\r\n\t\tif ( material instanceof THREE.LineBasicMaterial ) {\r\n\r\n\t\t\tsetLineWidth( material.linewidth );\r\n\t\t\tsetLineCap( material.linecap );\r\n\t\t\tsetLineJoin( material.linejoin );\r\n\r\n\t\t\tif ( material.vertexColors !== THREE.VertexColors ) {\r\n\r\n\t\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tvar colorStyle1 = element.vertexColors[ 0 ].getStyle();\r\n\t\t\t\tvar colorStyle2 = element.vertexColors[ 1 ].getStyle();\r\n\r\n\t\t\t\tif ( colorStyle1 === colorStyle2 ) {\r\n\r\n\t\t\t\t\tsetStrokeStyle( colorStyle1 );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\ttry {\r\n\r\n\t\t\t\t\t\tvar grad = _context.createLinearGradient(\r\n\t\t\t\t\t\t\tv1.positionScreen.x,\r\n\t\t\t\t\t\t\tv1.positionScreen.y,\r\n\t\t\t\t\t\t\tv2.positionScreen.x,\r\n\t\t\t\t\t\t\tv2.positionScreen.y\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tgrad.addColorStop( 0, colorStyle1 );\r\n\t\t\t\t\t\tgrad.addColorStop( 1, colorStyle2 );\r\n\r\n\t\t\t\t\t} catch ( exception ) {\r\n\r\n\t\t\t\t\t\tgrad = colorStyle1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tsetStrokeStyle( grad );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_context.stroke();\r\n\t\t\t_elemBox.expandByScalar( material.linewidth * 2 );\r\n\r\n\t\t} else if ( material instanceof THREE.LineDashedMaterial ) {\r\n\r\n\t\t\tsetLineWidth( material.linewidth );\r\n\t\t\tsetLineCap( material.linecap );\r\n\t\t\tsetLineJoin( material.linejoin );\r\n\t\t\tsetStrokeStyle( material.color.getStyle() );\r\n\t\t\tsetLineDash( [ material.dashSize, material.gapSize ] );\r\n\r\n\t\t\t_context.stroke();\r\n\r\n\t\t\t_elemBox.expandByScalar( material.linewidth * 2 );\r\n\r\n\t\t\tsetLineDash( [] );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction renderFace3( v1, v2, v3, uv1, uv2, uv3, element, material ) {\r\n\r\n\t\t_this.info.render.vertices += 3;\r\n\t\t_this.info.render.faces ++;\r\n\r\n\t\tsetOpacity( material.opacity );\r\n\t\tsetBlending( material.blending );\r\n\r\n\t\t_v1x = v1.positionScreen.x; _v1y = v1.positionScreen.y;\r\n\t\t_v2x = v2.positionScreen.x; _v2y = v2.positionScreen.y;\r\n\t\t_v3x = v3.positionScreen.x; _v3y = v3.positionScreen.y;\r\n\r\n\t\tdrawTriangle( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y );\r\n\r\n\t\tif ( ( material instanceof THREE.MeshLambertMaterial || material instanceof THREE.MeshPhongMaterial ) && material.map === null ) {\r\n\r\n\t\t\t_diffuseColor.copy( material.color );\r\n\t\t\t_emissiveColor.copy( material.emissive );\r\n\r\n\t\t\tif ( material.vertexColors === THREE.FaceColors ) {\r\n\r\n\t\t\t\t_diffuseColor.multiply( element.color );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_color.copy( _ambientLight );\r\n\r\n\t\t\t_centroid.copy( v1.positionWorld ).add( v2.positionWorld ).add( v3.positionWorld ).divideScalar( 3 );\r\n\r\n\t\t\tcalculateLight( _centroid, element.normalModel, _color );\r\n\r\n\t\t\t_color.multiply( _diffuseColor ).add( _emissiveColor );\r\n\r\n\t\t\tmaterial.wireframe === true\r\n\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t : fillPath( _color );\r\n\r\n\t\t} else if ( material instanceof THREE.MeshBasicMaterial ||\r\n\t\t\t\t    material instanceof THREE.MeshLambertMaterial ||\r\n\t\t\t\t    material instanceof THREE.MeshPhongMaterial ) {\r\n\r\n\t\t\tif ( material.map !== null ) {\r\n\r\n\t\t\t\tvar mapping = material.map.mapping;\r\n\r\n\t\t\t\tif ( mapping === THREE.UVMapping ) {\r\n\r\n\t\t\t\t\t_uvs = element.uvs;\r\n\t\t\t\t\tpatternPath( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uvs[ uv1 ].x, _uvs[ uv1 ].y, _uvs[ uv2 ].x, _uvs[ uv2 ].y, _uvs[ uv3 ].x, _uvs[ uv3 ].y, material.map );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( material.envMap !== null ) {\r\n\r\n\t\t\t\tif ( material.envMap.mapping === THREE.SphericalReflectionMapping ) {\r\n\r\n\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv1 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t_uv1x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t_uv1y = 0.5 * _normal.y + 0.5;\r\n\r\n\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv2 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t_uv2x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t_uv2y = 0.5 * _normal.y + 0.5;\r\n\r\n\t\t\t\t\t_normal.copy( element.vertexNormalsModel[ uv3 ] ).applyMatrix3( _normalViewMatrix );\r\n\t\t\t\t\t_uv3x = 0.5 * _normal.x + 0.5;\r\n\t\t\t\t\t_uv3y = 0.5 * _normal.y + 0.5;\r\n\r\n\t\t\t\t\tpatternPath( _v1x, _v1y, _v2x, _v2y, _v3x, _v3y, _uv1x, _uv1y, _uv2x, _uv2y, _uv3x, _uv3y, material.envMap );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_color.copy( material.color );\r\n\r\n\t\t\t\tif ( material.vertexColors === THREE.FaceColors ) {\r\n\r\n\t\t\t\t\t_color.multiply( element.color );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterial.wireframe === true\r\n\t\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t\t : fillPath( _color );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( material instanceof THREE.MeshNormalMaterial ) {\r\n\r\n\t\t\t_normal.copy( element.normalModel ).applyMatrix3( _normalViewMatrix );\r\n\r\n\t\t\t_color.setRGB( _normal.x, _normal.y, _normal.z ).multiplyScalar( 0.5 ).addScalar( 0.5 );\r\n\r\n\t\t\tmaterial.wireframe === true\r\n\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t : fillPath( _color );\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_color.setRGB( 1, 1, 1 );\r\n\r\n\t\t\tmaterial.wireframe === true\r\n\t\t\t\t ? strokePath( _color, material.wireframeLinewidth, material.wireframeLinecap, material.wireframeLinejoin )\r\n\t\t\t\t : fillPath( _color );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction drawTriangle( x0, y0, x1, y1, x2, y2 ) {\r\n\r\n\t\t_context.beginPath();\r\n\t\t_context.moveTo( x0, y0 );\r\n\t\t_context.lineTo( x1, y1 );\r\n\t\t_context.lineTo( x2, y2 );\r\n\t\t_context.closePath();\r\n\r\n\t}\r\n\r\n\tfunction strokePath( color, linewidth, linecap, linejoin ) {\r\n\r\n\t\tsetLineWidth( linewidth );\r\n\t\tsetLineCap( linecap );\r\n\t\tsetLineJoin( linejoin );\r\n\t\tsetStrokeStyle( color.getStyle() );\r\n\r\n\t\t_context.stroke();\r\n\r\n\t\t_elemBox.expandByScalar( linewidth * 2 );\r\n\r\n\t}\r\n\r\n\tfunction fillPath( color ) {\r\n\r\n\t\tsetFillStyle( color.getStyle() );\r\n\t\t_context.fill();\r\n\r\n\t}\r\n\r\n\tfunction textureToPattern( texture ) {\r\n\r\n\t\tif ( texture.version === 0 ||\r\n\t\t\ttexture instanceof THREE.CompressedTexture ||\r\n\t\t\ttexture instanceof THREE.DataTexture ) {\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcanvas: undefined,\r\n\t\t\t\tversion: texture.version\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tvar image = texture.image;\r\n\r\n\t\tif ( image.complete === false ) {\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcanvas: undefined,\r\n\t\t\t\tversion: 0\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tvar canvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = image.width;\r\n\t\tcanvas.height = image.height;\r\n\r\n\t\tvar context = canvas.getContext( '2d' );\r\n\t\tcontext.setTransform( 1, 0, 0, - 1, 0, image.height );\r\n\t\tcontext.drawImage( image, 0, 0 );\r\n\r\n\t\tvar repeatX = texture.wrapS === THREE.RepeatWrapping;\r\n\t\tvar repeatY = texture.wrapT === THREE.RepeatWrapping;\r\n\r\n\t\tvar repeat = 'no-repeat';\r\n\r\n\t\tif ( repeatX === true && repeatY === true ) {\r\n\r\n\t\t\trepeat = 'repeat';\r\n\r\n\t\t} else if ( repeatX === true ) {\r\n\r\n\t\t\trepeat = 'repeat-x';\r\n\r\n\t\t} else if ( repeatY === true ) {\r\n\r\n\t\t\trepeat = 'repeat-y';\r\n\r\n\t\t}\r\n\r\n\t\tvar pattern = _context.createPattern( canvas, repeat );\r\n\r\n\t\tif ( texture.onUpdate ) texture.onUpdate( texture );\r\n\r\n\t\treturn {\r\n\t\t\tcanvas: pattern,\r\n\t\t\tversion: texture.version\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction patternPath( x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, texture ) {\r\n\r\n\t\tvar pattern = _patterns[ texture.id ];\r\n\r\n\t\tif ( pattern === undefined || pattern.version !== texture.version ) {\r\n\r\n\t\t\tpattern = textureToPattern( texture );\r\n\t\t\t_patterns[ texture.id ] = pattern;\r\n\r\n\t\t}\r\n\r\n\t\tif ( pattern.canvas !== undefined ) {\r\n\r\n\t\t\tsetFillStyle( pattern.canvas );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tsetFillStyle( 'rgba( 0, 0, 0, 1)' );\r\n\t\t\t_context.fill();\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\r\n\t\t// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120\r\n\r\n\t\tvar a, b, c, d, e, f, det, idet,\r\n\t\toffsetX = texture.offset.x / texture.repeat.x,\r\n\t\toffsetY = texture.offset.y / texture.repeat.y,\r\n\t\twidth = texture.image.width * texture.repeat.x,\r\n\t\theight = texture.image.height * texture.repeat.y;\r\n\r\n\t\tu0 = ( u0 + offsetX ) * width;\r\n\t\tv0 = ( v0 + offsetY ) * height;\r\n\r\n\t\tu1 = ( u1 + offsetX ) * width;\r\n\t\tv1 = ( v1 + offsetY ) * height;\r\n\r\n\t\tu2 = ( u2 + offsetX ) * width;\r\n\t\tv2 = ( v2 + offsetY ) * height;\r\n\r\n\t\tx1 -= x0; y1 -= y0;\r\n\t\tx2 -= x0; y2 -= y0;\r\n\r\n\t\tu1 -= u0; v1 -= v0;\r\n\t\tu2 -= u0; v2 -= v0;\r\n\r\n\t\tdet = u1 * v2 - u2 * v1;\r\n\r\n\t\tif ( det === 0 ) return;\r\n\r\n\t\tidet = 1 / det;\r\n\r\n\t\ta = ( v2 * x1 - v1 * x2 ) * idet;\r\n\t\tb = ( v2 * y1 - v1 * y2 ) * idet;\r\n\t\tc = ( u1 * x2 - u2 * x1 ) * idet;\r\n\t\td = ( u1 * y2 - u2 * y1 ) * idet;\r\n\r\n\t\te = x0 - a * u0 - c * v0;\r\n\t\tf = y0 - b * u0 - d * v0;\r\n\r\n\t\t_context.save();\r\n\t\t_context.transform( a, b, c, d, e, f );\r\n\t\t_context.fill();\r\n\t\t_context.restore();\r\n\r\n\t}\r\n\r\n\tfunction clipImage( x0, y0, x1, y1, x2, y2, u0, v0, u1, v1, u2, v2, image ) {\r\n\r\n\t\t// http://extremelysatisfactorytotalitarianism.com/blog/?p=2120\r\n\r\n\t\tvar a, b, c, d, e, f, det, idet,\r\n\t\twidth = image.width - 1,\r\n\t\theight = image.height - 1;\r\n\r\n\t\tu0 *= width; v0 *= height;\r\n\t\tu1 *= width; v1 *= height;\r\n\t\tu2 *= width; v2 *= height;\r\n\r\n\t\tx1 -= x0; y1 -= y0;\r\n\t\tx2 -= x0; y2 -= y0;\r\n\r\n\t\tu1 -= u0; v1 -= v0;\r\n\t\tu2 -= u0; v2 -= v0;\r\n\r\n\t\tdet = u1 * v2 - u2 * v1;\r\n\r\n\t\tidet = 1 / det;\r\n\r\n\t\ta = ( v2 * x1 - v1 * x2 ) * idet;\r\n\t\tb = ( v2 * y1 - v1 * y2 ) * idet;\r\n\t\tc = ( u1 * x2 - u2 * x1 ) * idet;\r\n\t\td = ( u1 * y2 - u2 * y1 ) * idet;\r\n\r\n\t\te = x0 - a * u0 - c * v0;\r\n\t\tf = y0 - b * u0 - d * v0;\r\n\r\n\t\t_context.save();\r\n\t\t_context.transform( a, b, c, d, e, f );\r\n\t\t_context.clip();\r\n\t\t_context.drawImage( image, 0, 0 );\r\n\t\t_context.restore();\r\n\r\n\t}\r\n\r\n\t// Hide anti-alias gaps\r\n\r\n\tfunction expand( v1, v2, pixels ) {\r\n\r\n\t\tvar x = v2.x - v1.x, y = v2.y - v1.y,\r\n\t\tdet = x * x + y * y, idet;\r\n\r\n\t\tif ( det === 0 ) return;\r\n\r\n\t\tidet = pixels / Math.sqrt( det );\r\n\r\n\t\tx *= idet; y *= idet;\r\n\r\n\t\tv2.x += x; v2.y += y;\r\n\t\tv1.x -= x; v1.y -= y;\r\n\r\n\t}\r\n\r\n\t// Context cached methods.\r\n\r\n\tfunction setOpacity( value ) {\r\n\r\n\t\tif ( _contextGlobalAlpha !== value ) {\r\n\r\n\t\t\t_context.globalAlpha = value;\r\n\t\t\t_contextGlobalAlpha = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setBlending( value ) {\r\n\r\n\t\tif ( _contextGlobalCompositeOperation !== value ) {\r\n\r\n\t\t\tif ( value === THREE.NormalBlending ) {\r\n\r\n\t\t\t\t_context.globalCompositeOperation = 'source-over';\r\n\r\n\t\t\t} else if ( value === THREE.AdditiveBlending ) {\r\n\r\n\t\t\t\t_context.globalCompositeOperation = 'lighter';\r\n\r\n\t\t\t} else if ( value === THREE.SubtractiveBlending ) {\r\n\r\n\t\t\t\t_context.globalCompositeOperation = 'darker';\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_contextGlobalCompositeOperation = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineWidth( value ) {\r\n\r\n\t\tif ( _contextLineWidth !== value ) {\r\n\r\n\t\t\t_context.lineWidth = value;\r\n\t\t\t_contextLineWidth = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineCap( value ) {\r\n\r\n\t\t// \"butt\", \"round\", \"square\"\r\n\r\n\t\tif ( _contextLineCap !== value ) {\r\n\r\n\t\t\t_context.lineCap = value;\r\n\t\t\t_contextLineCap = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineJoin( value ) {\r\n\r\n\t\t// \"round\", \"bevel\", \"miter\"\r\n\r\n\t\tif ( _contextLineJoin !== value ) {\r\n\r\n\t\t\t_context.lineJoin = value;\r\n\t\t\t_contextLineJoin = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setStrokeStyle( value ) {\r\n\r\n\t\tif ( _contextStrokeStyle !== value ) {\r\n\r\n\t\t\t_context.strokeStyle = value;\r\n\t\t\t_contextStrokeStyle = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setFillStyle( value ) {\r\n\r\n\t\tif ( _contextFillStyle !== value ) {\r\n\r\n\t\t\t_context.fillStyle = value;\r\n\t\t\t_contextFillStyle = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction setLineDash( value ) {\r\n\r\n\t\tif ( _contextLineDash.length !== value.length ) {\r\n\r\n\t\t\t_context.setLineDash( value );\r\n\t\t\t_contextLineDash = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/three/examples/js/renderers/CanvasRenderer.js\n ** module id = 5\n ** module chunks = 0\n **/","/**\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author supereggbert / http://www.paulbrunt.co.uk/\r\n * @author julianwa / https://github.com/julianwa\r\n */\r\n\r\nTHREE.RenderableObject = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.object = null;\r\n\tthis.z = 0;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableFace = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.v1 = new THREE.RenderableVertex();\r\n\tthis.v2 = new THREE.RenderableVertex();\r\n\tthis.v3 = new THREE.RenderableVertex();\r\n\r\n\tthis.normalModel = new THREE.Vector3();\r\n\r\n\tthis.vertexNormalsModel = [ new THREE.Vector3(), new THREE.Vector3(), new THREE.Vector3() ];\r\n\tthis.vertexNormalsLength = 0;\r\n\r\n\tthis.color = new THREE.Color();\r\n\tthis.material = null;\r\n\tthis.uvs = [ new THREE.Vector2(), new THREE.Vector2(), new THREE.Vector2() ];\r\n\r\n\tthis.z = 0;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableVertex = function () {\r\n\r\n\tthis.position = new THREE.Vector3();\r\n\tthis.positionWorld = new THREE.Vector3();\r\n\tthis.positionScreen = new THREE.Vector4();\r\n\r\n\tthis.visible = true;\r\n\r\n};\r\n\r\nTHREE.RenderableVertex.prototype.copy = function ( vertex ) {\r\n\r\n\tthis.positionWorld.copy( vertex.positionWorld );\r\n\tthis.positionScreen.copy( vertex.positionScreen );\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableLine = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.v1 = new THREE.RenderableVertex();\r\n\tthis.v2 = new THREE.RenderableVertex();\r\n\r\n\tthis.vertexColors = [ new THREE.Color(), new THREE.Color() ];\r\n\tthis.material = null;\r\n\r\n\tthis.z = 0;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.RenderableSprite = function () {\r\n\r\n\tthis.id = 0;\r\n\r\n\tthis.object = null;\r\n\r\n\tthis.x = 0;\r\n\tthis.y = 0;\r\n\tthis.z = 0;\r\n\r\n\tthis.rotation = 0;\r\n\tthis.scale = new THREE.Vector2();\r\n\r\n\tthis.material = null;\r\n\tthis.renderOrder = 0;\r\n\r\n};\r\n\r\n//\r\n\r\nTHREE.Projector = function () {\r\n\r\n\tvar _object, _objectCount, _objectPool = [], _objectPoolLength = 0,\r\n\t_vertex, _vertexCount, _vertexPool = [], _vertexPoolLength = 0,\r\n\t_face, _faceCount, _facePool = [], _facePoolLength = 0,\r\n\t_line, _lineCount, _linePool = [], _linePoolLength = 0,\r\n\t_sprite, _spriteCount, _spritePool = [], _spritePoolLength = 0,\r\n\r\n\t_renderData = { objects: [], lights: [], elements: [] },\r\n\r\n\t_vector3 = new THREE.Vector3(),\r\n\t_vector4 = new THREE.Vector4(),\r\n\r\n\t_clipBox = new THREE.Box3( new THREE.Vector3( - 1, - 1, - 1 ), new THREE.Vector3( 1, 1, 1 ) ),\r\n\t_boundingBox = new THREE.Box3(),\r\n\t_points3 = new Array( 3 ),\r\n\t_points4 = new Array( 4 ),\r\n\r\n\t_viewMatrix = new THREE.Matrix4(),\r\n\t_viewProjectionMatrix = new THREE.Matrix4(),\r\n\r\n\t_modelMatrix,\r\n\t_modelViewProjectionMatrix = new THREE.Matrix4(),\r\n\r\n\t_normalMatrix = new THREE.Matrix3(),\r\n\r\n\t_frustum = new THREE.Frustum(),\r\n\r\n\t_clippedVertex1PositionScreen = new THREE.Vector4(),\r\n\t_clippedVertex2PositionScreen = new THREE.Vector4();\r\n\r\n\t//\r\n\r\n\tthis.projectVector = function ( vector, camera ) {\r\n\r\n\t\tconsole.warn( 'THREE.Projector: .projectVector() is now vector.project().' );\r\n\t\tvector.project( camera );\r\n\r\n\t};\r\n\r\n\tthis.unprojectVector = function ( vector, camera ) {\r\n\r\n\t\tconsole.warn( 'THREE.Projector: .unprojectVector() is now vector.unproject().' );\r\n\t\tvector.unproject( camera );\r\n\r\n\t};\r\n\r\n\tthis.pickingRay = function ( vector, camera ) {\r\n\r\n\t\tconsole.error( 'THREE.Projector: .pickingRay() is now raycaster.setFromCamera().' );\r\n\r\n\t};\r\n\r\n\t//\r\n\r\n\tvar RenderList = function () {\r\n\r\n\t\tvar normals = [];\r\n\t\tvar uvs = [];\r\n\r\n\t\tvar object = null;\r\n\t\tvar material = null;\r\n\r\n\t\tvar normalMatrix = new THREE.Matrix3();\r\n\r\n\t\tfunction setObject( value ) {\r\n\r\n\t\t\tobject = value;\r\n\t\t\tmaterial = object.material;\r\n\r\n\t\t\tnormalMatrix.getNormalMatrix( object.matrixWorld );\r\n\r\n\t\t\tnormals.length = 0;\r\n\t\t\tuvs.length = 0;\r\n\r\n\t\t}\r\n\r\n\t\tfunction projectVertex( vertex ) {\r\n\r\n\t\t\tvar position = vertex.position;\r\n\t\t\tvar positionWorld = vertex.positionWorld;\r\n\t\t\tvar positionScreen = vertex.positionScreen;\r\n\r\n\t\t\tpositionWorld.copy( position ).applyMatrix4( _modelMatrix );\r\n\t\t\tpositionScreen.copy( positionWorld ).applyMatrix4( _viewProjectionMatrix );\r\n\r\n\t\t\tvar invW = 1 / positionScreen.w;\r\n\r\n\t\t\tpositionScreen.x *= invW;\r\n\t\t\tpositionScreen.y *= invW;\r\n\t\t\tpositionScreen.z *= invW;\r\n\r\n\t\t\tvertex.visible = positionScreen.x >= - 1 && positionScreen.x <= 1 &&\r\n\t\t\t\t\t positionScreen.y >= - 1 && positionScreen.y <= 1 &&\r\n\t\t\t\t\t positionScreen.z >= - 1 && positionScreen.z <= 1;\r\n\r\n\t\t}\r\n\r\n\t\tfunction pushVertex( x, y, z ) {\r\n\r\n\t\t\t_vertex = getNextVertexInPool();\r\n\t\t\t_vertex.position.set( x, y, z );\r\n\r\n\t\t\tprojectVertex( _vertex );\r\n\r\n\t\t}\r\n\r\n\t\tfunction pushNormal( x, y, z ) {\r\n\r\n\t\t\tnormals.push( x, y, z );\r\n\r\n\t\t}\r\n\r\n\t\tfunction pushUv( x, y ) {\r\n\r\n\t\t\tuvs.push( x, y );\r\n\r\n\t\t}\r\n\r\n\t\tfunction checkTriangleVisibility( v1, v2, v3 ) {\r\n\r\n\t\t\tif ( v1.visible === true || v2.visible === true || v3.visible === true ) return true;\r\n\r\n\t\t\t_points3[ 0 ] = v1.positionScreen;\r\n\t\t\t_points3[ 1 ] = v2.positionScreen;\r\n\t\t\t_points3[ 2 ] = v3.positionScreen;\r\n\r\n\t\t\treturn _clipBox.intersectsBox( _boundingBox.setFromPoints( _points3 ) );\r\n\r\n\t\t}\r\n\r\n\t\tfunction checkBackfaceCulling( v1, v2, v3 ) {\r\n\r\n\t\t\treturn ( ( v3.positionScreen.x - v1.positionScreen.x ) *\r\n\t\t\t\t    ( v2.positionScreen.y - v1.positionScreen.y ) -\r\n\t\t\t\t    ( v3.positionScreen.y - v1.positionScreen.y ) *\r\n\t\t\t\t    ( v2.positionScreen.x - v1.positionScreen.x ) ) < 0;\r\n\r\n\t\t}\r\n\r\n\t\tfunction pushLine( a, b ) {\r\n\r\n\t\t\tvar v1 = _vertexPool[ a ];\r\n\t\t\tvar v2 = _vertexPool[ b ];\r\n\r\n\t\t\t_line = getNextLineInPool();\r\n\r\n\t\t\t_line.id = object.id;\r\n\t\t\t_line.v1.copy( v1 );\r\n\t\t\t_line.v2.copy( v2 );\r\n\t\t\t_line.z = ( v1.positionScreen.z + v2.positionScreen.z ) / 2;\r\n\t\t\t_line.renderOrder = object.renderOrder;\r\n\r\n\t\t\t_line.material = object.material;\r\n\r\n\t\t\t_renderData.elements.push( _line );\r\n\r\n\t\t}\r\n\r\n\t\tfunction pushTriangle( a, b, c ) {\r\n\r\n\t\t\tvar v1 = _vertexPool[ a ];\r\n\t\t\tvar v2 = _vertexPool[ b ];\r\n\t\t\tvar v3 = _vertexPool[ c ];\r\n\r\n\t\t\tif ( checkTriangleVisibility( v1, v2, v3 ) === false ) return;\r\n\r\n\t\t\tif ( material.side === THREE.DoubleSide || checkBackfaceCulling( v1, v2, v3 ) === true ) {\r\n\r\n\t\t\t\t_face = getNextFaceInPool();\r\n\r\n\t\t\t\t_face.id = object.id;\r\n\t\t\t\t_face.v1.copy( v1 );\r\n\t\t\t\t_face.v2.copy( v2 );\r\n\t\t\t\t_face.v3.copy( v3 );\r\n\t\t\t\t_face.z = ( v1.positionScreen.z + v2.positionScreen.z + v3.positionScreen.z ) / 3;\r\n\t\t\t\t_face.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t// use first vertex normal as face normal\r\n\r\n\t\t\t\t_face.normalModel.fromArray( normals, a * 3 );\r\n\t\t\t\t_face.normalModel.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t\tfor ( var i = 0; i < 3; i ++ ) {\r\n\r\n\t\t\t\t\tvar normal = _face.vertexNormalsModel[ i ];\r\n\t\t\t\t\tnormal.fromArray( normals, arguments[ i ] * 3 );\r\n\t\t\t\t\tnormal.applyMatrix3( normalMatrix ).normalize();\r\n\r\n\t\t\t\t\tvar uv = _face.uvs[ i ];\r\n\t\t\t\t\tuv.fromArray( uvs, arguments[ i ] * 2 );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_face.vertexNormalsLength = 3;\r\n\r\n\t\t\t\t_face.material = object.material;\r\n\r\n\t\t\t\t_renderData.elements.push( _face );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tsetObject: setObject,\r\n\t\t\tprojectVertex: projectVertex,\r\n\t\t\tcheckTriangleVisibility: checkTriangleVisibility,\r\n\t\t\tcheckBackfaceCulling: checkBackfaceCulling,\r\n\t\t\tpushVertex: pushVertex,\r\n\t\t\tpushNormal: pushNormal,\r\n\t\t\tpushUv: pushUv,\r\n\t\t\tpushLine: pushLine,\r\n\t\t\tpushTriangle: pushTriangle\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tvar renderList = new RenderList();\r\n\r\n\tthis.projectScene = function ( scene, camera, sortObjects, sortElements ) {\r\n\r\n\t\t_faceCount = 0;\r\n\t\t_lineCount = 0;\r\n\t\t_spriteCount = 0;\r\n\r\n\t\t_renderData.elements.length = 0;\r\n\r\n\t\tif ( scene.autoUpdate === true ) scene.updateMatrixWorld();\r\n\t\tif ( camera.parent === null ) camera.updateMatrixWorld();\r\n\r\n\t\t_viewMatrix.copy( camera.matrixWorldInverse.getInverse( camera.matrixWorld ) );\r\n\t\t_viewProjectionMatrix.multiplyMatrices( camera.projectionMatrix, _viewMatrix );\r\n\r\n\t\t_frustum.setFromMatrix( _viewProjectionMatrix );\r\n\r\n\t\t//\r\n\r\n\t\t_objectCount = 0;\r\n\r\n\t\t_renderData.objects.length = 0;\r\n\t\t_renderData.lights.length = 0;\r\n\r\n\t\tscene.traverseVisible( function ( object ) {\r\n\r\n\t\t\tif ( object instanceof THREE.Light ) {\r\n\r\n\t\t\t\t_renderData.lights.push( object );\r\n\r\n\t\t\t} else if ( object instanceof THREE.Mesh || object instanceof THREE.Line || object instanceof THREE.Sprite ) {\r\n\r\n\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\tif ( material.visible === false ) return;\r\n\r\n\t\t\t\tif ( object.frustumCulled === false || _frustum.intersectsObject( object ) === true ) {\r\n\r\n\t\t\t\t\t_object = getNextObjectInPool();\r\n\t\t\t\t\t_object.id = object.id;\r\n\t\t\t\t\t_object.object = object;\r\n\r\n\t\t\t\t\t_vector3.setFromMatrixPosition( object.matrixWorld );\r\n\t\t\t\t\t_vector3.applyProjection( _viewProjectionMatrix );\r\n\t\t\t\t\t_object.z = _vector3.z;\r\n\t\t\t\t\t_object.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t\t_renderData.objects.push( _object );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tif ( sortObjects === true ) {\r\n\r\n\t\t\t_renderData.objects.sort( painterSort );\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tfor ( var o = 0, ol = _renderData.objects.length; o < ol; o ++ ) {\r\n\r\n\t\t\tvar object = _renderData.objects[ o ].object;\r\n\t\t\tvar geometry = object.geometry;\r\n\r\n\t\t\trenderList.setObject( object );\r\n\r\n\t\t\t_modelMatrix = object.matrixWorld;\r\n\r\n\t\t\t_vertexCount = 0;\r\n\r\n\t\t\tif ( object instanceof THREE.Mesh ) {\r\n\r\n\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t\tvar attributes = geometry.attributes;\r\n\t\t\t\t\tvar groups = geometry.groups;\r\n\r\n\t\t\t\t\tif ( attributes.position === undefined ) continue;\r\n\r\n\t\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\trenderList.pushVertex( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( attributes.normal !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar normals = attributes.normal.array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = normals.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushNormal( normals[ i ], normals[ i + 1 ], normals[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( attributes.uv !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar uvs = attributes.uv.array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = uvs.length; i < l; i += 2 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushUv( uvs[ i ], uvs[ i + 1 ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( geometry.index !== null ) {\r\n\r\n\t\t\t\t\t\tvar indices = geometry.index.array;\r\n\r\n\t\t\t\t\t\tif ( groups.length > 0 ) {\r\n\r\n\t\t\t\t\t\t\tfor ( var o = 0; o < groups.length; o ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvar group = groups[ o ];\r\n\r\n\t\t\t\t\t\t\t\tfor ( var i = group.start, l = group.start + group.count; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\t\t\trenderList.pushTriangle( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\t\trenderList.pushTriangle( indices[ i ], indices[ i + 1 ], indices[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = positions.length / 3; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushTriangle( i, i + 1, i + 2 );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\tvar vertices = geometry.vertices;\r\n\t\t\t\t\tvar faces = geometry.faces;\r\n\t\t\t\t\tvar faceVertexUvs = geometry.faceVertexUvs[ 0 ];\r\n\r\n\t\t\t\t\t_normalMatrix.getNormalMatrix( _modelMatrix );\r\n\r\n\t\t\t\t\tvar material = object.material;\r\n\r\n\t\t\t\t\tvar isFaceMaterial = material instanceof THREE.MultiMaterial;\r\n\t\t\t\t\tvar objectMaterials = isFaceMaterial === true ? object.material : null;\r\n\r\n\t\t\t\t\tfor ( var v = 0, vl = vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\t\t\t\tvar vertex = vertices[ v ];\r\n\r\n\t\t\t\t\t\t_vector3.copy( vertex );\r\n\r\n\t\t\t\t\t\tif ( material.morphTargets === true ) {\r\n\r\n\t\t\t\t\t\t\tvar morphTargets = geometry.morphTargets;\r\n\t\t\t\t\t\t\tvar morphInfluences = object.morphTargetInfluences;\r\n\r\n\t\t\t\t\t\t\tfor ( var t = 0, tl = morphTargets.length; t < tl; t ++ ) {\r\n\r\n\t\t\t\t\t\t\t\tvar influence = morphInfluences[ t ];\r\n\r\n\t\t\t\t\t\t\t\tif ( influence === 0 ) continue;\r\n\r\n\t\t\t\t\t\t\t\tvar target = morphTargets[ t ];\r\n\t\t\t\t\t\t\t\tvar targetVertex = target.vertices[ v ];\r\n\r\n\t\t\t\t\t\t\t\t_vector3.x += ( targetVertex.x - vertex.x ) * influence;\r\n\t\t\t\t\t\t\t\t_vector3.y += ( targetVertex.y - vertex.y ) * influence;\r\n\t\t\t\t\t\t\t\t_vector3.z += ( targetVertex.z - vertex.z ) * influence;\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\trenderList.pushVertex( _vector3.x, _vector3.y, _vector3.z );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tfor ( var f = 0, fl = faces.length; f < fl; f ++ ) {\r\n\r\n\t\t\t\t\t\tvar face = faces[ f ];\r\n\r\n\t\t\t\t\t\tmaterial = isFaceMaterial === true\r\n\t\t\t\t\t\t\t ? objectMaterials.materials[ face.materialIndex ]\r\n\t\t\t\t\t\t\t : object.material;\r\n\r\n\t\t\t\t\t\tif ( material === undefined ) continue;\r\n\r\n\t\t\t\t\t\tvar side = material.side;\r\n\r\n\t\t\t\t\t\tvar v1 = _vertexPool[ face.a ];\r\n\t\t\t\t\t\tvar v2 = _vertexPool[ face.b ];\r\n\t\t\t\t\t\tvar v3 = _vertexPool[ face.c ];\r\n\r\n\t\t\t\t\t\tif ( renderList.checkTriangleVisibility( v1, v2, v3 ) === false ) continue;\r\n\r\n\t\t\t\t\t\tvar visible = renderList.checkBackfaceCulling( v1, v2, v3 );\r\n\r\n\t\t\t\t\t\tif ( side !== THREE.DoubleSide ) {\r\n\r\n\t\t\t\t\t\t\tif ( side === THREE.FrontSide && visible === false ) continue;\r\n\t\t\t\t\t\t\tif ( side === THREE.BackSide && visible === true ) continue;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face = getNextFaceInPool();\r\n\r\n\t\t\t\t\t\t_face.id = object.id;\r\n\t\t\t\t\t\t_face.v1.copy( v1 );\r\n\t\t\t\t\t\t_face.v2.copy( v2 );\r\n\t\t\t\t\t\t_face.v3.copy( v3 );\r\n\r\n\t\t\t\t\t\t_face.normalModel.copy( face.normal );\r\n\r\n\t\t\t\t\t\tif ( visible === false && ( side === THREE.BackSide || side === THREE.DoubleSide ) ) {\r\n\r\n\t\t\t\t\t\t\t_face.normalModel.negate();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face.normalModel.applyMatrix3( _normalMatrix ).normalize();\r\n\r\n\t\t\t\t\t\tvar faceVertexNormals = face.vertexNormals;\r\n\r\n\t\t\t\t\t\tfor ( var n = 0, nl = Math.min( faceVertexNormals.length, 3 ); n < nl; n ++ ) {\r\n\r\n\t\t\t\t\t\t\tvar normalModel = _face.vertexNormalsModel[ n ];\r\n\t\t\t\t\t\t\tnormalModel.copy( faceVertexNormals[ n ] );\r\n\r\n\t\t\t\t\t\t\tif ( visible === false && ( side === THREE.BackSide || side === THREE.DoubleSide ) ) {\r\n\r\n\t\t\t\t\t\t\t\tnormalModel.negate();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tnormalModel.applyMatrix3( _normalMatrix ).normalize();\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face.vertexNormalsLength = faceVertexNormals.length;\r\n\r\n\t\t\t\t\t\tvar vertexUvs = faceVertexUvs[ f ];\r\n\r\n\t\t\t\t\t\tif ( vertexUvs !== undefined ) {\r\n\r\n\t\t\t\t\t\t\tfor ( var u = 0; u < 3; u ++ ) {\r\n\r\n\t\t\t\t\t\t\t\t_face.uvs[ u ].copy( vertexUvs[ u ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t_face.color = face.color;\r\n\t\t\t\t\t\t_face.material = material;\r\n\r\n\t\t\t\t\t\t_face.z = ( v1.positionScreen.z + v2.positionScreen.z + v3.positionScreen.z ) / 3;\r\n\t\t\t\t\t\t_face.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t\t\t_renderData.elements.push( _face );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object instanceof THREE.Line ) {\r\n\r\n\t\t\t\tif ( geometry instanceof THREE.BufferGeometry ) {\r\n\r\n\t\t\t\t\tvar attributes = geometry.attributes;\r\n\r\n\t\t\t\t\tif ( attributes.position !== undefined ) {\r\n\r\n\t\t\t\t\t\tvar positions = attributes.position.array;\r\n\r\n\t\t\t\t\t\tfor ( var i = 0, l = positions.length; i < l; i += 3 ) {\r\n\r\n\t\t\t\t\t\t\trenderList.pushVertex( positions[ i ], positions[ i + 1 ], positions[ i + 2 ] );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ( geometry.index !== null ) {\r\n\r\n\t\t\t\t\t\t\tvar indices = geometry.index.array;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = indices.length; i < l; i += 2 ) {\r\n\r\n\t\t\t\t\t\t\t\trenderList.pushLine( indices[ i ], indices[ i + 1 ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tvar step = object instanceof THREE.LineSegments ? 2 : 1;\r\n\r\n\t\t\t\t\t\t\tfor ( var i = 0, l = ( positions.length / 3 ) - 1; i < l; i += step ) {\r\n\r\n\t\t\t\t\t\t\t\trenderList.pushLine( i, i + 1 );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if ( geometry instanceof THREE.Geometry ) {\r\n\r\n\t\t\t\t\t_modelViewProjectionMatrix.multiplyMatrices( _viewProjectionMatrix, _modelMatrix );\r\n\r\n\t\t\t\t\tvar vertices = object.geometry.vertices;\r\n\r\n\t\t\t\t\tif ( vertices.length === 0 ) continue;\r\n\r\n\t\t\t\t\tv1 = getNextVertexInPool();\r\n\t\t\t\t\tv1.positionScreen.copy( vertices[ 0 ] ).applyMatrix4( _modelViewProjectionMatrix );\r\n\r\n\t\t\t\t\tvar step = object instanceof THREE.LineSegments ? 2 : 1;\r\n\r\n\t\t\t\t\tfor ( var v = 1, vl = vertices.length; v < vl; v ++ ) {\r\n\r\n\t\t\t\t\t\tv1 = getNextVertexInPool();\r\n\t\t\t\t\t\tv1.positionScreen.copy( vertices[ v ] ).applyMatrix4( _modelViewProjectionMatrix );\r\n\r\n\t\t\t\t\t\tif ( ( v + 1 ) % step > 0 ) continue;\r\n\r\n\t\t\t\t\t\tv2 = _vertexPool[ _vertexCount - 2 ];\r\n\r\n\t\t\t\t\t\t_clippedVertex1PositionScreen.copy( v1.positionScreen );\r\n\t\t\t\t\t\t_clippedVertex2PositionScreen.copy( v2.positionScreen );\r\n\r\n\t\t\t\t\t\tif ( clipLine( _clippedVertex1PositionScreen, _clippedVertex2PositionScreen ) === true ) {\r\n\r\n\t\t\t\t\t\t\t// Perform the perspective divide\r\n\t\t\t\t\t\t\t_clippedVertex1PositionScreen.multiplyScalar( 1 / _clippedVertex1PositionScreen.w );\r\n\t\t\t\t\t\t\t_clippedVertex2PositionScreen.multiplyScalar( 1 / _clippedVertex2PositionScreen.w );\r\n\r\n\t\t\t\t\t\t\t_line = getNextLineInPool();\r\n\r\n\t\t\t\t\t\t\t_line.id = object.id;\r\n\t\t\t\t\t\t\t_line.v1.positionScreen.copy( _clippedVertex1PositionScreen );\r\n\t\t\t\t\t\t\t_line.v2.positionScreen.copy( _clippedVertex2PositionScreen );\r\n\r\n\t\t\t\t\t\t\t_line.z = Math.max( _clippedVertex1PositionScreen.z, _clippedVertex2PositionScreen.z );\r\n\t\t\t\t\t\t\t_line.renderOrder = object.renderOrder;\r\n\r\n\t\t\t\t\t\t\t_line.material = object.material;\r\n\r\n\t\t\t\t\t\t\tif ( object.material.vertexColors === THREE.VertexColors ) {\r\n\r\n\t\t\t\t\t\t\t\t_line.vertexColors[ 0 ].copy( object.geometry.colors[ v ] );\r\n\t\t\t\t\t\t\t\t_line.vertexColors[ 1 ].copy( object.geometry.colors[ v - 1 ] );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t_renderData.elements.push( _line );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else if ( object instanceof THREE.Sprite ) {\r\n\r\n\t\t\t\t_vector4.set( _modelMatrix.elements[ 12 ], _modelMatrix.elements[ 13 ], _modelMatrix.elements[ 14 ], 1 );\r\n\t\t\t\t_vector4.applyMatrix4( _viewProjectionMatrix );\r\n\r\n\t\t\t\tvar invW = 1 / _vector4.w;\r\n\r\n\t\t\t\t_vector4.z *= invW;\r\n\r\n\t\t\t\tif ( _vector4.z >= - 1 && _vector4.z <= 1 ) {\r\n\r\n\t\t\t\t\t_sprite = getNextSpriteInPool();\r\n\t\t\t\t\t_sprite.id = object.id;\r\n\t\t\t\t\t_sprite.x = _vector4.x * invW;\r\n\t\t\t\t\t_sprite.y = _vector4.y * invW;\r\n\t\t\t\t\t_sprite.z = _vector4.z;\r\n\t\t\t\t\t_sprite.renderOrder = object.renderOrder;\r\n\t\t\t\t\t_sprite.object = object;\r\n\r\n\t\t\t\t\t_sprite.rotation = object.rotation;\r\n\r\n\t\t\t\t\t_sprite.scale.x = object.scale.x * Math.abs( _sprite.x - ( _vector4.x + camera.projectionMatrix.elements[ 0 ] ) / ( _vector4.w + camera.projectionMatrix.elements[ 12 ] ) );\r\n\t\t\t\t\t_sprite.scale.y = object.scale.y * Math.abs( _sprite.y - ( _vector4.y + camera.projectionMatrix.elements[ 5 ] ) / ( _vector4.w + camera.projectionMatrix.elements[ 13 ] ) );\r\n\r\n\t\t\t\t\t_sprite.material = object.material;\r\n\r\n\t\t\t\t\t_renderData.elements.push( _sprite );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( sortElements === true ) {\r\n\r\n\t\t\t_renderData.elements.sort( painterSort );\r\n\r\n\t\t}\r\n\r\n\t\treturn _renderData;\r\n\r\n\t};\r\n\r\n\t// Pools\r\n\r\n\tfunction getNextObjectInPool() {\r\n\r\n\t\tif ( _objectCount === _objectPoolLength ) {\r\n\r\n\t\t\tvar object = new THREE.RenderableObject();\r\n\t\t\t_objectPool.push( object );\r\n\t\t\t_objectPoolLength ++;\r\n\t\t\t_objectCount ++;\r\n\t\t\treturn object;\r\n\r\n\t\t}\r\n\r\n\t\treturn _objectPool[ _objectCount ++ ];\r\n\r\n\t}\r\n\r\n\tfunction getNextVertexInPool() {\r\n\r\n\t\tif ( _vertexCount === _vertexPoolLength ) {\r\n\r\n\t\t\tvar vertex = new THREE.RenderableVertex();\r\n\t\t\t_vertexPool.push( vertex );\r\n\t\t\t_vertexPoolLength ++;\r\n\t\t\t_vertexCount ++;\r\n\t\t\treturn vertex;\r\n\r\n\t\t}\r\n\r\n\t\treturn _vertexPool[ _vertexCount ++ ];\r\n\r\n\t}\r\n\r\n\tfunction getNextFaceInPool() {\r\n\r\n\t\tif ( _faceCount === _facePoolLength ) {\r\n\r\n\t\t\tvar face = new THREE.RenderableFace();\r\n\t\t\t_facePool.push( face );\r\n\t\t\t_facePoolLength ++;\r\n\t\t\t_faceCount ++;\r\n\t\t\treturn face;\r\n\r\n\t\t}\r\n\r\n\t\treturn _facePool[ _faceCount ++ ];\r\n\r\n\r\n\t}\r\n\r\n\tfunction getNextLineInPool() {\r\n\r\n\t\tif ( _lineCount === _linePoolLength ) {\r\n\r\n\t\t\tvar line = new THREE.RenderableLine();\r\n\t\t\t_linePool.push( line );\r\n\t\t\t_linePoolLength ++;\r\n\t\t\t_lineCount ++;\r\n\t\t\treturn line;\r\n\r\n\t\t}\r\n\r\n\t\treturn _linePool[ _lineCount ++ ];\r\n\r\n\t}\r\n\r\n\tfunction getNextSpriteInPool() {\r\n\r\n\t\tif ( _spriteCount === _spritePoolLength ) {\r\n\r\n\t\t\tvar sprite = new THREE.RenderableSprite();\r\n\t\t\t_spritePool.push( sprite );\r\n\t\t\t_spritePoolLength ++;\r\n\t\t\t_spriteCount ++;\r\n\t\t\treturn sprite;\r\n\r\n\t\t}\r\n\r\n\t\treturn _spritePool[ _spriteCount ++ ];\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tfunction painterSort( a, b ) {\r\n\r\n\t\tif ( a.renderOrder !== b.renderOrder ) {\r\n\r\n\t\t\treturn a.renderOrder - b.renderOrder;\r\n\r\n\t\t} else if ( a.z !== b.z ) {\r\n\r\n\t\t\treturn b.z - a.z;\r\n\r\n\t\t} else if ( a.id !== b.id ) {\r\n\r\n\t\t\treturn a.id - b.id;\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn 0;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction clipLine( s1, s2 ) {\r\n\r\n\t\tvar alpha1 = 0, alpha2 = 1,\r\n\r\n\t\t// Calculate the boundary coordinate of each vertex for the near and far clip planes,\r\n\t\t// Z = -1 and Z = +1, respectively.\r\n\t\tbc1near =  s1.z + s1.w,\r\n\t\tbc2near =  s2.z + s2.w,\r\n\t\tbc1far =  - s1.z + s1.w,\r\n\t\tbc2far =  - s2.z + s2.w;\r\n\r\n\t\tif ( bc1near >= 0 && bc2near >= 0 && bc1far >= 0 && bc2far >= 0 ) {\r\n\r\n\t\t\t// Both vertices lie entirely within all clip planes.\r\n\t\t\treturn true;\r\n\r\n\t\t} else if ( ( bc1near < 0 && bc2near < 0 ) || ( bc1far < 0 && bc2far < 0 ) ) {\r\n\r\n\t\t\t// Both vertices lie entirely outside one of the clip planes.\r\n\t\t\treturn false;\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// The line segment spans at least one clip plane.\r\n\r\n\t\t\tif ( bc1near < 0 ) {\r\n\r\n\t\t\t\t// v1 lies outside the near plane, v2 inside\r\n\t\t\t\talpha1 = Math.max( alpha1, bc1near / ( bc1near - bc2near ) );\r\n\r\n\t\t\t} else if ( bc2near < 0 ) {\r\n\r\n\t\t\t\t// v2 lies outside the near plane, v1 inside\r\n\t\t\t\talpha2 = Math.min( alpha2, bc1near / ( bc1near - bc2near ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( bc1far < 0 ) {\r\n\r\n\t\t\t\t// v1 lies outside the far plane, v2 inside\r\n\t\t\t\talpha1 = Math.max( alpha1, bc1far / ( bc1far - bc2far ) );\r\n\r\n\t\t\t} else if ( bc2far < 0 ) {\r\n\r\n\t\t\t\t// v2 lies outside the far plane, v2 inside\r\n\t\t\t\talpha2 = Math.min( alpha2, bc1far / ( bc1far - bc2far ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( alpha2 < alpha1 ) {\r\n\r\n\t\t\t\t// The line segment spans two boundaries, but is outside both of them.\r\n\t\t\t\t// (This can't happen when we're only clipping against just near/far but good\r\n\t\t\t\t//  to leave the check here for future usage if other clip planes are added.)\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Update the s1 and s2 vertices to match the clipped line segment.\r\n\t\t\t\ts1.lerp( s2, alpha1 );\r\n\t\t\t\ts2.lerp( s1, 1 - alpha2 );\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n};\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/three/examples/js/renderers/Projector.js\n ** module id = 6\n ** module chunks = 0\n **/","/*!\n * is-plain-object <https://github.com/jonschlinkert/is-plain-object>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nvar isObject = require('isobject');\n\nfunction isObjectObject(o) {\n  return isObject(o) === true\n    && Object.prototype.toString.call(o) === '[object Object]';\n}\n\nmodule.exports = function isPlainObject(o) {\n  var ctor,prot;\n  \n  if (isObjectObject(o) === false) return false;\n  \n  // If has modified constructor\n  ctor = o.constructor;\n  if (typeof ctor !== 'function') return false;\n  \n  // If has modified prototype\n  prot = ctor.prototype;\n  if (isObjectObject(prot) === false) return false;\n  \n  // If constructor does not have an Object-specific method\n  if (prot.hasOwnProperty('isPrototypeOf') === false) {\n    return false;\n  }\n  \n  // Most likely a plain Object\n  return true;\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/is-plain-object/index.js\n ** module id = 7\n ** module chunks = 0\n **/","/*!\n * isobject <https://github.com/jonschlinkert/isobject>\n *\n * Copyright (c) 2014-2015, Jon Schlinkert.\n * Licensed under the MIT License.\n */\n\n'use strict';\n\nmodule.exports = function isObject(val) {\n  return val != null && typeof val === 'object'\n    && !Array.isArray(val);\n};\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/isobject/index.js\n ** module id = 8\n ** module chunks = 0\n **/","/*!\n * EventEmitter2\n * https://github.com/hij1nx/EventEmitter2\n *\n * Copyright (c) 2013 hij1nx\n * Licensed under the MIT license.\n */\n;!function(undefined) {\n\n  var isArray = Array.isArray ? Array.isArray : function _isArray(obj) {\n    return Object.prototype.toString.call(obj) === \"[object Array]\";\n  };\n  var defaultMaxListeners = 10;\n\n  function init() {\n    this._events = {};\n    if (this._conf) {\n      configure.call(this, this._conf);\n    }\n  }\n\n  function configure(conf) {\n    if (conf) {\n\n      this._conf = conf;\n\n      conf.delimiter && (this.delimiter = conf.delimiter);\n      conf.maxListeners && (this._events.maxListeners = conf.maxListeners);\n      conf.wildcard && (this.wildcard = conf.wildcard);\n      conf.newListener && (this.newListener = conf.newListener);\n\n      if (this.wildcard) {\n        this.listenerTree = {};\n      }\n    }\n  }\n\n  function EventEmitter(conf) {\n    this._events = {};\n    this.newListener = false;\n    configure.call(this, conf);\n  }\n\n  //\n  // Attention, function return type now is array, always !\n  // It has zero elements if no any matches found and one or more\n  // elements (leafs) if there are matches\n  //\n  function searchListenerTree(handlers, type, tree, i) {\n    if (!tree) {\n      return [];\n    }\n    var listeners=[], leaf, len, branch, xTree, xxTree, isolatedBranch, endReached,\n        typeLength = type.length, currentType = type[i], nextType = type[i+1];\n    if (i === typeLength && tree._listeners) {\n      //\n      // If at the end of the event(s) list and the tree has listeners\n      // invoke those listeners.\n      //\n      if (typeof tree._listeners === 'function') {\n        handlers && handlers.push(tree._listeners);\n        return [tree];\n      } else {\n        for (leaf = 0, len = tree._listeners.length; leaf < len; leaf++) {\n          handlers && handlers.push(tree._listeners[leaf]);\n        }\n        return [tree];\n      }\n    }\n\n    if ((currentType === '*' || currentType === '**') || tree[currentType]) {\n      //\n      // If the event emitted is '*' at this part\n      // or there is a concrete match at this patch\n      //\n      if (currentType === '*') {\n        for (branch in tree) {\n          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\n            listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+1));\n          }\n        }\n        return listeners;\n      } else if(currentType === '**') {\n        endReached = (i+1 === typeLength || (i+2 === typeLength && nextType === '*'));\n        if(endReached && tree._listeners) {\n          // The next element has a _listeners, add it to the handlers.\n          listeners = listeners.concat(searchListenerTree(handlers, type, tree, typeLength));\n        }\n\n        for (branch in tree) {\n          if (branch !== '_listeners' && tree.hasOwnProperty(branch)) {\n            if(branch === '*' || branch === '**') {\n              if(tree[branch]._listeners && !endReached) {\n                listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], typeLength));\n              }\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\n            } else if(branch === nextType) {\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i+2));\n            } else {\n              // No match on this one, shift into the tree but not in the type array.\n              listeners = listeners.concat(searchListenerTree(handlers, type, tree[branch], i));\n            }\n          }\n        }\n        return listeners;\n      }\n\n      listeners = listeners.concat(searchListenerTree(handlers, type, tree[currentType], i+1));\n    }\n\n    xTree = tree['*'];\n    if (xTree) {\n      //\n      // If the listener tree will allow any match for this part,\n      // then recursively explore all branches of the tree\n      //\n      searchListenerTree(handlers, type, xTree, i+1);\n    }\n\n    xxTree = tree['**'];\n    if(xxTree) {\n      if(i < typeLength) {\n        if(xxTree._listeners) {\n          // If we have a listener on a '**', it will catch all, so add its handler.\n          searchListenerTree(handlers, type, xxTree, typeLength);\n        }\n\n        // Build arrays of matching next branches and others.\n        for(branch in xxTree) {\n          if(branch !== '_listeners' && xxTree.hasOwnProperty(branch)) {\n            if(branch === nextType) {\n              // We know the next element will match, so jump twice.\n              searchListenerTree(handlers, type, xxTree[branch], i+2);\n            } else if(branch === currentType) {\n              // Current node matches, move into the tree.\n              searchListenerTree(handlers, type, xxTree[branch], i+1);\n            } else {\n              isolatedBranch = {};\n              isolatedBranch[branch] = xxTree[branch];\n              searchListenerTree(handlers, type, { '**': isolatedBranch }, i+1);\n            }\n          }\n        }\n      } else if(xxTree._listeners) {\n        // We have reached the end and still on a '**'\n        searchListenerTree(handlers, type, xxTree, typeLength);\n      } else if(xxTree['*'] && xxTree['*']._listeners) {\n        searchListenerTree(handlers, type, xxTree['*'], typeLength);\n      }\n    }\n\n    return listeners;\n  }\n\n  function growListenerTree(type, listener) {\n\n    type = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n\n    //\n    // Looks for two consecutive '**', if so, don't add the event at all.\n    //\n    for(var i = 0, len = type.length; i+1 < len; i++) {\n      if(type[i] === '**' && type[i+1] === '**') {\n        return;\n      }\n    }\n\n    var tree = this.listenerTree;\n    var name = type.shift();\n\n    while (name) {\n\n      if (!tree[name]) {\n        tree[name] = {};\n      }\n\n      tree = tree[name];\n\n      if (type.length === 0) {\n\n        if (!tree._listeners) {\n          tree._listeners = listener;\n        }\n        else if(typeof tree._listeners === 'function') {\n          tree._listeners = [tree._listeners, listener];\n        }\n        else if (isArray(tree._listeners)) {\n\n          tree._listeners.push(listener);\n\n          if (!tree._listeners.warned) {\n\n            var m = defaultMaxListeners;\n\n            if (typeof this._events.maxListeners !== 'undefined') {\n              m = this._events.maxListeners;\n            }\n\n            if (m > 0 && tree._listeners.length > m) {\n\n              tree._listeners.warned = true;\n              console.error('(node) warning: possible EventEmitter memory ' +\n                            'leak detected. %d listeners added. ' +\n                            'Use emitter.setMaxListeners() to increase limit.',\n                            tree._listeners.length);\n              console.trace();\n            }\n          }\n        }\n        return true;\n      }\n      name = type.shift();\n    }\n    return true;\n  }\n\n  // By default EventEmitters will print a warning if more than\n  // 10 listeners are added to it. This is a useful default which\n  // helps finding memory leaks.\n  //\n  // Obviously not all Emitters should be limited to 10. This function allows\n  // that to be increased. Set to zero for unlimited.\n\n  EventEmitter.prototype.delimiter = '.';\n\n  EventEmitter.prototype.setMaxListeners = function(n) {\n    this._events || init.call(this);\n    this._events.maxListeners = n;\n    if (!this._conf) this._conf = {};\n    this._conf.maxListeners = n;\n  };\n\n  EventEmitter.prototype.event = '';\n\n  EventEmitter.prototype.once = function(event, fn) {\n    this.many(event, 1, fn);\n    return this;\n  };\n\n  EventEmitter.prototype.many = function(event, ttl, fn) {\n    var self = this;\n\n    if (typeof fn !== 'function') {\n      throw new Error('many only accepts instances of Function');\n    }\n\n    function listener() {\n      if (--ttl === 0) {\n        self.off(event, listener);\n      }\n      fn.apply(this, arguments);\n    }\n\n    listener._origin = fn;\n\n    this.on(event, listener);\n\n    return self;\n  };\n\n  EventEmitter.prototype.emit = function() {\n\n    this._events || init.call(this);\n\n    var type = arguments[0];\n\n    if (type === 'newListener' && !this.newListener) {\n      if (!this._events.newListener) { return false; }\n    }\n\n    // Loop through the *_all* functions and invoke them.\n    if (this._all) {\n      var l = arguments.length;\n      var args = new Array(l - 1);\n      for (var i = 1; i < l; i++) args[i - 1] = arguments[i];\n      for (i = 0, l = this._all.length; i < l; i++) {\n        this.event = type;\n        this._all[i].apply(this, args);\n      }\n    }\n\n    // If there is no 'error' event listener then throw.\n    if (type === 'error') {\n\n      if (!this._all &&\n        !this._events.error &&\n        !(this.wildcard && this.listenerTree.error)) {\n\n        if (arguments[1] instanceof Error) {\n          throw arguments[1]; // Unhandled 'error' event\n        } else {\n          throw new Error(\"Uncaught, unspecified 'error' event.\");\n        }\n        return false;\n      }\n    }\n\n    var handler;\n\n    if(this.wildcard) {\n      handler = [];\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      searchListenerTree.call(this, handler, ns, this.listenerTree, 0);\n    }\n    else {\n      handler = this._events[type];\n    }\n\n    if (typeof handler === 'function') {\n      this.event = type;\n      if (arguments.length === 1) {\n        handler.call(this);\n      }\n      else if (arguments.length > 1)\n        switch (arguments.length) {\n          case 2:\n            handler.call(this, arguments[1]);\n            break;\n          case 3:\n            handler.call(this, arguments[1], arguments[2]);\n            break;\n          // slower\n          default:\n            var l = arguments.length;\n            var args = new Array(l - 1);\n            for (var i = 1; i < l; i++) args[i - 1] = arguments[i];\n            handler.apply(this, args);\n        }\n      return true;\n    }\n    else if (handler) {\n      var l = arguments.length;\n      var args = new Array(l - 1);\n      for (var i = 1; i < l; i++) args[i - 1] = arguments[i];\n\n      var listeners = handler.slice();\n      for (var i = 0, l = listeners.length; i < l; i++) {\n        this.event = type;\n        listeners[i].apply(this, args);\n      }\n      return (listeners.length > 0) || !!this._all;\n    }\n    else {\n      return !!this._all;\n    }\n\n  };\n\n  EventEmitter.prototype.on = function(type, listener) {\n\n    if (typeof type === 'function') {\n      this.onAny(type);\n      return this;\n    }\n\n    if (typeof listener !== 'function') {\n      throw new Error('on only accepts instances of Function');\n    }\n    this._events || init.call(this);\n\n    // To avoid recursion in the case that type == \"newListeners\"! Before\n    // adding it to the listeners, first emit \"newListeners\".\n    this.emit('newListener', type, listener);\n\n    if(this.wildcard) {\n      growListenerTree.call(this, type, listener);\n      return this;\n    }\n\n    if (!this._events[type]) {\n      // Optimize the case of one listener. Don't need the extra array object.\n      this._events[type] = listener;\n    }\n    else if(typeof this._events[type] === 'function') {\n      // Adding the second element, need to change to array.\n      this._events[type] = [this._events[type], listener];\n    }\n    else if (isArray(this._events[type])) {\n      // If we've already got an array, just append.\n      this._events[type].push(listener);\n\n      // Check for listener leak\n      if (!this._events[type].warned) {\n\n        var m = defaultMaxListeners;\n\n        if (typeof this._events.maxListeners !== 'undefined') {\n          m = this._events.maxListeners;\n        }\n\n        if (m > 0 && this._events[type].length > m) {\n\n          this._events[type].warned = true;\n          console.error('(node) warning: possible EventEmitter memory ' +\n                        'leak detected. %d listeners added. ' +\n                        'Use emitter.setMaxListeners() to increase limit.',\n                        this._events[type].length);\n          console.trace();\n        }\n      }\n    }\n    return this;\n  };\n\n  EventEmitter.prototype.onAny = function(fn) {\n\n    if (typeof fn !== 'function') {\n      throw new Error('onAny only accepts instances of Function');\n    }\n\n    if(!this._all) {\n      this._all = [];\n    }\n\n    // Add the function to the event listener collection.\n    this._all.push(fn);\n    return this;\n  };\n\n  EventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n  EventEmitter.prototype.off = function(type, listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('removeListener only takes instances of Function');\n    }\n\n    var handlers,leafs=[];\n\n    if(this.wildcard) {\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\n    }\n    else {\n      // does not use listeners(), so no side effect of creating _events[type]\n      if (!this._events[type]) return this;\n      handlers = this._events[type];\n      leafs.push({_listeners:handlers});\n    }\n\n    for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {\n      var leaf = leafs[iLeaf];\n      handlers = leaf._listeners;\n      if (isArray(handlers)) {\n\n        var position = -1;\n\n        for (var i = 0, length = handlers.length; i < length; i++) {\n          if (handlers[i] === listener ||\n            (handlers[i].listener && handlers[i].listener === listener) ||\n            (handlers[i]._origin && handlers[i]._origin === listener)) {\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0) {\n          continue;\n        }\n\n        if(this.wildcard) {\n          leaf._listeners.splice(position, 1);\n        }\n        else {\n          this._events[type].splice(position, 1);\n        }\n\n        if (handlers.length === 0) {\n          if(this.wildcard) {\n            delete leaf._listeners;\n          }\n          else {\n            delete this._events[type];\n          }\n        }\n        return this;\n      }\n      else if (handlers === listener ||\n        (handlers.listener && handlers.listener === listener) ||\n        (handlers._origin && handlers._origin === listener)) {\n        if(this.wildcard) {\n          delete leaf._listeners;\n        }\n        else {\n          delete this._events[type];\n        }\n      }\n    }\n\n    return this;\n  };\n\n  EventEmitter.prototype.offAny = function(fn) {\n    var i = 0, l = 0, fns;\n    if (fn && this._all && this._all.length > 0) {\n      fns = this._all;\n      for(i = 0, l = fns.length; i < l; i++) {\n        if(fn === fns[i]) {\n          fns.splice(i, 1);\n          return this;\n        }\n      }\n    } else {\n      this._all = [];\n    }\n    return this;\n  };\n\n  EventEmitter.prototype.removeListener = EventEmitter.prototype.off;\n\n  EventEmitter.prototype.removeAllListeners = function(type) {\n    if (arguments.length === 0) {\n      !this._events || init.call(this);\n      return this;\n    }\n\n    if(this.wildcard) {\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      var leafs = searchListenerTree.call(this, null, ns, this.listenerTree, 0);\n\n      for (var iLeaf=0; iLeaf<leafs.length; iLeaf++) {\n        var leaf = leafs[iLeaf];\n        leaf._listeners = null;\n      }\n    }\n    else {\n      if (!this._events[type]) return this;\n      this._events[type] = null;\n    }\n    return this;\n  };\n\n  EventEmitter.prototype.listeners = function(type) {\n    if(this.wildcard) {\n      var handlers = [];\n      var ns = typeof type === 'string' ? type.split(this.delimiter) : type.slice();\n      searchListenerTree.call(this, handlers, ns, this.listenerTree, 0);\n      return handlers;\n    }\n\n    this._events || init.call(this);\n\n    if (!this._events[type]) this._events[type] = [];\n    if (!isArray(this._events[type])) {\n      this._events[type] = [this._events[type]];\n    }\n    return this._events[type];\n  };\n\n  EventEmitter.prototype.listenersAny = function() {\n\n    if(this._all) {\n      return this._all;\n    }\n    else {\n      return [];\n    }\n\n  };\n\n  if (typeof define === 'function' && define.amd) {\n     // AMD. Register as an anonymous module.\n    define(function() {\n      return EventEmitter;\n    });\n  } else if (typeof exports === 'object') {\n    // CommonJS\n    exports.EventEmitter2 = EventEmitter;\n  }\n  else {\n    // Browser global.\n    window.EventEmitter2 = EventEmitter;\n  }\n}();\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/EventEmitter2/lib/eventemitter2.js\n ** module id = 9\n ** module chunks = 0\n **/","module.exports = {Promise: window['Promise']}\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/polyfills/es6-promise.js\n ** module id = 10\n ** module chunks = 0\n **/","/**\n * Copyright Marc J. Schmidt. See the LICENSE file at the top-level\n * directory of this distribution and at\n * https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n */\n;\n(function() {\n\n    /**\n     * Class for dimension change detection.\n     *\n     * @param {Element|Element[]|Elements|jQuery} element\n     * @param {Function} callback\n     *\n     * @constructor\n     */\n    var ResizeSensor = function(element, callback) {\n        /**\n         *\n         * @constructor\n         */\n        function EventQueue() {\n            this.q = [];\n            this.add = function(ev) {\n                this.q.push(ev);\n            };\n\n            var i, j;\n            this.call = function() {\n                for (i = 0, j = this.q.length; i < j; i++) {\n                    this.q[i].call();\n                }\n            };\n        }\n\n        /**\n         * @param {HTMLElement} element\n         * @param {String}      prop\n         * @returns {String|Number}\n         */\n        function getComputedStyle(element, prop) {\n            if (element.currentStyle) {\n                return element.currentStyle[prop];\n            } else if (window.getComputedStyle) {\n                return window.getComputedStyle(element, null).getPropertyValue(prop);\n            } else {\n                return element.style[prop];\n            }\n        }\n\n        /**\n         *\n         * @param {HTMLElement} element\n         * @param {Function}    resized\n         */\n        function attachResizeEvent(element, resized) {\n            if (!element.resizedAttached) {\n                element.resizedAttached = new EventQueue();\n                element.resizedAttached.add(resized);\n            } else if (element.resizedAttached) {\n                element.resizedAttached.add(resized);\n                return;\n            }\n\n            element.resizeSensor = document.createElement('div');\n            element.resizeSensor.className = 'resize-sensor';\n            var style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: hidden; z-index: -1; visibility: hidden;';\n            var styleChild = 'position: absolute; left: 0; top: 0; transition: 0s;';\n\n            element.resizeSensor.style.cssText = style;\n            element.resizeSensor.innerHTML =\n                '<div class=\"resize-sensor-expand\" style=\"' + style + '\">' +\n                    '<div style=\"' + styleChild + '\"></div>' +\n                '</div>' +\n                '<div class=\"resize-sensor-shrink\" style=\"' + style + '\">' +\n                    '<div style=\"' + styleChild + ' width: 200%; height: 200%\"></div>' +\n                '</div>';\n            element.appendChild(element.resizeSensor);\n\n            if (!{fixed: 1, absolute: 1}[getComputedStyle(element, 'position')]) {\n                element.style.position = 'relative';\n            }\n\n            var expand = element.resizeSensor.childNodes[0];\n            var expandChild = expand.childNodes[0];\n            var shrink = element.resizeSensor.childNodes[1];\n            var shrinkChild = shrink.childNodes[0];\n\n            var lastWidth, lastHeight;\n\n            var reset = function() {\n                expandChild.style.width = expand.offsetWidth + 10 + 'px';\n                expandChild.style.height = expand.offsetHeight + 10 + 'px';\n                expand.scrollLeft = expand.scrollWidth;\n                expand.scrollTop = expand.scrollHeight;\n                shrink.scrollLeft = shrink.scrollWidth;\n                shrink.scrollTop = shrink.scrollHeight;\n                lastWidth = element.offsetWidth;\n                lastHeight = element.offsetHeight;\n            };\n\n            reset();\n\n            var changed = function() {\n                if (element.resizedAttached) {\n                    element.resizedAttached.call();\n                }\n            };\n\n            var addEvent = function(el, name, cb) {\n                if (el.attachEvent) {\n                    el.attachEvent('on' + name, cb);\n                } else {\n                    el.addEventListener(name, cb);\n                }\n            };\n\n            var onScroll = function() {\n              if (element.offsetWidth != lastWidth || element.offsetHeight != lastHeight) {\n                  changed();\n              }\n              reset();\n            };\n\n            addEvent(expand, 'scroll', onScroll);\n            addEvent(shrink, 'scroll', onScroll);\n        }\n\n        var elementType = Object.prototype.toString.call(element);\n        var isCollectionTyped = ('[object Array]' === elementType\n            || ('[object NodeList]' === elementType)\n            || ('[object HTMLCollection]' === elementType)\n            || ('undefined' !== typeof jQuery && element instanceof jQuery) //jquery\n            || ('undefined' !== typeof Elements && element instanceof Elements) //mootools\n        );\n\n        if (isCollectionTyped) {\n            var i = 0, j = element.length;\n            for (; i < j; i++) {\n                attachResizeEvent(element[i], callback);\n            }\n        } else {\n            attachResizeEvent(element, callback);\n        }\n\n        this.detach = function() {\n            if (isCollectionTyped) {\n                var i = 0, j = element.length;\n                for (; i < j; i++) {\n                    ResizeSensor.detach(element[i]);\n                }\n            } else {\n                ResizeSensor.detach(element);\n            }\n        };\n    };\n\n    ResizeSensor.detach = function(element) {\n        if (element.resizeSensor) {\n            element.removeChild(element.resizeSensor);\n            delete element.resizeSensor;\n            delete element.resizedAttached;\n        }\n    };\n\n    // make available to common module loader\n    if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n        module.exports = ResizeSensor;\n    }\n    else {\n        window.ResizeSensor = ResizeSensor;\n    }\n\n})();\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./~/css-element-queries/src/ResizeSensor.js\n ** module id = 11\n ** module chunks = 0\n **/","import Vector3 = THREE.Vector3;\nimport {ITrendOptions, Trend, ITrendData} from \"./Trend\";\nimport {EventEmitter} from './EventEmmiter';\nimport {Utils} from './Utils';\nimport {IChartWidgetOptions, ChartWidget} from \"./Widget\";\nimport {TrendsManager, ITrendsOptions} from \"./TrendsManager\";\nimport {Screen} from \"./Screen\";\nimport {AxisMarks} from \"./AxisMarks\";\nimport {\n\tAXIS_TYPE, AXIS_DATA_TYPE, IAxisOptions, IAnimationsOptions, AXIS_RANGE_TYPE\n} from \"./interfaces\";\nimport {Chart} from \"./Chart\";\nimport {Promise} from './deps/deps';\nimport { ChartPlugin } from './Plugin';\n\n\ninterface IRecalculatedStateResult {\n\tchangedProps: IChartState,\n\tpatch: IChartState\n}\n\nconst CHART_STATE_EVENTS = {\n\tINITIAL_STATE_APPLIED: 'initialStateApplied',\n\tREADY: 'ready',\n\tDESTROY: 'destroy',\n\tCHANGE: 'change',\n\tTREND_CHANGE: 'trendChange',\n\tTRENDS_CHANGE: 'trendsChange',\n\tZOOM: 'zoom',\n\tRESIZE: 'resize',\n\tSCROLL: 'scroll',\n\tSCROLL_STOP: 'scrollStop',\n\tPLUGINS_STATE_CHANGED: 'pluginsStateChanged'\n};\n\n/**\n * readonly computed state data\n * calculated after recalculateState() call\n * contains cached values\n */\nexport interface IChartStateComputedData {\n\ttrends?: {\n\t\tmaxXVal: number,\n\t\tminXVal: number\n\t}\n}\n\nexport interface IChartState {\n\tprevState?: IChartState,\n\twidth?: number;\n\theight?: number;\n\tzoom?: number;\n\txAxis?: IAxisOptions,\n\tyAxis?: IAxisOptions,\n\tanimations?: IAnimationsOptions,\n\ttrends?: ITrendsOptions,\n\twidgets?: {[widgetName: string]: IChartWidgetOptions},\n\tcursor?: {\n\t\tdragMode?: boolean,\n\t\tx?: number,\n\t\ty?: number\n\t},\n\n\t/**\n\t * use fps = 0 for no limits\n\t */\n\tautoRender?: {enabled?: boolean, fps?: number};\n\n\t/**\n\t * by default 'WebGLRenderer'\n\t * also available 'CanvasRenderer'\n\t */\n\trenderer?: 'WebGLRenderer' | 'CanvasRenderer';\n\n\n\tautoResize?: boolean;\n\tcontrols?: {enabled: boolean};\n\tautoScroll?: boolean;\n\tshowStats?: boolean;\n\tbackgroundColor?: number;\n\tbackgroundOpacity?: number;\n\tcomputedData?: IChartStateComputedData,\n\t/**\n\t * overridden settings for single setState operation\n\t */\n\toperationState?: IChartState;\n\tpluginsState?: {[pluginName: string]: any};\n\teventEmitterMaxListeners?: number;\n\t[key: string]: any; // for \"for in\" loops\n}\n\n/**\n *  class for manage chart state, all state changes caused only by State.setState method\n */\nexport class ChartState {\n\n\tdata: IChartState = {\n\t\tprevState: {},\n\t\t$el: null,\n\t\tzoom: 0,\n\t\txAxis: {\n\t\t\trange: {\n\t\t\t\ttype: AXIS_RANGE_TYPE.ALL,\n\t\t\t\tfrom: 0,\n\t\t\t\tto: 0,\n\t\t\t\tscroll: 0,\n\t\t\t\tzoom: 1,\n\t\t\t\tpadding: {start: 0, end: 5},\n\t\t\t\tmargin: {start: 0, end: 5}\n\t\t\t},\n\t\t\tdataType: AXIS_DATA_TYPE.NUMBER,\n\t\t\tgridMinSize: 100,\n\t\t\tautoScroll: true,\n\t\t\tmarks: [],\n\t\t},\n\t\tyAxis: {\n\t\t\trange: {\n\t\t\t\ttype: AXIS_RANGE_TYPE.RELATIVE_END,\n\t\t\t\tfrom: 0,\n\t\t\t\tto: 0,\n\t\t\t\tzoom: 1,\n\t\t\t\tpadding: {start: 5, end: 5},\n\t\t\t\tmargin: {start: 5, end: 5}\n\t\t\t},\n\t\t\tdataType: AXIS_DATA_TYPE.NUMBER,\n\t\t\tgridMinSize: 50,\n\t\t\tmarks: []\n\t\t},\n\t\tanimations: {\n\t\t\tenabled: true,\n\t\t\ttrendChangeSpeed: 0.5,\n\t\t\ttrendChangeEase: void 0, //Linear.easeNone,\n\t\t\tzoomSpeed: 0.25,\n\t\t\tzoomEase: Linear.easeNone,\n\t\t\tscrollSpeed: 0.5,\n\t\t\tscrollEase: Linear.easeNone,\n\t\t\tautoScrollSpeed: 1,\n\t\t\tautoScrollEase: Linear.easeNone,\n\t\t},\n\t\tautoRender: {enabled: true, fps: 0},\n\t\tautoResize: true,\n\t\trenderer: 'WebGLRenderer',\n\t\tautoScroll: true,\n\t\tcontrols: {enabled: true},\n\t\tcursor: {\n\t\t\tdragMode: false,\n\t\t\tx: 0,\n\t\t\ty: 0\n\t\t},\n\t\tbackgroundColor: 0x000000,\n\t\tbackgroundOpacity: 1,\n\t\tshowStats: false,\n\t\tpluginsState: {},\n\t\teventEmitterMaxListeners: 20\n\t};\n\twidgetsClasses: {[name: string]: typeof ChartWidget} = {};\n\tplugins: {[pluginName: string]: ChartPlugin} = {};\n\ttrendsManager: TrendsManager;\n\tscreen: Screen;\n\txAxisMarks: AxisMarks;\n\tyAxisMarks: AxisMarks;\n\n\t/**\n\t * true then chartState was initialized and ready to use\n\t */\n\tisReady = false;\n\n\n\tprivate ee: EventEmitter;\n\n\tconstructor(\n\t\tinitialState: IChartState,\n\t\twidgetsClasses: {[name: string]: typeof ChartWidget} = {},\n\t\tplugins: ChartPlugin[] = []\n\t) {\n\t\tthis.ee = new EventEmitter();\n\t\tthis.ee.setMaxListeners(initialState.eventEmitterMaxListeners || this.data.eventEmitterMaxListeners);\n\n\t\tthis.widgetsClasses = widgetsClasses;\n\t\tthis.trendsManager = new TrendsManager(this, initialState);\n\t\tinitialState.trends = this.trendsManager.calculatedOptions;\n\t\tinitialState = this.installPlugins(plugins, initialState);\n\t\tthis.setState(initialState);\n\t\tthis.setState({computedData: this.getComputedData()});\n\t\tthis.savePrevState();\n\n\t\tthis.screen = new Screen(this);\n\t\tthis.xAxisMarks = new AxisMarks(this, AXIS_TYPE.X);\n\t\tthis.yAxisMarks = new AxisMarks(this, AXIS_TYPE.Y);\n\t\tthis.initListeners();\n\t\t\n\t\t// message to other modules that ChartState.data is ready for use \n\t\tthis.ee.emit(CHART_STATE_EVENTS.INITIAL_STATE_APPLIED, initialState);\n\n\t\t// message to other modules that ChartState is ready for use\n\t\tthis.isReady = true;\n\t\tthis.ee.emit(CHART_STATE_EVENTS.READY, initialState);\n\t}\n\n\t/**\n\t * destroy state, use Chart.destroy to completely destroy chart\n\t */\n\tdestroy() {\n\t\tthis.ee.emit(CHART_STATE_EVENTS.DESTROY);\n\t\tthis.ee.removeAllListeners();\n\t\tthis.data = {};\n\t}\n\n\tonDestroy(cb: Function) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.DESTROY, cb);\n\t}\n\n\tonInitialStateApplied(cb: (initialState: IChartState) => void ): Function {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.INITIAL_STATE_APPLIED, cb);\n\t}\n\n\tonReady(cb: (initialState: IChartState) => void ): Function {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.READY, cb);\n\t}\n\n\tonChange(cb: (changedProps: IChartState) => void ) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.CHANGE, cb);\n\t}\n\n\tonTrendChange(cb: (trendName: string, changedOptions: ITrendOptions, newData: ITrendData) => void) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.TREND_CHANGE, cb);\n\t}\n\n\tonTrendsChange(cb: (trendsOptions: ITrendsOptions) => void) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.TRENDS_CHANGE, cb);\n\t}\n\n\tonScrollStop(cb: () => void) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.SCROLL_STOP, cb);\n\t}\n\n\tonScroll(cb: (scrollOptions: {deltaX: number}) => void) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.SCROLL, cb);\n\t}\n\n\tonZoom(cb: (changedProps: IChartState) => void) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.ZOOM, cb);\n\t}\n\n\tonResize(cb: (changedProps: IChartState) => void) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.RESIZE, cb);\n\t}\n\n\tonPluginsStateChange(cb: (changedPluginsStates: {[pluginName: string]: Plugin}) => any) {\n\t\treturn this.ee.subscribe(CHART_STATE_EVENTS.PLUGINS_STATE_CHANGED, cb);\n\t}\n\t\n\tgetTrend(trendName: string): Trend {\n\t\treturn this.trendsManager.getTrend(trendName);\n\t}\n\n\tsetState(newState: IChartState, eventData?: any, silent = false) {\n\t\tvar stateData = this.data;\n\n\t\tvar changedProps: IChartState = {};\n\t\tfor (let key in newState) {\n\t\t\tif ((<any>stateData)[key] !== newState[key]) {\n\t\t\t\tchangedProps[key] = newState[key];\n\t\t\t}\n\t\t}\n\n\t\tthis.savePrevState(changedProps);\n\n\n\t\t// temporary remove trends data from newState by performance reasons\n\t\tlet trendsData: {[trendName: string]: ITrendData} = {};\n\t\tif (newState.trends) for (let trendName in newState.trends) {\n\t\t\tlet trendOptions = newState.trends[trendName];\n\t\t\tif (trendOptions.data) trendsData[trendName] = trendOptions.data;\n\t\t\tdelete trendOptions.data;\n\t\t}\n\t\tlet newStateContainsData = Object.keys(trendsData).length > 0;\n\t\t\n\n\t\tthis.data = Utils.deepMerge(this.data, newState, false);\n\n\t\t// return data to state\n\t\tif (newStateContainsData) for (let trendName in trendsData) {\n\t\t\tthis.data.trends[trendName].data = trendsData[trendName];\n\t\t}\n\n\t\tif (silent) return;\n\n\t\t// recalculate all dynamic state props\n\t\tvar recalculateResult = this.recalculateState(changedProps);\n\t\tchangedProps = recalculateResult.changedProps;\n\t\t\n\t\tthis.emitChangedStateEvents(changedProps, eventData);\n\n\t}\n\n\t/**\n\t * recalculate all computed state props\n\t */\n\tprivate recalculateState(changedProps?: IChartState): IRecalculatedStateResult {\n\t\tvar data = this.data;\n\t\tvar patch: IChartState = {};\n\t\tvar actualData = Utils.deepMerge({}, data);\n\n\t\t// recalculate widgets\n\t\tif (changedProps.widgets || !data.widgets) {\n\t\t\tpatch.widgets = {};\n\t\t\tlet widgetsOptions = data.widgets || {};\n\t\t\tfor (let widgetName in this.widgetsClasses) {\n\t\t\t\tlet WidgetClass =  this.widgetsClasses[widgetName];\n\t\t\t\tlet userOptions = widgetsOptions[widgetName] || {};\n\t\t\t\tlet defaultOptions = WidgetClass.getDefaultOptions() || ChartWidget.getDefaultOptions();\n\t\t\t\tpatch.widgets[widgetName] = Utils.deepMerge(defaultOptions, userOptions) as IChartWidgetOptions;\n\t\t\t}\n\t\t}\n\n\t\t// recalculate scroll position by changed cursor options\n\t\tvar cursorOptions = changedProps.cursor;\n\t\tvar isMouseDrag = cursorOptions && data.cursor.dragMode && data.prevState.cursor.dragMode;\n\t\tif (isMouseDrag) {\n\t\t\tvar oldX = data.prevState.cursor.x;\n\t\t\tvar currentX =  cursorOptions.x;\n\t\t\tvar currentScroll = data.xAxis.range.scroll;\n\t\t\tvar deltaXVal = this.pxToValueByXAxis(oldX - currentX);\n\t\t\tpatch.xAxis = {range: {scroll: currentScroll + deltaXVal}};\n\t\t\tactualData = Utils.deepMerge(actualData, {xAxis: patch.xAxis} as IChartState)\n\t\t}\n\n\t\tlet chartWasResized = changedProps.width != void 0 || changedProps.height != void 0;\n\n\t\tlet scrollXChanged = false;\n\t\tlet needToRecalculateXAxis = (\n\t\t\tisMouseDrag ||\n\t\t\tchartWasResized ||\n\t\t\t(changedProps.xAxis && (changedProps.xAxis.range)) ||\n\t\t\tthis.data.xAxis.range.zeroVal == void 0\n\t\t);\n\t\tif (needToRecalculateXAxis) {\n\t\t\tlet xAxisPatch = this.recalculateXAxis(actualData, changedProps);\n\t\t\tif (xAxisPatch) {\n\t\t\t\tscrollXChanged = true;\n\t\t\t\tpatch = Utils.deepMerge(patch, {xAxis: xAxisPatch});\n\t\t\t\tactualData = Utils.deepMerge(actualData, {xAxis: xAxisPatch} as IChartState);\n\t\t\t}\n\t\t}\n\n\n\n\t\t// recalculate axis \"from\" and \"to\" for dynamics AXIS_RANGE_TYPE\n\t\tlet needToRecalculateYAxis = (\n\t\t\tchartWasResized ||\n\t\t\t(\n\t\t\t\tdata.yAxis.range.type === AXIS_RANGE_TYPE.RELATIVE_END ||\n\t\t\t\tdata.yAxis.range.type === AXIS_RANGE_TYPE.AUTO ||\n\t\t\t\tdata.yAxis.range.isMirrorMode\n\t\t\t) &&\n\t\t\t(scrollXChanged || changedProps.trends || changedProps.yAxis) ||\n\t\t\tthis.data.yAxis.range.zeroVal == void 0\n\t\t);\n\t\tif (needToRecalculateYAxis){\n\t\t\tlet yAxisPatch = this.recalculateYAxis(actualData);\n\t\t\tif (yAxisPatch) {\n\t\t\t\tpatch = Utils.deepMerge(patch, {yAxis: yAxisPatch});\n\t\t\t\tactualData = Utils.deepMerge(actualData, {yAxis: yAxisPatch} as IChartState);\n\t\t\t}\n\t\t}\n\n\t\tthis.savePrevState(patch);\n\t\tlet allChangedProps = Utils.deepMerge(changedProps, patch);\n\t\tpatch.computedData = this.getComputedData(allChangedProps);\n\t\tthis.savePrevState(patch);\n\t\tthis.data = Utils.deepMerge(this.data, patch);\n\t\treturn {changedProps: allChangedProps, patch: patch}\n\t}\n\n\tprivate getComputedData(changedProps?: IChartState): IChartStateComputedData {\n\t\tvar computeAll = !changedProps;\n\t\tvar computedData: IChartStateComputedData = {};\n\n\t\tif (computeAll || changedProps.trends && this.trendsManager) {\n\t\t\tcomputedData.trends = {\n\t\t\t\tmaxXVal: this.trendsManager.getEndXVal(),\n\t\t\t\tminXVal: this.trendsManager.getStartXVal()\n\t\t\t}\n\t\t}\n\t\treturn computedData;\n\t}\n\n\tprivate savePrevState(changedProps?: IChartState) {\n\t\t// var propsToSave = changedProps ? Object.keys(changedProps) : Object.keys(this.data);\n\t\tif (!changedProps) changedProps = this.data;\n\t\tvar prevState = this.data.prevState;\n\n\t\t// prevent to store prev trend data by performance reasons\n\t\tUtils.copyProps(this.data, prevState, changedProps, ['trends']);\n\n\t}\n\n\tprivate emitChangedStateEvents(changedProps: IChartState, eventData: any) {\n\t\tvar prevState = this.data.prevState;\n\n\t\t// emit common change event\n\t\tthis.ee.emit(CHART_STATE_EVENTS.CHANGE, changedProps, eventData);\n\n\t\t// emit event for each changed state property\n\t\tfor (let key in changedProps) {\n\t\t\tthis.ee.emit(key + 'Change', changedProps[key], eventData);\n\t\t}\n\n\t\tif (!this.isReady) return;\n\n\t\t// emit special events based on changed state\n\t\tlet scrollStopEventNeeded = (\n\t\t\tchangedProps.cursor &&\n\t\t\tchangedProps.cursor.dragMode === false &&\n\t\t\tprevState.cursor.dragMode === true\n\t\t);\n\t\tscrollStopEventNeeded && this.ee.emit(CHART_STATE_EVENTS.SCROLL_STOP, changedProps);\n\n\t\tlet scrollChangeEventsNeeded = (\n\t\t\tchangedProps.xAxis &&\n\t\t\tchangedProps.xAxis.range &&\n\t\t\tchangedProps.xAxis.range.scroll !== void 0\n\t\t);\n\t\tscrollChangeEventsNeeded && this.ee.emit(CHART_STATE_EVENTS.SCROLL, changedProps);\n\n\t\tlet zoomEventsNeeded = (\n\t\t\t(changedProps.xAxis && changedProps.xAxis.range && changedProps.xAxis.range.zoom) ||\n\t\t\t(changedProps.yAxis && changedProps.yAxis.range && changedProps.yAxis.range.zoom)\n\t\t);\n\t\tzoomEventsNeeded && this.ee.emit(CHART_STATE_EVENTS.ZOOM, changedProps);\n\n\t\tlet resizeEventNeeded = (changedProps.width || changedProps.height);\n\t\tresizeEventNeeded && this.ee.emit(CHART_STATE_EVENTS.RESIZE, changedProps);\n\n\t\tlet pluginStateChangedEventNeeded = !!(changedProps.pluginsState);\n\t\tpluginStateChangedEventNeeded && this.ee.emit(CHART_STATE_EVENTS.PLUGINS_STATE_CHANGED, changedProps.pluginsState);\n\t}\n\n\n\t/**\n\t * init plugins and save plugins options in initialState\n\t */\n\tprivate installPlugins(plugins: ChartPlugin[], initialState: IChartState): IChartState {\n\t\tinitialState.pluginsState = {};\n\t\tplugins.forEach(plugin => {\n\t\t\tlet PluginClass = plugin.constructor as typeof ChartPlugin;\n\t\t\tlet pluginName = PluginClass.NAME;\n\t\t\tPluginClass.pluginWidgets.forEach(\n\t\t\t\tPluginWidget => this.widgetsClasses[PluginWidget.widgetName] = PluginWidget\n\t\t\t);\n\t\t\tinitialState.pluginsState[pluginName] = Utils.deepMerge({}, plugin.initialState);\n\t\t\tthis.plugins[pluginName] = plugin;\n\t\t\tplugin.setupChartState(this);\n\t\t});\n\t\treturn initialState;\n\t}\n\n\n\t/**\n\t * returns plugin instance by plugin name\n\t * @example\n\t */\n\tgetPlugin(pluginName: string): ChartPlugin {\n\t\treturn this.plugins[pluginName];\n\t}\n\n\n\tprivate initListeners() {\n\t\tthis.ee.on(CHART_STATE_EVENTS.TRENDS_CHANGE, (changedTrends: ITrendsOptions, newData: ITrendData) => {\n\t\t\tthis.handleTrendsChange(changedTrends, newData)\n\t\t});\n\t}\n\n\tprivate handleTrendsChange(changedTrends: ITrendsOptions, newData: ITrendData) {\n\t\tfor (let trendName in changedTrends) {\n\t\t\tthis.ee.emit(CHART_STATE_EVENTS.TREND_CHANGE, trendName, changedTrends[trendName], newData);\n\t\t}\n\t}\n\n\tprivate recalculateXAxis(actualData: IChartState, changedProps: IChartState): IAxisOptions {\n\t\tvar axisRange = actualData.xAxis.range;\n\t\tvar patch: IAxisOptions = {range: {}};\n\t\tvar isInitialize = axisRange.zeroVal == void 0;\n\t\tvar zeroVal: number, scaleFactor: number;\n\t\tvar zoom = axisRange.zoom;\n\n\t\tif (axisRange.isMirrorMode) {\n\t\t\tUtils.error('range.isMirrorMode available only for yAxis.range');\n\t\t}\n\n\t\tif (isInitialize) {\n\t\t\tzeroVal = axisRange.from;\n\t\t\tscaleFactor = actualData.width / (axisRange.to - axisRange.from);\n\t\t\tpatch = { range: {zeroVal: zeroVal, scaleFactor: scaleFactor}};\n\t\t} else {\n\t\t\tzeroVal = axisRange.zeroVal;\n\t\t\tscaleFactor = axisRange.scaleFactor;\n\n\t\t\t// recalculate range.zoom and range.scroll then range.from or range.to was changed\n\t\t\tif (\n\t\t\t\tchangedProps.xAxis &&\n\t\t\t\t(changedProps.xAxis.range.from != void 0 || changedProps.xAxis.range.to)\n\t\t\t) {\n\t\t\t\tif (changedProps.xAxis.range.zoom) {\n\t\t\t\t\tUtils.error('Impossible to change \"range.zoom\" then \"range.from\" or \"range.to\" present');\n\t\t\t\t}\n\t\t\t\tlet currentScaleFactor = actualData.width / (axisRange.to - axisRange.from);\n\t\t\t\tpatch.range.scroll = axisRange.from - zeroVal;\n\t\t\t\tpatch.range.zoom = currentScaleFactor / scaleFactor;\n\t\t\t\treturn patch;\n\t\t\t}\n\t\t}\n\n\n\t\t// recalculate range.from and range.to then range.zoom or range.scroll was changed\n\t\tdo {\n\t\t\tvar from = zeroVal + axisRange.scroll;\n\t\t\tvar to = from + actualData.width / (scaleFactor * zoom);\n\t\t\tvar rangeLength = to - from;\n\t\t\tvar needToRecalculateZoom = false;\n\t\t\tvar rangeMoreThenMaxValue = (axisRange.maxLength && rangeLength > axisRange.maxLength);\n\t\t\tvar rangeLessThenMinValue = (axisRange.minLength && rangeLength < axisRange.minLength);\n\t\t\tneedToRecalculateZoom = rangeMoreThenMaxValue || rangeLessThenMinValue;\n\t\t\tif (needToRecalculateZoom) {\n\t\t\t\tvar fixScale = rangeLength > axisRange.maxLength ?\n\t\t\t\t\trangeLength / axisRange.maxLength :\n\t\t\t\t\trangeLength / axisRange.minLength;\n\t\t\t\tvar zoom = zoom * fixScale;\n\t\t\t\tpatch.range.zoom = zoom;\n\t\t\t}\n\t\t} while (needToRecalculateZoom);\n\n\t\tpatch.range.from = from;\n\t\tpatch.range.to = to;\n\t\treturn patch;\n\t}\n\n\n\tprivate recalculateYAxis(actualData: IChartState): IAxisOptions {\n\t\tvar patch: IAxisOptions = {range: {}};\n\t\tvar yAxisRange = actualData.yAxis.range;\n\t\tvar isInitialize = yAxisRange.scaleFactor == void 0;\n\t\tvar trends = this.trendsManager;\n\t\tvar trendsEndXVal = trends.getEndXVal();\n\t\tvar trendsStartXVal = trends.getStartXVal();\n\t\tvar xRange = actualData.xAxis.range;\n\t\tvar {from: xFrom, to: xTo} = xRange;\n\t\tvar xRangeLength = xTo - xFrom;\n\t\tvar zeroVal: number, scaleFactor: number, scroll: number, zoom: number, needToZoom: boolean;\n\n\t\t// check situation when chart was scrolled behind trends end or before trends start\n\t\tif (xTo > trendsEndXVal) {\n\t\t\txTo = trendsEndXVal;\n\t\t\txFrom = xTo - xRangeLength;\n\t\t} else if (xFrom < trendsStartXVal) {\n\t\t\txFrom = trendsStartXVal;\n\t\t\txTo = xFrom + xRangeLength;\n\t\t}\n\n\t\tvar maxY = trends.getMaxYVal(xFrom, xTo);\n\t\tvar minY = trends.getMinYVal(xFrom, xTo);\n\n\t\tvar trendLastY = trends.getMaxYVal(trendsEndXVal, trendsEndXVal);\n\t\tif (yAxisRange.type == AXIS_RANGE_TYPE.RELATIVE_END) {\n\t\t\tif (trendLastY > maxY) maxY = trendLastY;\n\t\t\tif (trendLastY < minY) minY = trendLastY;\n\t\t}\n\n\t\tif (yAxisRange.isMirrorMode) {\n\t\t\tif (yAxisRange.zeroVal == void 0) Utils.error('range.zeroVal must be set when range.isMirrorMode');\n\t\t\tlet distanceFromZeroValForMaxY = Math.abs(yAxisRange.zeroVal - maxY);\n\t\t\tlet distanceFromZeroValForMinY = Math.abs(yAxisRange.zeroVal - minY);\n\t\t\tlet maxDistanceFromZeroVal = Math.max(distanceFromZeroValForMaxY, distanceFromZeroValForMinY);\n\t\t\tmaxY = yAxisRange.zeroVal + maxDistanceFromZeroVal;\n\t\t\tminY = yAxisRange.zeroVal - maxDistanceFromZeroVal;\n\t\t}\n\t\tlet margin = yAxisRange.margin;\n\t\tlet padding = {\n\t\t\tstart: yAxisRange.padding.start + margin.start,\n\t\t\tend: yAxisRange.padding.end + margin.end\n\t\t};\n\n\t\tif (padding.end + padding.start >= actualData.height) {\n\t\t\tUtils.warn('Sum of padding and margins of yAxi more then available chart height. Trends can be rendered incorrectly');\n\t\t}\n\n\t\tlet rangeLength = maxY - minY;\n\t\tlet paddingTopInPercents = padding.end / actualData.height;\n\t\tlet paddingBottomInPercents = padding.start / actualData.height;\n\t\tlet rangeLengthInPercents = 1 - paddingTopInPercents - paddingBottomInPercents;\n\t\tlet visibleRangeLength = rangeLength / rangeLengthInPercents;\n\t\tlet fromVal = minY - visibleRangeLength * paddingBottomInPercents;\n\t\tlet toVal = maxY + visibleRangeLength * paddingTopInPercents;\n\t\t\n\t\tif (isInitialize) {\n\t\t\tzeroVal = yAxisRange.zeroVal != void 0 ? yAxisRange.zeroVal : fromVal;\n\t\t\tscaleFactor = actualData.height / (toVal - fromVal);\n\t\t\tpatch = { range: {zeroVal: zeroVal, scaleFactor: scaleFactor}};\n\t\t\tneedToZoom = true;\n\t\t} else {\n\t\t\tscaleFactor = yAxisRange.scaleFactor;\n\t\t\tzeroVal = yAxisRange.zeroVal;\n\n\t\t\tlet maxScreenY = Math.round(this.getScreenYByValue(maxY));\n\t\t\tlet minScreenY = Math.round(this.getScreenYByValue(minY));\n\t\t\tneedToZoom = (\n\t\t\t\tmaxScreenY > actualData.height - margin.end ||\n\t\t\t\tmaxScreenY < actualData.height - padding.end ||\n\t\t\t\tminScreenY < margin.start ||\n\t\t\t\tminScreenY > padding.start\n\t\t\t);\n\t\t}\n\n\t\tif (!needToZoom) return null;\n\n\t\tscroll = fromVal - zeroVal;\n\t\tzoom = (actualData.height / (toVal - fromVal)) / scaleFactor ;\n\n\t\tvar currentAxisRange = this.data.yAxis.range;\n\t\tif (currentAxisRange.from !== fromVal) patch.range.from = fromVal;\n\t\tif (currentAxisRange.to !== toVal) patch.range.to = toVal;\n\t\tif (currentAxisRange.scroll !== scroll) patch.range.scroll = scroll;\n\t\tif (currentAxisRange.zoom !== zoom) patch.range.zoom = zoom;\n\t\t\n\t\treturn patch;\n\t}\n\n\tzoom(zoomValue: number, origin = 0.5): Promise<void> {\n\t\tlet {zoom, scroll, scaleFactor} = this.data.xAxis.range;\n\t\tlet newZoom = zoom * zoomValue;\n\t\tlet currentRange = this.data.width / (scaleFactor * zoom);\n\t\tlet nextRange = this.data.width / (scaleFactor * newZoom);\n\t\tlet newScroll = scroll + (currentRange - nextRange) * origin;\n\t\tthis.setState({xAxis: {range: {zoom: newZoom, scroll: newScroll}}});\n\t\treturn new Promise<void>((resolve) => {\n\t\t\tlet animationTime = this.data.animations.enabled ? this.data.animations.zoomSpeed : 0;\n\t\t\tsetTimeout(resolve, animationTime * 1000);\n\t\t});\n\t}\n\t\n\tzoomToRange(range: number, origin?: number): Promise<void> {\n\t\tvar {scaleFactor, zoom} = this.data.xAxis.range;\n\t\tlet currentRange = this.data.width / (scaleFactor * zoom);\n\t\treturn this.zoom(currentRange / range, origin);\n\t}\n\n\tscrollToEnd(): Promise<void> {\n\t\tlet state = this.data;\n\t\tlet endXVal = this.trendsManager.getEndXVal();\n\t\tlet range = state.xAxis.range;\n\t\tvar scroll = endXVal - this.pxToValueByXAxis(state.width) + this.pxToValueByXAxis(range.padding.end) - range.zeroVal;\n\t\tthis.setState({xAxis: {range: {scroll: scroll}}});\n\t\treturn new Promise<void>((resolve) => {\n\t\t\tlet animationTime = this.data.animations.enabled ? this.data.animations.scrollSpeed : 0;\n\t\t\tsetTimeout(resolve, animationTime * 1000);\n\t\t});\n\t}\n\n\t/**\n\t *  returns offset in pixels from xAxis.range.zeroVal to xVal\n\t */\n\tgetPointOnXAxis(xVal: number): number {\n\t\tvar {scaleFactor, zoom, zeroVal} = this.data.xAxis.range;\n\t\treturn (xVal - zeroVal) * scaleFactor * zoom;\n\t}\n\n\t/**\n\t *  returns offset in pixels from yAxis.range.zeroVal to yVal\n\t */\n\tgetPointOnYAxis(yVal: number): number {\n\t\tvar {scaleFactor, zoom, zeroVal} = this.data.yAxis.range;\n\t\treturn (yVal - zeroVal) * scaleFactor * zoom;\n\t}\n\n\t/**\n\t * returns value by offset in pixels from xAxis.range.zeroVal\n\t */\n\tgetValueOnXAxis(x: number): number {\n\t\treturn this.data.xAxis.range.zeroVal + this.pxToValueByXAxis(x);\n\t}\n\n\n\t/**\n\t *  convert value to pixels by using settings from xAxis.range\n\t */\n\tvalueToPxByXAxis(xVal: number) {\n\t\treturn xVal * this.data.xAxis.range.scaleFactor * this.data.xAxis.range.zoom;\n\t}\n\n\n\t/**\n\t *  convert value to pixels by using settings from yAxis.range\n\t */\n\tvalueToPxByYAxis(yVal: number) {\n\t\treturn yVal * this.data.yAxis.range.scaleFactor * this.data.yAxis.range.zoom;\n\t}\n\n\t/**\n\t *  convert pixels to value by using settings from xAxis.range\n\t */\n\tpxToValueByXAxis(xVal: number) {\n\t\treturn xVal / this.data.xAxis.range.scaleFactor / this.data.xAxis.range.zoom;\n\t}\n\n\n\t/**\n\t *  convert pixels to value by using settings from yAxis.range\n\t */\n\tpxToValueByYAxis(yVal: number) {\n\t\treturn yVal / this.data.yAxis.range.scaleFactor / this.data.yAxis.range.zoom;\n\t}\n\n\n\t/**\n\t *  returns x value by screen x coordinate\n\t */\n\tgetValueByScreenX(x: number): number {\n\t\tvar {zeroVal, scroll} = this.data.xAxis.range;\n\t\treturn zeroVal + scroll + this.pxToValueByXAxis(x);\n\t}\n\n\n\t/**\n\t *  returns y value by screen y coordinate\n\t */\n\tgetValueByScreenY(y: number): number {\n\t\tvar {zeroVal, scroll} = this.data.yAxis.range;\n\t\treturn zeroVal + scroll + this.pxToValueByYAxis(y);\n\t}\n\n\n\t/**\n\t *  returns screen x value by screen y coordinate\n\t */\n\tgetScreenXByValue(xVal: number): number {\n\t\tvar {scroll, zeroVal} = this.data.xAxis.range;\n\t\treturn this.valueToPxByXAxis(xVal - zeroVal - scroll)\n\t}\n\n\t/**\n\t *  returns screen y value by screen y coordinate\n\t */\n\tgetScreenYByValue(yVal: number): number {\n\t\tvar {scroll, zeroVal} = this.data.yAxis.range;\n\t\treturn this.valueToPxByYAxis(yVal - zeroVal - scroll)\n\t}\n\n\n\t/**\n\t * returns screen x coordinate by offset in pixels from xAxis.range.zeroVal value\n\t */\n\tgetScreenXByPoint(xVal: number): number {\n\t\treturn this.getScreenXByValue(this.getValueOnXAxis(xVal));\n\t}\n\n\n\t/**\n\t * returns offset in pixels from xAxis.range.zeroVal value by screen x coordinate\n\t */\n\tgetPointByScreenX(screenX: number): number {\n\t\treturn this.getPointOnXAxis(this.getValueByScreenX(screenX));\n\t}\n\n\n\tgetPointOnChart(xVal: number, yVal: number): Vector3 {\n\t\treturn new Vector3(this.getPointOnXAxis(xVal), this.getPointOnYAxis(yVal), 0);\n\t}\n\n\n\tgetScreenLeftVal() {\n\t\treturn this.getValueByScreenX(0);\n\t}\n\n\n\tgetScreenRightVal() {\n\t\treturn this.getValueByScreenX(this.data.width);\n\t}\n\n\n\tgetPaddingRight(): number {\n\t\treturn this.getValueByScreenX(this.data.width - this.data.xAxis.range.padding.end);\n\t}\n\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/State.ts\n **/","import {EE2} from './deps/deps';\n\n/**\n * this class uses as proxy for EventEmitter2\n */\nexport class EventEmitter {\n\tprivate ee: EventEmitter2;\n\tconstructor() {\n\t\tthis.ee = new EE2();\n\t}\n\temit(eventName: string, ...args: any[]) {\n\t\tthis.ee.emit(eventName, ...args)\n\t}\n\ton(eventName: string, callback: Function) {\n\t\treturn this.ee.on(eventName, callback)\n\t}\n\toff(eventName: string, callback: Function) {\n\t\treturn this.ee.off(eventName, callback);\n\t}\n\tsubscribe(eventName: string, callback: Function): Function {\n\t\tthis.on(eventName, callback);\n\t\treturn () => this.off(eventName, callback);\n\t}\n\tsetMaxListeners(listenersCount: number) {\n\t\tthis.ee.setMaxListeners(listenersCount);\n\t}\n\tremoveAllListeners(eventName?: string) {\n\t\tthis.ee.removeAllListeners(eventName);\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/EventEmmiter.ts\n **/","import Texture = THREE.Texture;\nimport Color = THREE.Color;\nimport { TIteralable, IIteralable } from \"./interfaces\";\nimport { isPlainObject } from './deps/deps';\n\nfunction deepmerge(target: any, src: any, mergeArrays = true) {\n\tvar array = Array.isArray(src);\n\tvar dst: any = array && [] || {};\n\n\tif (array) {\n\t\ttarget = target || [];\n\t\tif (mergeArrays) {\n\t\t\tdst = dst.concat(target);\n\t\t}\n\t\tsrc.forEach(function(e: any, i: any) {\n\t\t\tif (typeof dst[i] === 'undefined') {\n\t\t\t\tdst[i] = e;\n\t\t\t} else if (typeof e === 'object') {\n\t\t\t\tdst[i] = deepmerge(target[i], e, mergeArrays);\n\t\t\t} else {\n\t\t\t\tif (target.indexOf(e) === -1) {\n\t\t\t\t\tdst.push(e);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t} else {\n\t\tif (target && typeof target === 'object') {\n\t\t\tObject.keys(target).forEach(function (key) {\n\t\t\t\tdst[key] = target[key];\n\t\t\t})\n\t\t}\n\t\tObject.keys(src).forEach(function (key) {\n\t\t\tif (typeof src[key] !== 'object' || !src[key]) {\n\t\t\t\tdst[key] = src[key];\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (!target[key]) {\n\t\t\t\t\tdst[key] = src[key];\n\t\t\t\t} else {\n\t\t\t\t\tdst[key] = deepmerge(target[key], src[key], mergeArrays);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\treturn dst;\n}\n\n\n\nexport declare type TUid = number;\n\n/**\n * project utils static class\n */\nexport class Utils {\n\n\tprivate static currentId: TUid = 1;\n\n\t/**\n\t * deepMerge based on https://www.npmjs.com/package/deepmerge\n\t */\n\tstatic deepMerge<T> (obj1: T, obj2: T, mergeArrays?: boolean) {\n\t\treturn deepmerge(obj1, obj2, mergeArrays) as T;\n\t}\n\n\t/**\n\t * deepCopy based on JSON.stringify function\n\t * @deprecated\n\t */\n\tstatic deepCopy<T> (obj: T) {\n\t\t// TODO: use deepMerge function to copy\n\t\treturn JSON.parse(JSON.stringify(obj)) as T;\n\t}\n\n\t/**\n\t *\n\t * @example\n\t * // returns \"000015\"\n\t * Utils.toFixed(15, 6);\n\t */\n\tstatic toFixed(num: number, digitsCount: number): string {\n\t\tvar maxDigits = 15;\n\t\tvar result = '';\n\t\tvar intVal = Math.floor(num);\n\t\tvar intStr = intVal.toString();\n\t\tvar lengthDiff = digitsCount - intStr.length;\n\t\tif (lengthDiff > 0 ) {\n\t\t\tresult = (<any>'0').repeat(lengthDiff) + intStr;\n\t\t} else {\n\t\t\tresult = intStr;\n\t\t}\n\t\tvar afterPointDigitsCount = maxDigits - intStr.length;\n\t\tvar afterPointStr = num.toString().split('.')[1];\n\t\tif (afterPointStr) {\n\t\t\tresult += '.' + afterPointStr.substr(0, afterPointDigitsCount);\n\t\t}\n\t\treturn result;\n\t}\n\n\tstatic bindEvent() {\n\n\t}\n\n\t/**\n\t * generate texture from canvas context\n\t * @example\n\t * \t// create texture with rect\n\t *  var texture = Utils.createTexture(20, 20, (ctx) => {ctx.fillRect(0, 0, 10, 10)});\n\t */\n\tstatic createTexture(width: number, height: number, fn: (ctx: CanvasRenderingContext2D) => void ): Texture {\n\t\tvar canvas: HTMLCanvasElement = document.createElement('canvas');\n\t\tcanvas.width = width;\n\t\tcanvas.height = height;\n\t\tvar ctx = canvas.getContext('2d');\n\t\tfn(ctx);\n\t\tvar texture = new THREE.Texture(canvas);\n\t\ttexture.needsUpdate = true;\n\t\treturn texture;\n\t}\n\n\t/**\n\t * generate texture from canvas context with NearestFilter\n\t * @example\n\t * \t// create texture with rect\n\t *  var texture = Utils.createTexture(20, 20, (ctx) => {ctx.fillRect(0, 0, 10, 10)});\n\t */\n\tstatic createPixelPerfectTexture(width: number, height: number, fn: (ctx: CanvasRenderingContext2D) => void ): Texture{\n\t\tvar texture = this.createTexture(width, height, fn);\n\t\t// texture.magFilter = THREE.NearestFilter;\n\t\ttexture.minFilter = THREE.NearestFilter;\n\t\treturn texture;\n\t}\n\n\t/**\n\t * throw error\n\t */\n\tstatic error(msg: string) {\n\t\tconsole.error('Chart error: ' + msg);\n\t\tthrow 'Chart: ' + msg;\n\t}\n\n\t/**\n\t * throw error\n\t */\n\tstatic warn(msg: string) {\n\t\tconsole.warn('Chart warning: ' + msg);\n\t}\n\n\t/**\n\t * @returns new unique id\n\t */\n\tstatic getUid(): TUid {\n\t\treturn this.currentId++;\n\t}\n\n\t/**\n\t * @returns distance between numbers\n\t */\n\tstatic getDistance(num1: number, num2: number) {\n\t\treturn Math.max(num1, num2) - Math.min(num1, num2);\n\t}\n\n\tstatic binarySearchClosestInd(arr: IIteralable[], num: number, key: string): number {\n\t\tvar mid: number;\n\t\tvar lo = 0;\n\t\tvar hi = arr.length - 1;\n\t\twhile (hi - lo > 1) {\n\t\t\tmid = Math.floor ((lo + hi) / 2);\n\t\t\tif (arr[mid][key] < num) {\n\t\t\t\tlo = mid;\n\t\t\t} else {\n\t\t\t\thi = mid;\n\t\t\t}\n\t\t}\n\t\tif (num - arr[lo][key] <= arr[hi][key] - num) {\n\t\t\treturn lo;\n\t\t}\n\t\treturn hi;\n\t}\n\t\n\tstatic binarySearchClosest<ArrayItem>(arr: ArrayItem[], num: number, key: string): ArrayItem {\n\t\tlet ind = this.binarySearchClosestInd(arr, num, key);\n\t\treturn arr[ind];\n\t}\n\n\n\tstatic rectsIntersect(r1: number[], r2: number[]) {\n\t\tlet [left1, top1, width1, height1] = r1;\n\t\tlet [left2, top2, width2, height2] = r2;\n\t\tlet [right1, right2, bottom1, bottom2] = [left1 + width1, left2 + width2, top1 + height1, top2 + height2];\n\t\treturn !(left2 > right1 ||\n\t\t\tright2 < left1 ||\n\t\t\ttop2 > bottom1 ||\n\t\t\tbottom2 < top1\n\t\t);\n\t}\n\n\n\t/**!\n\t * @preserve $.parseColor\n\t * Copyright 2011 THEtheChad Elliott\n\t * Released under the MIT and GPL licenses.\n\t */\n\n\n// Parse hex/rgb{a} color syntax.\n// @input string\n// @returns array [r,g,b{,o}]\n\tstatic parseColor(color: string): number[] {\n\n\t\tvar cache: any\n\t\t\t, p = parseInt // Use p as a byte saving reference to parseInt\n\t\t\t, color = color.replace(/\\s\\s*/g, '') // Remove all spaces\n\t\t\t;//var\n\n\t\t// Checks for 6 digit hex and converts string to integer\n\t\tif (cache = /^#([\\da-fA-F]{2})([\\da-fA-F]{2})([\\da-fA-F]{2})/.exec(color))\n\t\t\tcache = [p(cache[1], 16), p(cache[2], 16), p(cache[3], 16)];\n\n\t\t// Checks for 3 digit hex and converts string to integer\n\t\telse if (cache = /^#([\\da-fA-F])([\\da-fA-F])([\\da-fA-F])/.exec(color))\n\t\t\tcache = [p(cache[1], 16) * 17, p(cache[2], 16) * 17, p(cache[3], 16) * 17];\n\n\t\t// Checks for rgba and converts string to\n\t\t// integer/float using unary + operator to save bytes\n\t\telse if (cache = /^rgba\\(([\\d]+),([\\d]+),([\\d]+),([\\d]+|[\\d]*.[\\d]+)\\)/.exec(color))\n\t\t\tcache = [+cache[1], +cache[2], +cache[3], +cache[4]];\n\n\t\t// Checks for rgb and converts string to\n\t\t// integer/float using unary + operator to save bytes\n\t\telse if (cache = /^rgb\\(([\\d]+),([\\d]+),([\\d]+)\\)/.exec(color))\n\t\t\tcache = [+cache[1], +cache[2], +cache[3]];\n\n\t\t// Otherwise throw an exception to make debugging easier\n\t\telse throw Error(color + ' is not supported by $.parseColor');\n\n\t\t// Performs RGBA conversion by default\n\t\tisNaN(cache[3]) && (cache[3] = 1);\n\t\treturn cache;\n\t\t// Adds or removes 4th value based on rgba support\n\t\t// Support is flipped twice to prevent erros if\n\t\t// it's not defined\n\t\t//return cache.slice(0,3 + !!$.support.rgba);\n\t}\n\n\tstatic getHexColor(str: string): number {\n\t\tvar rgb = this.parseColor(str);\n\t\treturn (rgb[0] << (8 * 2)) + (rgb[1] << 8) + rgb[2];\n\t}\n\n\tstatic throttle(func: Function, ms: number) {\n\n\t\tvar isThrottled = false,\n\t\t\tsavedArgs: any,\n\t\t\tsavedThis: any;\n\n\t\tfunction wrapper() {\n\n\t\t\tif (isThrottled) { // (2)\n\t\t\t\tsavedArgs = arguments;\n\t\t\t\tsavedThis = this;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tfunc.apply(this, arguments); // (1)\n\n\t\t\tisThrottled = true;\n\n\t\t\tsetTimeout(function () {\n\t\t\t\tisThrottled = false; // (3)\n\t\t\t\tif (savedArgs) {\n\t\t\t\t\twrapper.apply(savedThis, savedArgs);\n\t\t\t\t\tsavedArgs = savedThis = null;\n\t\t\t\t}\n\t\t\t}, ms);\n\t\t}\n\n\t\treturn wrapper;\n\t}\n\n\tstatic msToTimeString(timestamp: number) {\n\t\tvar h = Math.floor(timestamp / 360000);\n\t\tvar m =  Math.floor(timestamp / 60000);\n\t\tvar s =  Math.floor(timestamp / 1000);\n\t\treturn h + ':' + m + ':' + s;\n\t}\n\t\n\tstatic getRandomItem<T>(arr: Array<T>): T {\n\t\tvar ind = Math.floor(Math.random() * arr.length);\n\t\treturn arr[ind];\n\t}\n\n\tstatic copyProps(srcObject: TIteralable, dstObject: TIteralable, props: TIteralable, excludeProps: string[] = []) {\n\t\tfor (var key in props) {\n\t\t\tif (excludeProps.indexOf(key) !== -1) continue;\n\t\t\tif (srcObject[key] == void 0) continue;\n\t\t\tif (isPlainObject(props[key]) && dstObject[key] !== void 0) {\n\t\t\t\tthis.copyProps(srcObject[key], dstObject[key], props[key])\n\t\t\t} else {\n\t\t\t\tdstObject[key] = this.deepCopy(srcObject[key]);\n\t\t\t}\n\t\t}\n\t}\n\n\n\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Utils.ts\n **/","import {ChartState} from \"./State\";\nimport Object3D = THREE.Object3D;\n\nexport interface IChartWidgetConstructor {\n\tnew (chartState: ChartState): ChartWidget;\n\twidgetName: string;\n\tgetDefaultOptions(): IChartWidgetOptions;\n}\n\n/**\n * base class for all widgets\n * each widget must have widgetName static property\n */\nexport abstract class ChartWidget {\n\tstatic widgetName = '';\n\tprotected chartState: ChartState;\n\tprivate unsubscribers: Function[] = [];\n\n\tconstructor (chartState: ChartState) {\n\t\tthis.chartState = chartState;\n\t\tthis.bindEvents();\n\t}\n\n\t\n\tabstract getObject3D(): Object3D;\n\t\n\tprotected bindEvents() {}\n\n\tprotected bindEvent(...args: Array<Function | Function[]>): void {\n\t\tlet unsubscribers: Function[] = [];\n\t\tif (!Array.isArray(args[0])) {\n\t\t\tunsubscribers.push(args[0] as Function);\n\t\t} else {\n\t\t\tunsubscribers.push(...args as Function[]);\n\t\t}\n\t\tthis.unsubscribers.push(...unsubscribers);\n\t}\n\tprotected unbindEvents() {\n\t\tthis.unsubscribers.forEach(unsubscriber => unsubscriber());\n\t\tthis.unsubscribers.length = 0;\n\t}\n\t\n\tstatic getDefaultOptions(): IChartWidgetOptions {\n\t\treturn {enabled: true}\n\t}\n}\n\nexport interface IChartWidgetOptions {\n\tenabled: boolean\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Widget.ts\n **/","\nimport {Trend, ITrendOptions} from \"./Trend\";\nimport {ChartState, IChartState} from \"./State\";\nimport { EventEmitter } from './EventEmmiter';\n\nexport interface ITrendsOptions {\n\t[trendName: string]: ITrendOptions;\n}\n\nconst EVENTS = {\n\tSEGMENTS_REBUILDED: 'segmentsRebuilded'\n};\n\n/**\n * Trends manager\n */\nexport class TrendsManager {\n\ttrends: {[name: string]: Trend} = {};\n\tcalculatedOptions: ITrendsOptions;\n\tprivate ee = new EventEmitter();\n\tprivate chartState: ChartState;\n\t\n\tconstructor(state: ChartState, initialState: IChartState) {\n\t\tthis.chartState = state;\n\t\tvar trendsCalculatedOptions: ITrendsOptions = {};\n\t\tfor (let trendName in initialState.trends) {\n\t\t\tlet trend = this.createTrend(state, trendName, initialState);\n\t\t\ttrendsCalculatedOptions[trendName] = trend.getCalculatedOptions();\n\t\t}\n\t\tthis.calculatedOptions = trendsCalculatedOptions;\n\t\tthis.bindEvents();\n\t}\n\n\tgetTrend(trendName: string) {\n\t\treturn this.trends[trendName];\n\t}\n\t\n\tgetEnabledTrends(): Trend[] {\n\t\tvar enabledTrends: Trend[] = [];\n\t\tvar allTrends = this.trends;\n\t\tfor (let trendName in allTrends) {\n\t\t\tlet trend = allTrends[trendName];\n\t\t\ttrend.getOptions().enabled && enabledTrends.push(trend);\n\t\t}\n\t\treturn enabledTrends;\n\t}\n\n\n\tgetStartXVal() {\n\t\tvar trends = this.getEnabledTrends();\n\t\treturn trends[0].getData()[0].xVal;\n\t}\n\n\n\tgetEndXVal(): number {\n\t\tvar trends = this.getEnabledTrends();\n\t\tvar firstTrendData = trends[0].getData();\n\t\treturn firstTrendData[firstTrendData.length - 1].xVal;\n\t}\n\t\n\t\n\tgetExtremumYVal(extremumIsMax: boolean, fromX?: number, toX?: number) {\n\t\tvar trends = this.getEnabledTrends();\n\t\tvar compareFn: Function;\n\t\tvar result: number;\n\t\tif (extremumIsMax) {\n\t\t\tresult = -Infinity;\n\t\t\tcompareFn = Math.max;\n\t\t} else {\n\t\t\tresult = Infinity;\n\t\t\tcompareFn = Math.min;\n\t\t}\n\t\tfor (let trend of trends) {\n\t\t\tvar trendData = trend.getData(fromX, toX);\n\t\t\tvar trendYValues = trendData.map((dataItem) => dataItem.yVal);\n\t\t\tresult = compareFn(result, ...trendYValues);\n\t\t}\n\t\tif (result == Infinity || result == -Infinity) result = NaN;\n\t\treturn result;\n\t}\n\n\tgetMaxYVal(fromX?: number, toX?: number) {return this.getExtremumYVal(true, fromX, toX)}\n\tgetMinYVal(fromX?: number, toX?: number) {return this.getExtremumYVal(false, fromX, toX)}\n\n\tonSegmentsRebuilded(cb: (trendName: string) => any) {\n\t\treturn this.ee.subscribe(EVENTS.SEGMENTS_REBUILDED, cb);\n\t}\n\n\tprivate bindEvents() {\n\t\tthis.chartState.onInitialStateApplied(() => this.onInitialStateAppliedHandler());\n\t}\n\n\tprivate onInitialStateAppliedHandler() {\n\t\tfor (let trendName in this.trends) {\n\t\t\tthis.trends[trendName].segments.onRebuild(() => this.ee.emit(EVENTS.SEGMENTS_REBUILDED, trendName));\n\t\t}\n\t}\n\n\tprivate createTrend(state: ChartState, trendName: string, initialState: IChartState): Trend {\n\t\tlet trend = new Trend(state, trendName, initialState);\n\t\tthis.trends[trendName] = trend;\n\t\treturn trend;\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/TrendsManager.ts\n **/","import {ChartState, IChartState} from \"./State\";\nimport {Utils} from \"./Utils\";\nimport {TrendSegments} from \"./TrendSegments\";\nimport {EventEmitter} from './EventEmmiter';\nimport {Promise} from './deps/deps';\n\nexport interface IPrependPromiseExecutor {\n\t(requestedDataLength: number, resolve: (data: TTrendRawData) => void, reject: () => void): void;\n}\nconst EVENTS = {\n\tCHANGE: 'Change',\n\tPREPEND_REQUEST: 'prependRequest'\n};\nexport enum TREND_TYPE {LINE, CANDLE}\nexport type TTrendRawData = ITrendData | number[];\nexport interface ITrendItem {xVal: number, yVal: number, id?: number}\nexport interface ITrendData extends Array<ITrendItem>{}\nexport interface ITrendTypeSettings {\n\tminSegmentLengthInPx?: number;\n\tmaxSegmentLengthInPx?: number;\n}\nexport interface ITrendOptions {\n\tenabled?: boolean,\n\tdata?: ITrendData\n\tdataset?: ITrendData | number[];\n\tname?: string;\n\ttype?: TREND_TYPE;\n\tlineWidth?: number;\n\tlineColor?: number;\n\thasGradient?: boolean;\n\thasIndicator?: boolean;\n\thasBeacon?: boolean;\n\tmaxSegmentLength?: number;\n\tsettingsForTypes?: {\n\t\tCANDLE?: ITrendTypeSettings,\n\t\tLINE?: ITrendTypeSettings\n\t}\n}\n\nconst DEFAULT_OPTIONS: ITrendOptions = {\n\tenabled: true,\n\ttype: TREND_TYPE.LINE,\n\tdata: [],\n\tmaxSegmentLength: 1000,\n\tlineWidth: 2,\n\tlineColor: 0xFFFFFF,\n\thasGradient: true,\n\thasBeacon: false,\n\tsettingsForTypes: {\n\t\tCANDLE: {\n\t\t\tminSegmentLengthInPx: 20,\n\t\t\tmaxSegmentLengthInPx: 40,\n\t\t},\n\t\tLINE: {\n\t\t\tminSegmentLengthInPx: 2,\n\t\t\tmaxSegmentLengthInPx: 10,\n\t\t}\n\t}\n};\n\nexport class Trend {\n\tname: string;\n\tsegments: TrendSegments;\n\tminXVal = Infinity;\n\tminYVal = Infinity;\n\tmaxXVal = -Infinity;\n\tmaxYVal = -Infinity;\n\tprivate chartState: ChartState;\n\tprivate calculatedOptions: ITrendOptions;\n\tprivate prependRequest: Promise<TTrendRawData>;\n\tprivate ee: EventEmitter;\n\t\n\tconstructor(chartState: ChartState, trendName: string, initialState: IChartState) {\n\t\tvar options = initialState.trends[trendName];\n\t\tthis.name = trendName;\n\t\tthis.chartState = chartState;\n\t\tthis.calculatedOptions = Utils.deepMerge(DEFAULT_OPTIONS, options);\n\t\tthis.calculatedOptions.name = trendName;\n\t\tif (options.dataset) this.calculatedOptions.data = Trend.prepareData(options.dataset);\n\t\tthis.calculatedOptions.dataset = [];\n\t\tthis.ee = new EventEmitter();\n\t\tthis.bindEvents();\n\t}\n\n\tprivate onInitialStateApplied() {\n\t\tthis.segments = new TrendSegments(this.chartState, this);\n\t}\n\n\tprivate bindEvents() {\n\t\tvar chartState = this.chartState;\n\t\tchartState.onInitialStateApplied(() => this.onInitialStateApplied());\n\t\tchartState.onScrollStop(() => this.checkForPrependRequest());\n\t\tchartState.onZoom(() => this.checkForPrependRequest());\n\t\tchartState.onTrendChange((trendName, changedOptions, newData) => this.ee.emit(EVENTS.CHANGE, changedOptions, newData));\n\t\tchartState.onDestroy(() => this.ee.removeAllListeners());\n\t}\n\n\tgetCalculatedOptions() {\n\t\treturn this.calculatedOptions;\n\t}\n\n\tappendData(rawData: TTrendRawData) {\n\t\tvar options = this.getOptions();\n\t\tvar newData = Trend.prepareData(rawData, this.getData());\n\t\tvar updatedTrendData = options.data.concat(newData);\n\t\tthis.changeData(updatedTrendData, newData);\n\t}\n\n\tprependData(rawData: TTrendRawData) {\n\t\tvar options = this.getOptions();\n\t\tvar newData = Trend.prepareData(rawData, this.getData(), true);\n\t\tvar updatedTrendData = newData.concat(options.data);\n\t\tthis.changeData(updatedTrendData, newData);\n\t}\n\n\tprivate changeData(allData: ITrendData, newData: ITrendData) {\n\t\tfor (let item of newData) {\n\t\t\tif (item.xVal < this.minXVal) this.minXVal = item.xVal;\n\t\t\tif (item.xVal > this.maxXVal) this.maxXVal = item.xVal;\n\t\t\tif (item.yVal < this.minYVal) this.minYVal = item.yVal;\n\t\t\tif (item.yVal > this.maxYVal) this.maxYVal = item.yVal;\n\t\t}\n\t\tvar options = this.getOptions();\n\t\tvar statePatch: IChartState = {trends: {[options.name]: {data: allData}}};\n\t\tthis.chartState.setState(statePatch, newData);\n\t}\n\t\n\tgetData(fromX?: number, toX?: number): ITrendData {\n\t\tvar data = this.getOptions().data;\n\t\tif (fromX == void 0 && toX == void 0) return data;\n\n\t\tfromX = fromX !== void 0 ? fromX : data[0].xVal;\n\t\ttoX = toX !== void 0 ? toX : data[data.length].xVal;\n\t\tvar filteredData: ITrendData = [];\n\t\tfor (let item of data) {\n\t\t\tif (item.xVal < fromX) continue;\n\t\t\tif (item.xVal > toX) break;\n\t\t\tfilteredData.push(item)\n\t\t}\n\t\treturn filteredData;\n\t}\n\n\tgetFirstItem(): ITrendItem {\n\t\treturn this.getOptions().data[0];\n\t}\n\t\n\tgetLastItem(): ITrendItem {\n\t\tvar data = this.getOptions().data;\n\t\treturn data[data.length - 1];\n\t}\n\n\tgetOptions() {\n\t\treturn this.chartState.data.trends[this.name]\n\t}\n\n\tsetOptions(options: ITrendOptions) {\n\t\tthis.chartState.setState({trends: {[this.name]: options}});\n\t}\n\n\tonPrependRequest(cb: IPrependPromiseExecutor): Function {\n\t\tthis.ee.on(EVENTS.PREPEND_REQUEST, cb);\n\t\treturn () => {\n\t\t\tthis.ee.off(EVENTS.PREPEND_REQUEST, cb);\n\t\t}\n\t}\n\n\t/**\n\t * shortcut for ChartState.onTrendChange\n\t */\n\tonChange(cb: (changedOptions: ITrendOptions, newData: ITrendData) => void): Function {\n\t\tthis.ee.on(EVENTS.CHANGE, cb);\n\t\treturn () => { this.ee.off(EVENTS.CHANGE, cb);}\n\t}\n\n\tonDataChange(cb: (newData: ITrendData) => void): Function {\n\t\tvar onChangeCb = (changedOptions: ITrendOptions, newData: ITrendData) => {\n\t\t\tif (newData) cb(newData);\n\t\t};\n\t\tthis.ee.on(EVENTS.CHANGE, onChangeCb);\n\t\treturn () => {\n\t\t\tthis.ee.off(EVENTS.CHANGE, onChangeCb);\n\t\t}\n\t}\n\n\tprivate checkForPrependRequest() {\n\t\tif (this.prependRequest) return;\n\t\tvar chartState = this.chartState;\n\t\tvar minXVal = chartState.data.computedData.trends.minXVal;\n\t\tvar minScreenX = chartState.getScreenXByValue(minXVal);\n\t\tvar needToRequest = minScreenX > 0;\n\t\tvar {from, to} = chartState.data.xAxis.range;\n\t\tvar requestedDataLength = to - from;\n\t\tif (!needToRequest) return;\n\t\t\n\t\tthis.prependRequest = new Promise<TTrendRawData>((resolve: Function, reject: Function) => {\n\t\t\tthis.ee.emit(EVENTS.PREPEND_REQUEST, requestedDataLength, resolve, reject);\n\t\t});\n\n\t\tthis.prependRequest.then((newData: TTrendRawData) => {\n\t\t\tthis.prependData(newData);\n\t\t\tthis.prependRequest = null;\n\t\t}, () => {\n\t\t\tthis.prependRequest = null;\n\t\t})\n\t\n\t}\n\n\tstatic prepareData (newData: TTrendRawData, currentData?: ITrendData, isPrepend = false): ITrendData {\n\t\tvar data: ITrendData = [];\n\t\tif (typeof newData[0] == 'number') {\n\t\t\tcurrentData = currentData || [];\n\t\t\tlet initialItem: ITrendItem;\n\t\t\tlet xVal: number;\n\t\t\tif (isPrepend) {\n\t\t\t\tinitialItem = currentData[0];\n\t\t\t\txVal = initialItem.xVal - newData.length;\n\t\t\t} else {\n\t\t\t\tinitialItem = currentData[currentData.length - 1];\n\t\t\t\txVal = initialItem ? initialItem.xVal + 1 : 0;\n\t\t\t}\n\t\t\tfor (let yVal of newData as number[]) {\n\t\t\t\tdata.push({xVal: xVal, yVal: yVal, id: Utils.getUid()});\n\t\t\t\txVal++;\n\t\t\t}\n\t\t} else {\n\t\t\tdata = newData as ITrendData;\n\t\t}\n\t\treturn data;\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Trend.ts\n **/","import { IIteralable } from \"./interfaces\";\nimport { EventEmitter } from './EventEmmiter';\nimport { ChartState } from \"./State\";\nimport Vector3 = THREE.Vector3;\nimport { ITrendData, ITrendOptions, ITrendItem, Trend, TREND_TYPE, ITrendTypeSettings } from \"./Trend\";\nimport { Utils } from \"./Utils\";\nimport convertArray = THREE.AnimationUtils.convertArray;\n\nconst MAX_ANIMATED_SEGMENTS = 100;\nconst EVENTS = {\n\tREBUILD: 'rebuild',\n\tDISLPAYED_RANGE_CHANGED: 'displayedRangeChanged',\n\tANIMATION_FRAME: 'animationFrame'\n};\n\n/**\n *  Class helps to display and animate trends segments\n */\nexport class TrendSegments {\n\tsegmentsById: {[id: string]: TrendSegment} = {};\n\tsegments: TrendSegment[] = [];\n\tchartState: ChartState;\n\tanimatedSegmentsIds: number[] = [];\n\tmaxSegmentLength: number;\n\tsegmentsLength = 0;\n\tfirstDisplayedSegment: TrendSegment;\n\tlastDisplayedSegment: TrendSegment;\n\tprivate appendAnimation: TweenLite;\n\tprivate prependAnimation: TweenLite;\n\tprivate animatedSegmentsForAppend: number[] = [];\n\tprivate animatedSegmentsForPrepend: number[] = [];\n\tprivate nextEmptyId = 0;\n\tprivate startSegmentId = 0;\n\tprivate endSegmentId = 0;\n\tprivate trend: Trend;\n\tprivate ee: EventEmitter;\n\n\tconstructor (chartState: ChartState, trend: Trend) {\n\t\tthis.chartState = chartState;\n\t\tthis.ee = new EventEmitter();\n\t\tthis.trend = trend;\n\t\tthis.maxSegmentLength = trend.getOptions().maxSegmentLength;\n\t\tthis.tryToRebuildSegments();\n\t\tthis.bindEvents();\n\t}\n\n\tprotected bindEvents() {\n\t\tthis.trend.onChange((changedOptions, newData) => this.onTrendChangeHandler(changedOptions, newData));\n\t\tthis.chartState.onZoom(() => this.onZoomHandler());\n\t\tthis.chartState.onScroll(() => this.recalculateDisplayedRange());\n\t\tthis.chartState.onDestroy(() => this.onDestroyHandler());\n\t}\n\n\tprivate onDestroyHandler() {\n\t\tthis.ee.removeAllListeners();\n\t\tthis.appendAnimation && this.appendAnimation.kill();\n\t\tthis.prependAnimation && this.prependAnimation.kill();\n\t}\n\n\tprivate onZoomHandler() {\n\t\tlet segmentsRebuilded = this.tryToRebuildSegments();\n\t\tif (!segmentsRebuilded) {\n\t\t\tthis.recalculateDisplayedRange()\n\t\t}\n\t}\n\n\tprivate onTrendChangeHandler(changedOptions: ITrendOptions, newData: ITrendData) {\n\t\tvar needToRebuildSegments = (\n\t\t\tchangedOptions.type != void 0 ||\n\t\t\tchangedOptions.maxSegmentLength != void 0\n\t\t);\n\n\n\t\tif (needToRebuildSegments) {\n\t\t\tthis.tryToRebuildSegments(true);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!newData) return;\n\n\t\tvar data = this.trend.getData();\n\t\tvar isAppend = (!data.length || data[0].xVal < newData[0].xVal);\n\t\tisAppend ? this.appendData(newData) : this.prependData(newData);\n\t\tthis.recalculateDisplayedRange();\n\t}\n\n\tgetEndSegment(): TrendSegment {\n\t\treturn this.segmentsById[this.endSegmentId];\n\t}\n\n\tgetStartSegment(): TrendSegment {\n\t\treturn this.segmentsById[this.startSegmentId];\n\t}\n\t\n\tprivate tryToRebuildSegments(force = false): boolean {\n\t\tlet options = this.trend.getOptions();\n\t\tlet trendTypeName = TREND_TYPE[options.type] as string;\n\t\tlet trendTypesSettings =  options.settingsForTypes as IIteralable;\n\t\tlet trendTypeSettings = trendTypesSettings[trendTypeName] as ITrendTypeSettings;\n\t\tlet {\n\t\t\tminSegmentLengthInPx,\n\t\t\tmaxSegmentLengthInPx\n\t\t} = trendTypeSettings;\n\n\t\tlet needToRebuild = this.segments.length === 0 || force;\n\t\tlet segmentLength = this.maxSegmentLength;\n\n\t\t// call toFixed(2) to prevent floating segment error compare\n\t\tlet currentSegmentLengthInPx = Number(this.chartState.valueToPxByXAxis(segmentLength).toFixed(2));\n\t\tlet currentMaxSegmentLengthInPx = Number(this.chartState.valueToPxByXAxis(this.maxSegmentLength).toFixed(2));\n\n\t\tif (currentSegmentLengthInPx < minSegmentLengthInPx) {\n\t\t\tneedToRebuild = true;\n\t\t\tsegmentLength = Math.ceil(this.chartState.pxToValueByXAxis(maxSegmentLengthInPx));\n\t\t} else if (currentMaxSegmentLengthInPx > maxSegmentLengthInPx) {\n\t\t\tneedToRebuild = true;\n\t\t\tsegmentLength = this.chartState.pxToValueByXAxis(minSegmentLengthInPx);\n\t\t}\n\n\t\tif (!needToRebuild) return false;\n\n\t\tthis.maxSegmentLength = segmentLength;\n\t\tthis.segmentsById = {};\n\t\tthis.segments = [];\n\t\tthis.nextEmptyId = 0;\n\t\tthis.startSegmentId = 0;\n\t\tthis.endSegmentId = 0;\n\t\tthis.segmentsLength = 0;\n\t\tthis.stopAllAnimations();\n\t\tthis.appendData(null, true);\n\t\tthis.recalculateDisplayedRange(true);\n\t\tthis.ee.emit(EVENTS.REBUILD);\n\t}\n\n\tprivate stopAllAnimations() {\n\t\tthis.animatedSegmentsIds = [];\n\t\tthis.animatedSegmentsForAppend = [];\n\t\tthis.animatedSegmentsForAppend = [];\n\t\tif (this.prependAnimation) this.prependAnimation.kill();\n\t\tif (this.appendAnimation) this.appendAnimation.kill();\n\t}\n\t\n\tprivate recalculateDisplayedRange(segmentsAreRebuilded = false) {\n\t\tvar {from, to} = this.chartState.data.xAxis.range;\n\t\tvar {firstDisplayedSegment, lastDisplayedSegment} = this;\n\t\tvar displayedRange = to - from;\n\n\t\tthis.firstDisplayedSegment = Utils.binarySearchClosest(this.segments, from - displayedRange, 'startXVal');\n\t\tthis.lastDisplayedSegment = Utils.binarySearchClosest(this.segments, to + displayedRange, 'endXVal');\n\t\tif (segmentsAreRebuilded) return;\n\n\t\tvar displayedRangeChanged = (\n\t\t\tfirstDisplayedSegment.id !== this.firstDisplayedSegment.id ||\n\t\t\tlastDisplayedSegment.id !== this.lastDisplayedSegment.id\n\t\t);\n\t\tif (displayedRangeChanged) this.ee.emit(EVENTS.DISLPAYED_RANGE_CHANGED);\n\t}\n\n\t// getSegments(fromX?: number, toX?: number): TrendSegment[] {\n\t// \tvar segments = this.segments;\n\t// \tif (fromX == void 0 && toX == void 0) return segments;\n\t// \tfromX = fromX !== void 0 ? fromX : segments[0].startXVal;\n\t// \ttoX = toX !== void 0 ? toX : segments[this.segmentsLength].endXVal;\n\t// \tvar startSegmentInd = Utils.closestBinarySearch(segments, fromX, 'xVal');\n\t// \tvar endSegmentInd = Utils.closestBinarySearch(segments, toX, 'xVal');\n\t// \treturn segments.slice(startSegmentInd, endSegmentInd);\n\t// }\n\n\t/**\n\t * returns array of segments for values array\n\t * values must be sorted!\n\t */\n\tgetSegmentsForXValues(values: number[]): TrendSegment[] {\n\t\tvar valueInd = 0;\n\t\tvar value = values[valueInd];\n\t\tvar lastValueInd = values.length - 1;\n\t\tvar results: TrendSegment[] = [];\n\t\tvar segment = this.getStartSegment();\n\t\tif (!segment.hasValue) return [];\n\t\twhile (segment) {\n\t\t\n\t\t\twhile (value < segment.startXVal) {\n\t\t\t\tresults.push(void 0);\n\t\t\t\tvalue = values[++valueInd];\n\t\t\t}\n\t\t\n\t\t\twhile (value > segment.endXVal) {\n\t\t\t\tsegment = segment.getNext();\n\t\t\t\tif (!segment) break;\n\t\t\t}\n\t\t\n\t\t\tvar valueInPoint = (\n\t\t\t\tsegment.startXVal == value || segment.endXVal == value ||\n\t\t\t\t(segment.startXVal < value && segment.endXVal > value)\n\t\t\t);\n\t\t\tif (valueInPoint) {\n\t\t\t\tresults.push(segment);\n\t\t\t\tvalue = values[++valueInd];\n\t\t\t}\n\t\t\tif (valueInd > lastValueInd) break;\n\t\t}\n\t\treturn results;\n\t}\n\n\tonAnimationFrame(cb: (animationState: TrendSegments) => void): Function {\n\t\treturn this.ee.subscribe(EVENTS.ANIMATION_FRAME, cb);\n\t}\n\n\tonRebuild(cb: Function) {\n\t\treturn this.ee.subscribe(EVENTS.REBUILD, cb);\n\t}\n\n\tonDisplayedRangeChanged(cb: Function) {\n\t\treturn this.ee.subscribe(EVENTS.DISLPAYED_RANGE_CHANGED, cb);\n\t}\n\t\n\tallocateNextSegment() {\n\t\tvar id = this.nextEmptyId++;\n\t\tvar segment = new TrendSegment(this, id);\n\t\tvar prevSegment = this.segmentsById[this.endSegmentId];\n\t\tif (prevSegment && prevSegment.hasValue) {\n\t\t\tprevSegment.nextId = id;\n\t\t\tsegment.prevId = prevSegment.id;\n\t\t}\n\t\tthis.endSegmentId = id;\n\t\tthis.segmentsLength++;\n\t\tthis.segmentsById[id] = segment;\n\t\tthis.segments.push(segment);\n\t\treturn segment;\n\t}\n\n\tallocatePrevSegment() {\n\t\tvar id = this.nextEmptyId++;\n\t\tvar segment = new TrendSegment(this, id);\n\t\tvar nextSegment = this.segmentsById[this.startSegmentId];\n\t\tif (nextSegment && nextSegment.hasValue) {\n\t\t\tnextSegment.prevId = id;\n\t\t\tsegment.nextId = nextSegment.id;\n\t\t}\n\t\tthis.startSegmentId = id;\n\t\tthis.segmentsLength++;\n\t\tthis.segmentsById[id] = segment;\n\t\tthis.segments.unshift(segment);\n\t\treturn segment;\n\t}\n\n\tprivate appendData(newData: ITrendData, needRebuildSegments = false) {\n\n\t\t// WARNING: bottleneck method!\n\n\t\t// var t1 = performance.now();\n\t\tvar trendData = this.trend.getData();\n\t\tif (needRebuildSegments) {\n\t\t\tnewData = trendData;\n\t\t\tthis.animatedSegmentsForAppend = [];\n\t\t}\n\n\t\tvar startItemInd = trendData.length - newData.length;\n\t\tvar segment = this.getEndSegment() || this.allocateNextSegment();\n\t\tvar initialSegment = segment.hasValue ? segment : null;\n\t\tvar initialAnimationState = segment.createAnimationState();\n\t\tvar itemInd = 0;\n\t\twhile (itemInd < newData.length) {\n\t\t\tlet item = newData[itemInd];\n\t\t\tlet itemIsInserted = segment.appendItem(item);\n\t\t\tlet isLastItem = itemInd == newData.length - 1;\n\n\t\t\tif (itemIsInserted) {\n\t\t\t\tif (!isLastItem) itemInd++;\n\t\t\t} else {\n\t\t\t\tif (!segment.isCompleted) segment.complete();\n\t\t\t}\n\n\t\t\tif (isLastItem && itemIsInserted) {\n\t\t\t\tsegment.recalculateItems();\n\t\t\t}\n\n\t\t\tlet segmentIsReadyForAnimate = segment.isCompleted || (isLastItem && itemIsInserted);\n\t\t\tif (segmentIsReadyForAnimate) {\n\t\t\t\tlet id = segment.id;\n\t\t\t\tif (!initialSegment) initialSegment = segment;\n\t\t\t\tif (!initialAnimationState) initialAnimationState = initialSegment.createAnimationState();\n\n\t\t\t\tsegment.initialAnimationState = Utils.deepMerge({}, initialAnimationState);\n\t\t\t\tif (this.animatedSegmentsForAppend.length > 0) {\n\t\t\t\t\tsegment.initialAnimationState.startXVal = initialAnimationState.endXVal;\n\t\t\t\t\tsegment.initialAnimationState.startYVal = initialAnimationState.endYVal;\n\t\t\t\t}\n\n\t\t\t\tsegment.targetAnimationState = segment.createAnimationState();\n\t\t\t\tthis.animatedSegmentsForAppend.push(id);\n\n\t\t\t}\n\n\n\t\t\tif (isLastItem && itemIsInserted) break;\n\t\t\tif (!segment.isCompleted) continue;\n\n\t\t\tsegment = this.allocateNextSegment();\n\t\t\tlet prevItem = trendData[startItemInd + itemInd - 1];\n\t\t\tsegment.appendItem(prevItem);\n\n\t\t}\n\n\t\tvar animationsOptions = this.chartState.data.animations;\n\t\tvar time = animationsOptions.enabled ? animationsOptions.trendChangeSpeed : 0;\n\n\t\t// var t2 = performance.now();\n\t\t// console.log(t2 - t1);\n\n\t\t// do not create animation if segments was rebuilded\n\t\tif (needRebuildSegments) {\n\t\t\tfor (let segmentId of this.animatedSegmentsForAppend) {\n\t\t\t\tlet segment = this.segmentsById[segmentId];\n\t\t\t\tsegment.currentAnimationState = segment.createAnimationState();\n\t\t\t}\n\t\t\tthis.animatedSegmentsForAppend = [];\n\t\t\treturn;\n\t\t}\n\t\tif (this.animatedSegmentsForAppend.length > MAX_ANIMATED_SEGMENTS) time = 0;\n\t\tthis.animate(time);\n\t}\n\n\n\t// TODO: refactor duplicated code from appendData\n\tprivate prependData(newData: ITrendData) {\n\t\tvar trendData = this.trend.getData();\n\t\tvar segment = this.getStartSegment() || this.segmentsById[0];\n\t\tvar initialSegment = segment.hasValue ? segment : null;\n\t\tvar itemInd = newData.length - 1;\n\t\tvar initialAnimationState = segment.createAnimationState();\n\t\twhile (itemInd >= 0) {\n\t\t\tlet item = newData[itemInd];\n\t\t\tlet itemIsInserted = segment.prependItem(item);\n\t\t\tlet isLastItem = itemInd == 0;\n\n\t\t\tif (itemIsInserted) {\n\t\t\t\tif (!isLastItem) itemInd--;\n\t\t\t} else {\n\t\t\t\tif (!segment.isCompleted) segment.complete();\n\t\t\t}\n\n\t\t\tif (isLastItem && itemIsInserted) {\n\t\t\t\tsegment.recalculateItems();\n\t\t\t}\n\n\t\t\tlet segmentIsReadyForAnimate = segment.isCompleted || (isLastItem && itemIsInserted);\n\t\t\tif (segmentIsReadyForAnimate) {\n\t\t\t\tlet id = segment.id;\n\t\t\t\tif (!initialSegment) initialSegment = segment;\n\t\t\t\tif (!initialAnimationState) initialAnimationState = initialSegment.createAnimationState();\n\n\t\t\t\tsegment.initialAnimationState = Utils.deepMerge({}, initialAnimationState);\n\t\t\t\tif (this.animatedSegmentsForPrepend.length > 0) {\n\t\t\t\t\tsegment.initialAnimationState.endXVal = initialAnimationState.startXVal;\n\t\t\t\t\tsegment.initialAnimationState.endYVal =  initialAnimationState.startYVal;\n\t\t\t\t}\n\n\t\t\t\tsegment.targetAnimationState = segment.createAnimationState();\n\t\t\t\tthis.animatedSegmentsForPrepend.push(id);\n\n\t\t\t}\n\n\t\t\tif (isLastItem && itemIsInserted) break;\n\t\t\tif (!segment.isCompleted) continue;\n\n\t\t\tsegment = this.allocatePrevSegment();\n\t\t\tlet nextItem = trendData[itemInd + 1];\n\t\t\tsegment.prependItem(nextItem);\n\n\t\t}\n\n\t\tvar animationsOptions = this.chartState.data.animations;\n\t\tvar time = animationsOptions.enabled ? animationsOptions.trendChangeSpeed : 0;\n\n\t\tif (this.animatedSegmentsForPrepend.length > MAX_ANIMATED_SEGMENTS) time = 0;\n\t\tthis.animate(time, true);\n\t}\n\n\tprivate animate(time: number, isPrepend = false) {\n\n\t\tvar animatedSegmentsIds = isPrepend ? this.animatedSegmentsForPrepend : this.animatedSegmentsForAppend;\n\t\tvar animation = isPrepend ? this.prependAnimation : this.appendAnimation;\n\n\t\tif ((animation && animation.isActive()) || time == 0) {\n\t\t\tif (animation) animation.kill();\n\t\t\tthis.onAnimationFrameHandler(1, isPrepend);\n\t\t\tanimatedSegmentsIds.length = 0;\n\t\t\treturn;\n\t\t}\n\t\tvar animationsOptions = this.chartState.data.animations;\n\t\tvar ease = animationsOptions.trendChangeEase;\n\t\tvar objectToAnimate = {animationValue: 0};\n\t\tanimation = TweenLite.to(objectToAnimate, time, {animationValue: 1, ease});\n\t\tanimation.eventCallback('onUpdate', () => this.onAnimationFrameHandler(objectToAnimate.animationValue, isPrepend));\n\t\tanimation.eventCallback('onComplete', () => {\n\t\t\tanimatedSegmentsIds.length = 0;\n\t\t\tthis.appendAnimation = null;\n\t\t});\n\n\t\tif (isPrepend) {\n\t\t\tthis.prependAnimation = animation;\n\t\t} else {\n\t\t\tthis.appendAnimation = animation;\n\t\t}\n\t}\n\n\tprivate onAnimationFrameHandler(coefficient: number, isPrepend = false) {\n\t\tlet animatedSegmentsIds = isPrepend ? this.animatedSegmentsForPrepend : this.animatedSegmentsForAppend;\n\t\tfor (let segmentId of animatedSegmentsIds) {\n\t\t\tlet segment = this.segmentsById[segmentId];\n\t\t\tfor (let key in segment.targetAnimationState) {\n\t\t\t\tlet targetValue = segment.targetAnimationState[key] as number;\n\t\t\t\tlet initialValue = segment.initialAnimationState[key] as number;\n\t\t\t\tlet currentValue = initialValue + (targetValue - initialValue) * coefficient;\n\t\t\t\tsegment.currentAnimationState[key] = currentValue;\n\t\t\t}\n\t\t}\n\t\tthis.animatedSegmentsIds = this.animatedSegmentsForAppend.concat(this.animatedSegmentsForPrepend);\n\t\tthis.ee.emit(EVENTS.ANIMATION_FRAME, this);\n\t}\n\n}\n\nexport interface ITrendSegmentState extends IIteralable {\n\txVal?: number;\n\tyVal?: number;\n\tstartXVal?: number;\n\tstartYVal?: number;\n\tendXVal?: number;\n\tendYVal?: number;\n\tmaxYVal?: number;\n\tminYVal?: number;\n\tmaxLength?: number;\n}\n\nexport class TrendSegment implements ITrendSegmentState {\n\tid: number;\n\tprevId: number;\n\tnextId: number;\n\thasValue: boolean;\n\txVal: number;\n\tyVal: number;\n\tstartXVal: number;\n\tstartYVal: number;\n\tendXVal: number;\n\tendYVal: number;\n\tmaxYVal: number;\n\tminYVal: number;\n\tisCompleted = false;\n\tmaxLength: number;\n\titems: ITrendItem[] = [];\n\n\tinitialAnimationState: ITrendSegmentState = {};\n\ttargetAnimationState: ITrendSegmentState = {};\n\tcurrentAnimationState: ITrendSegmentState = {};\n\n\tprivate trendSegments: TrendSegments;\n\t\n\tconstructor(trendPoints: TrendSegments, id: number) {\n\t\tthis.trendSegments = trendPoints;\n\t\tthis.id = id;\n\t\tthis.maxLength = trendPoints.maxSegmentLength;\n\t}\n\n\tcreateAnimationState(): ITrendSegmentState {\n\t\tvar {\n\t\t\txVal,\n\t\t\tyVal,\n\t\t\tstartXVal,\n\t\t\tstartYVal,\n\t\t\tendXVal,\n\t\t\tendYVal,\n\t\t\tmaxYVal,\n\t\t\tminYVal,\n\t\t\tmaxLength\n\t\t} = this;\n\t\treturn {\n\t\t\txVal,\n\t\t\tyVal,\n\t\t\tstartXVal,\n\t\t\tstartYVal,\n\t\t\tendXVal,\n\t\t\tendYVal,\n\t\t\tmaxYVal,\n\t\t\tminYVal,\n\t\t\tmaxLength\n\t\t}\n\t};\n\t\n\tappendItem(item: ITrendItem): boolean {\n\t\tif (this.isCompleted) return false;\n\n\t\tvar items = this.items;\n\t\tif (items.length < 2) {\n\t\t\tthis.items.push(item);\n\t\t\tthis.hasValue = true;\n\t\t\treturn true;\n\t\t}\n\t\tvar startXVal = items[0].xVal;\n\t\tif (item.xVal - startXVal > this.maxLength) return false;\n\t\titems.push(item);\n\t\treturn true;\n\t}\n\n\tprependItem(item: ITrendItem): boolean {\n\t\tif (this.isCompleted) return false;\n\t\tvar items = this.items;\n\t\tif (items.length < 2) {\n\t\t\tthis.items.unshift(item);\n\t\t\tthis.hasValue = true;\n\t\t\treturn true;\n\t\t}\n\t\tvar endXVal = items[items.length - 1].xVal;\n\t\tif (endXVal - item.xVal > this.maxLength) return false;\n\t\titems.unshift(item);\n\t\treturn true;\n\t}\n\n\tcomplete() {\n\t\tthis.isCompleted = true;\n\t\tthis.recalculateItems();\n\t\tthis.items = []; // free memory for completed ranges\n\t}\n\n\trecalculateItems() {\n\t\tlet items = this.items;\n\t\tlet itemsLength = items.length;\n\t\tif (itemsLength === 0) Utils.error('Unable to create TrendSegment without TrendItems');\n\t\tlet endItem = items[itemsLength - 1];\n\t\tlet {xVal: endXVal, yVal: endYVal} = endItem;\n\t\tlet startXVal: number, startYVal: number;\n\n\n\t\tlet startItem = items[0];\n\t\tstartXVal = startItem.xVal;\n\t\tstartYVal = startItem.yVal;\n\n\t\tlet minX = Math.min(startXVal, endXVal);\n\t\tlet maxX = Math.max(startXVal, endXVal);\n\t\tlet middleXVal = minX + (maxX - minX) / 2;\n\n\t\tlet minY = Math.min(startYVal, endYVal);\n\t\tlet maxY = Math.max(startYVal, endYVal);\n\t\tlet middleYVal = minY + (maxY - minY) / 2;\n\n\t\tlet yVals = items.map(item => item.yVal);\n\n\t\tthis.startXVal = startXVal;\n\t\tthis.startYVal = startYVal;\n\t\tthis.endXVal = endXVal;\n\t\tthis.endYVal = endYVal;\n\t\tthis.xVal = middleXVal;\n\t\tthis.yVal = middleYVal;\n\t\tthis.maxYVal = Math.max(...yVals);\n\t\tthis.minYVal = Math.min(...yVals);\n\t\tif (!this.currentAnimationState) this.currentAnimationState = this.createAnimationState();\n\t}\n\n\tgetNext() {\n\t\tvar nextPoint = this.trendSegments.segmentsById[this.nextId];\n\t\treturn nextPoint && nextPoint.hasValue ? nextPoint : null;\n\t}\n\n\tgetPrev() {\n\t\tvar prevPoint = this.trendSegments.segmentsById[this.prevId];\n\t\treturn prevPoint && prevPoint.hasValue ? prevPoint : null;\n\t}\n\t\n\tgetFrameVal(): Vector3 {\n\t\tlet {xVal, yVal} = this.createAnimationState();\n\t\treturn new Vector3(xVal, yVal, 0);\n\t}\n\n\tgetFramePoint(): Vector3 {\n\t\tvar frameVal = this.getFrameVal();\n\t\treturn this.trendSegments.chartState.screen.getPointOnChart(frameVal.x, frameVal.y);\n\t}\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/TrendSegments.ts\n **/","import PerspectiveCamera = THREE.PerspectiveCamera;\nimport Vector3 = THREE.Vector3;\nimport {ChartState, IChartState} from \"./State\";\nimport forestgreen = THREE.ColorKeywords.forestgreen;\nimport {EventEmitter} from './EventEmmiter';\n\nexport interface IScreenTransformOptions {\n\tscrollXVal?: number,\n\tscrollYVal?: number,\n\tscrollX?: number,\n\tscrollY?: number,\n\tzoomX?: number,\n\tzoomY?: number\n}\n\n/**\n * manage camera, and contains methods for transforming pixels to values\n */\nexport class Screen {\n\toptions: IScreenTransformOptions = {scrollXVal: 0, scrollX: 0, scrollYVal: 0, scrollY: 0, zoomX: 1, zoomY: 1};\n\tprivate chartState: ChartState;\n\tprivate scrollXAnimation: TweenLite;\n\tprivate scrollYAnimation: TweenLite;\n\tprivate zoomXAnimation: TweenLite;\n\tprivate zoomYAnimation: TweenLite;\n\tprivate currentScrollX = {x: 0};\n\tprivate currentScrollY = {y: 0};\n\tprivate currentZoomX = {val: 1};\n\tprivate currentZoomY = {val: 1};\n\tprivate ee: EventEmitter;\n\n\tconstructor(chartState: ChartState) {\n\t\tthis.chartState = chartState;\n\t\tvar {width: w, height: h} = chartState.data;\n\t\tthis.ee = new EventEmitter();\n\t\tthis.transform({\n\t\t\tscrollY: this.valueToPxByYAxis(this.chartState.data.yAxis.range.scroll),\n\t\t\tzoomY: 1\n\t\t});\n\t\tthis.bindEvents();\n\n\t\t//camera.position.z = 1500;\n\t}\n\t\n\tgetCameraSettings() {\n\n\t\tvar {width: w, height: h} = this.chartState.data;\n\n\t\t// settings for pixel-perfect camera\n\t\tvar FOV = 75;\n\t\tvar vFOV = FOV * (Math.PI / 180);\n\t\t\n\t\treturn {\n\t\t\tFOV: FOV,\n\t\t\taspect: w / h,\n\t\t\tnear: 0.1,\n\t\t\tfar: 5000,\n\t\t\tz: h / (2 * Math.tan(vFOV / 2) ),\n\n\t\t\t// move 0,0 to left-bottom corner\n\t\t\tx: w / 2,\n\t\t\ty: h / 2\n\t\t}\n\t}\n\n\tonZoomFrame(cb: (zoomX: number, zoomY: number) => void): Function {\n\t\tvar eventName = 'zoomFrame';\n\t\tthis.ee.on(eventName, cb);\n\t\treturn () => {\n\t\t\tthis.ee.off(eventName, cb);\n\t\t}\n\t}\n\n\tonScrollFrame(cb: (options: IScreenTransformOptions) => void): Function {\n\t\tvar eventName = 'scrollFrame';\n\t\tthis.ee.on(eventName, cb);\n\t\treturn () => {\n\t\t\tthis.ee.off(eventName, cb);\n\t\t}\n\t}\n\n\tonTransformationFrame(cb: (options: IScreenTransformOptions) => void): Function {\n\t\tvar eventName = 'transformationFrame';\n\t\tthis.ee.on(eventName, cb);\n\t\treturn () => {\n\t\t\tthis.ee.off(eventName, cb);\n\t\t}\n\t}\n\n\tcameraIsMoving(): boolean {\n\t\treturn !!(\n\t\t\tthis.scrollXAnimation && this.scrollXAnimation.isActive() ||\n\t\t\t\tthis.zoomXAnimation && this.zoomXAnimation.isActive()\n\t\t);\n\t}\n\n\tprivate transform (options: IScreenTransformOptions, silent = false) {\n\t\tvar {scrollX, scrollY, zoomX, zoomY} = options;\n\t\t\n\t\tif (scrollX != void 0) this.options.scrollX = scrollX;\n\t\tif (scrollY != void 0) this.options.scrollY = scrollY;\n\t\tif (zoomX != void 0) this.options.zoomX = zoomX;\n\t\tif (zoomY != void 0) this.options.zoomY = zoomY;\n\n\t\tif (scrollX != void 0 || zoomX) {\n\t\t\toptions.scrollXVal = this.pxToValueByXAxis(scrollX != void 0 ? scrollX : this.options.scrollX);\n\t\t\tthis.options.scrollXVal = options.scrollXVal;\n\t\t}\n\n\t\tif (scrollY != void 0 || zoomY) {\n\t\t\toptions.scrollYVal = this.pxToValueByYAxis(scrollY != void 0 ? scrollY : this.options.scrollY);\n\t\t\tthis.options.scrollYVal = options.scrollYVal;\n\t\t}\n\n\t\tif (silent) return;\n\n\t\tthis.ee.emit('transformationFrame', options);\n\t\t\n\t\tif (options.scrollXVal != void 0 || options.scrollYVal != void 0) {\n\t\t\tthis.ee.emit('scrollFrame', options);\n\t\t}\n\t\t\n\t\tif (options.zoomX != void 0 || options.zoomY != void 0) {\n\t\t\tthis.ee.emit('zoomFrame', options);\n\t\t}\n\t}\n\n\n\tprivate bindEvents() {\n\t\tvar state = this.chartState;\n\n\t\t// handle scroll and zoom\n\t\tstate.onChange((changedProps) => {\n\t\t\tif (changedProps.xAxis && changedProps.xAxis.range) {\n\t\t\t\tif (changedProps.xAxis.range.scroll != void 0) this.onScrollXHandler(changedProps);\n\t\t\t\tif (changedProps.xAxis.range.zoom) this.onZoomXHandler();\n\t\t\t}\n\t\t\tif (changedProps.yAxis && changedProps.yAxis.range){\n\t\t\t\tif (changedProps.yAxis.range.scroll != void 0) this.onScrollYHandler();\n\t\t\t\tif (changedProps.yAxis.range.zoom) this.onZoomYHandler();\n\t\t\t}\n\t\t});\n\t\tstate.onDestroy(() => this.onDestroyHandler());\n\t}\n\n\tprivate onDestroyHandler() {\n\t\tthis.ee.removeAllListeners();\n\t\tthis.scrollXAnimation && this.scrollXAnimation.kill();\n\t\tthis.scrollYAnimation && this.scrollYAnimation.kill();\n\t\tthis.zoomXAnimation && this.zoomXAnimation.kill();\n\t\tthis.zoomYAnimation && this.zoomYAnimation.kill();\n\t}\n\n\tprivate onScrollXHandler(changedProps: IChartState) {\n\t\tvar state = this.chartState;\n\t\tvar isDragMode = state.data.cursor.dragMode;\n\t\tvar animations =  state.data.animations;\n\t\tvar canAnimate = animations.enabled && !isDragMode;\n\t\tvar zoomXChanged = changedProps.xAxis.range.zoom;\n\t\tvar isAutoscroll = state.data.autoScroll && !isDragMode && !zoomXChanged;\n\t\tvar time = isAutoscroll ? animations.autoScrollSpeed : animations.zoomSpeed;\n\t\tvar ease = isAutoscroll ? animations.autoScrollEase : animations.zoomEase;\n\t\tif (this.scrollXAnimation) this.scrollXAnimation.pause();\n\n\t\tvar range = state.data.xAxis.range;\n\t\tvar targetX = range.scroll * range.scaleFactor * range.zoom;\n\t\tthis.currentScrollX.x = this.options.scrollX;\n\n\t\tvar cb = () => {\n\t\t\tthis.transform({scrollX: this.currentScrollX.x});\n\t\t};\n\n\t\tif (canAnimate) {\n\t\t\tthis.scrollXAnimation = TweenLite.to(this.currentScrollX, time, {\n\t\t\t\tx: targetX, ease: ease\n\t\t\t});\n\t\t\tthis.scrollXAnimation.eventCallback('onUpdate', cb);\n\t\t} else {\n\t\t\tthis.currentScrollX.x = targetX;\n\t\t\tcb();\n\t\t}\n\n\t}\n\n\tprivate onScrollYHandler() {\n\t\tvar state = this.chartState;\n\t\tvar animations =  state.data.animations;\n\t\tvar canAnimate = animations.enabled;\n\t\tvar time = animations.zoomSpeed;\n\t\tif (this.scrollYAnimation) this.scrollYAnimation.pause();\n\t\tvar range = state.data.yAxis.range;\n\t\tvar targetY = range.scroll * range.scaleFactor * range.zoom;\n\n\t\tthis.currentScrollY.y = this.options.scrollY;\n\n\t\tvar cb = () => {\n\t\t\tthis.transform({scrollY: this.currentScrollY.y});\n\t\t};\n\n\t\tif (canAnimate) {\n\t\t\tthis.scrollYAnimation = TweenLite.to(this.currentScrollY, time, {\n\t\t\t\ty: targetY, ease: animations.zoomEase\n\t\t\t});\n\t\t\tthis.scrollYAnimation.eventCallback('onUpdate', cb);\n\t\t} else {\n\t\t\tthis.currentScrollY.y = targetY;\n\t\t\tcb();\n\t\t}\n\t}\n\n\tprivate onZoomXHandler() {\n\t\tvar state = this.chartState;\n\t\tvar animations =  state.data.animations;\n\t\tvar canAnimate = animations.enabled;\n\t\tvar time = animations.zoomSpeed;\n\t\tvar targetZoom = state.data.xAxis.range.zoom;\n\t\tif (this.zoomXAnimation) this.zoomXAnimation.pause();\n\n\t\tvar cb = () => {\n\t\t\tthis.transform({zoomX: this.currentZoomX.val});\n\t\t};\n\n\t\tif (canAnimate) {\n\t\t\tthis.zoomXAnimation = TweenLite.to(this.currentZoomX, time, {\n\t\t\t\tval: targetZoom, ease: animations.zoomEase\n\t\t\t});\n\t\t\tthis.zoomXAnimation.eventCallback('onUpdate', cb);\n\t\t} else {\n\t\t\tthis.currentZoomX.val = targetZoom;\n\t\t\tcb();\n\t\t}\n\t}\n\n\tprivate onZoomYHandler() {\n\t\tvar state = this.chartState;\n\t\tvar animations =  state.data.animations;\n\t\tvar canAnimate = animations.enabled;\n\t\tvar time = animations.zoomSpeed;\n\t\tvar targetZoom = state.data.yAxis.range.zoom;\n\t\tif (this.zoomYAnimation) this.zoomYAnimation.pause();\n\n\t\tvar cb = () => {\n\t\t\tthis.transform({zoomY: this.currentZoomY.val});\n\t\t};\n\n\t\tif (canAnimate) {\n\t\t\tthis.zoomYAnimation = TweenLite.to(this.currentZoomY, time, {\n\t\t\t\tval: targetZoom, ease: animations.zoomEase\n\t\t\t});\n\t\t\tthis.zoomYAnimation.eventCallback('onUpdate', cb);\n\t\t} else {\n\t\t\tthis.currentZoomY.val = targetZoom;\n\t\t\tcb();\n\t\t}\n\t}\n\n\n\t/**\n\t *  returns offset in pixels from xAxis.range.zeroVal to scrollXVal\n\t */\n\tgetPointOnXAxis(xVal: number): number {\n\t\tvar {scaleFactor, zeroVal} = this.chartState.data.xAxis.range;\n\t\tvar zoom = this.options.zoomX;\n\t\treturn (xVal - zeroVal) * scaleFactor * zoom;\n\t}\n\n\t/**\n\t *  returns offset in pixels from yAxis.range.zeroVal to scrollYVal\n\t */\n\tgetPointOnYAxis(yVal: number): number {\n\t\tvar {scaleFactor, zeroVal} =  this.chartState.data.yAxis.range;\n\t\tvar zoom = this.options.zoomY;\n\t\treturn (yVal - zeroVal) * scaleFactor * zoom;\n\t}\n\n\t/**\n\t *  returns offset in pixels from xAxis.range.zeroVal and from yAxis.range.zeroVal to scrollXVal and scrollYVal\n\t */\n\tgetPointOnChart(xVal: number, yVal: number): Vector3 {\n\t\treturn new Vector3(this.getPointOnXAxis(xVal), this.getPointOnYAxis(yVal), 0);\n\t}\n\t\n\t/**\n\t * returns value by offset in pixels from xAxis.range.zeroVal\n\t */\n\tgetValueOnXAxis(x: number): number {\n\t\treturn this.chartState.data.xAxis.range.zeroVal + this.pxToValueByXAxis(x);\n\t}\n\n\n\t/**\n\t *  convert value to pixels by using settings from xAxis.range\n\t */\n\tvalueToPxByXAxis(xVal: number) {\n\t\treturn xVal * this.chartState.data.xAxis.range.scaleFactor * this.options.zoomX;\n\t}\n\n\n\t/**\n\t *  convert value to pixels by using settings from yAxis.range\n\t */\n\tvalueToPxByYAxis(yVal: number) {\n\t\treturn yVal * this.chartState.data.yAxis.range.scaleFactor * this.options.zoomY;\n\t}\n\t\n\t/**\n\t *  convert pixels to value by using settings from xAxis.range\n\t */\n\tpxToValueByXAxis(xVal: number) {\n\t\treturn xVal / this.chartState.data.xAxis.range.scaleFactor / this.options.zoomX;\n\t}\n\n\n\t/**\n\t *  convert pixels to value by using settings from yAxis.range\n\t */\n\tpxToValueByYAxis(yVal: number) {\n\t\treturn yVal / this.chartState.data.yAxis.range.scaleFactor / this.options.zoomY;\n\t}\n\n\n\t/**\n\t *  returns scrollX value by screen scrollX coordinate\n\t */\n\tgetValueByScreenX(x: number): number {\n\t\treturn this.chartState.data.xAxis.range.zeroVal + this.options.scrollXVal + this.pxToValueByXAxis(x);\n\t}\n\t\n\t\n\t/**\n\t *  returns scrollY value by screen scrollY coordinate\n\t */\n\tgetValueByScreenY(y: number): number {\n\t\treturn this.chartState.data.yAxis.range.zeroVal + this.options.scrollYVal + this.pxToValueByYAxis(y);\n\t}\n\t\n\t//\n\t/**\n\t *  returns screen scrollX value by screen scrollY coordinate\n\t */\n\tgetScreenXByValue(xVal: number): number {\n\t\tvar {scroll, zeroVal} = this.chartState.data.xAxis.range;\n\t\treturn this.valueToPxByXAxis(xVal - zeroVal - scroll)\n\t}\n\n\t// /**\n\t//  *  returns screen scrollY value by screen scrollY coordinate\n\t//  */\n\t// getScreenYByValue(scrollYVal: number): number {\n\t// \tvar {scroll, zeroVal} = this.data.yAxis.range;\n\t// \treturn this.valueToPxByYAxis(scrollYVal - zeroVal - scroll)\n\t// }\n\t//\n\t//\n\t/**\n\t * returns screen scrollX coordinate by offset in pixels from xAxis.range.zeroVal value\n\t */\n\tgetScreenXByPoint(xVal: number): number {\n\t\treturn this.getScreenXByValue(this.getValueOnXAxis(xVal));\n\t}\n\n\n\t/**\n\t * returns offset in pixels from xAxis.range.zeroVal value by screen scrollX coordinate\n\t */\n\tgetPointByScreenX(screenX: number): number {\n\t\treturn this.getPointOnXAxis(this.getValueByScreenX(screenX));\n\t}\n\n\t/**\n\t * returns offset in pixels from yAxis.range.zeroVal value by screen scrollY coordinate\n\t */\n\tgetPointByScreenY(screenY: number): number {\n\t\treturn this.getPointOnYAxis(this.getValueByScreenY(screenY));\n\t}\n\n\tgetTop(): number {\n\t\treturn this.getPointByScreenY(this.chartState.data.height);\n\t}\n\t\n\tgetBottom(): number {\n\t\treturn this.getPointByScreenY(0);\n\t}\n\n\tgetLeft(): number {\n\t\treturn this.getPointByScreenX(0);\n\t}\n\n\tgetScreenRightVal() {\n\t\treturn this.getValueByScreenX(this.chartState.data.width);\n\t}\n\n\tgetTopVal() {\n\t\treturn this.getValueByScreenY(this.chartState.data.height);\n\t}\n\t\n\tgetBottomVal() {\n\t\treturn this.getValueByScreenY(0);\n\t}\n\n\tgetCenterYVal() {\n\t\treturn this.getValueByScreenY(this.chartState.data.height / 2);\n\t}\n\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Screen.ts\n **/","\nimport {ChartState} from \"./State\";\nimport {Utils} from \"./Utils\";\nimport {AXIS_TYPE} from \"./interfaces\";\nimport {ITrendData, ITrendOptions} from \"./Trend\";\nimport {EventEmitter} from './EventEmmiter';\n\nexport interface IAxisMarkUpdateOptions {\n\tvalue: number,\n\tdisplayedValue?: string\n}\n\nexport interface IAxisMarkOptions extends IAxisMarkUpdateOptions {\n\tname?: string;\n\ttitle?: string;\n\ttype?: string;\n\tlineColor?: string;\n\tlineWidth?: number;\n\tshowValue?: boolean;\n\tstickToEdges?: boolean;\n}\n\nconst AXIS_MARK_DEFAULT_OPTIONS: IAxisMarkOptions = {\n\ttype: 'simple',\n\tlineWidth: 1,\n\tvalue: 0,\n\tshowValue: false,\n\tstickToEdges: false,\n\tlineColor: '#FFFFFF',\n\ttitle: ''\n};\n\nexport class AxisMarks {\n\tprivate chartState: ChartState;\n\tprivate axisType: AXIS_TYPE;\n\tprivate ee: EventEmitter;\n\tprivate items: {[name: string]: AxisMark} = {};\n\n\tconstructor(chartState: ChartState, axisType: AXIS_TYPE) {\n\t\tthis.chartState = chartState;\n\t\tthis.ee = new EventEmitter();\n\t\tthis.axisType = axisType;\n\t\tvar marks = this.items;\n\t\tvar axisMarksOptions = axisType == AXIS_TYPE.X ? chartState.data.xAxis.marks : chartState.data.yAxis.marks;\n\t\t\n\t\tfor (let options of axisMarksOptions) {\n\t\t\tlet axisMark: AxisMark;\n\t\t\toptions = Utils.deepMerge(AXIS_MARK_DEFAULT_OPTIONS, options);\n\t\t\t\n\t\t\t// set mark name\n\t\t\tif (!options.name) options.name = Utils.getUid().toString();\n\t\t\tif (marks[options.name]) Utils.error('duplicated mark name ' + options.name);\n\t\t\t\n\t\t\t// create mark instance based on type option\n\t\t\tif (options.type == 'timeleft') {\n\t\t\t\taxisMark = new AxisTimeleftMark(chartState, axisType, options);\n\t\t\t} else {\n\t\t\t\taxisMark = new AxisMark(chartState, axisType, options);\n\t\t\t}\n\t\t\tmarks[options.name] = axisMark;\n\t\t}\n\t\tthis.bindEvents();\n\t}\n\n\tprotected bindEvents() {\n\t\tthis.chartState.onTrendChange((trendName: string, changedOptions: ITrendOptions, newData: ITrendData) => {\n\t\t\tthis.onTrendChange(trendName, newData)\n\t\t});\n\t\tthis.chartState.onDestroy(() => this.ee.removeAllListeners());\n\t}\n\n\tprivate onTrendChange(trendName: string, newData: ITrendData) {\n\t\tif (!newData) return;\n\t\tvar startVal = newData[0].xVal;\n\t\tvar endVal = newData[newData.length - 1].xVal;\n\t\tvar marks = this.items;\n\n\t\tfor (let markName in marks) {\n\t\t\tlet mark = marks[markName];\n\t\t\tlet markVal = mark.options.value;\n\t\t\tlet markWasCrossed = (startVal == markVal || endVal == markVal || (startVal < markVal && endVal > markVal));\n\t\t\tif (markWasCrossed) this.ee.emit('markCrossed', trendName, newData);\n\t\t}\n\t}\n\n\n\tgetItems() {\n\t\treturn this.items;\n\t}\n\t\n\tgetItem(markName: string) {\n\t\treturn this.items[markName];\n\t}\n\n}\n\nexport class AxisMark {\n\tstatic typeName = 'simple';\n\toptions: IAxisMarkOptions;\n\taxisType: AXIS_TYPE;\n\tprotected chartState: ChartState;\n\tprotected renderOnTrendsChange = false;\n\tprotected ee: EventEmitter;\n\n\tconstructor(chartState: ChartState, axisType: AXIS_TYPE, options: IAxisMarkOptions) {\n\t\tthis.ee = new EventEmitter();\n\t\tthis.options = options;\n\t\tthis.axisType = axisType;\n\t\tthis.chartState = chartState;\n\t\tthis.bindEvents();\n\t}\n\t\n\tprotected bindEvents() {}\n\n\tsetOptions(newOptions: IAxisMarkUpdateOptions) {\n\t\tvar value = this.options.value;\n\t\tthis.options = Utils.deepMerge(this.options, newOptions);\n\t\tif (this.options.value !== value) this.ee.emit('valueChange');\n\t\tthis.ee.emit('onDisplayedValueChange');\n\t}\n\n\tgetDisplayedVal(): string {\n\t\tlet {value, displayedValue} = this.options;\n\t\treturn String(displayedValue !== void 0 ? displayedValue : value);\n\t}\n\n\tonMarkCrossed(cb: (trendName: string, newData: ITrendData) => void): Function {\n\t\tthis.ee.on('markCrossed', cb);\n\t\treturn () => {\n\t\t\tthis.ee.off('markCrossed', cb);\n\t\t}\n\t}\n\n\tonValueChange(cb: () => void) {\n\t\tthis.ee.on('valueChange', cb);\n\t\treturn () => {\n\t\t\tthis.ee.off('valueChange', cb);\n\t\t}\n\t}\n\n\tonDisplayedValueChange(cb: () => void) {\n\t\tthis.ee.on('onDisplayedValueChange', cb);\n\t\treturn () => {\n\t\t\tthis.ee.off('onDisplayedValueChange', cb);\n\t\t}\n\t}\n}\n\nexport class AxisTimeleftMark extends AxisMark {\n\tstatic typeName = 'timeleft';\n\tprotected renderOnTrendsChange = true;\n\t\n\tgetDisplayedVal(): string {\n\t\tvar markVal = this.options.value;\n\t\tvar maxXVal = this.chartState.data.computedData.trends.maxXVal;\n\t\tvar time = markVal - maxXVal;\n\t\tif (time < 0) time = 0;\n\t\treturn Utils.msToTimeString(time);\n\t}\n\n\tprotected bindEvents() {\n\t\tthis.chartState.onTrendsChange(() => this.onTrendsChange());\n\t}\n\n\tprotected onTrendsChange() {\n\t\tthis.ee.emit('onDisplayedValueChange');\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/AxisMarks.ts\n **/","\n\n/**\n * defines how axis range will be calculated\n * FIXED - directly use range.from and range.to value\n * AUTO - automatically sets range.from and range.to by visible part of opposite axis\n * RELATIVE_END - same as AUTO, but trend end always present in range\n * ALL - automatically sets range.from and range.to by all values of opposite axis\n *\n */\nimport {IAxisMarkOptions} from \"./AxisMarks\";\nexport enum AXIS_RANGE_TYPE {\n\tFIXED,\n\tRELATIVE_END,\n\tAUTO,\n\tALL // TODO: AXIS_RANGE_TYPE.ALL\n}\n\n/**\n * Animation ease type\n */\nexport declare type TEase = Ease | Linear;\n\nexport declare type TIteralable = {[key: string]: any};\nexport interface IIteralable {[key: string]: any};\n\nexport enum AXIS_TYPE {X, Y}\n\nexport interface IAxisRange {\n\ttype?: AXIS_RANGE_TYPE,\n\tfrom?: number,\n\tto?: number,\n\tzoom?: number,\n\tscroll?: number,\n\n\t/**\n\t * Mode only for Y axis. When true displayed center of Y axis never changed. To use set range.zeroVal as center value.\n\t */\n\tisMirrorMode?: boolean,\n\n\tpadding?: {\n\t\tstart?: number,\n\t\tend?: number\n\t},\n\n\tmargin?: {\n\t\tstart?: number,\n\t\tend?: number\n\t},\n\n\tmaxLength?: number;\n\tminLength?: number;\n\tzeroVal?: number,\n\n\t/** only for internal usage **/\n\tscaleFactor?: number,\n}\n\nexport enum AXIS_DATA_TYPE {NUMBER, DATE}\n\nexport interface IAxisOptions {\n\trange?: IAxisRange;\n\tdataType?: AXIS_DATA_TYPE;\n\tgridMinSize?: number;\n\tautoScroll?: boolean;\n\tmarks?: IAxisMarkOptions[];\n}\n\nexport interface IAnimationsOptions {\n\tenabled?: boolean,\n\ttrendChangeSpeed?: number,\n\ttrendChangeEase?: TEase,\n\tscrollSpeed?: number,\n\tscrollEase?: TEase,\n\tautoScrollSpeed?: number,\n\tautoScrollEase?: TEase,\n\tzoomSpeed?: number,\n\tzoomEase?: TEase,\n}\n\nexport interface PromiseExecutor<T> {\n\t(resolve: (data: T) => void, reject: (data: T) => void): void;\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/interfaces.ts\n **/","import Geometry = THREE.Geometry;\nimport Mesh = THREE.Mesh;\nimport LineBasicMaterial = THREE.LineBasicMaterial;\nimport Material = THREE.Material;\nimport Vector3 = THREE.Vector3;\nimport Line = THREE.Line;\nimport Object3D = THREE.Object3D;\nimport UVMapping = THREE.UVMapping;\nimport GridHelper = THREE.GridHelper;\nimport {ChartWidget} from \"../Widget\";\nimport {ChartState} from \"../State\";\nimport {GridWidget, IGridParamsForAxis} from \"./GridWidget\";\nimport {Utils} from \"../Utils\";\nimport PlaneGeometry = THREE.PlaneGeometry;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport OrthographicCamera = THREE.OrthographicCamera;\nimport {IScreenTransformOptions} from \"../Screen\";\nimport {AXIS_TYPE, AXIS_DATA_TYPE, IAxisOptions} from \"../interfaces\";\n\n/**\n * widget for drawing axis\n */\nexport class AxisWidget extends ChartWidget {\n\tstatic widgetName = 'Axis';\n\tprivate isDestroyed = false;\n\tprivate object3D: Object3D;\n\tprivate axisXObject: Object3D;\n\tprivate axisYObject: Object3D;\n\tprivate updateAxisXRequest: () => void;\n\n\tconstructor (state: ChartState) {\n\t\tsuper(state);\n\t\tthis.object3D = new Object3D();\n\t\tthis.axisXObject = new Object3D();\n\t\tthis.axisYObject = new Object3D();\n\t\tthis.object3D.add(this.axisXObject);\n\t\tthis.object3D.add(this.axisYObject);\n\t\tthis.setupAxis(AXIS_TYPE.X);\n\t\tthis.setupAxis(AXIS_TYPE.Y);\n\n\t\t// canvas drawing is expensive operation, so when we scroll, redraw must be called only once per second\n\t\tthis.updateAxisXRequest = Utils.throttle(() => this.updateAxis(AXIS_TYPE.X), 1000);\n\n\n\t\tthis.onScrollChange(state.screen.options.scrollX, state.screen.options.scrollY);\n\t}\n\n\tbindEvents() {\n\t\tvar state = this.chartState;\n\n\t\tthis.bindEvent(\n\t\t\tstate.screen.onTransformationFrame((options) => {\n\t\t\t\tthis.onScrollChange(options.scrollX, options.scrollY);\n\t\t\t}),\n\t\t\tstate.screen.onZoomFrame((options) => {this.onZoomFrame(options)}),\n\t\t\tstate.onDestroy(() => this.onDestroy()),\n\t\t\tstate.onResize(() => this.onResize())\n\t\t);\n\t}\n\n\tprivate onDestroy() {\n\t\tthis.isDestroyed = true;\n\t\tthis.unbindEvents();\n\t}\n\n\tprivate onScrollChange(x: number, y: number) {\n\n\t\tif (y != void 0) {\n\t\t\tthis.axisYObject.position.y = y;\n\t\t\tthis.axisXObject.position.y = y;\n\t\t}\n\n\t\tif (x != void 0) {\n\t\t\tthis.axisYObject.position.x = x;\n\t\t\tthis.updateAxisXRequest();\n\t\t}\n\n\t}\n\n\tprivate onResize() {\n\t\tthis.setupAxis(AXIS_TYPE.X);\n\t\tthis.setupAxis(AXIS_TYPE.Y);\n\t}\n\n\tprivate setupAxis(orientation: AXIS_TYPE) {\n\n\t\tlet isXAxis = orientation == AXIS_TYPE.X;\n\t\tlet {width: visibleWidth, height: visibleHeight} = this.chartState.data;\n\t\tlet canvasWidth = 0, canvasHeight = 0;\n\n\t\t// clean meshes\n\t\tif (isXAxis) {\n\t\t\tthis.axisXObject.traverse(obj => this.axisXObject.remove(obj));\n\t\t\tcanvasWidth = visibleWidth * 3;\n\t\t\tcanvasHeight = 50;\n\t\t} else {\n\t\t\tthis.axisYObject.traverse(obj => this.axisYObject.remove(obj));\n\t\t\tcanvasWidth = 50;\n\t\t\tcanvasHeight = visibleHeight * 3;\n\t\t}\n\n\t\tvar texture = Utils.createPixelPerfectTexture(canvasWidth, canvasHeight, (ctx) => {\n\t\t\tctx.beginPath();\n\t\t\tctx.font = \"10px Arial\";\n\t\t\tctx.fillStyle = \"rgba(255,255,255,0.5)\";\n\t\t\tctx.strokeStyle = \"rgba(255,255,255,0.1)\";\n\t\t});\n\n\n\t\tvar material = new THREE.MeshBasicMaterial( {map: texture, side: THREE.FrontSide} );\n\t\tmaterial.transparent = true;\n\n\t\tvar axisMesh = new Mesh(\n\t\t\tnew THREE.PlaneGeometry(canvasWidth, canvasHeight),\n\t\t\tmaterial\n\t\t);\n\n\t\tif (isXAxis) {\n\t\t\taxisMesh.position.set(canvasWidth / 2, canvasHeight / 2, 0);\n\t\t\tthis.axisXObject.add(axisMesh);\n\t\t} else {\n\t\t\taxisMesh.position.set(visibleWidth - canvasWidth / 2, canvasHeight / 2, 0);\n\t\t\tthis.axisYObject.add(axisMesh);\n\t\t}\n\n\t\tthis.updateAxis(orientation);\n\n\t}\n\t\n\tgetObject3D(): Object3D {\n\t\treturn this.object3D;\n\t}\n\n\tprivate updateAxis(orientation: AXIS_TYPE) {\n\t\tif (this.isDestroyed) return;\n\t\tvar isXAxis = orientation == AXIS_TYPE.X;\n\t\tvar {width: visibleWidth, height: visibleHeight} = this.chartState.data;\n\t\tvar {scrollX, scrollY, zoomX, zoomY} = this.chartState.screen.options;\n\t\tvar axisOptions: IAxisOptions;\n\t\tvar axisMesh: Mesh;\n\t\tvar axisGridParams: IGridParamsForAxis;\n\n\t\tif (isXAxis) {\n\t\t\taxisMesh = this.axisXObject.children[0] as Mesh;\n\t\t\taxisOptions = this.chartState.data.xAxis;\n\t\t\taxisGridParams = GridWidget.getGridParamsForAxis(axisOptions, visibleWidth, zoomX);\n\t\t} else {\n\t\t\taxisMesh = this.axisYObject.children[0] as Mesh;\n\t\t\taxisOptions = this.chartState.data.yAxis;\n\t\t\taxisGridParams = GridWidget.getGridParamsForAxis(axisOptions, visibleHeight, zoomY);\n\t\t}\n\n\t\tvar geometry = axisMesh.geometry as PlaneGeometry;\n\t\tvar canvasWidth = geometry.parameters.width;\n\t\tvar canvasHeight = geometry.parameters.height;\n\t\tvar texture = (axisMesh.material as MeshBasicMaterial).map;\n\t\tvar ctx = texture.image.getContext('2d');\n\t\tctx.clearRect(0, 0, canvasWidth, canvasHeight);\n\n\t\tif (isXAxis) {\n\t\t\taxisMesh.position.x = canvasWidth / 2 - visibleWidth + scrollX;\n\t\t}\n\n\n\t\t// TODO: draw text and lines in different loops\n\t\tvar edgeOffset = axisGridParams.segmentsCount * axisGridParams.step;\n\t\tvar startVal = axisGridParams.start  - edgeOffset;\n\t\tvar endVal = axisGridParams.end + edgeOffset;\n\n\t\tctx.beginPath();\n\t\tfor (let val = startVal; val <= endVal; val += axisGridParams.step) {\n\t\t\tlet displayedValue = '';\n\t\t\tif (isXAxis) {\n\t\t\t\tlet pxVal = this.chartState.screen.getPointOnXAxis(val) - scrollX + visibleWidth;\n\t\t\t\tctx.textAlign = \"center\";\n\t\t\t\t// uncomment for dots\n\t\t\t\t// ctx.moveTo(pxVal + 0.5, canvasHeight);\n\t\t\t\t// ctx.lineTo(pxVal + 0.5, canvasHeight - 5);\n\t\t\t\tif (axisOptions.dataType == AXIS_DATA_TYPE.DATE) {\n\t\t\t\t\tdisplayedValue = AxisWidget.getDateStr(val, axisGridParams);\n\t\t\t\t} else {\n\t\t\t\t\tdisplayedValue = Number(val.toFixed(14)).toString();\n\t\t\t\t}\n\n\t\t\t\tctx.fillText(displayedValue, pxVal, canvasHeight - 10);\n\t\t\t} else {\n\t\t\t\tlet pxVal = canvasHeight - this.chartState.screen.getPointOnYAxis(val) + scrollY;\n\t\t\t\tctx.textAlign = \"right\";\n\t\t\t\t// uncomment for dots\n\t\t\t\t// ctx.moveTo(canvasWidth, pxVal + 0.5);\n\t\t\t\t// ctx.lineTo(canvasWidth - 5, pxVal + 0.5);\n\n\t\t\t\tdisplayedValue = Number(val.toFixed(14)).toString();\n\t\t\t\tctx.fillText(displayedValue, canvasWidth - 15 , pxVal + 3);\n\n\t\t\t\t// uncomment for left-side axis\n\t\t\t\t// ctx.moveTo(0, pxVal + 0.5);\n\t\t\t\t// ctx.lineTo(5, pxVal + 0.5);\n\t\t\t\t// ctx.fillText(Number(val.toFixed(14)).toString(), 15 , pxVal + 3);\n\t\t\t}\n\t\t\tctx.stroke();\n\t\t}\n\t\t// uncomment to preview canvas borders\n\t\t// ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\t\tctx.stroke();\n\t\tctx.closePath();\n\t\ttexture.needsUpdate = true;\n\t}\n\n\tprivate onZoomFrame(options: IScreenTransformOptions) {\n\t\tif (options.zoomX) {\n\t\t\tthis.updateAxis(AXIS_TYPE.X);\n\t\t\t//this.temporaryHideAxis(AXIS_ORIENTATION.H)\n\t\t}\n\t\tif (options.zoomY) {\n\t\t\tthis.updateAxis(AXIS_TYPE.Y);\n\t\t\t//this.temporaryHideAxis(AXIS_ORIENTATION.V)\n\t\t}\n\t}\n\n\t// private temporaryHideAxis(orientation: AXIS_TYPE) {\n\t// \tvar isXAxis = orientation == AXIS_TYPE.X;\n\t// \tvar timeoutId = setTimeout(() => {\n\t// \t\t\tthis.showAxis(orientation);\n\t// \t}, 200);\n\t//\n\t// \tif (isXAxis) {\n\t// \t\t(this.axisXObject.children[0] as Mesh).material.opacity = 0;\n\t// \t\tclearTimeout(this.showAxisXTimeout);\n\t// \t\tthis.showAxisXTimeout =\ttimeoutId;\n\t// \t} else {\n\t// \t\tclearTimeout(this.showAxisYTimeout);\n\t// \t\t(this.axisYObject.children[0] as Mesh).material.opacity = 0;\n\t// \t\tthis.showAxisYTimeout = timeoutId;\n\t// \t}\n\t// }\n\n\t// private showAxis(orientation: AXIS_TYPE) {\n\t// \tvar isXAxis = orientation == AXIS_TYPE.X;\n\t// \tvar material: MeshBasicMaterial;\n\t// \tif (isXAxis) {\n\t// \t\tmaterial = (this.axisXObject.children[0] as Mesh).material as MeshBasicMaterial;\n\t// \t} else {\n\t// \t\tmaterial = (this.axisYObject.children[0] as Mesh).material as MeshBasicMaterial;\n\t// \t}\n\t// \tthis.updateAxis(orientation);\n\t// \tTweenLite.to(material, 0.3, {opacity: 1});\n\t// }\n\n\tstatic getDateStr(timestamp: number, gridParams: IGridParamsForAxis): string {\n\t\tvar sec = 1000;\n\t\tvar min = sec * 60;\n\t\tvar hour = min * 60;\n\t\tvar day = hour * 60;\n\t\tvar step = gridParams.step;\n\t\tvar d = new Date(timestamp);\n\t\tvar tf = (num: number) => Utils.toFixed(num, 2);\n\t\treturn tf(d.getHours()) + ':' + tf(d.getMinutes()) + ':' + tf(d.getSeconds());\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/AxisWidget.ts\n **/","import Geometry = THREE.Geometry;\nimport Mesh = THREE.Mesh;\nimport LineBasicMaterial = THREE.LineBasicMaterial;\nimport Material = THREE.Material;\nimport Vector3 = THREE.Vector3;\nimport Line = THREE.Line;\nimport {ChartWidget} from \"../Widget\";\nimport LineSegments = THREE.LineSegments;\nimport {ChartState} from \"../State\";\nimport {Utils} from \"../Utils\";\nimport {IScreenTransformOptions} from \"../Screen\";\nimport {IAxisOptions} from \"../interfaces\";\n\nexport interface IGridParamsForAxis {\n\tstart: number,\n\tend: number,\n\tstep: number,\n\tstepInPx: number,\n\tlength: number,\n\tsegmentsCount: number\n}\n\n/**\n * widget for drawing chart grid\n */\nexport class GridWidget extends ChartWidget{\n\tstatic widgetName = 'Grid';\n\tprivate lineSegments: LineSegments;\n\tprivate gridSizeH: number;\n\tprivate gridSizeV: number;\n\tprivate isDestroyed = false;\n\n\tconstructor (chartState: ChartState) {\n\t\tsuper(chartState);\n\t\tvar {width, height, xAxis, yAxis} = chartState.data;\n\t\tthis.gridSizeH = Math.floor(width / xAxis.gridMinSize) * 3;\n\t\tthis.gridSizeV = Math.floor(height / yAxis.gridMinSize) * 3;\n\t\tthis.initGrid();\n\t\tthis.updateGrid();\n\t}\n\n\tbindEvents() {\n\t\t// grid is bigger then screen, so it's no need to update it on each scroll event\n\t\tlet updateGridThrottled = Utils.throttle(() => this.updateGrid(), 1000);\n\t\tthis.bindEvent(this.chartState.onScroll(() => updateGridThrottled()),\n\t\t\tthis.chartState.screen.onZoomFrame((options) => {\n\t\t\t\tupdateGridThrottled();\n\t\t\t\tthis.onZoomFrame(options);\n\t\t\t}),\n\t\t\tthis.chartState.onDestroy(() => {\n\t\t\t\tthis.isDestroyed = true;\n\t\t\t\tthis.unbindEvents();\n\t\t\t}),\n\t\t\tthis.chartState.onResize(() => {\n\t\t\t\tthis.updateGrid();\n\t\t\t})\n\t\t);\n\n\t}\n\n\tprivate initGrid() {\n\t\tvar geometry = new THREE.Geometry();\n\t\tvar material = new THREE.LineBasicMaterial( { linewidth: 1, opacity: 0.1, transparent: true});\n\t\tvar xLinesCount = this.gridSizeH;\n\t\tvar yLinesCount = this.gridSizeV;\n\t\twhile (xLinesCount--) geometry.vertices.push(new Vector3(), new Vector3());\n\t\twhile (yLinesCount--) geometry.vertices.push(new Vector3(), new Vector3());\n\t\tthis.lineSegments = new LineSegments(geometry, material);\n\t\tthis.lineSegments.position.setZ(-1);\n\t\tthis.lineSegments.frustumCulled = false;\n\t}\n\n\tprivate updateGrid() {\n\t\tif (this.isDestroyed) return;\n\t\tvar {yAxis, xAxis, width, height} = this.chartState.data;\n\t\tvar axisXGrid = GridWidget.getGridParamsForAxis(xAxis, width, xAxis.range.zoom);\n\t\tvar axisYGrid = GridWidget.getGridParamsForAxis(yAxis, height, yAxis.range.zoom);\n\t\tvar scrollXInSegments = Math.ceil(xAxis.range.scroll / axisXGrid.step);\n\t\tvar scrollYInSegments = Math.ceil(yAxis.range.scroll / axisYGrid.step);\n\t\tvar gridScrollXVal = scrollXInSegments * axisXGrid.step;\n\t\tvar gridScrollYVal = scrollYInSegments * axisYGrid.step;\n\t\tvar startXVal = axisXGrid.start + gridScrollXVal;\n\t\tvar startYVal = axisYGrid.start + gridScrollYVal;\n\t\tvar geometry = this.lineSegments.geometry as Geometry;\n\t\tvar vertices = geometry.vertices;\n\t\tvar lineInd = 0;\n\n\t\tfor (let i =  -this.gridSizeH / 3; i < this.gridSizeH * 2/3; i++) {\n\t\t\tlet value = startXVal + i * axisXGrid.step;\n\t\t\tlet lineSegment = this.getVerticalLineSegment(value, gridScrollXVal, gridScrollYVal);\n\t\t\tvertices[lineInd * 2].set(lineSegment[0].x, lineSegment[0].y, 0);\n\t\t\tvertices[lineInd * 2 + 1].set(lineSegment[1].x, lineSegment[1].y, 0);\n\t\t\tlineInd++;\n\t\t}\n\n\t\tfor (let i =  -this.gridSizeV / 3; i < this.gridSizeV * 2/3; i++) {\n\t\t\tlet value = startYVal + i * axisYGrid.step;\n\t\t\tlet lineSegment = this.getHorizontalLineSegment(value, gridScrollXVal, gridScrollYVal);\n\t\t\tvertices[lineInd * 2].set(lineSegment[0].x, lineSegment[0].y, 0);\n\t\t\tvertices[lineInd * 2 + 1].set(lineSegment[1].x, lineSegment[1].y, 0);\n\t\t\tlineInd++;\n\t\t}\n\n\t\tgeometry.verticesNeedUpdate = true;\n\n\t\tthis.lineSegments.scale.set(\n\t\t\txAxis.range.scaleFactor * xAxis.range.zoom,\n\t\t\tyAxis.range.scaleFactor * yAxis.range.zoom,\n\t\t\t1\n\t\t)\n\t}\n\n\tprivate getHorizontalLineSegment(yVal: number, scrollXVal: number, scrollYVal: number): Vector3[] {\n\t\tvar chartState = this.chartState;\n\t\tvar localYVal = yVal - chartState.data.yAxis.range.zeroVal - scrollYVal;\n\t\tvar widthVal = chartState.pxToValueByXAxis(chartState.data.width);\n\t\treturn [\n\t\t\tnew THREE.Vector3(widthVal * 2 + scrollXVal, localYVal, 0 ),\n\t\t\tnew THREE.Vector3( -widthVal + scrollXVal, localYVal, 0 )\n\t\t];\n\t}\n\n\tprivate getVerticalLineSegment(xVal: number, scrollXVal: number, scrollYVal: number): Vector3[] {\n\t\tvar chartState = this.chartState;\n\t\tvar localXVal = xVal - chartState.data.xAxis.range.zeroVal - scrollXVal;\n\t\tvar heightVal = chartState.pxToValueByYAxis(chartState.data.height);\n\t\treturn [\n\t\t\tnew THREE.Vector3(localXVal, heightVal * 2 + scrollYVal, 0 ),\n\t\t\tnew THREE.Vector3(localXVal, -heightVal + scrollYVal, 0 )\n\t\t];\n\t}\n\n\tprivate onZoomFrame(options: IScreenTransformOptions) {\n\t\tvar {xAxis, yAxis} = this.chartState.data;\n\t\tif (options.zoomX) this.lineSegments.scale.setX(xAxis.range.scaleFactor * options.zoomX);\n\t\tif (options.zoomY) this.lineSegments.scale.setY(yAxis.range.scaleFactor * options.zoomY);\n\t}\n\n\n\t// TODO: move this code to core\n\tstatic getGridParamsForAxis(axisOptions: IAxisOptions, axisWidth: number, zoom: number): IGridParamsForAxis {\n\t\tvar axisRange = axisOptions.range;\n\t\tvar from = axisRange.from; //var from = axisOptions.range.zeroVal + scroll;\n\t\tvar to = axisRange.to;  //var to = from + axisWidth / (axisRange.scaleFactor * zoom);\n\t\tvar axisLength = to - from;\n\t\tvar gridStep = 0;\n\t\tvar gridStepInPixels = 0;\n\t\tvar minGridStepInPixels = axisOptions.gridMinSize;\n\t\tvar axisLengthStr = String(axisLength);\n\t\tvar axisLengthPointPosition = axisLengthStr.indexOf('.');\n\t\tvar intPartLength = axisLengthPointPosition !== -1 ? axisLengthPointPosition : axisLengthStr.length;\n\n\t\tvar gridStepFound = false;\n\t\tvar digitPos = 0;\n\t\twhile (!gridStepFound) {\n\n\t\t\tlet power = intPartLength - digitPos - 1;\n\t\t\tlet multiplier = (Math.pow(10, power) || 1);\n\t\t\tlet dividers = [1, 2, 5];\n\t\t\tfor (let dividerInd = 0; dividerInd < dividers.length; dividerInd++) {\n\t\t\t\tlet nextGridStep = multiplier / dividers[dividerInd];\n\t\t\t\tlet nextGridStepInPixels = nextGridStep / axisLength * axisWidth;\n\t\t\t\tif (nextGridStepInPixels >= minGridStepInPixels) {\n\t\t\t\t\tgridStep = nextGridStep;\n\t\t\t\t\tgridStepInPixels = nextGridStepInPixels;\n\t\t\t\t} else {\n\t\t\t\t\tgridStepFound = true;\n\t\t\t\t\tif (gridStep === 0) {\n\t\t\t\t\t\tgridStep = nextGridStep;\n\t\t\t\t\t\tgridStepInPixels = nextGridStepInPixels;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!gridStepFound) digitPos++\n\n\t\t}\n\n\t\tvar gridStart = Math.floor(from / gridStep) * gridStep;\n\t\tvar gridEnd = Math.floor(to / gridStep) * gridStep;\n\n\t\treturn {\n\t\t\tstart: gridStart,\n\t\t\tend: gridEnd,\n\t\t\tstep: gridStep,\n\t\t\tstepInPx: gridStepInPixels,\n\t\t\tlength: gridEnd - gridStart,\n\t\t\tsegmentsCount: Math.round((gridEnd - gridStart) / gridStep)\n\t\t}\n\t}\n\t\n\tgetObject3D() {\n\t\treturn this.lineSegments;\n\t}\n\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/GridWidget.ts\n **/","\nimport Object3D = THREE.Object3D;\nimport {ChartState} from \"../State\";\nimport {Utils} from \"../Utils\";\nimport Mesh = THREE.Mesh;\nimport PlaneBufferGeometry = THREE.PlaneBufferGeometry;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport Vector3 = THREE.Vector3;\nimport {TrendWidget, TrendsWidget} from \"./TrendsWidget\";\nimport { ITrendOptions, TREND_TYPE } from \"../Trend\";\nimport {TrendSegments} from \"../TrendSegments.ts\";\n\n/**\n * widget adds loading indicator\n * activated when animations enabled\n */\nexport class TrendsLoadingWidget extends TrendsWidget<TrendLoading> {\n\tstatic widgetName = 'TrendsLoading';\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendLoading;\n\t}\n}\n\nexport class TrendLoading extends TrendWidget {\n\tprivate mesh: Mesh;\n\tprivate animation: TweenLite;\n\tprivate isActive = false;\n\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions, chartState: ChartState) {\n\t\treturn trendOptions.enabled && chartState.data.animations.enabled;\n\t}\n\n\tconstructor(state: ChartState, trendName: string) {\n\t\tsuper(state, trendName);\n\t\t// add beacon\n\t\tthis.mesh = new Mesh(\n\t\t\tnew PlaneBufferGeometry(32, 32),\n\t\t\tnew MeshBasicMaterial({map: TrendLoading.createTexture(), transparent: true})\n\t\t);\n\t\tthis.deactivate();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.mesh;\n\t}\n\t\n\tbindEvents() {\n\t\tsuper.bindEvents();\n\t\tthis.bindEvent(this.trend.onPrependRequest(() => this.activate()));\n\t}\n\n\tprependData() {\n\t\tthis.deactivate();\n\t}\n\n\tprivate activate() {\n\t\tvar mesh = this.mesh;\n\t\tmesh.material.opacity = 1;\n\t\tmesh.rotation.z = 0;\n\t\tvar animation = TweenLite.to(this.mesh.rotation, 0.5, {z: Math.PI * 2});\n\t\tanimation.eventCallback('onComplete', () => {\n\t\t\tanimation.restart();\n\t\t});\n\t\tthis.animation = animation;\n\t\tthis.isActive = true;\n\t\tthis.updatePosition();\n\t}\n\n\tprivate deactivate() {\n\t\tthis.animation && this.animation.kill();\n\t\tthis.mesh.material.opacity = 0;\n\t\tthis.isActive = false;\n\t}\n\n\n\tprivate static createTexture() {\n\t\tvar h = 64, w = 64;\n\t\treturn Utils.createTexture(h, w, (ctx: CanvasRenderingContext2D) => {\n\t\t\tctx.strokeStyle = \"rgba(255,255,255,0.95)\";\n\t\t\tctx.lineWidth = 5;\n\t\t\tvar center = h/2;\n\t\t\tctx.beginPath();\n\n\t\t\tctx.arc(center, center, 22, 0,Math.PI/ 2);\n\t\t\tctx.stroke();\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(center, center, 22, Math.PI, Math.PI + Math.PI/2);\n\t\t\tctx.stroke();\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(center, center, 3, 0, Math.PI * 2);\n\t\t\tctx.stroke();\n\t\t});\n\t}\n\t\n\tprotected onZoomFrame() {\n\t\tthis.updatePosition();\n\t}\n\n\tprivate updatePosition() {\n\t\tif (!this.isActive) return;\n\t\tlet trend = this.trend;\n\t\t// set new widget position\n\t\tlet segment = trend.segments.getStartSegment();\n\t\tlet x: number, y: number;\n\t\tif (trend.getOptions().type == TREND_TYPE.LINE) {\n\t\t\tx = segment.currentAnimationState.startXVal;\n\t\t\ty = segment.currentAnimationState.startYVal;\n\t\t} else {\n\t\t\tx = segment.currentAnimationState.xVal - segment.maxLength;\n\t\t\ty = segment.currentAnimationState.yVal\n\t\t}\n\t\tlet pointVector = this.chartState.screen.getPointOnChart(x, y);\n\t\tthis.mesh.position.set(pointVector.x, pointVector.y, 0);\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/TrendsLoadingWidget.ts\n **/","\nimport {ChartWidget} from \"../Widget\";\nimport Object3D = THREE.Object3D;\nimport {ChartState} from \"../State\";\nimport {ITrendOptions, ITrendData, Trend} from \"../Trend\";\nimport Vector2 = THREE.Vector2;\nimport Vector3 = THREE.Vector3;\nimport {TrendSegments} from \"../TrendSegments\";\nimport {IScreenTransformOptions} from \"../Screen\";\n\n\nexport interface ITrendWidgetClass<TrendWidgetType> {\n\tnew (chartState: ChartState, trendName: string): TrendWidgetType;\n\twidgetIsEnabled(trendOptions: ITrendOptions, chartState: ChartState): boolean;\n}\n\n/**\n * abstract manager class for all trends widgets\n */\nexport abstract class TrendsWidget<TrendWidgetType extends TrendWidget> extends ChartWidget {\n\tprotected abstract getTrendWidgetClass(): ITrendWidgetClass<TrendWidgetType>;\n\tprotected object3D: Object3D;\n\tprotected widgets: {[trendName: string]: TrendWidgetType} = {};\n\n\tconstructor (state: ChartState) {\n\t\tsuper(state);\n\t\tthis.object3D = new Object3D();\n\t\tthis.onTrendsChange();\n\t}\n\n\tprotected bindEvents() {\n\t\tvar state = this.chartState;\n\t\tstate.onTrendsChange(() => this.onTrendsChange());\n\t\tstate.onTrendChange((trendName: string, changedOptions: ITrendOptions, newData: ITrendData) => {\n\t\t\tthis.onTrendChange(trendName, changedOptions, newData)\n\t\t});\n\t}\n\n\tprotected onTrendsChange() {\n\t\tvar trendsOptions = this.chartState.data.trends;\n\t\tvar TrendWidgetClass = this.getTrendWidgetClass();\n\t\tfor (let trendName in trendsOptions) {\n\t\t\tlet trendOptions = trendsOptions[trendName];\n\t\t\tlet widgetCanBeEnabled = TrendWidgetClass.widgetIsEnabled(trendOptions, this.chartState);\n\t\t\tif (widgetCanBeEnabled && !this.widgets[trendName]) {\n\t\t\t\tthis.createTrendWidget(trendName);\n\t\t\t} else if (!widgetCanBeEnabled && this.widgets[trendName]){\n\t\t\t\tthis.destroyTrendWidget(trendName);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onTrendChange(trendName: string, changedOptions: ITrendOptions, newData: ITrendData) {\n\t\tvar widget = this.widgets[trendName];\n\t\tif (!widget) return;\n\t\twidget.onTrendChange(changedOptions);\n\t\tif (newData) {\n\t\t\tvar data = this.chartState.getTrend(trendName).getData();\n\t\t\tvar isAppend = (!data.length || data[0].xVal < newData[0].xVal);\n\t\t\tisAppend ? widget.appendData(newData) : widget.prependData(newData);\n\t\t}\n\t}\n\n\tgetObject3D(): Object3D {\n\t\treturn this.object3D;\n\t}\n\n\tprivate createTrendWidget(trendName: string) {\n\t\tvar WidgetConstructor = this.getTrendWidgetClass();\n\t\tvar widget = new WidgetConstructor(this.chartState, trendName);\n\t\tthis.widgets[trendName] = widget;\n\t\tvar widgetObject = widget.getObject3D();\n\t\twidgetObject.name = trendName;\n\t\tthis.object3D.add(widget.getObject3D());\n\t}\n\n\tprivate destroyTrendWidget(trendName: string) {\n\t\tthis.widgets[trendName].onDestroy();\n\t\tdelete this.widgets[trendName];\n\t\tvar widgetObject = this.object3D.getObjectByName(trendName);\n\t\tthis.object3D.remove(widgetObject);\n\t}\n}\n\n/**\n * based class for all trends widgets\n */\nexport abstract class TrendWidget {\n\tprotected trend: Trend;\n\tprivate unsubscribers: Function[] = [];\n\n\tconstructor (protected chartState: ChartState, protected trendName: string) {\n\t\tthis.trend = chartState.trendsManager.getTrend(trendName);\n\t\tthis.chartState = chartState;\n\t\tthis.bindEvents();\n\t}\n\tabstract getObject3D(): Object3D;\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions, chartState: ChartState) {\n\t\treturn trendOptions.enabled;\n\t}\n\tappendData(newData: ITrendData) {};\n\tprependData(newData: ITrendData) {};\n\tonTrendChange(changedOptions?: ITrendOptions) {}\n\tonDestroy() {\n\t\tfor (let unsubscriber of this.unsubscribers) {\n\t\t\tunsubscriber();\n\t\t}\n\t}\n\tprotected onSegmentsAnimate(segments: TrendSegments) {\n\t}\n\tprotected onZoomFrame(options: IScreenTransformOptions) {\n\t}\n\tprotected onTransformationFrame(options: IScreenTransformOptions) {\n\t}\n\tprotected onZoom() {\n\t}\n\n\n\tprotected bindEvents() {\n\n\t\tthis.bindEvent(this.trend.segments.onAnimationFrame(\n\t\t\t(trendPoints: TrendSegments) => this.onSegmentsAnimate(trendPoints)\n\t\t));\n\n\t\tthis.bindEvent(this.chartState.screen.onTransformationFrame(\n\t\t\t(options) => this.onTransformationFrame(options)\n\t\t));\n\t\t\n\t\tthis.bindEvent(this.chartState.screen.onZoomFrame(\n\t\t\t(options) => this.onZoomFrame(options)\n\t\t));\n\n\t\tthis.bindEvent(this.chartState.onZoom(() => this.onZoom()));\n\t};\n\n\tprotected bindEvent(unsubscriber: Function) {\n\t\tthis.unsubscribers.push(unsubscriber);\n\t}\n\n\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/TrendsWidget.ts\n **/","\nimport {ChartWidget} from \"../Widget\";\nimport {ChartState} from \"../State\";\nimport Object3D = THREE.Object3D;\nimport Geometry = THREE.Geometry;\nimport LineBasicMaterial = THREE.LineBasicMaterial;\nimport Vector3 = THREE.Vector3;\nimport {Utils} from \"../Utils\";\nimport Line = THREE.Line;\nimport Mesh = THREE.Mesh;\nimport Color = THREE.Color;\nimport Texture = THREE.Texture;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport {AxisMark, AxisMarks} from \"../AxisMarks\";\nimport {AXIS_TYPE} from \"../interfaces\";\nimport {IScreenTransformOptions} from \"../Screen\";\n\n\n/**\n * widget for shows marks on axis\n */\nexport class AxisMarksWidget extends ChartWidget {\n\tstatic widgetName = 'AxisMarks';\n\n\tprivate object3D: Object3D;\n\tprivate axisMarksWidgets: AxisMarkWidget[] = [];\n\n\tconstructor(chartState: ChartState) {\n\t\tsuper(chartState);\n\t\tthis.object3D = new Object3D();\n\t\tlet {xAxisMarks, yAxisMarks} = chartState;\n\n\t\tlet items = xAxisMarks.getItems();\n\t\tfor (var markName in items) {\n\t\t\tthis.createAxisMark(items[markName]);\n\t\t}\n\t\titems = yAxisMarks.getItems();\n\t\tfor (var markName in items) {\n\t\t\tthis.createAxisMark(items[markName]);\n\t\t}\n\t}\n\n\tprivate createAxisMark(axisMark: AxisMark) {\n\t\tvar axisMarkWidget = new AxisMarkWidget(this.chartState, axisMark);\n\t\tthis.axisMarksWidgets.push(axisMarkWidget);\n\t\tthis.object3D.add(axisMarkWidget.getObject3D());\n\t}\n\n\tprotected bindEvents() {\n\t\tthis.bindEvent(\n\t\t\tthis.chartState.screen.onTransformationFrame(() => this.updateMarksPositions()),\n\t\t\tthis.chartState.onResize(() => this.updateMarksPositions())\n\t\t);\n\t}\n\n\tprivate updateMarksPositions() {\n\t\tfor (let widget of this.axisMarksWidgets) widget.updatePosition();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.object3D;\n\t}\n\n}\n\n\n\nconst DEFAULT_INDICATOR_RENDER_FUNCTION = (axisMarkWidget: AxisMarkWidget, ctx: CanvasRenderingContext2D) => {\n\tvar axisMark = axisMarkWidget.axisMark;\n\tctx.fillStyle = axisMark.options.lineColor;\n\tctx.clearRect(0, 0, axisMarkWidget.indicatorWidth, axisMarkWidget.indicatorHeight);\n\tlet xCoord = 15;\n\n\tif (axisMark.axisType == AXIS_TYPE.Y) {\n\t\tctx.textAlign = 'end';\n\t\txCoord = axisMarkWidget.indicatorWidth;\n\t}\n\n\tctx.fillText(axisMark.options.title, xCoord, 20);\n\tif (!axisMark.options.showValue) return;\n\n\tctx.fillStyle = 'rgba(255, 255, 255, 0.7)';\n\tctx.fillText(axisMark.getDisplayedVal(), 16, 34);\n};\n\nlet INDICATOR_POS_Z = 0.1;\n\nclass AxisMarkWidget {\n\tstatic typeName = 'simple';\n\taxisMark: AxisMark;\n\tindicatorWidth = 128;\n\tindicatorHeight = 64;\n\tprotected indicatorRenderFunction = DEFAULT_INDICATOR_RENDER_FUNCTION;\n\tprotected chartState: ChartState;\n\tprotected axisType: AXIS_TYPE;\n\tprotected object3D: Object3D;\n\tprotected line: Line;\n\tprotected indicator: Mesh;\n\tprotected moveAnimation: TweenLite;\n\tprotected frameValue: number;\n\t\n\n\tconstructor(chartState: ChartState, axisMark: AxisMark) {\n\t\tthis.chartState = chartState;\n\t\tthis.axisMark = axisMark;\n\t\tthis.axisType = axisMark.axisType;\n\t\tthis.frameValue = axisMark.options.value;\n\t\tthis.object3D = new Object3D();\n\t\tthis.object3D.position.setZ(-0.1);\n\n\t\tthis.line = this.createLine();\n\t\tthis.object3D.add(this.line);\n\t\tthis.indicator = this.createIndicator();\n\t\tthis.object3D.add(this.indicator);\n\t\tthis.renderIndicator();\n\t\tthis.updatePosition();\n\t\tthis.bindEvents();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.object3D;\n\t}\n\n\tprotected createLine(): Line {\n\t\tvar {lineWidth, lineColor} = this.axisMark.options;\n\t\tvar lineGeometry = new Geometry();\n\n\t\tlineGeometry.vertices.push(new Vector3(0,0,0), new Vector3(0,0,0));\n\t\treturn new Line(\n\t\t\tlineGeometry,\n\t\t\tnew LineBasicMaterial( { color: Utils.getHexColor(lineColor), linewidth: lineWidth})\n\t\t);\n\t}\n\n\tprotected createIndicator(): Mesh {\n\t\tvar {indicatorWidth: width, indicatorHeight: height} = this;\n\t\tvar texture = Utils.createPixelPerfectTexture(width, height, (ctx) => {\n\t\t\tctx.beginPath();\n\t\t\tctx.font = \"10px Arial\";\n\t\t});\n\n\t\tvar material = new THREE.MeshBasicMaterial( {map: texture, side: THREE.FrontSide} );\n\t\tmaterial.transparent = true;\n\n\t\treturn new Mesh(\n\t\t\tnew THREE.PlaneGeometry(width, height),\n\t\t\tmaterial\n\t\t);\n\t}\n\n\tprotected renderIndicator() {\n\t\tvar texture = (this.indicator.material as MeshBasicMaterial).map as Texture;\n\t\tvar ctx = (texture.image as HTMLCanvasElement).getContext('2d');\n\t\tDEFAULT_INDICATOR_RENDER_FUNCTION(this, ctx);\n\t\ttexture.needsUpdate = true;\n\t}\n\n\tprotected bindEvents() {\n\t\tthis.axisMark.onDisplayedValueChange(() => this.renderIndicator());\n\t\tthis.axisMark.onValueChange(() => this.onValueChangeHandler());\n\t}\n\n\tprivate onValueChangeHandler() {\n\t\t// move mark to new position with animation\n\t\tif (this.moveAnimation) this.moveAnimation.kill();\n\t\tvar animations = this.chartState.data.animations;\n\t\tvar targetValue = this.axisMark.options.value;\n\t\tvar cb = () => {\n\t\t\tthis.updatePosition();\n\t\t};\n\t\tif (animations.enabled) {\n\t\t\tthis.moveAnimation = TweenLite.to(\n\t\t\t\tthis, animations.trendChangeSpeed,\n\t\t\t\t{frameValue: targetValue, ease: animations.trendChangeEase}\n\t\t\t);\n\t\t\tthis.moveAnimation.eventCallback('onUpdate', cb);\n\t\t} else {\n\t\t\tthis.frameValue = targetValue;\n\t\t\tcb();\n\t\t}\n\t}\n\n\tupdatePosition()  {\n\t\tlet chartState = this.chartState;\n\t\tlet screen = chartState.screen;\n\t\tlet isXAxis = this.axisType == AXIS_TYPE.X;\n\t\tlet lineGeometry = (this.line.geometry as Geometry);\n\t\tlet hasStickMode = this.axisMark.options.stickToEdges;\n\t\tlet {width, height} = this.chartState.data;\n\n\t\tif (isXAxis) {\n\t\t\t// TODO: make stickToEdges mode for AXIS_TYPE.X \n\t\t\tthis.object3D.position.x = screen.getPointOnXAxis(this.frameValue);\n\t\t\tthis.object3D.position.y = screen.getBottom();\n\t\t\tlineGeometry.vertices[1].setY(height);\n\t\t\tthis.indicator.position.set(\n\t\t\t\tthis.indicatorWidth / 2,\n\t\t\t\tchartState.data.height - this.indicatorHeight / 2,\n\t\t\t\tINDICATOR_POS_Z\n\t\t\t);\n\t\t} else {\n\t\t\tlet val = this.frameValue;\n\t\t\tlet bottomVal = screen.getBottomVal();\n\t\t\tlet topVal = screen.getTopVal();\n\t\t\tlet needToStickOnTop = hasStickMode && val > topVal;\n\t\t\tlet needToStickOnBottom = hasStickMode && val < bottomVal;\n\t\t\tlet centerYVal = screen.getCenterYVal();\n\t\t\tthis.object3D.position.x = screen.getLeft();\n\t\t\tif (needToStickOnTop) {\n\t\t\t\tthis.object3D.position.y = screen.getTop();\n\t\t\t} else if (needToStickOnBottom) {\n\t\t\t\tthis.object3D.position.y = screen.getBottom();\n\t\t\t} else {\n\t\t\t\tthis.object3D.position.y = screen.getPointOnYAxis(this.frameValue);\n\t\t\t}\n\t\t\tlineGeometry.vertices[1].setX(width);\n\n\t\t\tlet indicatorPosY = val > centerYVal ? -35 : 10;\n\t\t\tthis.indicator.position.set(width - this.indicatorWidth / 2 - 50, indicatorPosY, INDICATOR_POS_Z);\n\t\t}\n\t\tlineGeometry.verticesNeedUpdate = true;\n\t}\n\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/AxisMarksWidget.ts\n **/","\nimport {ChartWidget} from \"../Widget\";\nimport {ChartState} from \"../State\";\nimport LineSegments = THREE.LineSegments;\nimport Vector3 = THREE.Vector3;\n/**\n * widget for drawing chart grid\n */\nexport class BorderWidget extends ChartWidget {\n\tstatic widgetName = 'Border';\n\tprivate lineSegments: LineSegments;\n\n\n\tconstructor (chartState: ChartState) {\n\t\tsuper(chartState);\n\t\tvar {width, height} = chartState.data;\n\t\tvar geometry = new THREE.Geometry();\n\t\tvar material = new THREE.LineBasicMaterial( { linewidth: 1, opacity: 0.0, transparent: true} );\n\n\t\tgeometry.vertices.push(\n\t\t\tnew Vector3(0, 0, 0), new Vector3(0, height, 0),\n\t\t\tnew Vector3(0, height, 0), new Vector3(width, height, 0),\n\t\t\tnew Vector3(width, height, 0), new Vector3(width, 0, 0),\n\t\t\tnew Vector3(width, 0, 0), new Vector3(0, 0, 0),\n\t\t\tnew Vector3(width / 2, height, 0), new Vector3(width / 2, 0, 0)\n\t\t);\n\t\tthis.lineSegments = new LineSegments(geometry, material);\n\t}\n\tgetObject3D() {\n\t\treturn this.lineSegments;\n\t}\n\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/BorderWidget.ts\n **/","\nimport Object3D = THREE.Object3D;\nimport {ChartState} from \"../State\";\nimport {Utils} from \"../Utils\";\nimport Mesh = THREE.Mesh;\nimport PlaneBufferGeometry = THREE.PlaneBufferGeometry;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport Vector3 = THREE.Vector3;\nimport {TrendWidget, TrendsWidget} from \"./TrendsWidget\";\nimport {ITrendOptions} from \"../Trend\";\nimport PlaneGeometry = THREE.PlaneGeometry;\nimport Color = THREE.Color;\nimport {TrendSegments, TrendSegment} from \"../TrendSegments.ts\";\n\nconst CANVAS_WIDTH = 128;\nconst CANVAS_HEIGHT = 64;\nconst OFFSET_X = 15;\n\nexport class TrendsIndicatorWidget extends TrendsWidget<TrendIndicator> {\n\tstatic widgetName = 'TrendsIndicator';\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendIndicator;\n\t}\n}\n\nexport class TrendIndicator extends TrendWidget {\n\tprivate mesh: Mesh;\n\tprivate segment: TrendSegment;\n\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions) {\n\t\treturn trendOptions.enabled && trendOptions.hasIndicator;\n\t}\n\n\tconstructor(state: ChartState, trendName: string) {\n\t\tsuper(state, trendName);\n\t\tthis.initObject();\n\t\tthis.onTrendChange();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.mesh;\n\t}\n\n\tonTrendChange() {\n\t\t// update canvas value\n\t\tlet trendData = this.trend.getData();\n\t\tvar lastItem = trendData[trendData.length - 1];\n\t\tvar texture = (this.mesh.material as MeshBasicMaterial).map;\n\t\tvar ctx = texture.image.getContext('2d');\n\t\tctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);\n\t\t// uncomment to preview indicator rect\n\t\t// ctx.fillStyle = \"rgba(255,255,255,0.5)\";\n\t\t// ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);\n\t\tctx.fillText(lastItem.yVal.toFixed(4), 0, 15);\n\t\ttexture.needsUpdate = true;\n\t}\n\n\tprivate initObject() {\n\t\tvar color = new Color(this.trend.getOptions().lineColor);\n\t\tvar texture = Utils.createPixelPerfectTexture(CANVAS_WIDTH, CANVAS_HEIGHT, (ctx) => {\n\t\t\tctx.beginPath();\n\t\t\tctx.font = \"15px Arial\";\n\t\t\tctx.fillStyle = color.getStyle();\n\t\t\tctx.strokeStyle = \"rgba(255,255,255,0.95)\";\n\t\t});\n\n\t\tvar material = new THREE.MeshBasicMaterial( {map: texture, side: THREE.FrontSide} );\n\t\tmaterial.transparent = true;\n\n\t\tthis.mesh = new Mesh(\n\t\t\tnew THREE.PlaneGeometry(CANVAS_WIDTH, CANVAS_HEIGHT),\n\t\t\tmaterial\n\t\t);\n\t}\n\n\tprotected onTransformationFrame() {\n\t\t// set new widget position\n\t\tthis.segment = this.trend.segments.getEndSegment();\n\t\tthis.updatePosition();\n\t}\n\n\tprotected onSegmentsAnimate(segments: TrendSegments) {\n\t\t// set new widget position\n\t\tthis.segment = segments.getEndSegment();\n\t\tthis.updatePosition();\n\t}\n\n\tprivate updatePosition() {\n\t\tvar state = this.chartState;\n\t\tvar {endXVal: segmentEndXVal, endYVal: segmentEndYVal} = this.segment.currentAnimationState;\n\t\tvar endPointVector = state.screen.getPointOnChart(segmentEndXVal, segmentEndYVal);\n\t\tvar screenWidth = state.data.width;\n\t\tvar x = endPointVector.x + OFFSET_X;\n\t\tvar y = endPointVector.y;\n\t\t\n\t\tvar screenX = state.screen.getScreenXByPoint(endPointVector.x);\n\t\tvar indicatorIsOutOfScreen = screenX < 0 || screenX > screenWidth;\n\t\tif (indicatorIsOutOfScreen) {\n\t\t\tif (screenX < 0) x = state.screen.getPointByScreenX(0) + 20;\n\t\t\tif (screenX > screenWidth) x = state.screen.getPointByScreenX(screenWidth) - CANVAS_WIDTH / 2 - 10;\n\t\t\ty -= 25;\n\t\t}\n\t\tthis.mesh.position.set(x + CANVAS_WIDTH / 2, y + CANVAS_HEIGHT / 2  - 30, 0.1);\n\t}\n\n\t\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/TrendsIndicatorWidget.ts\n **/","import Geometry = THREE.Geometry;\nimport Mesh = THREE.Mesh;\nimport LineBasicMaterial = THREE.LineBasicMaterial;\nimport Material = THREE.Material;\nimport Vector3 = THREE.Vector3;\nimport Line = THREE.Line;\nimport Object3D = THREE.Object3D;\nimport {ChartState} from \"../State\";\nimport Face3 = THREE.Face3;\nimport Texture = THREE.Texture;\nimport Vector2 = THREE.Vector2;\nimport {TrendsWidget, TrendWidget} from \"./TrendsWidget\";\nimport { TrendSegments, ITrendSegmentState } from \"../TrendSegments.ts\";\nimport LineSegments = THREE.LineSegments;\nimport {IScreenTransformOptions} from \"../Screen\";\nimport { ITrendOptions, TREND_TYPE } from '../Trend';\nimport { Utils } from '../Utils';\n\nconst MAX_DISPLAYED_SEGMENTS = 2000;\n\n/**\n * widget for drawing trends lines\n */\nexport class TrendsLineWidget extends TrendsWidget<TrendLine> {\n\tstatic widgetName = \"TrendsLine\";\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendLine;\n\t}\n}\n\ninterface ILineSegment {\n\tind: number,\n\tsegmentId: number\n}\n\nexport class TrendLine extends TrendWidget {\n\tprivate material: LineBasicMaterial;\n\tprivate lineSegments: LineSegments;\n\tprivate scaleXFactor: number;\n\tprivate scaleYFactor: number;\n\tprivate vertices: Vector3[];\n\n\t// contains indexes of free segments\n\tprivate freeSegmentsInds: number[] = [];\n\n\t// contains segments to display\n\tprivate displayedSegments: {[segmentId: number]: ILineSegment} = {};\n\t\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions) {\n\t\treturn trendOptions.enabled && trendOptions.type == TREND_TYPE.LINE;\n\t}\n\t\n\tconstructor (chartState: ChartState, trendName: string) {\n\t\tsuper(chartState, trendName);\n\t\tvar options = this.trend.getOptions();\n\t\tthis.material = new LineBasicMaterial( { color: options.lineColor, linewidth: options.lineWidth } );\n\t\tthis.initLine();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.lineSegments;\n\t}\n\n\tprotected bindEvents() {\n\t\tsuper.bindEvents();\n\t\tthis.bindEvent(this.trend.segments.onRebuild(() => {\n\t\t\tthis.destroySegments();\n\t\t\tthis.setupSegments();\n\t\t}));\n\t\tthis.bindEvent(this.trend.segments.onDisplayedRangeChanged(() => {\n\t\t\tthis.setupSegments();\n\t\t}));\n\t}\n\t\n\tprivate initLine() {\n\t\tlet geometry = new Geometry();\n\t\tlet {scaleFactor: scaleXFactor, zoom: zoomX} = this.chartState.data.xAxis.range;\n\t\tlet {scaleFactor: scaleYFactor, zoom: zoomY} = this.chartState.data.yAxis.range;\n\t\tthis.scaleXFactor = scaleXFactor;\n\t\tthis.scaleYFactor = scaleYFactor;\n\t\tthis.lineSegments = new LineSegments(geometry, this.material);\n\t\tthis.lineSegments.scale.set(scaleXFactor * zoomX, scaleYFactor * zoomY, 1);\n\t\tthis.lineSegments.frustumCulled = false;\n\t\tfor (let i = 0; i < MAX_DISPLAYED_SEGMENTS; i++) {\n\t\t\tgeometry.vertices.push(new  Vector3(), new Vector3());\n\t\t\tthis.freeSegmentsInds.push(i);\n\t\t}\n\t\tthis.vertices = geometry.vertices;\n\t\tthis.setupSegments();\n\t}\n\n\tprivate setupSegments() {\n\t\tlet geometry = this.lineSegments.geometry as Geometry;\n\n\t\tlet {firstDisplayedSegment, lastDisplayedSegment} = this.trend.segments;\n\n\t\tfor (let segmentId in this.displayedSegments) {\n\t\t\tlet lineSegment = this.displayedSegments[segmentId];\n\t\t\tlet segment = this.trend.segments.segments[lineSegment.segmentId];\n\t\t\tlet segmentIsNotDisplayed = (\n\t\t\t\tsegment.startXVal < firstDisplayedSegment.startXVal ||\n\t\t\t\tsegment.endXVal > lastDisplayedSegment.endXVal\n\t\t\t);\n\t\t\tif (segmentIsNotDisplayed) this.destroySegment(Number(segmentId));\n\t\t}\n\n\t\tlet segment = firstDisplayedSegment;\n\t\twhile (segment && segment.xVal <= lastDisplayedSegment.xVal) {\n\t\t\tthis.setupSegment(segment.id, segment.currentAnimationState);\n\t\t\tsegment = segment.getNext();\n\t\t}\n\t\tgeometry.verticesNeedUpdate = true;\n\n\t}\n\n\tprivate setupSegment(segmentId: number, segmentState: ITrendSegmentState) {\n\t\tlet lineSegment = this.displayedSegments[segmentId];\n\t\tif (!lineSegment) {\n\t\t\tif (this.freeSegmentsInds.length == 0) Utils.error('Max allocated segments reached');\n\t\t\tlet ind = this.freeSegmentsInds.pop();\n\t\t\tlineSegment = this.displayedSegments[segmentId] = {segmentId, ind};\n\t\t}\n\t\tlet segmentInd = lineSegment.ind;\n\t\tlet lineStartVertex = this.vertices[segmentInd * 2];\n\t\tlet lineEndVertex = this.vertices[segmentInd * 2 + 1];\n\t\tlineStartVertex.set(this.toLocalX(segmentState.startXVal), this.toLocalY(segmentState.startYVal), 0);\n\t\tlineEndVertex.set(this.toLocalX(segmentState.endXVal), this.toLocalY(segmentState.endYVal), 0);\n\t}\n\n\tprivate destroySegments() {\n\t\tfor (let segmentId in this.displayedSegments) this.destroySegment(Number(segmentId));\n\t}\n\n\tprivate destroySegment(segmentId: number) {\n\t\tlet lineSegment = this.displayedSegments[segmentId];\n\t\tlet lineStartVertex = this.vertices[lineSegment.ind * 2];\n\t\tlet lineEndVertex = this.vertices[lineSegment.ind * 2 + 1];\n\t\tlineStartVertex.set(0, 0, 0);\n\t\tlineEndVertex.set(0, 0, 0);\n\t\tdelete this.displayedSegments[segmentId];\n\t\tthis.freeSegmentsInds.push(lineSegment.ind);\n\t}\n\n\n\tprotected onZoomFrame(options: IScreenTransformOptions) {\n\t\tvar currentScale = this.lineSegments.scale;\n\t\tif (options.zoomX) currentScale.setX(this.scaleXFactor * options.zoomX);\n\t\tif (options.zoomY) currentScale.setY(this.scaleYFactor * options.zoomY);\n\t}\n\n\n\tprotected onSegmentsAnimate(trendSegments: TrendSegments) {\n\t\tvar geometry = this.lineSegments.geometry as Geometry;\n\t\tfor (let segmentId of trendSegments.animatedSegmentsIds) {\n\t\t\tif (!this.displayedSegments[segmentId]) continue;\n\t\t\tthis.setupSegment(segmentId, trendSegments.segmentsById[segmentId].currentAnimationState);\n\t\t}\n\t\tgeometry.verticesNeedUpdate = true;\n\t}\n\n\n\tprivate toLocalX(xVal: number): number {\n\t\treturn xVal - this.chartState.data.xAxis.range.zeroVal;\n\t}\n\n\tprivate toLocalY(yVal: number): number {\n\t\treturn yVal - this.chartState.data.yAxis.range.zeroVal;\n\t}\n\n\tprivate toLocalVec(vec: Vector3): Vector3 {\n\t\treturn new Vector3(this.toLocalX(vec.x), this.toLocalY(vec.y), 0);\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/TrendsLineWidget.ts\n **/","\n\nimport { TrendsWidget, TrendWidget } from './TrendsWidget';\nimport { ChartState } from '../State';\nimport Object3D = THREE.Object3D;\nimport Geometry = THREE.Geometry;\nimport { IScreenTransformOptions } from '../Screen';\nimport { TrendSegments, ITrendSegmentState } from '../TrendSegments.ts';\nimport Vector3 = THREE.Vector3;\nimport Mesh = THREE.Mesh;\nimport Line = THREE.Line;\nimport BoxGeometry = THREE.BoxGeometry;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport PlaneGeometry = THREE.PlaneGeometry;\nimport { TREND_TYPE, ITrendOptions } from '../Trend';\nimport LineBasicMaterial = THREE.LineBasicMaterial;\nimport remove = THREE.Cache.remove;\nimport { Utils } from '../Utils';\n\n\nconst RISE_COLOR = 0x2CAC40;\nconst FALL_COLOR = 0xEE5533;\nconst MARGIN_PERCENT = 0.3;\nconst MAX_CANDLES = 100;\n\n/**\n * widget for drawing trends candles\n */\nexport class TrendsCandlesWidget extends TrendsWidget<TrendCandlesWidget> {\n\tstatic widgetName = \"TrendsCandles\";\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendCandlesWidget;\n\t}\n}\n\n\nexport class TrendCandlesWidget extends TrendWidget {\n\tprivate scaleXFactor: number;\n\tprivate scaleYFactor: number;\n\tprivate object3D: Object3D;\n\t\n\t// contains indexes of free candles\n\tprivate freeCandlesInds: number[] = [];\n\tprivate candlesPool: CandleWidget[] = [];\n\tprivate candles: {[segmentId: number]: CandleWidget} = {};\n\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions) {\n\t\treturn trendOptions.enabled && trendOptions.type == TREND_TYPE.CANDLE;\n\t}\n\n\tconstructor (chartState: ChartState, trendName: string) {\n\t\tsuper(chartState, trendName);\n\t\tthis.initObject();\n\t}\n\n\n\tgetObject3D() {\n\t\treturn this.object3D;\n\t}\n\n\tprotected bindEvents() {\n\t\tsuper.bindEvents();\n\t\tthis.bindEvent(this.trend.segments.onRebuild(() => {\n\t\t\tthis.destroyCandles();\n\t\t\tthis.setupCandles();\n\t\t}));\n\t\tthis.bindEvent(this.trend.segments.onDisplayedRangeChanged(() => {\n\t\t\tthis.setupCandles();\n\t\t}));\n\t}\n\t\n\tprivate initObject() {\n\t\tlet stateData = this.chartState.data;\n\t\tlet {scaleFactor: scaleXFactor, zoom: zoomX} = stateData.xAxis.range;\n\t\tlet {scaleFactor: scaleYFactor, zoom: zoomY} = stateData.yAxis.range;\n\t\tthis.scaleXFactor = scaleXFactor;\n\t\tthis.scaleYFactor = scaleYFactor;\n\t\tthis.object3D = new Object3D();\n\t\tthis.object3D.scale.set(scaleXFactor * zoomX, scaleYFactor * zoomY, 1);\n\t\tthis.object3D.frustumCulled = false;\n\t\tfor (let i = 0; i < MAX_CANDLES; i++) this.freeCandlesInds.push(i);\n\t\tthis.setupCandles();\n\t}\n\n\tprivate setupCandles() {\n\n\t\t// remove invisible\n\t\tlet {firstDisplayedSegment, lastDisplayedSegment} = this.trend.segments;\n\n\t\tfor (let segmentId in this.candles) {\n\t\t\tlet segment = this.candles[segmentId].segment;\n\t\t\tlet segmentIsNotDisplayed = (\n\t\t\t\tsegment.startXVal < firstDisplayedSegment.startXVal ||\n\t\t\t\tsegment.endXVal > lastDisplayedSegment.endXVal\n\t\t\t);\n\t\t\tif (segmentIsNotDisplayed) this.destroyCandle(Number(segmentId));\n\t\t}\n\n\t\tlet segment = firstDisplayedSegment;\n\t\twhile (segment && segment.xVal <= lastDisplayedSegment.xVal) {\n\t\t\tthis.setupCandle(segment.id, segment.currentAnimationState);\n\t\t\tsegment = segment.getNext();\n\t\t}\n\t}\n\n\tprivate destroyCandles() {\n\t\tfor (let segmentId in this.candles) this.destroyCandle(Number(segmentId));\n\t}\n\n\tprivate destroyCandle(segmentId: number) {\n\t\tlet candle = this.candles[segmentId];\n\t\tthis.object3D.remove(candle.getObject3D());\n\t\tdelete this.candles[segmentId];\n\t}\n\n\tprotected onZoomFrame(options: IScreenTransformOptions) {\n\t\tvar currentScale = this.object3D.scale;\n\t\tif (options.zoomX) currentScale.setX(this.scaleXFactor * options.zoomX);\n\t\tif (options.zoomY) currentScale.setY(this.scaleYFactor * options.zoomY);\n\t}\n\n\tprotected onSegmentsAnimate(trendSegments: TrendSegments) {\n\t\tfor (let segmentId of trendSegments.animatedSegmentsIds) {\n\t\t\tif (!this.candles[segmentId]) continue;\n\t\t\tlet segmentState = trendSegments.segmentsById[segmentId].currentAnimationState;\n\t\t\tthis.setupCandle(segmentId, segmentState);\n\t\t}\n\t}\n\n\t/**\n\t * create or modify candle\n\t */\n\tprivate setupCandle(candleId: number, segmentState: ITrendSegmentState) {\n\t\tlet candleInd = candleId % MAX_CANDLES;\n\n\t\t// get candle from candlesPool to avoid creating new Objects by performance reasons\n\t\tlet candle = this.candlesPool[candleInd];\n\t\tif (!candle) {\n\t\t\tcandle = this.candlesPool[candleInd] = new CandleWidget();\n\t\t}\n\n\t\tif (!this.candles[candleId]) {\n\t\t\tthis.candles[candleId] = candle;\n\t\t\tthis.object3D.add(candle.getObject3D());\n\t\t}\n\t\tcandle.getObject3D().position.set(this.toLocalX(segmentState.xVal), this.toLocalY(segmentState.yVal), 0);\n\t\tcandle.setSegment(segmentState);\n\t}\n\n\ttoLocalX(xVal: number): number {\n\t\treturn xVal - this.chartState.data.xAxis.range.zeroVal;\n\t}\n\n\ttoLocalY(yVal: number): number {\n\t\treturn yVal - this.chartState.data.yAxis.range.zeroVal;\n\t}\n\n\ttoLocalVec(vec: Vector3): Vector3 {\n\t\treturn new Vector3(this.toLocalX(vec.x), this.toLocalY(vec.y), 0);\n\t}\n}\n\nclass CandleWidget {\n\tsegment: ITrendSegmentState;\n\tprivate rect: Mesh;\n\tprivate vLine: Line;\n\tprivate hLine: Line;\n\tconstructor () {\n\t\tthis.initObject();\n\t}\n\n\tgetObject3D(): Object3D {\n\t\treturn this.rect;\n\t}\n\n\tsetSegment(segment: ITrendSegmentState) {\n\t\tthis.segment = segment;\n\t\tlet color = segment.endYVal < segment.startYVal ? FALL_COLOR : RISE_COLOR;\n\n\t\t// update rect\n\t\tlet geometry = this.rect.geometry as PlaneGeometry;\n\t\tlet material = this.rect.material as MeshBasicMaterial;\n\t\tlet width = segment.endXVal - segment.startXVal;\n\t\twidth -= width * MARGIN_PERCENT;\n\t\tlet height = Math.max(segment.startYVal, segment.endYVal) - Math.min(segment.startYVal, segment.endYVal);\n\t\tlet [leftTop, rightTop, leftBottom, rightBottom] = geometry.vertices;\n\t\tleftTop.set(-width / 2, height / 2, 0);\n\t\trightTop.set(width / 2, height / 2, 0);\n\t\tleftBottom.set(-width / 2, -height / 2, 0);\n\t\trightBottom.set(width / 2, -height / 2, 0);\n\n\t\t// prevent to draw bars with height < 1px\n\t\tif (Utils.getDistance(leftTop.y, leftBottom.y) < 1) {\n\t\t\tleftBottom.setY(leftBottom.y + 1);\n\t\t\trightBottom.setY(rightBottom.y + 1);\n\t\t}\n\n\t\tmaterial.color.set(color);\n\t\tgeometry.verticesNeedUpdate = true;\n\n\t\t// update lines\n\t\tlet vLineGeometry = this.vLine.geometry as Geometry;\n\t\tlet vLineMaterial = this.vLine.material as LineBasicMaterial;\n\t\tlet lineTop = segment.maxYVal - segment.yVal;\n\t\tlet lineBottom = segment.minYVal - segment.yVal;\n\t\tvLineGeometry.vertices[0].set(0, lineTop, 0);\n\t\tvLineGeometry.vertices[1].set(0, lineBottom, 0);\n\t\tvLineMaterial.color.set(color);\n\t\tvLineGeometry.verticesNeedUpdate = true;\n\n\t\tlet hLineGeometry = this.hLine.geometry as Geometry;\n\t\tlet hLineMaterial = this.hLine.material as LineBasicMaterial;\n\t\tlet lineLeft = (-width) / 2;\n\t\tlet lineRight = width / 2;\n\t\thLineGeometry.vertices[0].set(lineLeft, 0, 0);\n\t\thLineGeometry.vertices[1].set(lineRight, 0, 0);\n\t\thLineMaterial.color.set(color);\n\t\thLineGeometry.verticesNeedUpdate = true;\n\n\t}\n\n\tprivate initObject() {\n\t\tthis.rect = new Mesh(\n\t\t\tnew PlaneGeometry(1, 1),\n\t\t\tnew MeshBasicMaterial()\n\t\t);\n\t\tlet vLineGeometry = new Geometry();\n\t\tlet hLineGeometry = new Geometry();\n\t\tvLineGeometry.vertices.push(new Vector3(), new Vector3);\n\t\thLineGeometry.vertices.push(new Vector3(), new Vector3);\n\t\tthis.vLine = new Line(vLineGeometry, new LineBasicMaterial({linewidth: 1}));\n\t\tthis.hLine = new Line(hLineGeometry, new LineBasicMaterial({linewidth: 1}));\n\t\tthis.rect.add(this.vLine);\n\t\tthis.rect.add(this.hLine);\n\t}\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/TrendsCandleWidget.ts\n **/","\nimport Object3D = THREE.Object3D;\nimport { ChartState, IChartState } from \"../State\";\nimport {Utils} from \"../Utils\";\nimport Mesh = THREE.Mesh;\nimport PlaneBufferGeometry = THREE.PlaneBufferGeometry;\nimport MeshBasicMaterial = THREE.MeshBasicMaterial;\nimport Vector3 = THREE.Vector3;\nimport {TrendWidget, TrendsWidget} from \"./TrendsWidget\";\nimport { ITrendOptions, TREND_TYPE } from \"../Trend\";\nimport {TrendSegments, TrendSegment} from \"../TrendSegments.ts\";\nimport chartreuse = THREE.ColorKeywords.chartreuse;\n\n/**\n * widget adds blinking beacon on trends end\n * activated when trend.hasBeacon = true\n */\nexport class TrendsBeaconWidget extends TrendsWidget<TrendBeacon> {\n\tstatic widgetName = 'TrendsBeacon';\n\tprotected getTrendWidgetClass() {\n\t\treturn TrendBeacon;\n\t}\n}\n\nexport class TrendBeacon extends TrendWidget {\n\tprivate mesh: Mesh;\n\tprivate animated: boolean;\n\tprivate segment: TrendSegment;\n\tprivate animation: TweenLite;\n\n\tstatic widgetIsEnabled(trendOptions: ITrendOptions) {\n\t\treturn trendOptions.enabled && trendOptions.hasBeacon && trendOptions.type == TREND_TYPE.LINE;\n\t}\n\n\tconstructor(state: ChartState, trendName: string) {\n\t\tsuper(state, trendName);\n\n\t\tthis.initObject();\n\t\tif (state.data.animations.enabled) {\n\t\t\tthis.animate();\n\t\t}\n\t\tthis.updatePosition();\n\t}\n\n\tgetObject3D() {\n\t\treturn this.mesh;\n\t}\n\n\tonTrendChange() {\n\t\tthis.updatePosition();\n\t}\n\n\tprotected bindEvents() {\n\t\tsuper.bindEvents();\n\t\tthis.bindEvent(this.chartState.onScroll(() => this.updatePosition()));\n\t\tthis.bindEvent(this.chartState.onChange(changedProps => this.onStateChange(changedProps)));\n\t\tthis.bindEvent(this.chartState.onDestroy(() => this.stopAnimation()));\n\t}\n\n\tprivate initObject() {\n\t\t\n\t\t// add beacon\n\t\tlet light = this.mesh = new Mesh(\n\t\t\tnew PlaneBufferGeometry(32, 32),\n\t\t\tnew MeshBasicMaterial({map: TrendBeacon.createTexture(), transparent: true})\n\t\t);\n\n\n\t\tlight.scale.set(0.2, 0.2, 1);\n\n\t\t// add dot\n\t\tlight.add(new Mesh(\n\t\t\tnew PlaneBufferGeometry(5, 5),\n\t\t\tnew MeshBasicMaterial({map: TrendBeacon.createTexture()})\n\t\t));\n\n\t\tthis.segment = this.trend.segments.getEndSegment();\n\t}\n\n\tprivate animate() {\n\t\tthis.animated = true;\n\t\tvar object = this.mesh;\n\t\tvar animationObject = {\n\t\t\tscale: object.scale.x,\n\t\t\topacity: object.material.opacity\n\t\t};\n\n\n\t\tthis.mesh.scale.set(0.1, 0.1, 1);\n\n\t\tsetTimeout(() => {\n\t\t\tvar animation = this.animation = TweenLite.to(\n\t\t\t\tanimationObject,\n\t\t\t\t1,\n\t\t\t\t{scale: 1, opacity: 0}\n\t\t\t);\n\t\t\tanimation.eventCallback('onUpdate', () => {\n\t\t\t\tobject.scale.set(animationObject.scale, animationObject.scale, 1);\n\t\t\t\tobject.material.opacity = animationObject.opacity\n\t\t\t}).eventCallback('onComplete', () => {\n\t\t\t\tthis.animation && animation.restart();\n\t\t\t});\n\t\t}, 500);\n\t\n\t}\n\n\tprivate stopAnimation() {\n\t\tthis.animated = false;\n\t\tthis.animation && this.animation.kill();\n\t\tthis.animation = null;\n\t}\n\n\tprivate static createTexture() {\n\t\tvar h = 32, w = 32;\n\t\treturn Utils.createTexture(h, w, (ctx: CanvasRenderingContext2D) => {\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(w / 2, h / 2, w / 2, 0, 2 * Math.PI, false);\n\t\t\tctx.fillStyle = 'white';\n\t\t\tctx.fill();\n\t\t});\n\t}\n\n\tprotected onTransformationFrame() {\n\t\tthis.segment = this.trend.segments.getEndSegment();\n\t\tthis.updatePosition();\n\t}\n\n\tprotected onSegmentsAnimate(trendsSegments: TrendSegments) {\n\t\tthis.segment = trendsSegments.getEndSegment();\n\t\tthis.updatePosition();\n\t}\n\n\tprivate onStateChange(changedProps: IChartState) {\n\t\tif (!changedProps.animations) return;\n\t\tif (changedProps.animations.enabled == void 0 || changedProps.animations.enabled == this.animated) return;\n\t\tif (changedProps.animations.enabled) {\n\t\t\tthis.animate();\n\t\t} else {\n\t\t\tthis.stopAnimation();\n\t\t}\n\t}\n\n\tprivate updatePosition() {\n\t\tvar state = this.chartState;\n\t\tvar xVal: number, yVal: number;\n\t\tvar currentAnimationState =  this.segment.currentAnimationState;\n\t\tif (this.trend.getOptions().type == TREND_TYPE.LINE) {\n\t\t\txVal = currentAnimationState.endXVal;\n\t\t\tyVal = currentAnimationState.endYVal;\n\t\t} else {\n\t\t\txVal = currentAnimationState.xVal;\n\t\t\tyVal = currentAnimationState.endYVal;\n\t\t}\n\t\tvar endPointVector = state.screen.getPointOnChart(xVal, yVal);\n\t\tvar screenWidth = state.data.width;\n\t\tvar x = endPointVector.x;\n\t\tvar screenX = state.screen.getScreenXByPoint(endPointVector.x);\n\t\tif (screenX < 0) x = state.screen.getPointByScreenX(0);\n\t\tif (screenX > screenWidth) x = state.screen.getPointByScreenX(screenWidth);\n\t\tthis.mesh.position.set(x, endPointVector.y, 0.1);\n\t}\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/widgets/TrendsBeaconWidget.ts\n **/","export * from './deps'\n\n\n/** WEBPACK FOOTER **\n ** ./src/deps/index.ts\n **/","import { ChartState, IChartState } from \"./State\";\nimport { Utils } from './Utils';\nimport { EventEmitter } from './EventEmmiter';\nimport { ChartWidget } from './Widget';\n\nexport interface IChartPluginState {\n}\n\nexport interface IChartPluginConfig {\n\tinstallPluginWidgets?: boolean;\n}\n\nexport const DEFAULT_CONFIG: IChartPluginConfig = {\n\tinstallPluginWidgets: true\n};\n\n/**\n * base class for all plugins\n * NAME is mandatory\n */\nexport abstract class ChartPlugin {\n\tstatic NAME: string = '';\n\tstatic pluginWidgets: typeof ChartWidget[] = [];\n\n\tinitialState: IChartPluginState;\n\tconfig: IChartPluginConfig;\n\tname: string;\n\tprotected chartState: ChartState;\n\tprotected unsubscribers: Function[] = [];\n\tprotected ee: EventEmitter;\n\n\tconstructor (options?: IChartPluginState, config: IChartPluginConfig = {}) {\n\t\tthis.initialState = options;\n\t\tthis.config = Utils.deepMerge(DEFAULT_CONFIG, config);\n\t\tthis.name = (this.constructor as typeof ChartPlugin).NAME;\n\t\tif (!this.name) Utils.error('Unnamed plugin detected');\n\t}\n\n\tsetupChartState(chartState: ChartState) {\n\t\tthis.chartState = chartState;\n\t\tthis.ee = new EventEmitter();\n\t\tthis.bindEvent(\n\t\t\tthis.chartState.onInitialStateApplied(initialState => this.onInitialStateAppliedHandler(initialState)),\n\t\t\tthis.chartState.onReady(() => this.onChartReadyHandler()),\n\t\t\tthis.chartState.onDestroy(() => this.onDestroyHandler()),\n\t\t\tthis.chartState.onPluginsStateChange(changedPluginsStates => changedPluginsStates[this.name] && this.onStateChanged(changedPluginsStates[this.name]))\n\t\t)\n\t}\n\n\tgetOptions(): IChartPluginState {\n\t\treturn this.chartState.data.pluginsState[this.name];\n\t}\n\n\tprotected onInitialStateAppliedHandler(initialState: IChartState) {\n\t}\n\n\tprotected onChartReadyHandler() {\n\t}\n\n\tprotected onStateChanged(changedState: IChartPluginState) {\n\t}\n\n\tprotected onDestroyHandler() {\n\t\tthis.ee.removeAllListeners();\n\t}\n\n\tprotected bindEvent(...args: Array<Function | Function[]>): void {\n\t\tlet unsubscribers: Function[] = [];\n\t\tif (!Array.isArray(args[0])) {\n\t\t\tunsubscribers.push(args[0] as Function);\n\t\t} else {\n\t\t\tunsubscribers.push(...args as Function[]);\n\t\t}\n\t\tthis.unsubscribers.push(...unsubscribers);\n\t}\n\n\n\tprotected unbindEvents() {\n\t\tthis.unsubscribers.forEach(unsubscriber => unsubscriber());\n\t\tthis.unsubscribers.length = 0;\n\t}\n}\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/Plugin.ts\n **/"],"sourceRoot":""}